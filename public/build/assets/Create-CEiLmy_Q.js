import{d as G,E as R,p as v,c as O,o as p,w as l,a as r,b as i,u as n,g as J,G as W,h as u,e as y,f as b,t as f,x as V,y as C,F as X,r as Z,S as tt}from"./app-BJGGIgA8.js";import{_ as x}from"./index-riohrRak.js";import{_ as S}from"./Select.vue_vue_type_script_setup_true_lang-CVoDpg_u.js";import{_ as T}from"./SearchSelect.vue_vue_type_script_setup_true_lang-DjNxBFPF.js";import{_ as et}from"./AppLayout.vue_vue_type_script_setup_true_lang-6OmCq4tp.js";import{_ as w,a as I}from"./CardContent.vue_vue_type_script_setup_true_lang-DPB8yWHX.js";import{_ as P,a as U}from"./CardTitle.vue_vue_type_script_setup_true_lang-DvxTgNYv.js";import{_ as rt}from"./CardFooter.vue_vue_type_script_setup_true_lang-viGH8JM8.js";import{_ as c}from"./Label.vue_vue_type_script_setup_true_lang-bOJZE9lv.js";import{S as k}from"./sweetalert2.esm.all-BQIkj5Wb.js";import{_}from"./InputError.vue_vue_type_script_setup_true_lang-YNpV2x5o.js";import{T as ot}from"./trash-2-DcMzLwyY.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-MrJHOVsW.js";import"./useForwardPropsEmits-CZzI8B5e.js";import"./Teleport-MSIji786.js";import"./RovingFocusGroup-gSG5KO_4.js";import"./chevron-down-B83M1Caq.js";import"./Input.vue_vue_type_script_setup_true_lang-o7QhFVaq.js";import"./LocationInput.vue_vue_type_style_index_0_scoped_85568d9b_lang-CX_goT8l.js";import"./search-BUl39vHB.js";import"./x-BjkU5bBK.js";import"./VisuallyHidden-BC0AEIfW.js";import"./DialogPortal-Dpb7jdpY.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-DSD56j4j.js";import"./chevron-right-CjvrEjDl.js";const st={key:0,class:"mt-2 p-3 bg-orange-50 dark:bg-orange-950/20 border border-orange-200 dark:border-orange-800 rounded-md"},it={class:"text-sm text-orange-800 dark:text-orange-200"},dt={class:"text-sm text-orange-700 dark:text-orange-300 mt-1"},nt={class:"font-semibold"},lt={key:0},at={class:"flex justify-between items-center"},ut={class:"space-y-3"},mt={class:"flex justify-between items-center mb-3"},ct={class:"font-medium text-sm"},pt={class:"grid grid-cols-1 md:grid-cols-4 gap-3"},ft=["id","onUpdate:modelValue","max","onInput"],_t={key:0,class:"text-[11px] text-gray-500 mt-1"},yt={class:"w-full rounded-md border border-input bg-transparent px-2 py-1 mt-1 text-sm text-foreground dark:bg-input/30 h-8 flex items-center"},gt={class:"mt-4 pt-3 border-t"},vt={class:"flex justify-end"},bt={class:"text-right"},xt={class:"text-base font-medium"},h=500,Yt=G({__name:"Create",props:{customer_id:{},products:{},categories:{default:()=>[]}},setup(j){const m=j,o=R({customer_id:m.customer_id,delivery_type:"delivery",payment_method:"cash",credit_term_days:null,notes:"",order_items:[{category_id:null,product_id:null,quantity:1}]}),A=[{title:"Orders",href:"/orders"},{title:"Create Order",href:"/orders/create"}],g=v(()=>o.order_items.reduce((s,t)=>{if(t.product_id&&t.quantity){const e=m.products.find(d=>d.id===t.product_id);if(e)return s+t.quantity*e.selling_price}return s},0)),$=v(()=>o.delivery_type!=="delivery"?!0:g.value>=h),B=v(()=>!(!o.customer_id||!o.order_items.length||!o.order_items.some(s=>!!s.product_id&&s.quantity>0)||!$.value));function F(){o.order_items.push({category_id:null,product_id:null,quantity:1})}function M(s){o.order_items.length>1&&o.order_items.splice(s,1)}function D(s){const t=o.order_items[s];t.product_id=null}function N(s){const t=o.order_items[s];if(t.product_id&&t.quantity){const e=m.products.find(d=>d.id===t.product_id);e&&t.quantity>e.stock&&(t.quantity=e.stock,k.fire({icon:"info",title:"Quantity Adjusted",text:`Quantity for "${e.name}" has been adjusted to the maximum available stock (${e.stock} units).`,confirmButtonText:"OK",toast:!0,position:"top-end",timer:3e3,timerProgressBar:!0}))}}function Q(s){const t=o.order_items[s];if(t.product_id&&t.quantity){const e=m.products.find(d=>d.id===t.product_id);e&&t.quantity>e.stock&&(t.quantity=e.stock,k.fire({icon:"info",title:"Quantity Adjusted",text:`Quantity for "${e.name}" has been adjusted to the maximum available stock (${e.stock} units).`,confirmButtonText:"OK",toast:!0,position:"top-end",timer:3e3,timerProgressBar:!0}))}}function E(){for(let s=0;s<o.order_items.length;s++){const t=o.order_items[s];if(t.product_id&&t.quantity){const e=m.products.find(d=>d.id===t.product_id);e&&t.quantity>e.stock&&(t.quantity=e.stock,k.fire({icon:"warning",title:"Quantity Auto-Adjusted",text:`Quantity for "${e.name}" was automatically adjusted to ${e.stock} units due to stock limitations.`,confirmButtonText:"OK"}))}}o.post(route("orders.store"),{preserveScroll:!0,onSuccess:()=>{k.fire({toast:!0,position:"top-end",icon:"success",title:"Order created successfully",text:"Your order is pending approval from staff.",showConfirmButton:!1,timer:3e3,timerProgressBar:!0})}})}function q(s){return o.errors[s]}function K(s){return new Intl.NumberFormat("en-PH",{style:"currency",currency:"PHP",minimumFractionDigits:2}).format(s)}const H=[{value:"cash",label:"Cash"},{value:"credit",label:"Credit"}],L=v(()=>[{value:null,label:"Select category"},...(m.categories||[]).map(s=>({value:s.id,label:s.name}))]);function Y(s){const t=o.order_items[s],e=m.products||[],d=t.category_id?e.filter(a=>a.category_id===t.category_id):e;return[{value:null,label:"Select product"},...d.map(a=>({value:a.id,label:a.name,description:`${K(a.selling_price)}/${a.unit.toUpperCase()} • Stock: ${a.stock}`}))]}function z(s){const t=o.order_items[s];if(t.product_id&&t.quantity){const e=m.products.find(d=>d.id===t.product_id);if(e)return t.quantity*e.selling_price}return 0}return(s,t)=>(p(),O(et,{breadcrumbs:A},{default:l(()=>[r(n(J),{title:"Create Order"}),t[21]||(t[21]=i("div",{class:"flex items-center justify-between mb-6"},[i("h1",{class:"text-2xl font-bold"},"Create Order")],-1)),i("form",{onSubmit:t[4]||(t[4]=W(e=>E(),["prevent"])),class:"space-y-6"},[r(w,null,{default:l(()=>[r(P,null,{default:l(()=>[r(U,null,{default:l(()=>t[5]||(t[5]=[u("Order Details")])),_:1,__:[5]})]),_:1}),r(I,{class:"space-y-6"},{default:l(()=>[i("div",null,[r(c,{for:"delivery_type"},{default:l(()=>t[6]||(t[6]=[u("Delivery Type *")])),_:1,__:[6]}),r(n(S),{id:"delivery_type",modelValue:n(o).delivery_type,"onUpdate:modelValue":t[0]||(t[0]=e=>n(o).delivery_type=e),options:[{value:"pickup",label:"Pickup"},{value:"delivery",label:"Delivery"}],class:"mt-1",required:""},null,8,["modelValue"]),r(_,{message:n(o).errors.delivery_type},null,8,["message"]),n(o).delivery_type==="delivery"&&!$.value?(p(),y("div",st,[i("p",it,[t[7]||(t[7]=i("strong",null,"Minimum order amount for delivery:",-1)),u(" ₱"+f(h.toFixed(2)),1)]),i("p",dt,[u(" Current total: ₱"+f(g.value.toFixed(2))+". ",1),i("span",nt,"Add ₱"+f((h-g.value).toFixed(2))+" more to proceed with delivery.",1)])])):b("",!0)]),i("div",null,[r(c,{for:"payment_method"},{default:l(()=>t[8]||(t[8]=[u("Payment Method *")])),_:1,__:[8]}),r(n(S),{id:"payment_method",modelValue:n(o).payment_method,"onUpdate:modelValue":t[1]||(t[1]=e=>n(o).payment_method=e),options:H,class:"mt-1",required:""},null,8,["modelValue"]),r(_,{message:n(o).errors.payment_method},null,8,["message"])]),n(o).payment_method==="credit"?(p(),y("div",lt,[r(c,{for:"credit_term_days"},{default:l(()=>t[9]||(t[9]=[u("Credit Term (Days)")])),_:1,__:[9]}),V(i("input",{"onUpdate:modelValue":t[2]||(t[2]=e=>n(o).credit_term_days=e),type:"number",id:"credit_term_days",min:"0",max:"365",class:"mt-1 block w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",placeholder:"e.g., 30"},null,512),[[C,n(o).credit_term_days,void 0,{number:!0}]]),t[10]||(t[10]=i("div",{class:"text-[11px] text-gray-500 mt-1"}," Number of days until payment is due (default: 30 days). ",-1)),r(_,{message:n(o).errors.credit_term_days},null,8,["message"])])):b("",!0),i("div",null,[r(c,{for:"notes"},{default:l(()=>t[11]||(t[11]=[u("Notes (Optional)")])),_:1,__:[11]}),V(i("textarea",{id:"notes","onUpdate:modelValue":t[3]||(t[3]=e=>n(o).notes=e),class:"w-full rounded-md border border-input bg-transparent px-3 py-2 mt-1 text-foreground dark:bg-input/30 focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] focus-visible:outline-none",rows:"3",placeholder:"Add any special instructions or notes for your order..."},null,512),[[C,n(o).notes]]),r(_,{message:n(o).errors.notes},null,8,["message"])])]),_:1})]),_:1}),r(w,null,{default:l(()=>[r(P,null,{default:l(()=>[i("div",at,[r(U,null,{default:l(()=>t[12]||(t[12]=[u("Order Items")])),_:1,__:[12]}),r(n(x),{type:"button",variant:"outline",onClick:F},{default:l(()=>t[13]||(t[13]=[i("span",{class:"mr-2"},"+",-1),u(" Add Item ")])),_:1,__:[13]})])]),_:1}),r(I,null,{default:l(()=>[i("div",ut,[(p(!0),y(X,null,Z(n(o).order_items,(e,d)=>(p(),y("div",{key:d,class:"border rounded-md p-3"},[i("div",mt,[i("h4",ct,"Item "+f(d+1),1),n(o).order_items.length>1?(p(),O(n(x),{key:0,type:"button",variant:"ghost",size:"sm",class:"h-7 w-7 p-0 text-red-500 hover:text-red-600 hover:bg-red-50 dark:hover:bg-red-950/20",onClick:a=>M(d)},{default:l(()=>[r(n(ot),{class:"h-4 w-4"})]),_:2},1032,["onClick"])):b("",!0)]),i("div",pt,[i("div",null,[r(c,{for:`category_id_${d}`,class:"text-xs"},{default:l(()=>t[14]||(t[14]=[u("Category")])),_:2,__:[14]},1032,["for"]),r(n(T),{modelValue:e.category_id,"onUpdate:modelValue":[a=>e.category_id=a,a=>D(d)],options:L.value,placeholder:"Select category","search-placeholder":"Search categories...",class:"mt-1 h-8"},null,8,["modelValue","onUpdate:modelValue","options"]),r(_,{message:q(`order_items.${d}.category_id`)},null,8,["message"])]),i("div",null,[r(c,{for:`product_id_${d}`,class:"text-xs"},{default:l(()=>t[15]||(t[15]=[u("Product *")])),_:2,__:[15]},1032,["for"]),r(n(T),{modelValue:e.product_id,"onUpdate:modelValue":[a=>e.product_id=a,a=>N(d)],options:Y(d),placeholder:"Select product","search-placeholder":"Search products...",class:"mt-1 h-8",required:""},null,8,["modelValue","onUpdate:modelValue","options"]),r(_,{message:q(`order_items.${d}.product_id`)},null,8,["message"])]),i("div",null,[r(c,{for:`quantity_${d}`,class:"text-xs"},{default:l(()=>t[16]||(t[16]=[u("Quantity *")])),_:2,__:[16]},1032,["for"]),V(i("input",{id:`quantity_${d}`,"onUpdate:modelValue":a=>e.quantity=a,type:"number",min:"1",max:e.product_id?(m.products.find(a=>a.id===e.product_id)||{stock:0}).stock:void 0,class:"w-full rounded-md border border-input bg-transparent px-2 py-1 mt-1 text-sm text-foreground dark:bg-input/30 focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] focus-visible:outline-none h-8",onInput:a=>Q(d),required:""},null,40,ft),[[C,e.quantity,void 0,{number:!0}]]),e.product_id?(p(),y("div",_t," In stock: "+f((m.products.find(a=>a.id===e.product_id)||{stock:0}).stock),1)):b("",!0),r(_,{message:q(`order_items.${d}.quantity`)},null,8,["message"])]),i("div",null,[r(c,{class:"text-xs"},{default:l(()=>t[17]||(t[17]=[u("Total")])),_:1,__:[17]}),i("div",yt," ₱"+f(z(d).toFixed(2)),1)])])]))),128))]),i("div",gt,[i("div",vt,[i("div",bt,[i("div",xt,"Total Amount: ₱"+f(g.value.toFixed(2)),1),t[18]||(t[18]=i("div",{class:"text-xs text-muted-foreground mt-1"},"12% VAT is included in price",-1))])])])]),_:1})]),_:1}),r(w,null,{default:l(()=>[r(rt,{class:"flex gap-2 justify-end"},{default:l(()=>[r(n(x),{type:"submit",disabled:!B.value,variant:"default",title:$.value?"":`Minimum order amount for delivery is ₱${h.toFixed(2)}`},{default:l(()=>t[19]||(t[19]=[u(" Submit Order ")])),_:1,__:[19]},8,["disabled","title"]),r(n(tt),{href:s.route("orders.index")},{default:l(()=>[r(n(x),{type:"button",variant:"ghost"},{default:l(()=>t[20]||(t[20]=[u("Cancel")])),_:1,__:[20]})]),_:1},8,["href"])]),_:1})]),_:1})],32)]),_:1,__:[21]}))}});export{Yt as default};
