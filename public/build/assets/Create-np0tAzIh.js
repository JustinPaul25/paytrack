import{d as R,D as X,p as g,c as q,o as f,w as n,a as t,b as r,u as l,g as Y,E as Z,e as u,f as y,h as C,x as b,y as x,F as ee,r as te,t as $,S as oe}from"./app-DLGUJSur.js";import{_ as k}from"./index-CbeL7bQp.js";import{_ as V}from"./Select.vue_vue_type_script_setup_true_lang-BmMAiM-x.js";import{_ as h}from"./SearchSelect.vue_vue_type_script_setup_true_lang-DODuTYTX.js";import{_ as ie}from"./AppLayout.vue_vue_type_script_setup_true_lang-TGItx7cK.js";import{_ as w,a as S}from"./CardContent.vue_vue_type_script_setup_true_lang-DGEoivaK.js";import{_ as P,a as U}from"./CardTitle.vue_vue_type_script_setup_true_lang-CA3flqiV.js";import{_ as se}from"./CardFooter.vue_vue_type_script_setup_true_lang-ArF0VZWS.js";import{_ as m}from"./Label.vue_vue_type_script_setup_true_lang-s53qzNoi.js";import{S as I}from"./sweetalert2.esm.all-BQIkj5Wb.js";import{_ as c}from"./InputError.vue_vue_type_script_setup_true_lang-Biwlb9eG.js";import{T as re}from"./trash-2-C3BXaGst.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-0k-ecodo.js";import"./createLucideIcon-DFeQ1_P7.js";import"./RovingFocusGroup-B2V0LqPJ.js";import"./LocationInput.vue_vue_type_style_index_0_scoped_0fe2f881_lang-fGrSInQY.js";import"./Input.vue_vue_type_script_setup_true_lang-BhSvFCK4.js";import"./search-DX6CV7Ks.js";import"./VisuallyHidden-e3nHpJ_I.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-CCqgexjF.js";import"./chevron-right-BFHvTSNm.js";const le={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ne={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ae={key:0,class:"grid grid-cols-1 md:grid-cols-2 gap-4"},de={class:"flex justify-between items-center"},ue={class:"space-y-3"},me={class:"flex justify-between items-center mb-3"},ce={class:"font-medium text-sm"},pe={class:"grid grid-cols-1 md:grid-cols-5 gap-3"},fe=["id","onUpdate:modelValue","onInput"],_e={key:0,class:"text-[11px] text-gray-500 mt-1"},ve=["id","onUpdate:modelValue","onInput"],ge={class:"w-full rounded-md border border-input bg-transparent px-2 py-1 mt-1 text-sm text-foreground dark:bg-input/30 h-8 flex items-center"},ye={class:"mt-4 pt-3 border-t"},be={class:"flex justify-end"},xe={class:"text-right"},$e={class:"text-base font-medium"},He=R({__name:"Create",props:{customers:{},products:{},categories:{default:()=>[]}},setup(T){const p=T,s=X({customer_id:null,status:"draft",payment_method:"cash",invoice_type:"walk_in",credit_term_days:null,notes:"",invoice_items:[{category_id:null,product_id:null,quantity:1,price:0,total:0}]}),D=[{title:"Invoices",href:"/invoices"},{title:"Create Invoice",href:"/invoices/create"}],j=g(()=>s.invoice_items.reduce((i,e)=>i+e.total,0)),B=g(()=>!s.customer_id||!s.invoice_items.length?!1:s.invoice_items.some(i=>!!i.product_id&&i.quantity>0&&i.price>=0));function O(){s.invoice_items.push({category_id:null,product_id:null,quantity:1,price:0,total:0})}function A(i){s.invoice_items.length>1&&s.invoice_items.splice(i,1)}function _(i){const e=s.invoice_items[i];e.product_id&&e.quantity&&e.price?e.total=e.quantity*e.price:e.total=0}function F(i){const e=s.invoice_items[i];e.product_id=null,e.price=0,e.total=0}function N(i){const e=s.invoice_items[i];if(e.product_id){const o=p.products.find(a=>a.id===e.product_id);o&&(e.price=o.selling_price,_(i))}}function Q(i){const e=s.invoice_items[i];if(e.product_id&&e.quantity){const o=p.products.find(a=>a.id===e.product_id);o&&e.quantity>o.stock&&(e.quantity=o.stock,I.fire({icon:"info",title:"Quantity Adjusted",text:`Quantity for "${o.name}" has been adjusted to the maximum available stock (${o.stock} units).`,confirmButtonText:"OK",toast:!0,position:"top-end",timer:3e3,timerProgressBar:!0}))}_(i)}function M(i){_(i)}function E(){for(let i=0;i<s.invoice_items.length;i++){const e=s.invoice_items[i];if(e.product_id&&e.quantity){const o=p.products.find(a=>a.id===e.product_id);o&&e.quantity>o.stock&&(e.quantity=o.stock,_(i),I.fire({icon:"warning",title:"Quantity Auto-Adjusted",text:`Quantity for "${o.name}" was automatically adjusted to ${o.stock} units due to stock limitations.`,confirmButtonText:"OK"}))}}s.post(route("invoices.store"),{preserveScroll:!0,onSuccess:()=>{I.fire({toast:!0,position:"top-end",icon:"success",title:"Invoice created successfully",showConfirmButton:!1,timer:3e3,timerProgressBar:!0})}})}function v(i){return s.errors[i]}const H=g(()=>[{value:null,label:"Select customer"},...p.customers.map(i=>({value:i.id,label:`${i.name}${i.company_name?` (${i.company_name})`:""}`}))]),K=[{value:"draft",label:"Draft"},{value:"pending",label:"Pending"},{value:"completed",label:"Completed"},{value:"cancelled",label:"Cancelled"}],W=[{value:"cash",label:"Cash"},{value:"credit",label:"Credit"}],z=[{value:"walk_in",label:"Walk-in"},{value:"delivery",label:"Delivery"}];function L(i){return new Intl.NumberFormat("en-PH",{style:"currency",currency:"PHP",minimumFractionDigits:2}).format(i)}const G=g(()=>[{value:null,label:"Select category"},...(p.categories||[]).map(i=>({value:i.id,label:i.name}))]);function J(i){const e=s.invoice_items[i],o=p.products||[],a=e.category_id?o.filter(d=>d.category_id===e.category_id):o;return[{value:null,label:"Select product"},...a.map(d=>({value:d.id,label:d.name,description:`${L(d.selling_price)}/${d.unit.toUpperCase()} • Stock: ${d.stock}`}))]}return(i,e)=>(f(),q(ie,{breadcrumbs:D},{default:n(()=>[t(l(Y),{title:"Create Invoice"}),e[28]||(e[28]=r("div",{class:"flex items-center justify-between mb-6"},[r("h1",{class:"text-2xl font-bold"},"Create Invoice")],-1)),r("form",{onSubmit:e[6]||(e[6]=Z(o=>E(),["prevent"])),class:"space-y-6"},[t(w,null,{default:n(()=>[t(P,null,{default:n(()=>[t(U,null,{default:n(()=>e[7]||(e[7]=[u("Invoice Details")])),_:1,__:[7]})]),_:1}),t(S,{class:"space-y-6"},{default:n(()=>[r("div",le,[r("div",null,[t(m,{for:"customer_id"},{default:n(()=>e[8]||(e[8]=[u("Customer")])),_:1,__:[8]}),t(l(h),{modelValue:l(s).customer_id,"onUpdate:modelValue":e[0]||(e[0]=o=>l(s).customer_id=o),options:H.value,placeholder:"Select customer","search-placeholder":"Search customers...",class:"mt-1",required:""},null,8,["modelValue","options"]),t(c,{message:l(s).errors.customer_id},null,8,["message"])]),r("div",null,[t(m,{for:"status"},{default:n(()=>e[9]||(e[9]=[u("Status")])),_:1,__:[9]}),t(l(V),{modelValue:l(s).status,"onUpdate:modelValue":e[1]||(e[1]=o=>l(s).status=o),options:K,placeholder:"Select status",class:"mt-1",required:""},null,8,["modelValue"]),e[10]||(e[10]=r("div",{class:"text-[11px] text-gray-500 mt-1"}," Draft: still editing, Pending: awaiting payment, Completed: paid, Cancelled: void. ",-1)),t(c,{message:l(s).errors.status},null,8,["message"])])]),r("div",ne,[r("div",null,[t(m,{for:"payment_method"},{default:n(()=>e[11]||(e[11]=[u("Payment Method")])),_:1,__:[11]}),t(l(V),{modelValue:l(s).payment_method,"onUpdate:modelValue":e[2]||(e[2]=o=>l(s).payment_method=o),options:W,placeholder:"Select payment method",class:"mt-1",required:""},null,8,["modelValue"]),e[12]||(e[12]=r("div",{class:"text-[11px] text-gray-500 mt-1"}," Pick how the customer will pay (Cash or Credit). ",-1)),t(c,{message:l(s).errors.payment_method},null,8,["message"])]),r("div",null,[t(m,{for:"invoice_type"},{default:n(()=>e[13]||(e[13]=[u("Invoice Type")])),_:1,__:[13]}),t(l(V),{modelValue:l(s).invoice_type,"onUpdate:modelValue":e[3]||(e[3]=o=>l(s).invoice_type=o),options:z,placeholder:"Select invoice type",class:"mt-1",required:""},null,8,["modelValue"]),e[14]||(e[14]=r("div",{class:"text-[11px] text-gray-500 mt-1"}," Walk-in: Customer purchases in-store. Delivery: Items will be delivered. ",-1)),t(c,{message:l(s).errors.invoice_type},null,8,["message"])])]),l(s).payment_method==="credit"?(f(),y("div",ae,[r("div",null,[t(m,{for:"credit_term_days"},{default:n(()=>e[15]||(e[15]=[u("Credit Term (Days)")])),_:1,__:[15]}),b(r("input",{"onUpdate:modelValue":e[4]||(e[4]=o=>l(s).credit_term_days=o),type:"number",id:"credit_term_days",min:"0",max:"365",class:"mt-1 block w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",placeholder:"e.g., 30"},null,512),[[x,l(s).credit_term_days,void 0,{number:!0}]]),e[16]||(e[16]=r("div",{class:"text-[11px] text-gray-500 mt-1"}," Number of days until payment is due (default: 30 days). ",-1)),t(c,{message:l(s).errors.credit_term_days},null,8,["message"])])])):C("",!0),r("div",null,[t(m,{for:"notes"},{default:n(()=>e[17]||(e[17]=[u("Notes")])),_:1,__:[17]}),b(r("textarea",{id:"notes","onUpdate:modelValue":e[5]||(e[5]=o=>l(s).notes=o),class:"w-full rounded-md border border-input bg-transparent px-3 py-2 mt-1 text-foreground dark:bg-input/30 focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] focus-visible:outline-none",rows:"3"},null,512),[[x,l(s).notes]]),t(c,{message:l(s).errors.notes},null,8,["message"])])]),_:1})]),_:1}),t(w,null,{default:n(()=>[t(P,null,{default:n(()=>[r("div",de,[t(U,null,{default:n(()=>e[18]||(e[18]=[u("Invoice Items")])),_:1,__:[18]}),t(l(k),{type:"button",variant:"outline",onClick:O},{default:n(()=>e[19]||(e[19]=[r("span",{class:"mr-2"},"+",-1),u(" Add Item ")])),_:1,__:[19]})])]),_:1}),t(S,null,{default:n(()=>[r("div",ue,[(f(!0),y(ee,null,te(l(s).invoice_items,(o,a)=>(f(),y("div",{key:a,class:"border rounded-md p-3"},[r("div",me,[r("h4",ce,"Item "+$(a+1),1),l(s).invoice_items.length>1?(f(),q(l(k),{key:0,type:"button",variant:"ghost",size:"sm",class:"h-7 w-7 p-0 text-red-500 hover:text-red-600 hover:bg-red-50 dark:hover:bg-red-950/20",onClick:d=>A(a)},{default:n(()=>[t(l(re),{class:"h-4 w-4"})]),_:2},1032,["onClick"])):C("",!0)]),r("div",pe,[r("div",null,[t(m,{for:`category_id_${a}`,class:"text-xs"},{default:n(()=>e[20]||(e[20]=[u("Category")])),_:2,__:[20]},1032,["for"]),t(l(h),{modelValue:o.category_id,"onUpdate:modelValue":[d=>o.category_id=d,d=>F(a)],options:G.value,placeholder:"Select category","search-placeholder":"Search categories...",class:"mt-1 h-8"},null,8,["modelValue","onUpdate:modelValue","options"]),t(c,{message:v(`invoice_items.${a}.category_id`)},null,8,["message"])]),r("div",null,[t(m,{for:`product_id_${a}`,class:"text-xs"},{default:n(()=>e[21]||(e[21]=[u("Product")])),_:2,__:[21]},1032,["for"]),t(l(h),{modelValue:o.product_id,"onUpdate:modelValue":[d=>o.product_id=d,d=>N(a)],options:J(a),placeholder:"Select product","search-placeholder":"Search products...",class:"mt-1 h-8",required:""},null,8,["modelValue","onUpdate:modelValue","options"]),t(c,{message:v(`invoice_items.${a}.product_id`)},null,8,["message"])]),r("div",null,[t(m,{for:`quantity_${a}`,class:"text-xs"},{default:n(()=>e[22]||(e[22]=[u("Quantity")])),_:2,__:[22]},1032,["for"]),b(r("input",{id:`quantity_${a}`,"onUpdate:modelValue":d=>o.quantity=d,type:"number",min:"1",class:"w-full rounded-md border border-input bg-transparent px-2 py-1 mt-1 text-sm text-foreground dark:bg-input/30 focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] focus-visible:outline-none h-8",onInput:d=>Q(a),required:""},null,40,fe),[[x,o.quantity,void 0,{number:!0}]]),o.product_id?(f(),y("div",_e," In stock: "+$((p.products.find(d=>d.id===o.product_id)||{stock:0}).stock),1)):C("",!0),t(c,{message:v(`invoice_items.${a}.quantity`)},null,8,["message"])]),r("div",null,[t(m,{for:`price_${a}`,class:"text-xs"},{default:n(()=>e[23]||(e[23]=[u("Price")])),_:2,__:[23]},1032,["for"]),b(r("input",{id:`price_${a}`,"onUpdate:modelValue":d=>o.price=d,type:"number",min:"0",step:"0.01",class:"w-full rounded-md border border-input bg-transparent px-2 py-1 mt-1 text-sm text-foreground dark:bg-input/30 focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] focus-visible:outline-none h-8",onInput:d=>M(a),required:""},null,40,ve),[[x,o.price,void 0,{number:!0}]]),t(c,{message:v(`invoice_items.${a}.price`)},null,8,["message"])]),r("div",null,[t(m,{class:"text-xs"},{default:n(()=>e[24]||(e[24]=[u("Total")])),_:1,__:[24]}),r("div",ge," ₱"+$(o.total.toFixed(2)),1)])])]))),128))]),r("div",ye,[r("div",be,[r("div",xe,[r("div",$e,"Total Amount: ₱"+$(j.value.toFixed(2)),1),e[25]||(e[25]=r("div",{class:"text-xs text-muted-foreground mt-1"},"12% VAT is included in price",-1))])])])]),_:1})]),_:1}),t(w,null,{default:n(()=>[t(se,{class:"flex gap-2 justify-end"},{default:n(()=>[t(l(k),{type:"submit",disabled:!B.value,variant:"default"},{default:n(()=>e[26]||(e[26]=[u("Create Invoice")])),_:1,__:[26]},8,["disabled"]),t(l(oe),{href:i.route("invoices.index")},{default:n(()=>[t(l(k),{type:"button",variant:"ghost"},{default:n(()=>e[27]||(e[27]=[u("Cancel")])),_:1,__:[27]})]),_:1},8,["href"])]),_:1})]),_:1})],32)]),_:1,__:[28]}))}});export{He as default};
