import{d as H,m as U,E as z,a5 as Q,p as D,c as W,o as v,w as i,a as o,b as e,u as m,g as G,S as Y,h as y,t as b,e as x,F as B,r as F,G as J,x as I,y as L,f as $,bL as K}from"./app-BJGGIgA8.js";import{_ as X}from"./AppLayout.vue_vue_type_script_setup_true_lang-6OmCq4tp.js";import{_ as h,a as k}from"./CardContent.vue_vue_type_script_setup_true_lang-DPB8yWHX.js";import{_ as q,a as w}from"./CardTitle.vue_vue_type_script_setup_true_lang-DvxTgNYv.js";import{_ as M}from"./index-riohrRak.js";import"./LocationInput.vue_vue_type_style_index_0_scoped_85568d9b_lang-CX_goT8l.js";import"./useForwardPropsEmits-CZzI8B5e.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-MrJHOVsW.js";import"./Teleport-MSIji786.js";import"./RovingFocusGroup-gSG5KO_4.js";import"./VisuallyHidden-BC0AEIfW.js";import"./DialogPortal-Dpb7jdpY.js";import"./x-BjkU5bBK.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-DSD56j4j.js";import"./chevron-down-B83M1Caq.js";import"./chevron-right-CjvrEjDl.js";const Z={class:"flex items-center justify-between my-6"},ee={class:"flex gap-2"},te={class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},se={class:"lg:col-span-2 space-y-6"},le={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ie={class:"font-semibold"},oe={class:"space-y-4"},ae={class:"min-w-full divide-y divide-border"},ne={class:"px-4 py-2"},re={class:"font-medium"},ue={class:"px-4 py-2"},de={class:"px-4 py-2"},me={class:"px-4 py-2"},ce=["max","value","onInput","onBlur"],pe={class:"border-t"},fe={class:"px-4 py-2 font-semibold"},ge={class:"space-y-4"},ve={key:0,class:"mt-3 grid grid-cols-2 md:grid-cols-3 gap-2"},ye=["src"],be=["onClick"],xe={class:"text-xs text-gray-500 mt-1 truncate"},_e={class:"flex items-center gap-2 mb-3"},he={class:"pt-2"},ke={class:"space-y-6"},Ve=H({__name:"Create",props:{invoice:{}},setup(S){const c=S,p=U([]),r=U([]),f=U({}),u=z({request_type:"refund",description:"",damaged_items_terms:"",is_damaged:!1,items:[],proof_images:[]});function P(l){return new Intl.NumberFormat("en-PH",{style:"currency",currency:"PHP",minimumFractionDigits:2}).format(l)}function C(l,t){const s=Number.isFinite(l)?Math.floor(l):0;return s<0?0:s>t?t:s}function N(l,t,s){f.value[l]||(f.value[l]={qty:0}),f.value[l].qty=C(t,s)}function V(l){const t=l.target;if(t.files){const a=Array.from(t.files).filter(g=>g.size>5*1024*1024?(alert(`File "${g.name}" is too large. Maximum size is 5MB.`),!1):!0),n=a.map(g=>URL.createObjectURL(g)),d=[...p.value,...a].slice(0,5),R=[...r.value,...n].slice(0,5),j=p.value.length+a.length-5;if(j>0){const g=r.value.length;for(let _=g;_<g+j;_++)r.value[_]&&URL.revokeObjectURL(r.value[_])}p.value=d,r.value=R}t.value=""}function O(l){r.value[l]&&URL.revokeObjectURL(r.value[l]),p.value.splice(l,1),r.value.splice(l,1)}Q(()=>{r.value.forEach(l=>{l&&URL.revokeObjectURL(l)})});const T=D(()=>{const l=Object.entries(f.value);if(l.length===0)return!1;let t=!1;for(const[s,a]of l){const n=c.invoice.invoice_items.find(R=>R.id===Number(s));if(!n)continue;const d=C(a.qty,n.quantity);if(d!==a.qty)return!1;d>0&&(t=!0)}return t}),A=D(()=>c.invoice.invoice_items.reduce((l,t)=>{const s=f.value[t.id];return!s||!s.qty?l:l+s.qty*t.price},0));function E(){const l=Object.entries(f.value).filter(([t,s])=>s.qty>0).map(([t,s])=>{const a=c.invoice.invoice_items.find(n=>n.id===Number(t));return{invoice_item_id:Number(t),product_id:a.product_id,quantity:Math.min(s.qty,a.quantity)}});u.request_type="refund",u.items=l,p.value.length>0?u.proof_images=p.value:u.proof_images=[],u.post(`/invoices/${c.invoice.id}/refund-request`,{forceFormData:!0})}return(l,t)=>(v(),W(X,null,{default:i(()=>[o(m(G),{title:`Refund Request - ${c.invoice.reference_number}`},null,8,["title"]),e("div",Z,[t[5]||(t[5]=e("h1",{class:"text-2xl font-bold"},"Request Refund",-1)),e("div",ee,[o(m(Y),{href:l.route("invoices.show",c.invoice.id)},{default:i(()=>[o(m(M),{variant:"ghost"},{default:i(()=>t[4]||(t[4]=[y("Back to Invoice")])),_:1,__:[4]})]),_:1},8,["href"])])]),e("div",te,[e("div",se,[o(h,null,{default:i(()=>[o(q,null,{default:i(()=>[o(w,null,{default:i(()=>t[6]||(t[6]=[y("Invoice")])),_:1,__:[6]})]),_:1}),o(k,null,{default:i(()=>[e("div",le,[e("div",null,[t[7]||(t[7]=e("div",{class:"text-sm text-gray-500"},"Invoice number",-1)),e("div",ie,b(c.invoice.reference_number),1)])])]),_:1})]),_:1}),o(h,null,{default:i(()=>[o(q,null,{default:i(()=>[o(w,null,{default:i(()=>t[8]||(t[8]=[y("Products to Refund")])),_:1,__:[8]})]),_:1}),o(k,null,{default:i(()=>[e("div",oe,[e("table",ae,[t[10]||(t[10]=e("thead",null,[e("tr",null,[e("th",{class:"px-4 py-2 text-left"},"Product"),e("th",{class:"px-4 py-2 text-left"},"Qty Purchased"),e("th",{class:"px-4 py-2 text-left"},"Price"),e("th",{class:"px-4 py-2 text-left"},"Refund Qty")])],-1)),e("tbody",null,[(v(!0),x(B,null,F(c.invoice.invoice_items,s=>{var a;return v(),x("tr",{key:s.id,class:"hover:bg-muted"},[e("td",ne,[e("div",re,b(s.product_name),1)]),e("td",ue,b(s.quantity),1),e("td",de,b(P(s.price)),1),e("td",me,[e("input",{type:"number",min:"0",max:s.quantity,step:"1",inputmode:"numeric",pattern:"[0-9]*",class:"w-24 rounded-md border border-input bg-background px-3 py-2 text-sm",value:((a=f.value[s.id])==null?void 0:a.qty)??0,onInput:n=>{var d;return N(s.id,Number(((d=n==null?void 0:n.target)==null?void 0:d.value)??0),s.quantity)},onBlur:n=>{var d;return N(s.id,Number(((d=n==null?void 0:n.target)==null?void 0:d.value)??0),s.quantity)},onWheel:t[0]||(t[0]=J(()=>{},["prevent"]))},null,40,ce)])])}),128))]),e("tfoot",null,[e("tr",pe,[t[9]||(t[9]=e("td",{class:"px-4 py-2 text-right font-medium",colspan:"3"},"Total refund amount:",-1)),e("td",fe,b(P(A.value)),1)])])])])]),_:1})]),_:1}),o(h,null,{default:i(()=>[o(q,null,{default:i(()=>[o(w,null,{default:i(()=>t[11]||(t[11]=[y("Additional Details")])),_:1,__:[11]})]),_:1}),o(k,null,{default:i(()=>[e("div",ge,[e("div",null,[t[12]||(t[12]=e("label",{class:"block text-sm text-gray-600 mb-1"}," Description / Reason * ",-1)),I(e("textarea",{"onUpdate:modelValue":t[1]||(t[1]=s=>m(u).description=s),rows:"4",class:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm",placeholder:"Describe the reason for the refund",required:""},null,512),[[L,m(u).description]]),t[13]||(t[13]=e("p",{class:"text-xs text-gray-500 mt-1"},"Please provide a clear explanation for your request.",-1))]),e("div",null,[t[14]||(t[14]=e("label",{class:"block text-sm text-gray-600 mb-1"},[y(" Proof Images "),e("span",{class:"text-gray-400 text-xs"},"(Recommended)")],-1)),e("input",{type:"file",accept:"image/jpeg,image/png,image/jpg,image/webp",multiple:"",onChange:V,class:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm"},null,32),t[15]||(t[15]=e("p",{class:"text-xs text-gray-500 mt-1"},"Upload photos of the item(s) as proof. Maximum 5 images, 5MB each.",-1)),p.value.length>0?(v(),x("div",ve,[(v(!0),x(B,null,F(p.value,(s,a)=>(v(),x("div",{key:a,class:"relative group"},[r.value[a]?(v(),x("img",{key:0,src:r.value[a],alt:"Proof image",class:"w-full h-32 object-cover rounded-md border"},null,8,ye)):$("",!0),e("button",{type:"button",onClick:n=>O(a),class:"absolute top-1 right-1 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs opacity-0 group-hover:opacity-100 transition-opacity"}," Ã— ",8,be),e("div",xe,b(s.name),1)]))),128))])):$("",!0)]),e("div",null,[e("label",_e,[I(e("input",{type:"checkbox","onUpdate:modelValue":t[2]||(t[2]=s=>m(u).is_damaged=s),class:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"},null,512),[[K,m(u).is_damaged]]),t[16]||(t[16]=e("span",{class:"text-sm font-medium text-gray-700"},"Damaged Items",-1))]),t[17]||(t[17]=e("p",{class:"text-xs text-gray-500 mb-3"},"Check this box if the items you are returning are damaged. Damaged items will not be restored to inventory stock.",-1))]),e("div",null,[t[18]||(t[18]=e("label",{class:"block text-sm text-gray-600 mb-1"}," Terms for Damaged Items ",-1)),I(e("textarea",{"onUpdate:modelValue":t[3]||(t[3]=s=>m(u).damaged_items_terms=s),rows:"3",class:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm",placeholder:"Any special terms or conditions regarding damaged items (e.g., partial refund for minor damage, etc.)"},null,512),[[L,m(u).damaged_items_terms]]),t[19]||(t[19]=e("p",{class:"text-xs text-gray-500 mt-1"},"Specify any special terms or expectations regarding damaged items.",-1))]),e("div",he,[o(m(M),{disabled:!T.value,onClick:E},{default:i(()=>t[20]||(t[20]=[y(" Submit Refund Request ")])),_:1,__:[20]},8,["disabled"])])])]),_:1})]),_:1})]),e("div",ke,[o(h,null,{default:i(()=>[o(q,null,{default:i(()=>[o(w,null,{default:i(()=>t[21]||(t[21]=[y("Instructions & Clarifications")])),_:1,__:[21]})]),_:1}),o(k,null,{default:i(()=>t[22]||(t[22]=[e("div",{class:"space-y-4 text-sm"},[e("div",null,[e("h4",{class:"font-semibold mb-2"},"Proof Images:"),e("div",{class:"text-gray-600"},[e("p",null,"Upload clear photos showing:"),e("ul",{class:"list-disc pl-5 space-y-1 text-gray-600 mt-1"},[e("li",null,"The item(s) condition"),e("li",null,"Any damage or defects"),e("li",null,"Package/receipt if applicable")]),e("p",{class:"mt-2"},"This helps us process your request faster and ensures accurate assessment.")])]),e("div",null,[e("h4",{class:"font-semibold mb-2"},"What Happens Next:"),e("ol",{class:"list-decimal pl-5 space-y-1 text-gray-600"},[e("li",null,"Submit your request"),e("li",null,"Admin reviews your request (usually within 1-2 business days)"),e("li",null,"You'll receive an email notification about the decision"),e("li",null,"If approved, follow instructions to return items")])]),e("div",null,[e("h4",{class:"font-semibold mb-2"},"Damaged Items:"),e("div",{class:"text-gray-600"},[e("p",null,"If items are damaged, please specify your expectations:"),e("ul",{class:"list-disc pl-5 space-y-1 text-gray-600 mt-1"},[e("li",null,"Full refund expected"),e("li",null,"Partial refund acceptable")])])])],-1)])),_:1,__:[22]})]),_:1})])])]),_:1}))}});export{Ve as default};
