import{d as te,m as se,E as oe,p as b,s as ie,c as T,o as f,w as a,a as i,b as t,u as n,g as le,G as ne,h as d,e as y,f as V,x as _,bN as j,y as x,F as re,r as ae,t as v,S as ue}from"./app-BJGGIgA8.js";import{_ as h}from"./index-riohrRak.js";import{_ as I}from"./Select.vue_vue_type_script_setup_true_lang-CVoDpg_u.js";import{_ as S}from"./SearchSelect.vue_vue_type_script_setup_true_lang-DjNxBFPF.js";import{_ as de}from"./AppLayout.vue_vue_type_script_setup_true_lang-6OmCq4tp.js";import{_ as q,a as A}from"./CardContent.vue_vue_type_script_setup_true_lang-DPB8yWHX.js";import{_ as D,a as F}from"./CardTitle.vue_vue_type_script_setup_true_lang-DvxTgNYv.js";import{_ as me}from"./CardFooter.vue_vue_type_script_setup_true_lang-viGH8JM8.js";import{_ as m}from"./Label.vue_vue_type_script_setup_true_lang-bOJZE9lv.js";import{S as U}from"./sweetalert2.esm.all-BQIkj5Wb.js";import{_ as p}from"./InputError.vue_vue_type_script_setup_true_lang-YNpV2x5o.js";import{T as pe}from"./trash-2-DcMzLwyY.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-MrJHOVsW.js";import"./useForwardPropsEmits-CZzI8B5e.js";import"./Teleport-MSIji786.js";import"./RovingFocusGroup-gSG5KO_4.js";import"./chevron-down-B83M1Caq.js";import"./Input.vue_vue_type_script_setup_true_lang-o7QhFVaq.js";import"./LocationInput.vue_vue_type_style_index_0_scoped_85568d9b_lang-CX_goT8l.js";import"./search-BUl39vHB.js";import"./x-BjkU5bBK.js";import"./VisuallyHidden-BC0AEIfW.js";import"./DialogPortal-Dpb7jdpY.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-DSD56j4j.js";import"./chevron-right-CjvrEjDl.js";const ce={class:"flex items-center gap-4 mb-4"},fe={class:"flex gap-4"},_e={class:"flex items-center gap-2 cursor-pointer"},ve={class:"flex items-center gap-2 cursor-pointer"},ge={key:0,class:"mb-4"},be={key:1,class:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4"},ye={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},xe={key:0,class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ke={class:"flex justify-between items-center"},we={class:"space-y-3"},$e={class:"flex justify-between items-center mb-3"},Ce={class:"font-medium text-sm"},Ve={class:"grid grid-cols-1 md:grid-cols-5 gap-3"},he=["id","onUpdate:modelValue","onInput"],Ie={key:0,class:"text-[11px] text-gray-500 mt-1"},Se=["id","onUpdate:modelValue","onInput"],qe={class:"w-full rounded-md border border-input bg-transparent px-2 py-1 mt-1 text-sm text-foreground dark:bg-input/30 h-8 flex items-center"},Ue={class:"mt-4 pt-3 border-t"},Pe={class:"flex justify-end"},Te={class:"text-right space-y-2"},je={class:"flex justify-between gap-8"},Ae={class:"text-sm font-medium"},De={class:"flex justify-between gap-8"},Fe={class:"text-sm font-medium"},Ne={class:"flex justify-between gap-8 border-t pt-2"},Oe={class:"text-sm font-medium"},Be={class:"flex justify-between gap-8"},We={class:"text-sm font-medium text-red-600"},Qe={class:"flex justify-between gap-8 border-t-2 pt-2"},Ee={class:"text-base font-bold"},Me={class:"mt-4 pt-3 border-t"},He={class:"text-[11px] text-gray-500 mt-1"},Le={key:0,class:"block text-blue-600 font-medium"},gt=te({__name:"Create",props:{customers:{},products:{},categories:{default:()=>[]}},setup(N){const g=N,c=se(!1),s=oe({customer_id:null,walk_in_customer:{name:"",phone:""},status:"draft",payment_method:"cash",invoice_type:"walk_in",credit_term_days:null,notes:"",invoice_items:[{category_id:null,product_id:null,quantity:1,price:0,total:0}]}),O=[{title:"Invoices",href:"/invoices"},{title:"Create Invoice",href:"/invoices/create"}],k=b(()=>s.invoice_items.reduce((l,e)=>l+e.total,0)),w=b(()=>k.value*.12),P=b(()=>(k.value+w.value)*.01),B=b(()=>k.value+w.value-P.value),W=b(()=>{if(c.value){if(!s.walk_in_customer.name||s.walk_in_customer.name.trim()==="")return!1}else if(!s.customer_id)return!1;return s.invoice_items.length?s.invoice_items.some(l=>!!l.product_id&&l.quantity>0&&l.price>=0):!1});function Q(){s.invoice_items.push({category_id:null,product_id:null,quantity:1,price:0,total:0})}function E(l){s.invoice_items.length>1&&s.invoice_items.splice(l,1)}function $(l){const e=s.invoice_items[l];e.product_id&&e.quantity&&e.price?e.total=e.quantity*e.price:e.total=0}function M(l){const e=s.invoice_items[l];e.product_id=null,e.price=0,e.total=0}function H(l){const e=s.invoice_items[l];if(e.product_id){const o=g.products.find(r=>r.id===e.product_id);o&&(e.price=o.selling_price,$(l))}}function L(l){const e=s.invoice_items[l];if(e.product_id&&e.quantity){const o=g.products.find(r=>r.id===e.product_id);o&&e.quantity>o.stock&&(e.quantity=o.stock,U.fire({icon:"info",title:"Quantity Adjusted",text:`Quantity for "${o.name}" has been adjusted to the maximum available stock (${o.stock} units).`,confirmButtonText:"OK",toast:!0,position:"top-end",timer:3e3,timerProgressBar:!0}))}$(l)}function K(l){$(l)}function R(){for(let e=0;e<s.invoice_items.length;e++){const o=s.invoice_items[e];if(o.product_id&&o.quantity){const r=g.products.find(u=>u.id===o.product_id);r&&o.quantity>r.stock&&(o.quantity=r.stock,$(e),U.fire({icon:"warning",title:"Quantity Auto-Adjusted",text:`Quantity for "${r.name}" was automatically adjusted to ${r.stock} units due to stock limitations.`,confirmButtonText:"OK"}))}}const l={...s.data()};c.value?l.customer_id=null:l.walk_in_customer=null,s.transform(()=>l).post(route("invoices.store"),{preserveScroll:!0,onSuccess:()=>{U.fire({toast:!0,position:"top-end",icon:"success",title:"Invoice created successfully",showConfirmButton:!1,timer:3e3,timerProgressBar:!0})}})}function C(l){return s.errors[l]}const z=b(()=>[{value:null,label:"Select customer"},...g.customers.map(l=>({value:l.id,label:`${l.name}${l.company_name?` (${l.company_name})`:""}${l.is_walk_in?" [Walk-in]":""}`}))]),G=[{value:"draft",label:"Draft"},{value:"pending",label:"Pending"},{value:"completed",label:"Completed"},{value:"cancelled",label:"Cancelled"}],J=[{value:"cash",label:"Cash"},{value:"credit",label:"Credit"}],X=[{value:"walk_in",label:"Walk-in"},{value:"delivery",label:"Delivery"}];function Y(l){return new Intl.NumberFormat("en-PH",{style:"currency",currency:"PHP",minimumFractionDigits:2}).format(l)}const Z=b(()=>[{value:null,label:"Select category"},...(g.categories||[]).map(l=>({value:l.id,label:l.name}))]);function ee(l){const e=s.invoice_items[l],o=g.products||[],r=e.category_id?o.filter(u=>u.category_id===e.category_id):o;return[{value:null,label:"Select product"},...r.map(u=>({value:u.id,label:u.name,description:`${Y(u.selling_price)}/${u.unit.toUpperCase()} • Stock: ${u.stock}`}))]}return ie(c,l=>{l?(s.customer_id=null,s.invoice_type="walk_in"):(s.walk_in_customer.name="",s.walk_in_customer.phone="")}),(l,e)=>(f(),T(de,{breadcrumbs:O},{default:a(()=>[i(n(le),{title:"Create Invoice"}),e[43]||(e[43]=t("div",{class:"flex items-center justify-between mb-6"},[t("h1",{class:"text-2xl font-bold"},"Create Invoice")],-1)),t("form",{onSubmit:e[10]||(e[10]=ne(o=>R(),["prevent"])),class:"space-y-6"},[i(q,null,{default:a(()=>[i(D,null,{default:a(()=>[i(F,null,{default:a(()=>e[11]||(e[11]=[d("Invoice Details")])),_:1,__:[11]})]),_:1}),i(A,{class:"space-y-6"},{default:a(()=>[t("div",null,[t("div",ce,[i(m,{class:"text-base font-medium"},{default:a(()=>e[12]||(e[12]=[d("Customer Type")])),_:1,__:[12]}),t("div",fe,[t("label",_e,[_(t("input",{type:"radio",value:!1,"onUpdate:modelValue":e[0]||(e[0]=o=>c.value=o),class:"w-4 h-4"},null,512),[[j,c.value]]),e[13]||(e[13]=t("span",null,"Registered Customer",-1))]),t("label",ve,[_(t("input",{type:"radio",value:!0,"onUpdate:modelValue":e[1]||(e[1]=o=>c.value=o),class:"w-4 h-4"},null,512),[[j,c.value]]),e[14]||(e[14]=t("span",null,"Walk-in Customer",-1))])])]),c.value?(f(),y("div",be,[t("div",null,[i(m,{for:"walk_in_name"},{default:a(()=>e[16]||(e[16]=[d("Customer Name *")])),_:1,__:[16]}),_(t("input",{id:"walk_in_name","onUpdate:modelValue":e[3]||(e[3]=o=>n(s).walk_in_customer.name=o),type:"text",class:"mt-1 block w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",placeholder:"Enter customer name",required:""},null,512),[[x,n(s).walk_in_customer.name]]),e[17]||(e[17]=t("div",{class:"text-[11px] text-gray-500 mt-1"}," Name of the walk-in customer ",-1)),i(p,{message:n(s).errors["walk_in_customer.name"]},null,8,["message"])]),t("div",null,[i(m,{for:"walk_in_phone"},{default:a(()=>e[18]||(e[18]=[d("Phone (Optional)")])),_:1,__:[18]}),_(t("input",{id:"walk_in_phone","onUpdate:modelValue":e[4]||(e[4]=o=>n(s).walk_in_customer.phone=o),type:"text",class:"mt-1 block w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",placeholder:"Enter phone number"},null,512),[[x,n(s).walk_in_customer.phone]]),e[19]||(e[19]=t("div",{class:"text-[11px] text-gray-500 mt-1"}," Optional phone number for walk-in customer ",-1)),i(p,{message:n(s).errors["walk_in_customer.phone"]},null,8,["message"])])])):(f(),y("div",ge,[i(m,{for:"customer_id"},{default:a(()=>e[15]||(e[15]=[d("Customer")])),_:1,__:[15]}),i(n(S),{modelValue:n(s).customer_id,"onUpdate:modelValue":e[2]||(e[2]=o=>n(s).customer_id=o),options:z.value,placeholder:"Select customer","search-placeholder":"Search customers...",class:"mt-1"},null,8,["modelValue","options"]),i(p,{message:n(s).errors.customer_id},null,8,["message"])]))]),t("div",ye,[t("div",null,[i(m,{for:"status"},{default:a(()=>e[20]||(e[20]=[d("Status *")])),_:1,__:[20]}),i(n(I),{modelValue:n(s).status,"onUpdate:modelValue":e[5]||(e[5]=o=>n(s).status=o),options:G,placeholder:"Select status",class:"mt-1",required:""},null,8,["modelValue"]),e[21]||(e[21]=t("div",{class:"text-[11px] text-gray-500 mt-1"}," Draft: still editing, Pending: awaiting payment, Completed: paid, Cancelled: void. ",-1)),i(p,{message:n(s).errors.status},null,8,["message"])]),t("div",null,[i(m,{for:"payment_method"},{default:a(()=>e[22]||(e[22]=[d("Payment Method *")])),_:1,__:[22]}),i(n(I),{modelValue:n(s).payment_method,"onUpdate:modelValue":e[6]||(e[6]=o=>n(s).payment_method=o),options:J,placeholder:"Select payment method",class:"mt-1",required:""},null,8,["modelValue"]),e[23]||(e[23]=t("div",{class:"text-[11px] text-gray-500 mt-1"}," Pick how the customer will pay (Cash or Credit). ",-1)),i(p,{message:n(s).errors.payment_method},null,8,["message"])])]),n(s).payment_method==="credit"?(f(),y("div",xe,[t("div",null,[i(m,{for:"credit_term_days"},{default:a(()=>e[24]||(e[24]=[d("Credit Term (Days)")])),_:1,__:[24]}),_(t("input",{"onUpdate:modelValue":e[7]||(e[7]=o=>n(s).credit_term_days=o),type:"number",id:"credit_term_days",min:"0",max:"365",class:"mt-1 block w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",placeholder:"e.g., 30"},null,512),[[x,n(s).credit_term_days,void 0,{number:!0}]]),e[25]||(e[25]=t("div",{class:"text-[11px] text-gray-500 mt-1"}," Number of days until payment is due (default: 30 days). ",-1)),i(p,{message:n(s).errors.credit_term_days},null,8,["message"])])])):V("",!0),t("div",null,[i(m,{for:"notes"},{default:a(()=>e[26]||(e[26]=[d("Notes")])),_:1,__:[26]}),_(t("textarea",{id:"notes","onUpdate:modelValue":e[8]||(e[8]=o=>n(s).notes=o),class:"w-full rounded-md border border-input bg-transparent px-3 py-2 mt-1 text-foreground dark:bg-input/30 focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] focus-visible:outline-none",rows:"3"},null,512),[[x,n(s).notes]]),i(p,{message:n(s).errors.notes},null,8,["message"])])]),_:1})]),_:1}),i(q,null,{default:a(()=>[i(D,null,{default:a(()=>[t("div",ke,[i(F,null,{default:a(()=>e[27]||(e[27]=[d("Invoice Items")])),_:1,__:[27]}),i(n(h),{type:"button",variant:"outline",onClick:Q},{default:a(()=>e[28]||(e[28]=[t("span",{class:"mr-2"},"+",-1),d(" Add Item ")])),_:1,__:[28]})])]),_:1}),i(A,null,{default:a(()=>[t("div",we,[(f(!0),y(re,null,ae(n(s).invoice_items,(o,r)=>(f(),y("div",{key:r,class:"border rounded-md p-3"},[t("div",$e,[t("h4",Ce,"Item "+v(r+1),1),n(s).invoice_items.length>1?(f(),T(n(h),{key:0,type:"button",variant:"ghost",size:"sm",class:"h-7 w-7 p-0 text-red-500 hover:text-red-600 hover:bg-red-50 dark:hover:bg-red-950/20",onClick:u=>E(r)},{default:a(()=>[i(n(pe),{class:"h-4 w-4"})]),_:2},1032,["onClick"])):V("",!0)]),t("div",Ve,[t("div",null,[i(m,{for:`category_id_${r}`,class:"text-xs"},{default:a(()=>e[29]||(e[29]=[d("Category")])),_:2,__:[29]},1032,["for"]),i(n(S),{modelValue:o.category_id,"onUpdate:modelValue":[u=>o.category_id=u,u=>M(r)],options:Z.value,placeholder:"Select category","search-placeholder":"Search categories...",class:"mt-1 h-8"},null,8,["modelValue","onUpdate:modelValue","options"]),i(p,{message:C(`invoice_items.${r}.category_id`)},null,8,["message"])]),t("div",null,[i(m,{for:`product_id_${r}`,class:"text-xs"},{default:a(()=>e[30]||(e[30]=[d("Product *")])),_:2,__:[30]},1032,["for"]),i(n(S),{modelValue:o.product_id,"onUpdate:modelValue":[u=>o.product_id=u,u=>H(r)],options:ee(r),placeholder:"Select product","search-placeholder":"Search products...",class:"mt-1 h-8",required:""},null,8,["modelValue","onUpdate:modelValue","options"]),i(p,{message:C(`invoice_items.${r}.product_id`)},null,8,["message"])]),t("div",null,[i(m,{for:`quantity_${r}`,class:"text-xs"},{default:a(()=>e[31]||(e[31]=[d("Quantity *")])),_:2,__:[31]},1032,["for"]),_(t("input",{id:`quantity_${r}`,"onUpdate:modelValue":u=>o.quantity=u,type:"number",min:"1",class:"w-full rounded-md border border-input bg-transparent px-2 py-1 mt-1 text-sm text-foreground dark:bg-input/30 focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] focus-visible:outline-none h-8",onInput:u=>L(r),required:""},null,40,he),[[x,o.quantity,void 0,{number:!0}]]),o.product_id?(f(),y("div",Ie," In stock: "+v((g.products.find(u=>u.id===o.product_id)||{stock:0}).stock),1)):V("",!0),i(p,{message:C(`invoice_items.${r}.quantity`)},null,8,["message"])]),t("div",null,[i(m,{for:`price_${r}`,class:"text-xs"},{default:a(()=>e[32]||(e[32]=[d("Price *")])),_:2,__:[32]},1032,["for"]),_(t("input",{id:`price_${r}`,"onUpdate:modelValue":u=>o.price=u,type:"number",min:"0",step:"0.01",class:"w-full rounded-md border border-input bg-transparent px-2 py-1 mt-1 text-sm text-foreground dark:bg-input/30 focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] focus-visible:outline-none h-8",onInput:u=>K(r),required:""},null,40,Se),[[x,o.price,void 0,{number:!0}]]),i(p,{message:C(`invoice_items.${r}.price`)},null,8,["message"])]),t("div",null,[i(m,{class:"text-xs"},{default:a(()=>e[33]||(e[33]=[d("Total")])),_:1,__:[33]}),t("div",qe," ₱"+v(o.total.toFixed(2)),1)])])]))),128))]),t("div",Ue,[t("div",Pe,[t("div",Te,[t("div",je,[e[34]||(e[34]=t("span",{class:"text-sm text-gray-600"},"Subtotal:",-1)),t("span",Ae,"₱"+v(k.value.toFixed(2)),1)]),t("div",De,[e[35]||(e[35]=t("span",{class:"text-sm text-gray-600"},"VAT (12%):",-1)),t("span",Fe,"₱"+v(w.value.toFixed(2)),1)]),t("div",Ne,[e[36]||(e[36]=t("span",{class:"text-sm text-gray-600"},"Amount Net of VAT:",-1)),t("span",Oe,"₱"+v((k.value+w.value).toFixed(2)),1)]),t("div",Be,[e[37]||(e[37]=t("span",{class:"text-sm text-red-600"},"Less: W/Holding Tax (1%):",-1)),t("span",We,"-₱"+v(P.value.toFixed(2)),1)]),t("div",Qe,[e[38]||(e[38]=t("span",{class:"text-base font-bold"},"Total Amount Due:",-1)),t("span",Ee,"₱"+v(B.value.toFixed(2)),1)])])])]),t("div",Me,[i(m,{for:"invoice_type"},{default:a(()=>e[39]||(e[39]=[d("Invoice Type *")])),_:1,__:[39]}),i(n(I),{modelValue:n(s).invoice_type,"onUpdate:modelValue":e[9]||(e[9]=o=>n(s).invoice_type=o),options:X,placeholder:"Select invoice type",class:"mt-1",disabled:c.value,required:""},null,8,["modelValue","disabled"]),t("div",He,[e[40]||(e[40]=d(" Walk-in: Customer purchases in-store. Delivery: Items will be delivered. ")),c.value?(f(),y("span",Le,"(Locked to Walk-in for walk-in customers)")):V("",!0)]),i(p,{message:n(s).errors.invoice_type},null,8,["message"])])]),_:1})]),_:1}),i(q,null,{default:a(()=>[i(me,{class:"flex gap-2 justify-end"},{default:a(()=>[i(n(h),{type:"submit",disabled:!W.value,variant:"default"},{default:a(()=>e[41]||(e[41]=[d("Create Invoice")])),_:1,__:[41]},8,["disabled"]),i(n(ue),{href:l.route("invoices.index")},{default:a(()=>[i(n(h),{type:"button",variant:"ghost"},{default:a(()=>e[42]||(e[42]=[d("Cancel")])),_:1,__:[42]})]),_:1},8,["href"])]),_:1})]),_:1})],32)]),_:1,__:[43]}))}});export{gt as default};
