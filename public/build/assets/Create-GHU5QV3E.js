import{d as A,x as I,c,j as L,a as T,o as H,w as i,b as o,e as n,u as r,k as R,q as G,f as a,m,v as p,S as J}from"./app-CY-R8p4I.js";import{_ as v}from"./index-ZrUxBZkM.js";import{_ as g}from"./Select.vue_vue_type_script_setup_true_lang-DQX3J9WN.js";import{_ as Y}from"./SearchSelect.vue_vue_type_script_setup_true_lang-CG7Kov0W.js";import{_ as z}from"./AppLayout.vue_vue_type_script_setup_true_lang-B6LMl6Iv.js";import{_ as b,a as C}from"./CardContent.vue_vue_type_script_setup_true_lang-CtAQy_Ha.js";import{a as P,_ as V}from"./CardTitle.vue_vue_type_script_setup_true_lang-rWRg4ec-.js";import{_ as K}from"./CardFooter.vue_vue_type_script_setup_true_lang-DK-vYXXD.js";import{_ as d}from"./Label.vue_vue_type_script_setup_true_lang-CGVOjAWu.js";import{S as _}from"./sweetalert2.esm.all-BQIkj5Wb.js";import{_ as u}from"./InputError.vue_vue_type_script_setup_true_lang-Bi5Jzzd8.js";import{D as Q}from"./DeliveryRouteMap-CZqrf7hk.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-DPhOlZ_-.js";import"./createLucideIcon-B5ntUyXr.js";import"./RovingFocusGroup-BIsjPPEl.js";import"./LocationInput.vue_vue_type_style_index_0_scoped_5601c0ff_lang-BzdxL_P_.js";import"./Input.vue_vue_type_script_setup_true_lang-rgbKOeco.js";import"./search-BjpgS1Pf.js";import"./VisuallyHidden-C6KiMAas.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-BcPEPjiy.js";import"./_plugin-vue_export-helper-DS9B_aYD.js";import"./marker-icon-2x-1TirABJh.js";import"./marker-icon-B6h-nX3D.js";import"./marker-shadow-B9CpECYs.js";const W={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},X={class:"flex gap-2 mt-1"},Z={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},h={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},ee=["min"],te={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},De=A({__name:"Create",props:{customers:{},invoices:{}},setup($){const f=$,t=I({customer_id:null,invoice_id:null,delivery_address:"",contact_person:"",contact_phone:"",delivery_date:"",delivery_time:"",status:"pending",notes:"",delivery_fee:"",create_another:void 0}),D=[{title:"Deliveries",href:"/deliveries"},{title:"Create Delivery",href:"/deliveries/create"}];function y(s=!1){s?t.create_another=1:delete t.create_another,t.post(route("deliveries.store"),{preserveScroll:!0,onSuccess:()=>{_.fire({toast:!0,position:"top-end",icon:"success",title:"Delivery created successfully",showConfirmButton:!1,timer:3e3,timerProgressBar:!0}),s&&t.reset()}})}const M=c(()=>[{value:null,label:"Select customer"},...f.customers.map(s=>({value:s.id,label:`${s.name}${s.company_name?` (${s.company_name})`:""}`}))]),S=c(()=>{if(!t.customer_id)return[{value:null,label:"Select invoice (select customer first)"}];const s=f.invoices.filter(e=>e.customer_id===t.customer_id);return[{value:null,label:"Select invoice (optional)"},...s.map(e=>({value:e.id,label:`Invoice #${e.id} - ${U(e.total_amount)}`}))]}),k=[{value:"pending",label:"Pending"},{value:"completed",label:"Completed"},{value:"cancelled",label:"Cancelled"}],N=[{value:"09:00 AM - 12:00 PM",label:"09:00 AM - 12:00 PM"},{value:"12:00 PM - 03:00 PM",label:"12:00 PM - 03:00 PM"},{value:"03:00 PM - 06:00 PM",label:"03:00 PM - 06:00 PM"},{value:"06:00 PM - 09:00 PM",label:"06:00 PM - 09:00 PM"},{value:"Custom",label:"Custom"}];function U(s){return new Intl.NumberFormat("en-PH",{style:"currency",currency:"PHP",minimumFractionDigits:2}).format(s)}const q=new Date().toISOString().split("T")[0],E=c(()=>{if(!t.customer_id)return null;const s=f.customers.find(l=>l.id===t.customer_id);if(!(s!=null&&s.location))return null;let e=s.location;if(typeof e=="string")try{e=JSON.parse(e)}catch{return console.warn("Failed to parse customer location string:",e),null}return e&&typeof e.lat=="number"&&typeof e.lng=="number"&&!isNaN(e.lat)&&!isNaN(e.lng)&&e.lat>=-90&&e.lat<=90&&e.lng>=-180&&e.lng<=180?e:(console.warn("Invalid customer location data:",s.location),null)}),O=c(()=>t.customer_id&&f.customers.find(s=>s.id===t.customer_id)||null);L(()=>t.customer_id,s=>{if(s){const e=f.customers.find(l=>l.id===s);e!=null&&e.address&&!t.delivery_address&&(t.delivery_address=e.address)}});async function B(){try{if(!navigator.geolocation){_.fire({icon:"error",title:"Geolocation not supported",text:"Your browser does not support geolocation."});return}const s=await new Promise((F,j)=>{navigator.geolocation.getCurrentPosition(F,j,{enableHighAccuracy:!0,timeout:1e4,maximumAge:6e4})}),{latitude:e,longitude:l}=s.coords,x=await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${e}&lon=${l}&addressdetails=1`);if(!x.ok)throw new Error("Failed to get address");const w=await x.json();w.display_name&&(t.delivery_address=w.display_name,_.fire({icon:"success",title:"Location Retrieved",text:"Current location address has been filled in.",toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3}))}catch(s){console.error("Error getting location address:",s),_.fire({icon:"error",title:"Location Error",text:"Failed to get your current location address. Please enter it manually."})}}return(s,e)=>(H(),T(z,{breadcrumbs:D},{default:i(()=>[o(r(R),{title:"Create Delivery"}),e[28]||(e[28]=n("div",{class:"flex items-center justify-between mb-6"},[n("h1",{class:"text-2xl font-bold"},"Create Delivery")],-1)),n("form",{onSubmit:e[11]||(e[11]=G(l=>y(),["prevent"])),class:"space-y-6"},[o(b,null,{default:i(()=>[o(P,null,{default:i(()=>[o(V,null,{default:i(()=>e[12]||(e[12]=[a("Delivery Details")])),_:1,__:[12]})]),_:1}),o(C,{class:"space-y-6"},{default:i(()=>[n("div",W,[n("div",null,[o(d,{for:"customer_id"},{default:i(()=>e[13]||(e[13]=[a("Customer")])),_:1,__:[13]}),o(r(Y),{modelValue:r(t).customer_id,"onUpdate:modelValue":e[0]||(e[0]=l=>r(t).customer_id=l),options:M.value,placeholder:"Select customer","search-placeholder":"Search customers...",class:"mt-1",required:""},null,8,["modelValue","options"]),o(u,{message:r(t).errors.customer_id},null,8,["message"])]),n("div",null,[o(d,{for:"invoice_id"},{default:i(()=>e[14]||(e[14]=[a("Invoice (Optional)")])),_:1,__:[14]}),o(r(g),{modelValue:r(t).invoice_id,"onUpdate:modelValue":e[1]||(e[1]=l=>r(t).invoice_id=l),options:S.value,placeholder:"Select invoice",class:"mt-1"},null,8,["modelValue","options"]),o(u,{message:r(t).errors.invoice_id},null,8,["message"])])]),n("div",null,[o(d,{for:"delivery_address"},{default:i(()=>e[15]||(e[15]=[a("Delivery Address")])),_:1,__:[15]}),n("div",X,[m(n("textarea",{"onUpdate:modelValue":e[2]||(e[2]=l=>r(t).delivery_address=l),id:"delivery_address",class:"flex-1 rounded-md border border-input bg-transparent px-3 py-2 text-foreground dark:bg-input/30 focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] focus-visible:outline-none",rows:"3",placeholder:"Enter complete delivery address",required:""},null,512),[[p,r(t).delivery_address]]),o(r(v),{type:"button",variant:"outline",onClick:B,class:"h-fit px-3 py-2"},{default:i(()=>e[16]||(e[16]=[a(" ðŸ“ Get Current Location ")])),_:1,__:[16]})]),o(u,{message:r(t).errors.delivery_address},null,8,["message"])]),n("div",Z,[n("div",null,[o(d,{for:"contact_person"},{default:i(()=>e[17]||(e[17]=[a("Contact Person")])),_:1,__:[17]}),m(n("input",{"onUpdate:modelValue":e[3]||(e[3]=l=>r(t).contact_person=l),type:"text",id:"contact_person",class:"w-full rounded-md border border-input bg-transparent px-3 py-2 mt-1 text-foreground dark:bg-input/30 focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] focus-visible:outline-none",placeholder:"Enter contact person name",required:""},null,512),[[p,r(t).contact_person]]),o(u,{message:r(t).errors.contact_person},null,8,["message"])]),n("div",null,[o(d,{for:"contact_phone"},{default:i(()=>e[18]||(e[18]=[a("Contact Phone")])),_:1,__:[18]}),m(n("input",{"onUpdate:modelValue":e[4]||(e[4]=l=>r(t).contact_phone=l),type:"tel",id:"contact_phone",class:"w-full rounded-md border border-input bg-transparent px-3 py-2 mt-1 text-foreground dark:bg-input/30 focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] focus-visible:outline-none",placeholder:"Enter contact phone number",required:""},null,512),[[p,r(t).contact_phone]]),o(u,{message:r(t).errors.contact_phone},null,8,["message"])])]),n("div",h,[n("div",null,[o(d,{for:"delivery_date"},{default:i(()=>e[19]||(e[19]=[a("Delivery Date")])),_:1,__:[19]}),m(n("input",{"onUpdate:modelValue":e[5]||(e[5]=l=>r(t).delivery_date=l),type:"date",id:"delivery_date",min:r(q),class:"w-full rounded-md border border-input bg-transparent px-3 py-2 mt-1 text-foreground dark:bg-input/30 focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] focus-visible:outline-none",required:""},null,8,ee),[[p,r(t).delivery_date]]),o(u,{message:r(t).errors.delivery_date},null,8,["message"])]),n("div",null,[o(d,{for:"delivery_time"},{default:i(()=>e[20]||(e[20]=[a("Delivery Time")])),_:1,__:[20]}),o(r(g),{modelValue:r(t).delivery_time,"onUpdate:modelValue":e[6]||(e[6]=l=>r(t).delivery_time=l),options:N,placeholder:"Select delivery time",class:"mt-1",required:""},null,8,["modelValue"]),o(u,{message:r(t).errors.delivery_time},null,8,["message"])]),n("div",null,[o(d,{for:"status"},{default:i(()=>e[21]||(e[21]=[a("Status")])),_:1,__:[21]}),o(r(g),{modelValue:r(t).status,"onUpdate:modelValue":e[7]||(e[7]=l=>r(t).status=l),options:k,placeholder:"Select status",class:"mt-1",required:""},null,8,["modelValue"]),o(u,{message:r(t).errors.status},null,8,["message"])])]),n("div",te,[n("div",null,[o(d,{for:"delivery_fee"},{default:i(()=>e[22]||(e[22]=[a("Delivery Fee")])),_:1,__:[22]}),m(n("input",{"onUpdate:modelValue":e[8]||(e[8]=l=>r(t).delivery_fee=l),type:"number",id:"delivery_fee",min:"0",step:"0.01",class:"w-full rounded-md border border-input bg-transparent px-3 py-2 mt-1 text-foreground dark:bg-input/30 focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] focus-visible:outline-none",placeholder:"0.00",required:""},null,512),[[p,r(t).delivery_fee]]),o(u,{message:r(t).errors.delivery_fee},null,8,["message"])]),n("div",null,[o(d,{for:"notes"},{default:i(()=>e[23]||(e[23]=[a("Notes")])),_:1,__:[23]}),m(n("textarea",{"onUpdate:modelValue":e[9]||(e[9]=l=>r(t).notes=l),id:"notes",class:"w-full rounded-md border border-input bg-transparent px-3 py-2 mt-1 text-foreground dark:bg-input/30 focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] focus-visible:outline-none",rows:"3",placeholder:"Enter any additional notes"},null,512),[[p,r(t).notes]]),o(u,{message:r(t).errors.notes},null,8,["message"])])])]),_:1})]),_:1}),o(b,null,{default:i(()=>[o(P,null,{default:i(()=>[o(V,null,{default:i(()=>e[24]||(e[24]=[a("Delivery Route")])),_:1,__:[24]})]),_:1}),o(C,null,{default:i(()=>{var l;return[o(Q,{"customer-location":E.value,"delivery-address":r(t).delivery_address||((l=O.value)==null?void 0:l.address),"map-height":"400px"},null,8,["customer-location","delivery-address"])]}),_:1})]),_:1}),o(b,null,{default:i(()=>[o(K,{class:"flex gap-2 justify-end"},{default:i(()=>[o(r(v),{type:"submit",variant:"default"},{default:i(()=>e[25]||(e[25]=[a("Create Delivery")])),_:1,__:[25]}),o(r(v),{type:"button",variant:"secondary",onClick:e[10]||(e[10]=l=>y(!0))},{default:i(()=>e[26]||(e[26]=[a("Create & create another")])),_:1,__:[26]}),o(r(J),{href:s.route("deliveries.index")},{default:i(()=>[o(r(v),{type:"button",variant:"ghost"},{default:i(()=>e[27]||(e[27]=[a("Cancel")])),_:1,__:[27]})]),_:1},8,["href"])]),_:1})]),_:1})],32)]),_:1,__:[28]}))}});export{De as default};
