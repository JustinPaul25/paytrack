import{d as H,D as J,l as f,c as w,o as v,w as l,a as o,b as s,u as n,g as K,t as p,q as R,e as d,A as h,B as $,f as V,F as X,r as Y,h as S,S as Z}from"./app-Cwu7HoSd.js";import{_ as g}from"./index-BdY75aZ2.js";import{_ as q}from"./Select.vue_vue_type_script_setup_true_lang-CBzjz3As.js";import{_ as C}from"./SearchSelect.vue_vue_type_script_setup_true_lang-KeLTEBMp.js";import{_ as ee}from"./AppLayout.vue_vue_type_script_setup_true_lang-By9GJnaP.js";import{_ as k,a as T}from"./CardContent.vue_vue_type_script_setup_true_lang-BYmIXq6h.js";import{_ as U,a as P}from"./CardTitle.vue_vue_type_script_setup_true_lang-DreEaS5s.js";import{_ as te}from"./CardFooter.vue_vue_type_script_setup_true_lang-Da1iX7RO.js";import{_ as c}from"./Label.vue_vue_type_script_setup_true_lang-BMHPrx55.js";import{S as oe}from"./sweetalert2.esm.all-BQIkj5Wb.js";import{_}from"./InputError.vue_vue_type_script_setup_true_lang-BULHRL9y.js";import{T as se}from"./trash-2-ftcGJkmD.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-DQ5B8Mu2.js";import"./createLucideIcon-BlW3GIPw.js";import"./RovingFocusGroup-BZ7O1hI-.js";import"./LocationInput.vue_vue_type_style_index_0_scoped_0fe2f881_lang-CbPCljGY.js";import"./Input.vue_vue_type_script_setup_true_lang-B7Gi-sP6.js";import"./search-fX2YwpmX.js";import"./VisuallyHidden-GGl4KIsE.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-DAN9CPXS.js";const ie={class:"flex items-center justify-between mb-6"},ne={class:"text-2xl font-bold"},le={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},re={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ae={class:"flex justify-between items-center"},de={class:"space-y-3"},ue={class:"flex justify-between items-center mb-3"},me={class:"font-medium text-sm"},ce={class:"grid grid-cols-1 md:grid-cols-4 gap-3"},pe=["id","onUpdate:modelValue","onInput"],_e={key:0,class:"text-[11px] text-gray-500 mt-1"},fe=["id","onUpdate:modelValue","onInput"],ve={class:"w-full rounded-md border border-input bg-transparent px-2 py-1 mt-1 text-sm text-foreground dark:bg-input/30 h-8 flex items-center"},ge={class:"mt-4 pt-3 border-t"},be={class:"flex justify-end"},ye={class:"text-right space-y-1"},xe={class:"text-sm text-muted-foreground"},he={class:"text-sm text-muted-foreground"},$e={class:"text-base font-medium"},We=H({__name:"Edit",props:{invoice:{},customers:{},products:{}},setup(B){const u=B,i=J({customer_id:u.invoice.customer_id,status:u.invoice.status,payment_method:u.invoice.payment_method,notes:u.invoice.notes||"",invoice_items:u.invoice.invoice_items.map(t=>({id:t.id,product_id:t.product_id,quantity:t.quantity,price:t.price,total:t.total}))}),E=[{title:"Invoices",href:"/invoices"},{title:"Edit Invoice",href:`/invoices/${u.invoice.id}/edit`}],b=f(()=>i.invoice_items.reduce((t,e)=>t+e.total,0)),I=f(()=>b.value*.12),F=f(()=>b.value+I.value),A=f(()=>!i.customer_id||!i.invoice_items.length?!1:i.invoice_items.some(t=>!!t.product_id&&t.quantity>0&&t.price>=0));function D(){i.invoice_items.push({id:void 0,product_id:null,quantity:1,price:0,total:0})}function j(t){i.invoice_items.length>1&&i.invoice_items.splice(t,1)}function y(t){const e=i.invoice_items[t];e.product_id&&e.quantity&&e.price?e.total=e.quantity*e.price:e.total=0}function N(t){const e=i.invoice_items[t];if(e.product_id){const r=u.products.find(a=>a.id===e.product_id);r&&(e.price=r.selling_price,y(t))}}function O(t){y(t)}function M(t){y(t)}function Q(){i.post(route("invoices.update",u.invoice.id),{preserveScroll:!0,onSuccess:()=>{oe.fire({toast:!0,position:"top-end",icon:"success",title:"Invoice updated successfully",showConfirmButton:!1,timer:3e3,timerProgressBar:!0})},method:"post"})}function x(t){return i.errors[t]}const W=f(()=>[{value:null,label:"Select customer"},...u.customers.map(t=>({value:t.id,label:`${t.name}${t.company_name?` (${t.company_name})`:""}`}))]),z=[{value:"draft",label:"Draft"},{value:"pending",label:"Pending"},{value:"completed",label:"Completed"},{value:"cancelled",label:"Cancelled"}],L=[{value:"cash",label:"Cash"},{value:"bank_transfer",label:"Bank Transfer"},{value:"e-wallet",label:"E-Wallet"},{value:"other",label:"Other"}];function G(){return[{value:null,label:"Select product"},...u.products.map(t=>({value:t.id,label:`${t.name} - ₱${t.selling_price.toFixed(2)}`}))]}return(t,e)=>(v(),w(ee,{breadcrumbs:E},{default:l(()=>[o(n(K),{title:"Edit Invoice"}),s("div",ie,[s("h1",ne,"Edit Invoice #"+p(u.invoice.id),1)]),s("form",{onSubmit:R(Q,["prevent"]),class:"space-y-6"},[o(k,null,{default:l(()=>[o(U,null,{default:l(()=>[o(P,null,{default:l(()=>e[4]||(e[4]=[d("Invoice Details")])),_:1,__:[4]})]),_:1}),o(T,{class:"space-y-6"},{default:l(()=>[s("div",le,[s("div",null,[o(c,{for:"customer_id"},{default:l(()=>e[5]||(e[5]=[d("Customer")])),_:1,__:[5]}),o(n(C),{modelValue:n(i).customer_id,"onUpdate:modelValue":e[0]||(e[0]=r=>n(i).customer_id=r),options:W.value,placeholder:"Select customer","search-placeholder":"Search customers...",class:"mt-1",required:""},null,8,["modelValue","options"]),o(_,{message:n(i).errors.customer_id},null,8,["message"])]),s("div",null,[o(c,{for:"status"},{default:l(()=>e[6]||(e[6]=[d("Status")])),_:1,__:[6]}),o(n(q),{modelValue:n(i).status,"onUpdate:modelValue":e[1]||(e[1]=r=>n(i).status=r),options:z,placeholder:"Select status",class:"mt-1",required:""},null,8,["modelValue"]),e[7]||(e[7]=s("div",{class:"text-[11px] text-gray-500 mt-1"}," Draft: still editing, Pending: awaiting payment, Completed: paid, Cancelled: void. ",-1)),o(_,{message:n(i).errors.status},null,8,["message"])])]),s("div",re,[s("div",null,[o(c,{for:"payment_method"},{default:l(()=>e[8]||(e[8]=[d("Payment Method")])),_:1,__:[8]}),o(n(q),{modelValue:n(i).payment_method,"onUpdate:modelValue":e[2]||(e[2]=r=>n(i).payment_method=r),options:L,placeholder:"Select payment method",class:"mt-1",required:""},null,8,["modelValue"]),e[9]||(e[9]=s("div",{class:"text-[11px] text-gray-500 mt-1"}," Pick how the customer will pay (e.g. Cash, Bank Transfer, E‑Wallet). ",-1)),o(_,{message:n(i).errors.payment_method},null,8,["message"])])]),s("div",null,[o(c,{for:"notes"},{default:l(()=>e[10]||(e[10]=[d("Notes")])),_:1,__:[10]}),h(s("textarea",{id:"notes","onUpdate:modelValue":e[3]||(e[3]=r=>n(i).notes=r),class:"w-full rounded-md border border-input bg-transparent px-3 py-2 mt-1 text-foreground dark:bg-input/30 focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] focus-visible:outline-none",rows:"3"},null,512),[[$,n(i).notes]]),o(_,{message:n(i).errors.notes},null,8,["message"])])]),_:1})]),_:1}),o(k,null,{default:l(()=>[o(U,null,{default:l(()=>[s("div",ae,[o(P,null,{default:l(()=>e[11]||(e[11]=[d("Invoice Items")])),_:1,__:[11]}),o(n(g),{type:"button",variant:"outline",onClick:D},{default:l(()=>e[12]||(e[12]=[s("span",{class:"mr-2"},"+",-1),d(" Add Item ")])),_:1,__:[12]})])]),_:1}),o(T,null,{default:l(()=>[s("div",de,[(v(!0),V(X,null,Y(n(i).invoice_items,(r,a)=>(v(),V("div",{key:a,class:"border rounded-md p-3"},[s("div",ue,[s("h4",me,"Item "+p(a+1),1),n(i).invoice_items.length>1?(v(),w(n(g),{key:0,type:"button",variant:"ghost",size:"sm",class:"h-7 w-7 p-0 text-red-500 hover:text-red-600 hover:bg-red-50 dark:hover:bg-red-950/20",onClick:m=>j(a)},{default:l(()=>[o(n(se),{class:"h-4 w-4"})]),_:2},1032,["onClick"])):S("",!0)]),s("div",ce,[s("div",null,[o(c,{for:`product_id_${a}`,class:"text-xs"},{default:l(()=>e[13]||(e[13]=[d("Product")])),_:2,__:[13]},1032,["for"]),o(n(C),{modelValue:r.product_id,"onUpdate:modelValue":[m=>r.product_id=m,m=>N(a)],options:G(),placeholder:"Select product","search-placeholder":"Search products...",class:"mt-1 h-8",required:""},null,8,["modelValue","onUpdate:modelValue","options"]),o(_,{message:x(`invoice_items.${a}.product_id`)},null,8,["message"])]),s("div",null,[o(c,{for:`quantity_${a}`,class:"text-xs"},{default:l(()=>e[14]||(e[14]=[d("Quantity")])),_:2,__:[14]},1032,["for"]),h(s("input",{id:`quantity_${a}`,"onUpdate:modelValue":m=>r.quantity=m,type:"number",min:"1",class:"w-full rounded-md border border-input bg-transparent px-2 py-1 mt-1 text-sm text-foreground dark:bg-input/30 focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] focus-visible:outline-none h-8",onInput:m=>O(a),required:""},null,40,pe),[[$,r.quantity,void 0,{number:!0}]]),r.product_id?(v(),V("div",_e," In stock: "+p((u.products.find(m=>m.id===r.product_id)||{stock:0}).stock),1)):S("",!0),o(_,{message:x(`invoice_items.${a}.quantity`)},null,8,["message"])]),s("div",null,[o(c,{for:`price_${a}`,class:"text-xs"},{default:l(()=>e[15]||(e[15]=[d("Price")])),_:2,__:[15]},1032,["for"]),h(s("input",{id:`price_${a}`,"onUpdate:modelValue":m=>r.price=m,type:"number",min:"0",step:"0.01",class:"w-full rounded-md border border-input bg-transparent px-2 py-1 mt-1 text-sm text-foreground dark:bg-input/30 focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] focus-visible:outline-none h-8",onInput:m=>M(a),required:""},null,40,fe),[[$,r.price,void 0,{number:!0}]]),o(_,{message:x(`invoice_items.${a}.price`)},null,8,["message"])]),s("div",null,[o(c,{class:"text-xs"},{default:l(()=>e[16]||(e[16]=[d("Total")])),_:1,__:[16]}),s("div",ve," ₱"+p(r.total.toFixed(2)),1)])])]))),128))]),s("div",ge,[s("div",be,[s("div",ye,[s("div",xe,"Subtotal: ₱"+p(b.value.toFixed(2)),1),s("div",he,"VAT (12%): ₱"+p(I.value.toFixed(2)),1),s("div",$e,"Total Amount: ₱"+p(F.value.toFixed(2)),1)])])])]),_:1})]),_:1}),o(k,null,{default:l(()=>[o(te,{class:"flex gap-2 justify-end"},{default:l(()=>[o(n(g),{type:"submit",disabled:!A.value,variant:"default"},{default:l(()=>e[17]||(e[17]=[d("Update Invoice")])),_:1,__:[17]},8,["disabled"]),o(n(Z),{href:t.route("invoices.index")},{default:l(()=>[o(n(g),{type:"button",variant:"ghost"},{default:l(()=>e[18]||(e[18]=[d("Cancel")])),_:1,__:[18]})]),_:1},8,["href"])]),_:1})]),_:1})],32)]),_:1}))}});export{We as default};
