import{d as E,D as M,l as p,c as q,o as f,w as n,a as s,b as r,u,g as Y,q as z,e as l,A as w,B as O,f as g,F as L,r as G,h as S,t as m,S as H}from"./app-D8GMqoQL.js";import{_}from"./index-CKTUUg4B.js";import{_ as J}from"./SearchSelect.vue_vue_type_script_setup_true_lang-BGOYTj0h.js";import{_ as R}from"./AppLayout.vue_vue_type_script_setup_true_lang-B7FY6UE4.js";import{_ as x,a as C}from"./CardContent.vue_vue_type_script_setup_true_lang-zCpbmRui.js";import{_ as B,a as T}from"./CardTitle.vue_vue_type_script_setup_true_lang-COI8iZOX.js";import{_ as W}from"./CardFooter.vue_vue_type_script_setup_true_lang-D0OErrDq.js";import{_ as b}from"./Label.vue_vue_type_script_setup_true_lang-Dc3JaC7p.js";import{S as v}from"./sweetalert2.esm.all-BQIkj5Wb.js";import{_ as k}from"./InputError.vue_vue_type_script_setup_true_lang-BCon8n8M.js";import{T as X}from"./trash-2-CiE0f_9y.js";import"./Input.vue_vue_type_script_setup_true_lang-D3J-Rw-h.js";import"./LocationInput.vue_vue_type_style_index_0_scoped_0fe2f881_lang-Ay1pUOAN.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-DtVqRXXk.js";import"./createLucideIcon-sEmkw9Pt.js";import"./RovingFocusGroup-B0Y8hFFN.js";import"./search-CRAqy-0D.js";import"./VisuallyHidden-DKr5urU_.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-BH_Bl99z.js";import"./chevron-right-CmK6lVL2.js";const Z={class:"flex justify-between items-center"},tt={class:"space-y-3"},et={class:"flex justify-between items-center mb-3"},ot={class:"font-medium text-sm"},rt={class:"grid grid-cols-1 md:grid-cols-3 gap-3"},st=["id","onUpdate:modelValue","max","onInput"],it={key:0,class:"text-[11px] text-gray-500 mt-1"},nt={class:"w-full rounded-md border border-input bg-transparent px-2 py-1 mt-1 text-sm text-foreground dark:bg-input/30 h-8 flex items-center"},dt={class:"mt-4 pt-3 border-t"},ut={class:"flex justify-end"},at={class:"text-right space-y-1"},lt={class:"text-sm text-muted-foreground"},ct={class:"text-sm text-muted-foreground"},mt={class:"text-base font-medium"},At=E({__name:"Create",props:{customer_id:{},products:{}},setup(V){const c=V,d=M({customer_id:c.customer_id,notes:"",order_items:[{product_id:null,quantity:1}]}),j=[{title:"Orders",href:"/orders"},{title:"Create Order",href:"/orders/create"}],y=p(()=>d.order_items.reduce((o,t)=>{if(t.product_id&&t.quantity){const e=c.products.find(i=>i.id===t.product_id);if(e)return o+t.quantity*e.selling_price}return o},0)),h=p(()=>y.value*.12),A=p(()=>y.value+h.value),I=p(()=>!d.customer_id||!d.order_items.length?!1:d.order_items.some(o=>!!o.product_id&&o.quantity>0));function Q(){d.order_items.push({product_id:null,quantity:1})}function F(o){d.order_items.length>1&&d.order_items.splice(o,1)}function N(o){const t=d.order_items[o];if(t.product_id&&t.quantity){const e=c.products.find(i=>i.id===t.product_id);e&&t.quantity>e.stock&&(t.quantity=e.stock,v.fire({icon:"info",title:"Quantity Adjusted",text:`Quantity for "${e.name}" has been adjusted to the maximum available stock (${e.stock} units).`,confirmButtonText:"OK",toast:!0,position:"top-end",timer:3e3,timerProgressBar:!0}))}}function P(o){const t=d.order_items[o];if(t.product_id&&t.quantity){const e=c.products.find(i=>i.id===t.product_id);e&&t.quantity>e.stock&&(t.quantity=e.stock,v.fire({icon:"info",title:"Quantity Adjusted",text:`Quantity for "${e.name}" has been adjusted to the maximum available stock (${e.stock} units).`,confirmButtonText:"OK",toast:!0,position:"top-end",timer:3e3,timerProgressBar:!0}))}}function U(){for(let o=0;o<d.order_items.length;o++){const t=d.order_items[o];if(t.product_id&&t.quantity){const e=c.products.find(i=>i.id===t.product_id);e&&t.quantity>e.stock&&(t.quantity=e.stock,v.fire({icon:"warning",title:"Quantity Auto-Adjusted",text:`Quantity for "${e.name}" was automatically adjusted to ${e.stock} units due to stock limitations.`,confirmButtonText:"OK"}))}}d.post(route("orders.store"),{preserveScroll:!0,onSuccess:()=>{v.fire({toast:!0,position:"top-end",icon:"success",title:"Order created successfully",text:"Your order is pending approval from staff.",showConfirmButton:!1,timer:3e3,timerProgressBar:!0})}})}function $(o){return d.errors[o]}function D(){return[{value:null,label:"Select product"},...c.products.map(o=>({value:o.id,label:`${o.name} (Stock: ${o.stock})`}))]}function K(o){const t=d.order_items[o];if(t.product_id&&t.quantity){const e=c.products.find(i=>i.id===t.product_id);if(e)return t.quantity*e.selling_price}return 0}return(o,t)=>(f(),q(R,{breadcrumbs:j},{default:n(()=>[s(u(Y),{title:"Create Order"}),t[12]||(t[12]=r("div",{class:"flex items-center justify-between mb-6"},[r("h1",{class:"text-2xl font-bold"},"Create Order")],-1)),r("form",{onSubmit:t[1]||(t[1]=z(e=>U(),["prevent"])),class:"space-y-6"},[s(x,null,{default:n(()=>[s(B,null,{default:n(()=>[s(T,null,{default:n(()=>t[2]||(t[2]=[l("Order Details")])),_:1,__:[2]})]),_:1}),s(C,{class:"space-y-6"},{default:n(()=>[t[4]||(t[4]=r("div",{class:"bg-yellow-50 border border-yellow-200 rounded-md p-4"},[r("p",{class:"text-sm text-yellow-800"},[r("strong",null,"Note:"),l(" Your order will be reviewed by staff for product availability before approval. Once approved, an invoice will be automatically generated. ")])],-1)),r("div",null,[s(b,{for:"notes"},{default:n(()=>t[3]||(t[3]=[l("Notes (Optional)")])),_:1,__:[3]}),w(r("textarea",{id:"notes","onUpdate:modelValue":t[0]||(t[0]=e=>u(d).notes=e),class:"w-full rounded-md border border-input bg-transparent px-3 py-2 mt-1 text-foreground dark:bg-input/30 focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] focus-visible:outline-none",rows:"3",placeholder:"Add any special instructions or notes for your order..."},null,512),[[O,u(d).notes]]),s(k,{message:u(d).errors.notes},null,8,["message"])])]),_:1,__:[4]})]),_:1}),s(x,null,{default:n(()=>[s(B,null,{default:n(()=>[r("div",Z,[s(T,null,{default:n(()=>t[5]||(t[5]=[l("Order Items")])),_:1,__:[5]}),s(u(_),{type:"button",variant:"outline",onClick:Q},{default:n(()=>t[6]||(t[6]=[r("span",{class:"mr-2"},"+",-1),l(" Add Item ")])),_:1,__:[6]})])]),_:1}),s(C,null,{default:n(()=>[r("div",tt,[(f(!0),g(L,null,G(u(d).order_items,(e,i)=>(f(),g("div",{key:i,class:"border rounded-md p-3"},[r("div",et,[r("h4",ot,"Item "+m(i+1),1),u(d).order_items.length>1?(f(),q(u(_),{key:0,type:"button",variant:"ghost",size:"sm",class:"h-7 w-7 p-0 text-red-500 hover:text-red-600 hover:bg-red-50 dark:hover:bg-red-950/20",onClick:a=>F(i)},{default:n(()=>[s(u(X),{class:"h-4 w-4"})]),_:2},1032,["onClick"])):S("",!0)]),r("div",rt,[r("div",null,[s(b,{for:`product_id_${i}`,class:"text-xs"},{default:n(()=>t[7]||(t[7]=[l("Product")])),_:2,__:[7]},1032,["for"]),s(u(J),{modelValue:e.product_id,"onUpdate:modelValue":[a=>e.product_id=a,a=>N(i)],options:D(),placeholder:"Select product","search-placeholder":"Search products...",class:"mt-1 h-8",required:""},null,8,["modelValue","onUpdate:modelValue","options"]),s(k,{message:$(`order_items.${i}.product_id`)},null,8,["message"])]),r("div",null,[s(b,{for:`quantity_${i}`,class:"text-xs"},{default:n(()=>t[8]||(t[8]=[l("Quantity")])),_:2,__:[8]},1032,["for"]),w(r("input",{id:`quantity_${i}`,"onUpdate:modelValue":a=>e.quantity=a,type:"number",min:"1",max:e.product_id?(c.products.find(a=>a.id===e.product_id)||{stock:0}).stock:void 0,class:"w-full rounded-md border border-input bg-transparent px-2 py-1 mt-1 text-sm text-foreground dark:bg-input/30 focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] focus-visible:outline-none h-8",onInput:a=>P(i),required:""},null,40,st),[[O,e.quantity,void 0,{number:!0}]]),e.product_id?(f(),g("div",it," In stock: "+m((c.products.find(a=>a.id===e.product_id)||{stock:0}).stock),1)):S("",!0),s(k,{message:$(`order_items.${i}.quantity`)},null,8,["message"])]),r("div",null,[s(b,{class:"text-xs"},{default:n(()=>t[9]||(t[9]=[l("Total")])),_:1,__:[9]}),r("div",nt," ₱"+m(K(i).toFixed(2)),1)])])]))),128))]),r("div",dt,[r("div",ut,[r("div",at,[r("div",lt,"Subtotal: ₱"+m(y.value.toFixed(2)),1),r("div",ct,"VAT (12%): ₱"+m(h.value.toFixed(2)),1),r("div",mt,"Total Amount: ₱"+m(A.value.toFixed(2)),1)])])])]),_:1})]),_:1}),s(x,null,{default:n(()=>[s(W,{class:"flex gap-2 justify-end"},{default:n(()=>[s(u(_),{type:"submit",disabled:!I.value,variant:"default"},{default:n(()=>t[10]||(t[10]=[l("Submit Order")])),_:1,__:[10]},8,["disabled"]),s(u(H),{href:o.route("orders.index")},{default:n(()=>[s(u(_),{type:"button",variant:"ghost"},{default:n(()=>t[11]||(t[11]=[l("Cancel")])),_:1,__:[11]})]),_:1},8,["href"])]),_:1})]),_:1})],32)]),_:1,__:[12]}))}});export{At as default};
