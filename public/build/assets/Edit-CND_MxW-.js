import{d as W,D as H,l as X,z,j as $,I as J,c as Y,o as P,w as a,a as r,b as i,u as o,g as K,q as Q,e as u,A as c,B as v,f as V,h as D,S as Z}from"./app-BppbanFS.js";import{_ as y}from"./index-DdAVKVaq.js";import{_ as C}from"./Select.vue_vue_type_script_setup_true_lang-B-HEN9p8.js";import{_ as ee}from"./SearchSelect.vue_vue_type_script_setup_true_lang-DNWoqHzV.js";import{_ as te}from"./AppLayout.vue_vue_type_script_setup_true_lang-D5Pq10W9.js";import{_ as M,a as h}from"./CardContent.vue_vue_type_script_setup_true_lang-Cp4AVxHx.js";import{_ as k,a as S}from"./CardTitle.vue_vue_type_script_setup_true_lang-pPrA6o1g.js";import{_ as re}from"./CardFooter.vue_vue_type_script_setup_true_lang-8zeefmuX.js";import{_ as m}from"./Label.vue_vue_type_script_setup_true_lang-P16Xb_4X.js";import{S as g}from"./sweetalert2.esm.all-BQIkj5Wb.js";import{_ as f}from"./InputError.vue_vue_type_script_setup_true_lang-COWMmP1y.js";import{D as oe}from"./DeliveryRouteMap-C-JfNxc6.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-ux9OOYtp.js";import"./createLucideIcon-DxD9bzKd.js";import"./RovingFocusGroup-6gC7THRb.js";import"./LocationInput.vue_vue_type_style_index_0_scoped_0fe2f881_lang-CQ7Ev6Bh.js";import"./Input.vue_vue_type_script_setup_true_lang-BQgv2MFq.js";import"./search-CIhrno3W.js";import"./VisuallyHidden-DrnV714O.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-BHfjNyTC.js";import"./_plugin-vue_export-helper-CI-bknNw.js";import"./marker-icon-2x-1TirABJh.js";import"./marker-icon-B6h-nX3D.js";import"./marker-shadow-B9CpECYs.js";const le={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ie={class:"flex gap-2 mt-1"},se={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ne={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},ae={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},de={class:"mt-1 space-y-4"},ue={class:"flex items-center gap-4"},me={key:0,class:"relative inline-block"},fe=["src"],pe={key:1,class:"relative inline-block"},ce=["src"],Ae=W({__name:"Edit",props:{delivery:{},customers:{},invoices:{}},setup(I){const d=I,t=H({customer_id:d.delivery.customer_id,invoice_id:d.delivery.invoice_id||null,delivery_address:d.delivery.delivery_address,contact_person:d.delivery.contact_person,contact_phone:d.delivery.contact_phone,delivery_date:d.delivery.delivery_date,delivery_time:d.delivery.delivery_time,status:d.delivery.status,notes:d.delivery.notes||"",delivery_fee:d.delivery.delivery_fee.toString(),proof_of_delivery:null}),E=[{title:"Deliveries",href:"/deliveries"},{title:"Edit Delivery",href:`/deliveries/${d.delivery.id}/edit`}];function N(s){const e=s.target;let l=e.value;l=l.replace(/[^0-9+]/g,""),l.startsWith("+")?(l.length>1&&!l.startsWith("+63")&&(l="+63"+l.substring(1).replace(/[^0-9]/g,"")),l.length>13&&(l=l.substring(0,13))):(l.length>0&&l[0]==="0"&&l.length>1&&l[1]!=="9"&&(l="09"+l.substring(2).replace(/[^0-9]/g,"")),l.startsWith("63")&&(l="+"+l),l.length>11&&!l.startsWith("+")&&(l=l.substring(0,11))),l!==e.value&&(e.value=l),t.contact_phone=l}function F(){if(!/^(?:\+?63|0)9\d{9}$/.test(t.contact_phone||"")){t.setError("contact_phone","Enter a valid PH mobile number (09XXXXXXXXX or +639XXXXXXXXX).");return}t.put(route("deliveries.update",d.delivery.id),{preserveScroll:!0,onSuccess:()=>{g.fire({toast:!0,position:"top-end",icon:"success",title:"Delivery updated successfully",showConfirmButton:!1,timer:3e3,timerProgressBar:!0})}})}const U=X(()=>[{value:null,label:"Select customer"},...d.customers.map(s=>({value:s.id,label:`${s.name}${s.company_name?` (${s.company_name})`:""}`}))]),B=X(()=>{if(!t.customer_id)return[{value:null,label:"Select invoice (select customer first)"}];const s=d.invoices.filter(e=>e.customer_id===t.customer_id);return[{value:null,label:"Select invoice (optional)"},...s.map(e=>({value:e.id,label:`Invoice #${e.id} - ${R(e.total_amount)}`}))]}),q=[{value:"pending",label:"Pending"},{value:"completed",label:"Completed"},{value:"cancelled",label:"Cancelled"}],A=[{value:"09:00 AM - 12:00 PM",label:"09:00 AM - 12:00 PM"},{value:"12:00 PM - 03:00 PM",label:"12:00 PM - 03:00 PM"},{value:"03:00 PM - 06:00 PM",label:"03:00 PM - 06:00 PM"},{value:"06:00 PM - 09:00 PM",label:"06:00 PM - 09:00 PM"},{value:"Custom",label:"Custom"}];function R(s){return new Intl.NumberFormat("en-PH",{style:"currency",currency:"PHP",minimumFractionDigits:2}).format(s)}const G=X(()=>{if(!t.customer_id)return null;const s=d.customers.find(l=>l.id===t.customer_id);if(!(s!=null&&s.location))return null;let e=s.location;if(typeof e=="string")try{e=JSON.parse(e)}catch{return console.warn("Failed to parse customer location string:",e),null}return e&&typeof e.lat=="number"&&typeof e.lng=="number"&&!isNaN(e.lat)&&!isNaN(e.lng)&&e.lat>=-90&&e.lat<=90&&e.lng>=-180&&e.lng<=180?e:(console.warn("Invalid customer location data:",s.location),null)}),L=X(()=>t.customer_id&&d.customers.find(s=>s.id===t.customer_id)||null);z(()=>t.customer_id,s=>{if(s){const e=d.customers.find(l=>l.id===s);e!=null&&e.address&&!t.delivery_address&&(t.delivery_address=e.address)}});async function O(){try{if(!navigator.geolocation){g.fire({icon:"error",title:"Geolocation not supported",text:"Your browser does not support geolocation."});return}const s=await new Promise((w,x)=>{navigator.geolocation.getCurrentPosition(w,x,{enableHighAccuracy:!0,timeout:1e4,maximumAge:6e4})}),{latitude:e,longitude:l}=s.coords,n=await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${e}&lon=${l}&addressdetails=1`);if(!n.ok)throw new Error("Failed to get address");const p=await n.json();p.display_name&&(t.delivery_address=p.display_name,g.fire({icon:"success",title:"Location Retrieved",text:"Current location address has been filled in.",toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3}))}catch(s){console.error("Error getting location address:",s),g.fire({icon:"error",title:"Location Error",text:"Failed to get your current location address. Please enter it manually."})}}const _=$(null),b=$(null),T=s=>{var n;const l=(n=s.target.files)==null?void 0:n[0];if(l){if(!l.type.startsWith("image/")){g.fire({icon:"error",title:"Invalid File Type",text:"Please select an image file (JPEG, PNG, GIF, etc.)"});return}if(l.size>5*1024*1024){g.fire({icon:"error",title:"File Too Large",text:"Please select an image smaller than 5MB"});return}t.proof_of_delivery=l;const p=new FileReader;p.onload=w=>{var x;_.value=(x=w.target)==null?void 0:x.result},p.readAsDataURL(l)}},j=()=>{t.proof_of_delivery=null,_.value=null,b.value&&(b.value.value="")};return(s,e)=>{const l=J("Icon");return P(),Y(te,{breadcrumbs:E},{default:a(()=>[r(o(K),{title:"Edit Delivery"}),e[31]||(e[31]=i("div",{class:"flex items-center justify-between mb-6"},[i("h1",{class:"text-2xl font-bold"},"Edit Delivery")],-1)),i("form",{onSubmit:e[11]||(e[11]=Q(n=>F(),["prevent"])),class:"space-y-6"},[r(M,null,{default:a(()=>[r(k,null,{default:a(()=>[r(S,null,{default:a(()=>e[12]||(e[12]=[u("Delivery Details")])),_:1,__:[12]})]),_:1}),r(h,{class:"space-y-6"},{default:a(()=>[i("div",le,[i("div",null,[r(m,{for:"customer_id"},{default:a(()=>e[13]||(e[13]=[u("Customer")])),_:1,__:[13]}),r(o(ee),{modelValue:o(t).customer_id,"onUpdate:modelValue":e[0]||(e[0]=n=>o(t).customer_id=n),options:U.value,placeholder:"Select customer","search-placeholder":"Search customers...",class:"mt-1",required:""},null,8,["modelValue","options"]),r(f,{message:o(t).errors.customer_id},null,8,["message"])]),i("div",null,[r(m,{for:"invoice_id"},{default:a(()=>e[14]||(e[14]=[u("Invoice (Optional)")])),_:1,__:[14]}),r(o(C),{modelValue:o(t).invoice_id,"onUpdate:modelValue":e[1]||(e[1]=n=>o(t).invoice_id=n),options:B.value,placeholder:"Select invoice",class:"mt-1"},null,8,["modelValue","options"]),r(f,{message:o(t).errors.invoice_id},null,8,["message"])])]),i("div",null,[r(m,{for:"delivery_address"},{default:a(()=>e[15]||(e[15]=[u("Delivery Address")])),_:1,__:[15]}),i("div",ie,[c(i("textarea",{"onUpdate:modelValue":e[2]||(e[2]=n=>o(t).delivery_address=n),id:"delivery_address",class:"flex-1 rounded-md border border-input bg-transparent px-3 py-2 text-foreground dark:bg-input/30 focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] focus-visible:outline-none",rows:"3",placeholder:"Enter complete delivery address",required:""},null,512),[[v,o(t).delivery_address]]),r(o(y),{type:"button",variant:"outline",onClick:O,class:"h-fit px-3 py-2"},{default:a(()=>e[16]||(e[16]=[u(" ðŸ“ Get Current Location ")])),_:1,__:[16]})]),r(f,{message:o(t).errors.delivery_address},null,8,["message"])]),i("div",se,[i("div",null,[r(m,{for:"contact_person"},{default:a(()=>e[17]||(e[17]=[u("Contact Person")])),_:1,__:[17]}),c(i("input",{"onUpdate:modelValue":e[3]||(e[3]=n=>o(t).contact_person=n),type:"text",id:"contact_person",class:"w-full rounded-md border border-input bg-transparent px-3 py-2 mt-1 text-foreground dark:bg-input/30 focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] focus-visible:outline-none",placeholder:"Enter contact person name",required:""},null,512),[[v,o(t).contact_person]]),r(f,{message:o(t).errors.contact_person},null,8,["message"])]),i("div",null,[r(m,{for:"contact_phone"},{default:a(()=>e[18]||(e[18]=[u("Contact Phone")])),_:1,__:[18]}),c(i("input",{"onUpdate:modelValue":e[4]||(e[4]=n=>o(t).contact_phone=n),type:"tel",id:"contact_phone",inputmode:"numeric",pattern:"^(?:\\+?63|0)9\\d{9}$",maxlength:"13",class:"w-full rounded-md border border-input bg-transparent px-3 py-2 mt-1 text-foreground dark:bg-input/30 focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] focus-visible:outline-none",placeholder:"09XXXXXXXXX or +639XXXXXXXXX",onInput:N,required:""},null,544),[[v,o(t).contact_phone]]),r(f,{message:o(t).errors.contact_phone},null,8,["message"])])]),i("div",ne,[i("div",null,[r(m,{for:"delivery_date"},{default:a(()=>e[19]||(e[19]=[u("Delivery Date")])),_:1,__:[19]}),c(i("input",{"onUpdate:modelValue":e[5]||(e[5]=n=>o(t).delivery_date=n),type:"date",id:"delivery_date",class:"w-full rounded-md border border-input bg-transparent px-3 py-2 mt-1 text-foreground dark:bg-input/30 focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] focus-visible:outline-none",required:""},null,512),[[v,o(t).delivery_date]]),r(f,{message:o(t).errors.delivery_date},null,8,["message"])]),i("div",null,[r(m,{for:"delivery_time"},{default:a(()=>e[20]||(e[20]=[u("Delivery Time")])),_:1,__:[20]}),r(o(C),{modelValue:o(t).delivery_time,"onUpdate:modelValue":e[6]||(e[6]=n=>o(t).delivery_time=n),options:A,placeholder:"Select delivery time",class:"mt-1",required:""},null,8,["modelValue"]),r(f,{message:o(t).errors.delivery_time},null,8,["message"])]),i("div",null,[r(m,{for:"status"},{default:a(()=>e[21]||(e[21]=[u("Status")])),_:1,__:[21]}),r(o(C),{modelValue:o(t).status,"onUpdate:modelValue":e[7]||(e[7]=n=>o(t).status=n),options:q,placeholder:"Select status",class:"mt-1",required:""},null,8,["modelValue"]),r(f,{message:o(t).errors.status},null,8,["message"])])]),i("div",ae,[i("div",null,[r(m,{for:"delivery_fee"},{default:a(()=>e[22]||(e[22]=[u("Delivery Fee")])),_:1,__:[22]}),c(i("input",{"onUpdate:modelValue":e[8]||(e[8]=n=>o(t).delivery_fee=n),type:"number",id:"delivery_fee",min:"0",step:"0.01",class:"w-full rounded-md border border-input bg-transparent px-3 py-2 mt-1 text-foreground dark:bg-input/30 focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] focus-visible:outline-none",placeholder:"0.00",required:""},null,512),[[v,o(t).delivery_fee]]),r(f,{message:o(t).errors.delivery_fee},null,8,["message"])]),i("div",null,[r(m,{for:"notes"},{default:a(()=>e[23]||(e[23]=[u("Notes")])),_:1,__:[23]}),c(i("textarea",{"onUpdate:modelValue":e[9]||(e[9]=n=>o(t).notes=n),id:"notes",class:"w-full rounded-md border border-input bg-transparent px-3 py-2 mt-1 text-foreground dark:bg-input/30 focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] focus-visible:outline-none",rows:"3",placeholder:"Enter any additional notes"},null,512),[[v,o(t).notes]]),r(f,{message:o(t).errors.notes},null,8,["message"])])]),i("div",null,[r(m,{for:"proof_of_delivery"},{default:a(()=>e[24]||(e[24]=[u("Proof of Delivery")])),_:1,__:[24]}),i("div",de,[i("div",ue,[i("input",{ref_key:"fileInputRef",ref:b,type:"file",id:"proof_of_delivery",accept:"image/*",onChange:T,class:"hidden"},null,544),r(o(y),{type:"button",variant:"outline",onClick:e[10]||(e[10]=n=>{var p;return(p=b.value)==null?void 0:p.click()}),class:"flex items-center gap-2"},{default:a(()=>[r(l,{name:"upload",class:"h-4 w-4"}),e[25]||(e[25]=u(" Choose Image "))]),_:1,__:[25]}),e[26]||(e[26]=i("span",{class:"text-sm text-muted-foreground"}," Accepted formats: JPEG, PNG, GIF (Max 5MB) ",-1))]),_.value?(P(),V("div",me,[i("img",{src:_.value,alt:"Proof of delivery preview",class:"max-w-xs rounded-lg border border-border shadow-sm"},null,8,fe),r(o(y),{type:"button",variant:"destructive",size:"sm",onClick:j,class:"absolute -top-2 -right-2 h-6 w-6 rounded-full p-0"},{default:a(()=>[r(l,{name:"x",class:"h-3 w-3"})]),_:1})])):D("",!0),d.delivery.proof_of_delivery_url&&!_.value?(P(),V("div",pe,[i("img",{src:d.delivery.proof_of_delivery_url,alt:"Current proof of delivery",class:"max-w-xs rounded-lg border border-border shadow-sm"},null,8,ce),e[27]||(e[27]=i("div",{class:"mt-2 text-sm text-muted-foreground"}," Current proof of delivery image ",-1))])):D("",!0)]),r(f,{message:o(t).errors.proof_of_delivery},null,8,["message"])])]),_:1})]),_:1}),r(M,null,{default:a(()=>[r(k,null,{default:a(()=>[r(S,null,{default:a(()=>e[28]||(e[28]=[u("Delivery Route")])),_:1,__:[28]})]),_:1}),r(h,null,{default:a(()=>{var n;return[r(oe,{"customer-location":G.value,"delivery-address":o(t).delivery_address||((n=L.value)==null?void 0:n.address),"map-height":"400px"},null,8,["customer-location","delivery-address"])]}),_:1})]),_:1}),r(M,null,{default:a(()=>[r(re,{class:"flex gap-2 justify-end"},{default:a(()=>[r(o(y),{type:"submit",variant:"default"},{default:a(()=>e[29]||(e[29]=[u("Update Delivery")])),_:1,__:[29]}),r(o(Z),{href:s.route("deliveries.index")},{default:a(()=>[r(o(y),{type:"button",variant:"ghost"},{default:a(()=>e[30]||(e[30]=[u("Cancel")])),_:1,__:[30]})]),_:1},8,["href"])]),_:1})]),_:1})],32)]),_:1,__:[31]})}}});export{Ae as default};
