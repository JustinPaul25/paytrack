import{d as W,x as X,c as g,a as w,o as f,w as r,b as i,e as n,u as l,k as Z,q as ee,l as x,f as u,g as c,t as v,m as I,n as D,v as k,S as F,F as te,h as ne}from"./app-WiUpeBwz.js";import{_ as h}from"./index-Cn_g6VzM.js";import{_ as j}from"./Select.vue_vue_type_script_setup_true_lang-C6cCdH76.js";import{_ as Y}from"./SearchSelect.vue_vue_type_script_setup_true_lang-B-bgqbXr.js";import{_ as ie}from"./AppLayout.vue_vue_type_script_setup_true_lang-asCoNTCN.js";import{_ as q,a as R}from"./CardContent.vue_vue_type_script_setup_true_lang-C1Ro3lXn.js";import{a as V,_ as $}from"./CardTitle.vue_vue_type_script_setup_true_lang-CL8KIKUs.js";import{_ as le}from"./CardFooter.vue_vue_type_script_setup_true_lang-BpozAbEV.js";import{_ as p}from"./Label.vue_vue_type_script_setup_true_lang-CyKS2_tF.js";import{S}from"./sweetalert2.esm.all-BQIkj5Wb.js";import{_}from"./InputError.vue_vue_type_script_setup_true_lang--EdPhFmS.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-BUpirRbf.js";import"./createLucideIcon-DXTUwZoB.js";import"./RovingFocusGroup-DA_UrK7F.js";import"./LocationInput.vue_vue_type_style_index_0_scoped_5601c0ff_lang-DTIP4i8X.js";import"./Input.vue_vue_type_script_setup_true_lang-cNK_ZO_F.js";import"./search-Bx7Ckkek.js";import"./VisuallyHidden-CHKbz_EY.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-4xCIPFzj.js";const re={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},oe={class:"text-xs text-gray-500 mt-1"},se={key:0,class:"text-xs text-orange-500 mt-1"},ae={key:1,class:"text-xs text-gray-400 mt-1"},ue={key:0,class:"text-xs text-blue-500 mt-1"},de={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},me={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},fe=["max","disabled"],ve={key:0,class:"text-xs text-orange-500 mt-1"},ce={key:1,class:"text-xs text-red-500 mt-1"},pe={key:2,class:"text-xs text-gray-500 mt-1"},_e=["disabled"],be={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ge={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},ye={class:"text-lg font-semibold"},xe={class:"text-lg font-semibold"},Ie={class:"text-lg font-semibold"},ke={class:"space-y-2 text-sm text-orange-700 dark:text-orange-300"},qe={class:"mt-3 p-3 bg-white dark:bg-gray-800 rounded border"},Se={class:"space-y-1 text-xs"},we={class:"mt-2"},Re={class:"space-y-2 text-sm text-blue-700 dark:text-blue-300"},Ve={class:"space-y-1"},$e={key:0,class:"text-gray-500"},Le=W({__name:"Create",props:{invoice:{},invoiceItem:{},availableInvoices:{},invoiceStats:{},refundTypes:{},refundMethods:{}},setup(K){var A,Q,T,B,P;const m=K,t=X({invoice_id:((A=m.invoice)==null?void 0:A.id)||null,invoice_item_id:((Q=m.invoiceItem)==null?void 0:Q.id)||null,product_id:((T=m.invoiceItem)==null?void 0:T.product_id)||null,quantity_refunded:((B=m.invoiceItem)==null?void 0:B.quantity)||1,refund_amount:((P=m.invoiceItem)==null?void 0:P.total)||0,refund_type:"full",refund_method:"cash",reason:"",notes:"",reference_number:"Auto-generated",create_another:void 0}),E=[{title:"Refunds",href:"/refunds"},{title:"Create Refund",href:"/refunds/create"}],b=g(()=>t.invoice_id?m.availableInvoices.find(o=>o.id===t.invoice_id):m.invoice),a=g(()=>t.invoice_item_id&&b.value?b.value.invoice_items.find(o=>o.id===t.invoice_item_id):m.invoiceItem),d=g(()=>a.value?a.value.quantity:0),H=g(()=>[{value:null,label:"Select invoice"},...m.availableInvoices.map(o=>({value:o.id,label:`Invoice #${o.id} - ${o.customer.name}${o.customer.company_name?` (${o.customer.company_name})`:""}`}))]),y=g(()=>m.availableInvoices.length),z=g(()=>b.value?[{value:null,label:"Select item"},...b.value.invoice_items.map(o=>({value:o.id,label:`${o.product.name} - Qty: ${o.quantity} - ₱${o.total.toFixed(2)}`}))]:[{value:null,label:"Select invoice first"}]);function L(){a.value&&(t.product_id=a.value.product_id,t.quantity_refunded=a.value.quantity,t.refund_amount=a.value.total)}function C(){if(a.value&&t.quantity_refunded){const o=a.value.price;t.refund_amount=t.quantity_refunded*o,t.quantity_refunded>d.value&&(t.quantity_refunded=d.value,t.refund_amount=d.value*o,S.fire({icon:"info",title:"Quantity Adjusted",text:`Quantity has been adjusted to the maximum available (${d.value} units).`,confirmButtonText:"OK",toast:!0,position:"top-end",timer:3e3,timerProgressBar:!0}))}}function G(){a.value&&(t.refund_type==="full"?(t.quantity_refunded=a.value.quantity,t.refund_amount=a.value.total):t.refund_type==="partial"||t.refund_type==="exchange"&&(t.quantity_refunded=a.value.quantity,t.refund_amount=0))}function N(o=!1){if(!a.value){S.fire({icon:"error",title:"No Invoice Item Selected",text:"Please select an invoice item before creating a refund.",confirmButtonText:"OK"});return}if(d.value===0){S.fire({icon:"error",title:"No Quantity Available",text:"This item has no quantity available for refund.",confirmButtonText:"OK"});return}t.quantity_refunded>d.value&&(t.quantity_refunded=d.value,C(),S.fire({icon:"warning",title:"Quantity Auto-Adjusted",text:`Quantity was automatically adjusted to ${d.value} units due to limitations.`,confirmButtonText:"OK"})),o?t.create_another=1:delete t.create_another,t.post(route("refunds.store"),{preserveScroll:!0,onSuccess:()=>{S.fire({toast:!0,position:"top-end",icon:"success",title:"Refund created successfully",showConfirmButton:!1,timer:3e3,timerProgressBar:!0}),o&&(t.reset(),t.invoice_id=null,t.invoice_item_id=null,t.product_id=null,t.quantity_refunded=1,t.refund_amount=0,t.reference_number="Auto-generated")}})}function J(o){return new Intl.NumberFormat("en-PH",{style:"currency",currency:"PHP",minimumFractionDigits:2}).format(o)}return(o,e)=>(f(),w(ie,{breadcrumbs:E},{default:r(()=>[i(l(Z),{title:"Create Refund"}),e[36]||(e[36]=n("div",{class:"flex items-center justify-between mb-6"},[n("h1",{class:"text-2xl font-bold"},"Create Refund")],-1)),n("form",{onSubmit:e[10]||(e[10]=ee(s=>N(),["prevent"])),class:"space-y-6"},[i(q,null,{default:r(()=>[i(V,null,{default:r(()=>[i($,null,{default:r(()=>e[11]||(e[11]=[u("Refund Details")])),_:1,__:[11]})]),_:1}),i(R,{class:"space-y-6"},{default:r(()=>[n("div",re,[n("div",null,[i(p,{for:"invoice_id"},{default:r(()=>e[12]||(e[12]=[u("Invoice")])),_:1,__:[12]}),i(l(Y),{modelValue:l(t).invoice_id,"onUpdate:modelValue":e[0]||(e[0]=s=>l(t).invoice_id=s),options:H.value,placeholder:"Select invoice","search-placeholder":"Search by invoice # or customer name...",class:"mt-1",required:""},null,8,["modelValue","options"]),n("div",oe," Available invoices: "+v(y.value)+" (completed invoices from last 3 months) ",1),y.value===0?(f(),c("div",se,' No completed invoices available for refund. Only invoices with "completed" status from the last 3 months can be refunded. ')):(f(),c("div",ae,' Search by: invoice number (e.g., "123") or customer name ')),i(_,{message:l(t).errors.invoice_id},null,8,["message"])]),n("div",null,[i(p,{for:"invoice_item_id"},{default:r(()=>e[13]||(e[13]=[u("Invoice Item")])),_:1,__:[13]}),i(l(Y),{modelValue:l(t).invoice_item_id,"onUpdate:modelValue":[e[1]||(e[1]=s=>l(t).invoice_item_id=s),L],options:z.value,placeholder:"Select item","search-placeholder":"Search items...",class:"mt-1",disabled:!b.value,required:""},null,8,["modelValue","options","disabled"]),b.value&&!a.value?(f(),c("div",ue," Please select an item from this invoice to proceed with the refund ")):x("",!0),i(_,{message:l(t).errors.invoice_item_id},null,8,["message"])])]),n("div",de,[n("div",null,[i(p,{for:"refund_type"},{default:r(()=>e[14]||(e[14]=[u("Refund Type")])),_:1,__:[14]}),i(l(j),{modelValue:l(t).refund_type,"onUpdate:modelValue":[e[2]||(e[2]=s=>l(t).refund_type=s),G],options:o.refundTypes,placeholder:"Select refund type",class:"mt-1",required:""},null,8,["modelValue","options"]),i(_,{message:l(t).errors.refund_type},null,8,["message"])]),n("div",null,[i(p,{for:"refund_method"},{default:r(()=>e[15]||(e[15]=[u("Refund Method")])),_:1,__:[15]}),i(l(j),{modelValue:l(t).refund_method,"onUpdate:modelValue":e[3]||(e[3]=s=>l(t).refund_method=s),options:o.refundMethods,placeholder:"Select refund method",class:"mt-1",required:""},null,8,["modelValue","options"]),i(_,{message:l(t).errors.refund_method},null,8,["message"])])]),n("div",me,[n("div",null,[i(p,{for:"quantity_refunded"},{default:r(()=>e[16]||(e[16]=[u("Quantity to Refund")])),_:1,__:[16]}),I(n("input",{"onUpdate:modelValue":e[4]||(e[4]=s=>l(t).quantity_refunded=s),type:"number",id:"quantity_refunded",min:"1",max:d.value,disabled:!a.value||d.value===0,class:D(["w-full rounded-md border border-input px-3 py-2 mt-1 text-foreground focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] focus-visible:outline-none",!a.value||d.value===0?"bg-gray-100 dark:bg-gray-800 cursor-not-allowed":"bg-transparent dark:bg-input/30"]),onInput:C,required:""},null,42,fe),[[k,l(t).quantity_refunded,void 0,{number:!0}]]),a.value?d.value===0?(f(),c("div",ce," No quantity available for refund on this item ")):(f(),c("div",pe," Maximum available: "+v(d.value),1)):(f(),c("div",ve," Please select an invoice item first ")),i(_,{message:l(t).errors.quantity_refunded},null,8,["message"])]),n("div",null,[i(p,{for:"refund_amount"},{default:r(()=>e[17]||(e[17]=[u("Refund Amount")])),_:1,__:[17]}),I(n("input",{"onUpdate:modelValue":e[5]||(e[5]=s=>l(t).refund_amount=s),type:"number",id:"refund_amount",min:"0",step:"0.01",disabled:l(t).refund_type==="exchange"||!a.value||d.value===0,class:D(["w-full rounded-md border border-input px-3 py-2 mt-1 text-foreground focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] focus-visible:outline-none",l(t).refund_type==="exchange"||!a.value||d.value===0?"bg-gray-100 dark:bg-gray-800 cursor-not-allowed":"bg-transparent dark:bg-input/30"]),required:""},null,10,_e),[[k,l(t).refund_amount,void 0,{number:!0}]]),i(_,{message:l(t).errors.refund_amount},null,8,["message"])])]),n("div",be,[n("div",null,[i(p,{for:"reference_number",class:"flex items-center gap-2"},{default:r(()=>e[18]||(e[18]=[u(" Reference Number "),n("span",{class:"text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded-full"},"Auto-generated",-1)])),_:1,__:[18]}),I(n("input",{"onUpdate:modelValue":e[6]||(e[6]=s=>l(t).reference_number=s),type:"text",id:"reference_number",class:"w-full rounded-md border border-input bg-gray-100 dark:bg-gray-800 px-3 py-2 mt-1 text-foreground cursor-not-allowed",placeholder:"Auto-generated reference number",readonly:""},null,512),[[k,l(t).reference_number]]),e[19]||(e[19]=n("div",{class:"text-xs text-gray-500 mt-1"}," Format: RRNYYYYMMDD#### (e.g., RRN202412150001) ",-1)),i(_,{message:l(t).errors.reference_number},null,8,["message"])]),n("div",null,[i(p,{for:"reason"},{default:r(()=>e[20]||(e[20]=[u("Reason")])),_:1,__:[20]}),I(n("input",{"onUpdate:modelValue":e[7]||(e[7]=s=>l(t).reason=s),type:"text",id:"reason",class:"w-full rounded-md border border-input bg-transparent px-3 py-2 mt-1 text-foreground dark:bg-input/30 focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] focus-visible:outline-none",placeholder:"Enter refund reason",required:""},null,512),[[k,l(t).reason]]),i(_,{message:l(t).errors.reason},null,8,["message"])])]),n("div",null,[i(p,{for:"notes"},{default:r(()=>e[21]||(e[21]=[u("Notes")])),_:1,__:[21]}),I(n("textarea",{id:"notes","onUpdate:modelValue":e[8]||(e[8]=s=>l(t).notes=s),class:"w-full rounded-md border border-input bg-transparent px-3 py-2 mt-1 text-foreground dark:bg-input/30 focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] focus-visible:outline-none",rows:"3",placeholder:"Additional notes..."},null,512),[[k,l(t).notes]]),i(_,{message:l(t).errors.notes},null,8,["message"])])]),_:1})]),_:1}),a.value?(f(),w(q,{key:0},{default:r(()=>[i(V,null,{default:r(()=>[i($,null,{default:r(()=>e[22]||(e[22]=[u("Selected Item Details")])),_:1,__:[22]})]),_:1}),i(R,null,{default:r(()=>[n("div",ge,[n("div",null,[e[23]||(e[23]=n("label",{class:"text-sm font-medium text-gray-500"},"Product",-1)),n("p",ye,v(a.value.product.name),1)]),n("div",null,[e[24]||(e[24]=n("label",{class:"text-sm font-medium text-gray-500"},"Original Quantity",-1)),n("p",xe,v(a.value.quantity),1)]),n("div",null,[e[25]||(e[25]=n("label",{class:"text-sm font-medium text-gray-500"},"Original Price",-1)),n("p",Ie,v(J(a.value.price)),1)])])]),_:1})]),_:1})):x("",!0),y.value===0?(f(),w(q,{key:1,class:"border-orange-200 bg-orange-50 dark:border-orange-800 dark:bg-orange-950/20"},{default:r(()=>[i(V,null,{default:r(()=>[i($,{class:"text-orange-800 dark:text-orange-200"},{default:r(()=>e[26]||(e[26]=[u("No Invoices Available for Refund")])),_:1,__:[26]})]),_:1}),i(R,null,{default:r(()=>{var s,O,U,M;return[n("div",ke,[e[29]||(e[29]=n("p",null,[n("strong",null,"Requirements for refundable invoices:")],-1)),e[30]||(e[30]=n("ul",{class:"list-disc list-inside space-y-1 ml-4"},[n("li",null,'Invoice status must be "completed"'),n("li",null,"Invoice must be created within the last 3 months"),n("li",null,"Invoice must have at least one item")],-1)),n("div",qe,[e[27]||(e[27]=n("p",{class:"font-semibold mb-2"},"Invoice Statistics:",-1)),n("ul",Se,[n("li",null,"Total invoices: "+v(((s=m.invoiceStats)==null?void 0:s.totalInvoices)||0),1),n("li",null,"Completed invoices: "+v(((O=m.invoiceStats)==null?void 0:O.completedInvoices)||0),1),n("li",null,"Recent invoices (last 3 months): "+v(((U=m.invoiceStats)==null?void 0:U.recentInvoices)||0),1),n("li",null,"Available for refund: "+v(((M=m.invoiceStats)==null?void 0:M.availableForRefund)||0),1)])]),n("p",we,[i(l(F),{href:o.route("invoices.index"),class:"text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-200 underline"},{default:r(()=>e[28]||(e[28]=[u(" View all invoices → ")])),_:1,__:[28]},8,["href"])])])]}),_:1})]),_:1})):x("",!0),y.value>0&&y.value<=5?(f(),w(q,{key:2,class:"border-blue-200 bg-blue-50 dark:border-blue-800 dark:bg-blue-950/20"},{default:r(()=>[i(V,null,{default:r(()=>[i($,{class:"text-blue-800 dark:text-blue-200"},{default:r(()=>e[31]||(e[31]=[u("Available Invoices for Refund")])),_:1,__:[31]})]),_:1}),i(R,null,{default:r(()=>[n("div",Re,[e[32]||(e[32]=n("p",{class:"mb-3"},"You can search for any of these invoices:",-1)),n("div",Ve,[(f(!0),c(te,null,ne(m.availableInvoices,s=>(f(),c("div",{key:s.id,class:"p-2 bg-white dark:bg-gray-800 rounded border"},[n("strong",null,"Invoice #"+v(s.id),1),u(" - "+v(s.customer.name)+" ",1),s.customer.company_name?(f(),c("span",$e,"("+v(s.customer.company_name)+")",1)):x("",!0)]))),128))])])]),_:1})]),_:1})):x("",!0),i(q,null,{default:r(()=>[i(le,{class:"flex gap-2 justify-end"},{default:r(()=>[i(l(h),{type:"submit",variant:"default",disabled:!a.value||d.value===0},{default:r(()=>e[33]||(e[33]=[u(" Create Refund ")])),_:1,__:[33]},8,["disabled"]),i(l(h),{type:"button",variant:"secondary",onClick:e[9]||(e[9]=s=>N(!0)),disabled:!a.value||d.value===0},{default:r(()=>e[34]||(e[34]=[u(" Create & create another ")])),_:1,__:[34]},8,["disabled"]),i(l(F),{href:o.route("refunds.index")},{default:r(()=>[i(l(h),{type:"button",variant:"ghost"},{default:r(()=>e[35]||(e[35]=[u("Cancel")])),_:1,__:[35]})]),_:1},8,["href"])]),_:1})]),_:1})],32)]),_:1,__:[36]}))}});export{Le as default};
