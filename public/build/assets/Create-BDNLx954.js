import{d as I,D as O,l as c,z as L,c as R,o as T,w as s,a as i,b as n,u as o,g as j,q as F,e as a,A as m,B as p,S as W}from"./app-Cwu7HoSd.js";import{_ as g}from"./index-BdY75aZ2.js";import{_}from"./Select.vue_vue_type_script_setup_true_lang-CBzjz3As.js";import{_ as G}from"./SearchSelect.vue_vue_type_script_setup_true_lang-KeLTEBMp.js";import{_ as H}from"./AppLayout.vue_vue_type_script_setup_true_lang-By9GJnaP.js";import{_ as b,a as X}from"./CardContent.vue_vue_type_script_setup_true_lang-BYmIXq6h.js";import{_ as w,a as C}from"./CardTitle.vue_vue_type_script_setup_true_lang-DreEaS5s.js";import{_ as z}from"./CardFooter.vue_vue_type_script_setup_true_lang-Da1iX7RO.js";import{_ as d}from"./Label.vue_vue_type_script_setup_true_lang-BMHPrx55.js";import{S as v}from"./sweetalert2.esm.all-BQIkj5Wb.js";import{_ as u}from"./InputError.vue_vue_type_script_setup_true_lang-BULHRL9y.js";import{D as J}from"./DeliveryRouteMap-DbQr89LM.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-DQ5B8Mu2.js";import"./createLucideIcon-BlW3GIPw.js";import"./RovingFocusGroup-BZ7O1hI-.js";import"./LocationInput.vue_vue_type_style_index_0_scoped_0fe2f881_lang-CbPCljGY.js";import"./Input.vue_vue_type_script_setup_true_lang-B7Gi-sP6.js";import"./search-fX2YwpmX.js";import"./VisuallyHidden-GGl4KIsE.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-DAN9CPXS.js";import"./_plugin-vue_export-helper-eiijoV99.js";import"./marker-icon-2x-1TirABJh.js";import"./marker-icon-B6h-nX3D.js";import"./marker-shadow-B9CpECYs.js";const Y={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},K={class:"flex gap-2 mt-1"},Q={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Z={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},ee=["min"],te={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ve=I({__name:"Create",props:{customers:{},invoices:{}},setup(P){const f=P,r=O({customer_id:null,invoice_id:null,delivery_address:"",contact_person:"",contact_phone:"",delivery_date:"",delivery_time:"",status:"pending",notes:"",delivery_fee:""}),M=[{title:"Deliveries",href:"/deliveries"},{title:"Create Delivery",href:"/deliveries/create"}];function V(l){const e=l.target;let t=e.value;t=t.replace(/[^0-9+]/g,""),t.startsWith("+")?(t.length>1&&!t.startsWith("+63")&&(t="+63"+t.substring(1).replace(/[^0-9]/g,"")),t.length>13&&(t=t.substring(0,13))):(t.length>0&&t[0]==="0"&&t.length>1&&t[1]!=="9"&&(t="09"+t.substring(2).replace(/[^0-9]/g,"")),t.startsWith("63")&&(t="+"+t),t.length>11&&!t.startsWith("+")&&(t=t.substring(0,11))),t!==e.value&&(e.value=t),r.contact_phone=t}function $(){if(!r.invoice_id){r.setError("invoice_id","Invoice is required.");return}if(!/^(?:\+?63|0)9\d{9}$/.test(r.contact_phone||"")){r.setError("contact_phone","Enter a valid PH mobile number (09XXXXXXXXX or +639XXXXXXXXX).");return}r.post(route("deliveries.store"),{preserveScroll:!0,onSuccess:()=>{v.fire({toast:!0,position:"top-end",icon:"success",title:"Delivery created successfully",showConfirmButton:!1,timer:3e3,timerProgressBar:!0})}})}const D=c(()=>[{value:null,label:"Select customer"},...f.customers.map(l=>({value:l.id,label:`${l.name}${l.company_name?` (${l.company_name})`:""}`}))]),S=c(()=>{if(!r.customer_id)return[{value:null,label:"Select invoice (select customer first)"}];const l=f.invoices.filter(e=>e.customer_id===r.customer_id);return[{value:null,label:"Select invoice"},...l.map(e=>({value:e.id,label:`${e.reference_number}`}))]}),q=[{value:"pending",label:"Pending"},{value:"completed",label:"Completed"},{value:"cancelled",label:"Cancelled"}],h=[{value:"09:00 AM - 12:00 PM",label:"09:00 AM - 12:00 PM"},{value:"12:00 PM - 03:00 PM",label:"12:00 PM - 03:00 PM"},{value:"03:00 PM - 06:00 PM",label:"03:00 PM - 06:00 PM"},{value:"06:00 PM - 09:00 PM",label:"06:00 PM - 09:00 PM"},{value:"Custom",label:"Custom"}],k=new Date().toISOString().split("T")[0],U=c(()=>{if(!r.customer_id)return null;const l=f.customers.find(t=>t.id===r.customer_id);if(!(l!=null&&l.location))return null;let e=l.location;if(typeof e=="string")try{e=JSON.parse(e)}catch{return console.warn("Failed to parse customer location string:",e),null}return e&&typeof e.lat=="number"&&typeof e.lng=="number"&&!isNaN(e.lat)&&!isNaN(e.lng)&&e.lat>=-90&&e.lat<=90&&e.lng>=-180&&e.lng<=180?e:(console.warn("Invalid customer location data:",l.location),null)}),E=c(()=>r.customer_id&&f.customers.find(l=>l.id===r.customer_id)||null);L(()=>r.customer_id,l=>{if(l){const e=f.customers.find(t=>t.id===l);e!=null&&e.address&&!r.delivery_address&&(r.delivery_address=e.address)}});async function N(){try{if(!navigator.geolocation){v.fire({icon:"error",title:"Geolocation not supported",text:"Your browser does not support geolocation."});return}const l=await new Promise((A,B)=>{navigator.geolocation.getCurrentPosition(A,B,{enableHighAccuracy:!0,timeout:1e4,maximumAge:6e4})}),{latitude:e,longitude:t}=l.coords,y=await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${e}&lon=${t}&addressdetails=1`);if(!y.ok)throw new Error("Failed to get address");const x=await y.json();x.display_name&&(r.delivery_address=x.display_name,v.fire({icon:"success",title:"Location Retrieved",text:"Current location address has been filled in.",toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3}))}catch(l){console.error("Error getting location address:",l),v.fire({icon:"error",title:"Location Error",text:"Failed to get your current location address. Please enter it manually."})}}return(l,e)=>(T(),R(H,{breadcrumbs:M},{default:s(()=>[i(o(j),{title:"Create Delivery"}),e[26]||(e[26]=n("div",{class:"flex items-center justify-between mb-6"},[n("h1",{class:"text-2xl font-bold"},"Create Delivery")],-1)),n("form",{onSubmit:e[10]||(e[10]=F(t=>$(),["prevent"])),class:"space-y-6"},[i(b,null,{default:s(()=>[i(w,null,{default:s(()=>[i(C,null,{default:s(()=>e[11]||(e[11]=[a("Delivery Details")])),_:1,__:[11]})]),_:1}),i(X,{class:"space-y-6"},{default:s(()=>[n("div",Y,[n("div",null,[i(d,{for:"customer_id"},{default:s(()=>e[12]||(e[12]=[a("Customer")])),_:1,__:[12]}),i(o(G),{modelValue:o(r).customer_id,"onUpdate:modelValue":e[0]||(e[0]=t=>o(r).customer_id=t),options:D.value,placeholder:"Select customer","search-placeholder":"Search customers...",class:"mt-1",required:""},null,8,["modelValue","options"]),i(u,{message:o(r).errors.customer_id},null,8,["message"])]),n("div",null,[i(d,{for:"invoice_id"},{default:s(()=>e[13]||(e[13]=[a("Invoice")])),_:1,__:[13]}),i(o(_),{modelValue:o(r).invoice_id,"onUpdate:modelValue":e[1]||(e[1]=t=>o(r).invoice_id=t),options:S.value,placeholder:"Select invoice",class:"mt-1",required:""},null,8,["modelValue","options"]),i(u,{message:o(r).errors.invoice_id},null,8,["message"])])]),n("div",null,[i(d,{for:"delivery_address"},{default:s(()=>e[14]||(e[14]=[a("Delivery Address")])),_:1,__:[14]}),n("div",K,[m(n("textarea",{"onUpdate:modelValue":e[2]||(e[2]=t=>o(r).delivery_address=t),id:"delivery_address",class:"flex-1 rounded-md border border-input bg-transparent px-3 py-2 text-foreground dark:bg-input/30 focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] focus-visible:outline-none",rows:"3",placeholder:"Enter complete delivery address",required:""},null,512),[[p,o(r).delivery_address]]),i(o(g),{type:"button",variant:"outline",onClick:N,class:"h-fit px-3 py-2"},{default:s(()=>e[15]||(e[15]=[a(" ðŸ“ Get Current Location ")])),_:1,__:[15]})]),i(u,{message:o(r).errors.delivery_address},null,8,["message"])]),n("div",Q,[n("div",null,[i(d,{for:"contact_person"},{default:s(()=>e[16]||(e[16]=[a("Contact Person")])),_:1,__:[16]}),m(n("input",{"onUpdate:modelValue":e[3]||(e[3]=t=>o(r).contact_person=t),type:"text",id:"contact_person",class:"w-full rounded-md border border-input bg-transparent px-3 py-2 mt-1 text-foreground dark:bg-input/30 focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] focus-visible:outline-none",placeholder:"Enter contact person name",required:""},null,512),[[p,o(r).contact_person]]),i(u,{message:o(r).errors.contact_person},null,8,["message"])]),n("div",null,[i(d,{for:"contact_phone"},{default:s(()=>e[17]||(e[17]=[a("Contact Phone")])),_:1,__:[17]}),m(n("input",{"onUpdate:modelValue":e[4]||(e[4]=t=>o(r).contact_phone=t),type:"tel",id:"contact_phone",inputmode:"numeric",pattern:"^(?:\\+?63|0)9\\d{9}$",maxlength:"13",class:"w-full rounded-md border border-input bg-transparent px-3 py-2 mt-1 text-foreground dark:bg-input/30 focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] focus-visible:outline-none",placeholder:"09XXXXXXXXX or +639XXXXXXXXX",onInput:V,required:""},null,544),[[p,o(r).contact_phone]]),i(u,{message:o(r).errors.contact_phone},null,8,["message"])])]),n("div",Z,[n("div",null,[i(d,{for:"delivery_date"},{default:s(()=>e[18]||(e[18]=[a("Delivery Date")])),_:1,__:[18]}),m(n("input",{"onUpdate:modelValue":e[5]||(e[5]=t=>o(r).delivery_date=t),type:"date",id:"delivery_date",min:o(k),class:"w-full rounded-md border border-input bg-transparent px-3 py-2 mt-1 text-foreground dark:bg-input/30 focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] focus-visible:outline-none",required:""},null,8,ee),[[p,o(r).delivery_date]]),i(u,{message:o(r).errors.delivery_date},null,8,["message"])]),n("div",null,[i(d,{for:"delivery_time"},{default:s(()=>e[19]||(e[19]=[a("Delivery Time")])),_:1,__:[19]}),i(o(_),{modelValue:o(r).delivery_time,"onUpdate:modelValue":e[6]||(e[6]=t=>o(r).delivery_time=t),options:h,placeholder:"Select delivery time",class:"mt-1",required:""},null,8,["modelValue"]),i(u,{message:o(r).errors.delivery_time},null,8,["message"])]),n("div",null,[i(d,{for:"status"},{default:s(()=>e[20]||(e[20]=[a("Status")])),_:1,__:[20]}),i(o(_),{modelValue:o(r).status,"onUpdate:modelValue":e[7]||(e[7]=t=>o(r).status=t),options:q,placeholder:"Select status",class:"mt-1",required:""},null,8,["modelValue"]),i(u,{message:o(r).errors.status},null,8,["message"])])]),n("div",te,[n("div",null,[i(d,{for:"delivery_fee"},{default:s(()=>e[21]||(e[21]=[a("Delivery Fee")])),_:1,__:[21]}),m(n("input",{"onUpdate:modelValue":e[8]||(e[8]=t=>o(r).delivery_fee=t),type:"number",id:"delivery_fee",min:"0",step:"0.01",class:"w-full rounded-md border border-input bg-transparent px-3 py-2 mt-1 text-foreground dark:bg-input/30 focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] focus-visible:outline-none",placeholder:"0.00",required:""},null,512),[[p,o(r).delivery_fee]]),i(u,{message:o(r).errors.delivery_fee},null,8,["message"])]),n("div",null,[i(d,{for:"notes"},{default:s(()=>e[22]||(e[22]=[a("Notes")])),_:1,__:[22]}),m(n("textarea",{"onUpdate:modelValue":e[9]||(e[9]=t=>o(r).notes=t),id:"notes",class:"w-full rounded-md border border-input bg-transparent px-3 py-2 mt-1 text-foreground dark:bg-input/30 focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] focus-visible:outline-none",rows:"3",placeholder:"Enter any additional notes"},null,512),[[p,o(r).notes]]),i(u,{message:o(r).errors.notes},null,8,["message"])])])]),_:1})]),_:1}),i(b,null,{default:s(()=>[i(w,null,{default:s(()=>[i(C,null,{default:s(()=>e[23]||(e[23]=[a("Delivery Route")])),_:1,__:[23]})]),_:1}),i(X,null,{default:s(()=>{var t;return[i(J,{"customer-location":U.value,"delivery-address":o(r).delivery_address||((t=E.value)==null?void 0:t.address),"map-height":"400px"},null,8,["customer-location","delivery-address"])]}),_:1})]),_:1}),i(b,null,{default:s(()=>[i(z,{class:"flex gap-2 justify-end"},{default:s(()=>[i(o(g),{type:"submit",variant:"default"},{default:s(()=>e[24]||(e[24]=[a("Create Delivery")])),_:1,__:[24]}),i(o(W),{href:l.route("deliveries.index")},{default:s(()=>[i(o(g),{type:"button",variant:"ghost"},{default:s(()=>e[25]||(e[25]=[a("Cancel")])),_:1,__:[25]})]),_:1},8,["href"])]),_:1})]),_:1})],32)]),_:1,__:[26]}))}});export{Ve as default};
