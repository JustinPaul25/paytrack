import{d as j,j as i,z as F,m as T,f as u,o as r,b as a,h as n,a as _,w as C,c as M,u as f,t as v,n as q,C as I,A as S,B as D,x as G}from"./app-CMwthHAy.js";import{v as W,u as P,p as Y,i as J,_ as K}from"./_plugin-vue_export-helper-D9EepBSG.js";import{b as U}from"./LocationInput.vue_vue_type_style_index_0_scoped_0fe2f881_lang-Bn3PhHWy.js";import Q from"./marker-icon-2x-1TirABJh.js";import X from"./marker-icon-B6h-nX3D.js";import Z from"./marker-shadow-B9CpECYs.js";const ee={class:"relative"},te={class:"text-center"},ae={class:"text-sm text-gray-600"},oe={class:"text-center"},le={class:"text-sm text-gray-600"},se={key:0,class:"text-xs text-gray-500 mt-1"},re={key:0,class:"absolute inset-0 bg-white/80 dark:bg-gray-900/80 flex items-center justify-center rounded-lg"},ne={key:0,class:"mt-4 p-4 bg-gray-50 dark:bg-gray-800 rounded-lg"},ie={class:"flex items-center justify-between"},ue={key:0,class:"text-right"},de={class:"text-lg font-bold text-gray-900 dark:text-gray-100"},ce={key:0,class:"text-sm text-gray-600 dark:text-gray-400"},ve={key:1,class:"mt-4 p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg"},ge={class:"flex items-center gap-2 mb-3"},fe={class:"text-sm text-red-700 dark:text-red-400"},me={class:"flex gap-2"},pe={key:0,class:"mt-3 p-3 bg-white dark:bg-gray-700 rounded border"},be={class:"flex gap-2"},ye={key:2,class:"mt-4 p-4 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg"},xe={key:3,class:"mt-4 p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg"},he=j({__name:"DeliveryRouteMap",props:{customerLocation:{},deliveryAddress:{},class:{default:""},mapHeight:{default:"400px"}},setup(R){U.Icon.Default.mergeOptions({iconRetinaUrl:Q,iconUrl:X,shadowUrl:Z});const d=R,o=i(null),m=i([]),y=i(null),x=i(null),h=i(!1),s=i(null),g=i([14.5995,120.9842]),p=i(10),w=i(!1),N=i(""),L=i(""),z=e=>new U.Icon({iconUrl:`data:image/svg+xml;base64,${btoa(`
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="${e}" width="24" height="24">
        <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
      </svg>
    `)}`,iconSize:[24,24],iconAnchor:[12,24],popupAnchor:[0,-24]}),B=z("#3b82f6"),V=z("#ef4444"),E=()=>new Promise((e,t)=>{if(!navigator.geolocation){t(new Error("Geolocation is not supported by this browser"));return}navigator.geolocation.getCurrentPosition(l=>{e({lat:l.coords.latitude,lng:l.coords.longitude})},l=>{let c="Unknown geolocation error";switch(l.code){case l.PERMISSION_DENIED:c="Location access was denied. Please allow location access in your browser settings and refresh the page.";break;case l.POSITION_UNAVAILABLE:c="Location information is unavailable. Please check your device location settings.";break;case l.TIMEOUT:c="Location request timed out. Please try again.";break;default:c=`Geolocation error: ${l.message}`}t(new Error(c))},{enableHighAccuracy:!1,timeout:15e3,maximumAge:3e5})}),k=async(e,t)=>{if(!e||!t||typeof e.lat!="number"||typeof e.lng!="number"||typeof t.lat!="number"||typeof t.lng!="number"||isNaN(e.lat)||isNaN(e.lng)||isNaN(t.lat)||isNaN(t.lng)){console.error("Invalid coordinates for route calculation:",{from:e,to:t}),s.value="Invalid coordinates for route calculation";return}try{h.value=!0,s.value=null;const l=`https://router.project-osrm.org/route/v1/driving/${e.lng},${e.lat};${t.lng},${t.lat}?overview=full&geometries=geojson`,c=await fetch(l);if(!c.ok)throw new Error("Failed to calculate route");const b=await c.json();if(b.routes&&b.routes[0]&&b.routes[0].geometry){const O=b.routes[0].geometry.coordinates;m.value=O.map(A=>[A[1],A[0]]),y.value=parseFloat((b.routes[0].distance/1e3).toFixed(1)),x.value=parseFloat((b.routes[0].duration/60).toFixed(1)),console.log("Route calculated:",{distance:y.value,duration:x.value,coordinates:m.value.length})}else throw new Error("No route found")}catch(l){console.error("Route calculation error:",l),s.value="Failed to calculate route. Please check your internet connection.",m.value=[[e.lat,e.lng],[t.lat,t.lng]]}finally{h.value=!1}};F(()=>d.customerLocation,async e=>{if(e&&typeof e.lat=="number"&&typeof e.lng=="number"&&!isNaN(e.lat)&&!isNaN(e.lng)&&e.lat>=-90&&e.lat<=90&&e.lng>=-180&&e.lng<=180)if(o.value){await k(o.value,e);const t=(o.value.lat+e.lat)/2,l=(o.value.lng+e.lng)/2;g.value=[t,l],p.value=12}else g.value=[e.lat,e.lng],p.value=13;else e&&(console.warn("Invalid customer location data:",e),s.value="Customer location data is invalid or missing. Please update the customer with valid coordinates.")},{immediate:!0}),T(async()=>{try{o.value=await E(),g.value=[o.value.lat,o.value.lng],p.value=13,d.customerLocation&&await k(o.value,d.customerLocation)}catch(e){console.error("Failed to get current location:",e),s.value="Unable to get your current location. Please enable location services."}}),F(m,e=>{e.length<2&&(y.value=null,x.value=null)});function $(){const e=parseFloat(N.value),t=parseFloat(L.value);if(isNaN(e)||isNaN(t)){s.value="Please enter valid latitude and longitude coordinates";return}if(e<-90||e>90){s.value="Latitude must be between -90 and 90";return}if(t<-180||t>180){s.value="Longitude must be between -180 and 180";return}o.value={lat:e,lng:t},g.value=[e,t],p.value=13,s.value=null,w.value=!1,d.customerLocation&&k(o.value,d.customerLocation)}async function H(){s.value=null,h.value=!0;try{o.value=await E(),g.value=[o.value.lat,o.value.lng],p.value=13,d.customerLocation&&await k(o.value,d.customerLocation)}catch(e){console.error("Failed to get current location:",e),s.value=e instanceof Error?e.message:"Unable to get your current location"}finally{h.value=!1}}return(e,t)=>(r(),u("div",{class:G(["w-full",d.class])},[a("div",ee,[_(f(J),{center:g.value,"onUpdate:center":t[0]||(t[0]=l=>g.value=l),zoom:p.value,style:q({width:"100%",height:d.mapHeight,borderRadius:"0.5rem",border:"1px solid #e5e7eb",overflow:"hidden"}),"aria-label":"Delivery route map",tabindex:"0",role:"application"},{default:C(()=>[_(f(W),{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:"Â© OpenStreetMap contributors","max-zoom":19}),o.value&&typeof o.value.lat=="number"&&typeof o.value.lng=="number"&&!isNaN(o.value.lat)&&!isNaN(o.value.lng)?(r(),M(f(P),{key:0,"lat-lng":[o.value.lat,o.value.lng],icon:f(B)},{popup:C(()=>[a("div",te,[t[4]||(t[4]=a("div",{class:"font-semibold text-blue-600"},"Current Location",-1)),a("div",ae,v(Number(o.value.lat).toFixed(6))+", "+v(Number(o.value.lng).toFixed(6)),1)])]),_:1},8,["lat-lng","icon"])):n("",!0),e.customerLocation&&typeof e.customerLocation.lat=="number"&&typeof e.customerLocation.lng=="number"&&!isNaN(e.customerLocation.lat)&&!isNaN(e.customerLocation.lng)?(r(),M(f(P),{key:1,"lat-lng":[e.customerLocation.lat,e.customerLocation.lng],icon:f(V)},{popup:C(()=>[a("div",oe,[t[5]||(t[5]=a("div",{class:"font-semibold text-red-600"},"Delivery Location",-1)),a("div",le,v(Number(e.customerLocation.lat).toFixed(6))+", "+v(Number(e.customerLocation.lng).toFixed(6)),1),e.deliveryAddress?(r(),u("div",se,v(e.deliveryAddress),1)):n("",!0)])]),_:1},8,["lat-lng","icon"])):n("",!0),m.value.length>1?(r(),M(f(Y),{key:2,"lat-lngs":m.value,color:"#10b981",weight:"4",opacity:"0.8"},null,8,["lat-lngs"])):n("",!0)]),_:1},8,["center","zoom","style"]),h.value?(r(),u("div",re,t[6]||(t[6]=[a("div",{class:"text-center"},[a("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),a("div",{class:"mt-2 text-sm text-gray-600"},"Calculating route...")],-1)]))):n("",!0)]),o.value&&e.customerLocation?(r(),u("div",ne,[a("div",ie,[t[8]||(t[8]=I('<div data-v-f10139f7><h3 class="font-semibold text-gray-900 dark:text-gray-100" data-v-f10139f7>Route Information</h3><div class="text-sm text-gray-600 dark:text-gray-400 mt-1" data-v-f10139f7><div class="flex items-center gap-2" data-v-f10139f7><div class="w-3 h-3 bg-blue-500 rounded-full" data-v-f10139f7></div><span data-v-f10139f7>Current Location</span></div><div class="flex items-center gap-2 mt-1" data-v-f10139f7><div class="w-3 h-3 bg-red-500 rounded-full" data-v-f10139f7></div><span data-v-f10139f7>Delivery Location</span></div></div></div>',1)),y.value?(r(),u("div",ue,[a("div",de,v(y.value)+" km",1),x.value?(r(),u("div",ce,v(x.value)+" min",1)):n("",!0),t[7]||(t[7]=a("div",{class:"text-xs text-gray-500"},"Route distance & time",-1))])):n("",!0)])])):n("",!0),s.value?(r(),u("div",ve,[a("div",ge,[t[9]||(t[9]=a("div",{class:"w-5 h-5 text-red-500"},[a("svg",{fill:"currentColor",viewBox:"0 0 20 20"},[a("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule":"evenodd"})])],-1)),a("span",fe,v(s.value),1)]),a("div",me,[a("button",{type:"button",onClick:H,class:"px-3 py-1 text-xs bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors"}," ðŸ”„ Retry Location "),a("button",{type:"button",onClick:t[1]||(t[1]=l=>w.value=!w.value),class:"px-3 py-1 text-xs bg-gray-500 text-white rounded hover:bg-gray-600 transition-colors"}," ðŸ“ Enter Manually ")]),w.value?(r(),u("div",pe,[t[10]||(t[10]=a("div",{class:"text-xs text-gray-600 dark:text-gray-400 mb-2"}," Enter your current location coordinates: ",-1)),a("div",be,[S(a("input",{"onUpdate:modelValue":t[2]||(t[2]=l=>N.value=l),type:"number",step:"any",placeholder:"Latitude",class:"flex-1 px-2 py-1 text-xs border rounded"},null,512),[[D,N.value]]),S(a("input",{"onUpdate:modelValue":t[3]||(t[3]=l=>L.value=l),type:"number",step:"any",placeholder:"Longitude",class:"flex-1 px-2 py-1 text-xs border rounded"},null,512),[[D,L.value]]),a("button",{type:"button",onClick:$,class:"px-3 py-1 text-xs bg-green-500 text-white rounded hover:bg-green-600 transition-colors"}," Set ")]),t[11]||(t[11]=a("div",{class:"text-xs text-gray-500 mt-1"}," Example: 14.5995, 120.9842 (Manila) ",-1))])):n("",!0)])):n("",!0),!o.value&&!e.customerLocation?(r(),u("div",ye,t[12]||(t[12]=[I('<div class="flex items-center gap-2" data-v-f10139f7><div class="w-5 h-5 text-yellow-500" data-v-f10139f7><svg fill="currentColor" viewBox="0 0 20 20" data-v-f10139f7><path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd" data-v-f10139f7></path></svg></div><span class="text-sm text-yellow-700 dark:text-yellow-400" data-v-f10139f7>Select a customer with location data to view the route</span></div>',1)]))):n("",!0),o.value?n("",!0):(r(),u("div",xe,t[13]||(t[13]=[I('<div class="flex items-start gap-2" data-v-f10139f7><div class="w-5 h-5 text-blue-500 mt-0.5" data-v-f10139f7><svg fill="currentColor" viewBox="0 0 20 20" data-v-f10139f7><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" data-v-f10139f7></path></svg></div><div class="flex-1" data-v-f10139f7><h4 class="text-sm font-semibold text-blue-900 dark:text-blue-100 mb-2" data-v-f10139f7>Location Access Help</h4><div class="text-xs text-blue-800 dark:text-blue-200 space-y-1" data-v-f10139f7><p data-v-f10139f7><strong data-v-f10139f7>Chrome/Edge:</strong> Click the location icon in the address bar â†’ Allow</p><p data-v-f10139f7><strong data-v-f10139f7>Firefox:</strong> Click the shield icon â†’ Allow location access</p><p data-v-f10139f7><strong data-v-f10139f7>Safari:</strong> Safari â†’ Preferences â†’ Websites â†’ Location â†’ Allow</p><p data-v-f10139f7><strong data-v-f10139f7>Mobile:</strong> Check your device&#39;s location settings and browser permissions</p></div><div class="mt-2 text-xs text-blue-600 dark:text-blue-300" data-v-f10139f7> ðŸ’¡ <strong data-v-f10139f7>Tip:</strong> You can also manually enter your coordinates using the &quot;Enter Manually&quot; option above. </div></div></div>',1)])))],2))}}),Ie=K(he,[["__scopeId","data-v-f10139f7"]]);export{Ie as D};
