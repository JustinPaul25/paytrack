import{d as L,D as Y,p as x,c as V,o as f,w as l,a as r,b as d,u as n,g as G,E as J,e as u,f as _,h as k,x as $,y as h,F as R,r as W,t as y,S as X}from"./app-DLGUJSur.js";import{_ as g}from"./index-CbeL7bQp.js";import{_ as C}from"./Select.vue_vue_type_script_setup_true_lang-BmMAiM-x.js";import{_ as w}from"./SearchSelect.vue_vue_type_script_setup_true_lang-DODuTYTX.js";import{_ as Z}from"./AppLayout.vue_vue_type_script_setup_true_lang-TGItx7cK.js";import{_ as q,a as O}from"./CardContent.vue_vue_type_script_setup_true_lang-DGEoivaK.js";import{_ as S,a as P}from"./CardTitle.vue_vue_type_script_setup_true_lang-CA3flqiV.js";import{_ as tt}from"./CardFooter.vue_vue_type_script_setup_true_lang-ArF0VZWS.js";import{_ as c}from"./Label.vue_vue_type_script_setup_true_lang-s53qzNoi.js";import{S as v}from"./sweetalert2.esm.all-BQIkj5Wb.js";import{_ as p}from"./InputError.vue_vue_type_script_setup_true_lang-Biwlb9eG.js";import{T as et}from"./trash-2-C3BXaGst.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-0k-ecodo.js";import"./createLucideIcon-DFeQ1_P7.js";import"./RovingFocusGroup-B2V0LqPJ.js";import"./LocationInput.vue_vue_type_style_index_0_scoped_0fe2f881_lang-fGrSInQY.js";import"./Input.vue_vue_type_script_setup_true_lang-BhSvFCK4.js";import"./search-DX6CV7Ks.js";import"./VisuallyHidden-e3nHpJ_I.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-CCqgexjF.js";import"./chevron-right-BFHvTSNm.js";const rt={key:0},ot={class:"flex justify-between items-center"},st={class:"space-y-3"},it={class:"flex justify-between items-center mb-3"},dt={class:"font-medium text-sm"},nt={class:"grid grid-cols-1 md:grid-cols-4 gap-3"},lt=["id","onUpdate:modelValue","max","onInput"],at={key:0,class:"text-[11px] text-gray-500 mt-1"},ut={class:"w-full rounded-md border border-input bg-transparent px-2 py-1 mt-1 text-sm text-foreground dark:bg-input/30 h-8 flex items-center"},mt={class:"mt-4 pt-3 border-t"},ct={class:"flex justify-end"},pt={class:"text-right"},ft={class:"text-base font-medium"},At=L({__name:"Create",props:{customer_id:{},products:{},categories:{default:()=>[]}},setup(T){const m=T,o=Y({customer_id:m.customer_id,delivery_type:"delivery",payment_method:"cash",credit_term_days:null,notes:"",order_items:[{category_id:null,product_id:null,quantity:1}]}),j=[{title:"Orders",href:"/orders"},{title:"Create Order",href:"/orders/create"}],B=x(()=>o.order_items.reduce((s,t)=>{if(t.product_id&&t.quantity){const e=m.products.find(i=>i.id===t.product_id);if(e)return s+t.quantity*e.selling_price}return s},0)),U=x(()=>!o.customer_id||!o.order_items.length?!1:o.order_items.some(s=>!!s.product_id&&s.quantity>0));function I(){o.order_items.push({category_id:null,product_id:null,quantity:1})}function A(s){o.order_items.length>1&&o.order_items.splice(s,1)}function D(s){const t=o.order_items[s];t.product_id=null}function Q(s){const t=o.order_items[s];if(t.product_id&&t.quantity){const e=m.products.find(i=>i.id===t.product_id);e&&t.quantity>e.stock&&(t.quantity=e.stock,v.fire({icon:"info",title:"Quantity Adjusted",text:`Quantity for "${e.name}" has been adjusted to the maximum available stock (${e.stock} units).`,confirmButtonText:"OK",toast:!0,position:"top-end",timer:3e3,timerProgressBar:!0}))}}function F(s){const t=o.order_items[s];if(t.product_id&&t.quantity){const e=m.products.find(i=>i.id===t.product_id);e&&t.quantity>e.stock&&(t.quantity=e.stock,v.fire({icon:"info",title:"Quantity Adjusted",text:`Quantity for "${e.name}" has been adjusted to the maximum available stock (${e.stock} units).`,confirmButtonText:"OK",toast:!0,position:"top-end",timer:3e3,timerProgressBar:!0}))}}function N(){for(let s=0;s<o.order_items.length;s++){const t=o.order_items[s];if(t.product_id&&t.quantity){const e=m.products.find(i=>i.id===t.product_id);e&&t.quantity>e.stock&&(t.quantity=e.stock,v.fire({icon:"warning",title:"Quantity Auto-Adjusted",text:`Quantity for "${e.name}" was automatically adjusted to ${e.stock} units due to stock limitations.`,confirmButtonText:"OK"}))}}o.post(route("orders.store"),{preserveScroll:!0,onSuccess:()=>{v.fire({toast:!0,position:"top-end",icon:"success",title:"Order created successfully",text:"Your order is pending approval from staff.",showConfirmButton:!1,timer:3e3,timerProgressBar:!0})}})}function b(s){return o.errors[s]}function M(s){return new Intl.NumberFormat("en-PH",{style:"currency",currency:"PHP",minimumFractionDigits:2}).format(s)}const E=[{value:"cash",label:"Cash"},{value:"credit",label:"Credit"}],K=x(()=>[{value:null,label:"Select category"},...(m.categories||[]).map(s=>({value:s.id,label:s.name}))]);function H(s){const t=o.order_items[s],e=m.products||[],i=t.category_id?e.filter(a=>a.category_id===t.category_id):e;return[{value:null,label:"Select product"},...i.map(a=>({value:a.id,label:a.name,description:`${M(a.selling_price)}/${a.unit.toUpperCase()} • Stock: ${a.stock}`}))]}function z(s){const t=o.order_items[s];if(t.product_id&&t.quantity){const e=m.products.find(i=>i.id===t.product_id);if(e)return t.quantity*e.selling_price}return 0}return(s,t)=>(f(),V(Z,{breadcrumbs:j},{default:l(()=>[r(n(G),{title:"Create Order"}),t[20]||(t[20]=d("div",{class:"flex items-center justify-between mb-6"},[d("h1",{class:"text-2xl font-bold"},"Create Order")],-1)),d("form",{onSubmit:t[4]||(t[4]=J(e=>N(),["prevent"])),class:"space-y-6"},[r(q,null,{default:l(()=>[r(S,null,{default:l(()=>[r(P,null,{default:l(()=>t[5]||(t[5]=[u("Order Details")])),_:1,__:[5]})]),_:1}),r(O,{class:"space-y-6"},{default:l(()=>[d("div",null,[r(c,{for:"delivery_type"},{default:l(()=>t[6]||(t[6]=[u("Delivery Type *")])),_:1,__:[6]}),r(n(C),{id:"delivery_type",modelValue:n(o).delivery_type,"onUpdate:modelValue":t[0]||(t[0]=e=>n(o).delivery_type=e),options:[{value:"pickup",label:"Pickup"},{value:"delivery",label:"Delivery"}],class:"mt-1",required:""},null,8,["modelValue"]),r(p,{message:n(o).errors.delivery_type},null,8,["message"])]),d("div",null,[r(c,{for:"payment_method"},{default:l(()=>t[7]||(t[7]=[u("Payment Method *")])),_:1,__:[7]}),r(n(C),{id:"payment_method",modelValue:n(o).payment_method,"onUpdate:modelValue":t[1]||(t[1]=e=>n(o).payment_method=e),options:E,class:"mt-1",required:""},null,8,["modelValue"]),r(p,{message:n(o).errors.payment_method},null,8,["message"])]),n(o).payment_method==="credit"?(f(),_("div",rt,[r(c,{for:"credit_term_days"},{default:l(()=>t[8]||(t[8]=[u("Credit Term (Days)")])),_:1,__:[8]}),$(d("input",{"onUpdate:modelValue":t[2]||(t[2]=e=>n(o).credit_term_days=e),type:"number",id:"credit_term_days",min:"0",max:"365",class:"mt-1 block w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",placeholder:"e.g., 30"},null,512),[[h,n(o).credit_term_days,void 0,{number:!0}]]),t[9]||(t[9]=d("div",{class:"text-[11px] text-gray-500 mt-1"}," Number of days until payment is due (default: 30 days). ",-1)),r(p,{message:n(o).errors.credit_term_days},null,8,["message"])])):k("",!0),d("div",null,[r(c,{for:"notes"},{default:l(()=>t[10]||(t[10]=[u("Notes (Optional)")])),_:1,__:[10]}),$(d("textarea",{id:"notes","onUpdate:modelValue":t[3]||(t[3]=e=>n(o).notes=e),class:"w-full rounded-md border border-input bg-transparent px-3 py-2 mt-1 text-foreground dark:bg-input/30 focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] focus-visible:outline-none",rows:"3",placeholder:"Add any special instructions or notes for your order..."},null,512),[[h,n(o).notes]]),r(p,{message:n(o).errors.notes},null,8,["message"])])]),_:1})]),_:1}),r(q,null,{default:l(()=>[r(S,null,{default:l(()=>[d("div",ot,[r(P,null,{default:l(()=>t[11]||(t[11]=[u("Order Items")])),_:1,__:[11]}),r(n(g),{type:"button",variant:"outline",onClick:I},{default:l(()=>t[12]||(t[12]=[d("span",{class:"mr-2"},"+",-1),u(" Add Item ")])),_:1,__:[12]})])]),_:1}),r(O,null,{default:l(()=>[d("div",st,[(f(!0),_(R,null,W(n(o).order_items,(e,i)=>(f(),_("div",{key:i,class:"border rounded-md p-3"},[d("div",it,[d("h4",dt,"Item "+y(i+1),1),n(o).order_items.length>1?(f(),V(n(g),{key:0,type:"button",variant:"ghost",size:"sm",class:"h-7 w-7 p-0 text-red-500 hover:text-red-600 hover:bg-red-50 dark:hover:bg-red-950/20",onClick:a=>A(i)},{default:l(()=>[r(n(et),{class:"h-4 w-4"})]),_:2},1032,["onClick"])):k("",!0)]),d("div",nt,[d("div",null,[r(c,{for:`category_id_${i}`,class:"text-xs"},{default:l(()=>t[13]||(t[13]=[u("Category")])),_:2,__:[13]},1032,["for"]),r(n(w),{modelValue:e.category_id,"onUpdate:modelValue":[a=>e.category_id=a,a=>D(i)],options:K.value,placeholder:"Select category","search-placeholder":"Search categories...",class:"mt-1 h-8"},null,8,["modelValue","onUpdate:modelValue","options"]),r(p,{message:b(`order_items.${i}.category_id`)},null,8,["message"])]),d("div",null,[r(c,{for:`product_id_${i}`,class:"text-xs"},{default:l(()=>t[14]||(t[14]=[u("Product")])),_:2,__:[14]},1032,["for"]),r(n(w),{modelValue:e.product_id,"onUpdate:modelValue":[a=>e.product_id=a,a=>Q(i)],options:H(i),placeholder:"Select product","search-placeholder":"Search products...",class:"mt-1 h-8",required:""},null,8,["modelValue","onUpdate:modelValue","options"]),r(p,{message:b(`order_items.${i}.product_id`)},null,8,["message"])]),d("div",null,[r(c,{for:`quantity_${i}`,class:"text-xs"},{default:l(()=>t[15]||(t[15]=[u("Quantity")])),_:2,__:[15]},1032,["for"]),$(d("input",{id:`quantity_${i}`,"onUpdate:modelValue":a=>e.quantity=a,type:"number",min:"1",max:e.product_id?(m.products.find(a=>a.id===e.product_id)||{stock:0}).stock:void 0,class:"w-full rounded-md border border-input bg-transparent px-2 py-1 mt-1 text-sm text-foreground dark:bg-input/30 focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] focus-visible:outline-none h-8",onInput:a=>F(i),required:""},null,40,lt),[[h,e.quantity,void 0,{number:!0}]]),e.product_id?(f(),_("div",at," In stock: "+y((m.products.find(a=>a.id===e.product_id)||{stock:0}).stock),1)):k("",!0),r(p,{message:b(`order_items.${i}.quantity`)},null,8,["message"])]),d("div",null,[r(c,{class:"text-xs"},{default:l(()=>t[16]||(t[16]=[u("Total")])),_:1,__:[16]}),d("div",ut," ₱"+y(z(i).toFixed(2)),1)])])]))),128))]),d("div",mt,[d("div",ct,[d("div",pt,[d("div",ft,"Total Amount: ₱"+y(B.value.toFixed(2)),1),t[17]||(t[17]=d("div",{class:"text-xs text-muted-foreground mt-1"},"12% VAT is included in price",-1))])])])]),_:1})]),_:1}),r(q,null,{default:l(()=>[r(tt,{class:"flex gap-2 justify-end"},{default:l(()=>[r(n(g),{type:"submit",disabled:!U.value,variant:"default"},{default:l(()=>t[18]||(t[18]=[u("Submit Order")])),_:1,__:[18]},8,["disabled"]),r(n(X),{href:s.route("orders.index")},{default:l(()=>[r(n(g),{type:"button",variant:"ghost"},{default:l(()=>t[19]||(t[19]=[u("Cancel")])),_:1,__:[19]})]),_:1},8,["href"])]),_:1})]),_:1})],32)]),_:1,__:[20]}))}});export{At as default};
