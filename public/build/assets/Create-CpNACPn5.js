import{d as H,D as J,l as _,c as w,o as v,w as l,a as e,b as i,u as r,g as R,q as X,e as u,A as h,B as $,f as k,F as Y,r as Z,h as I,t as f,S as tt}from"./app-Bui3OkzT.js";import{_ as b}from"./index-BMjEgJpi.js";import{_ as S}from"./Select.vue_vue_type_script_setup_true_lang-DPS2lC1J.js";import{_ as T}from"./SearchSelect.vue_vue_type_script_setup_true_lang-DZO--fjy.js";import{_ as et}from"./AppLayout.vue_vue_type_script_setup_true_lang-BzDZMiPU.js";import{_ as q,a as B}from"./CardContent.vue_vue_type_script_setup_true_lang-DxrZKxoF.js";import{_ as P,a as U}from"./CardTitle.vue_vue_type_script_setup_true_lang-CPQYtZhA.js";import{_ as ot}from"./CardFooter.vue_vue_type_script_setup_true_lang-D0GYYNR3.js";import{_ as m}from"./Label.vue_vue_type_script_setup_true_lang-B4RgKJbl.js";import{S as C}from"./sweetalert2.esm.all-BQIkj5Wb.js";import{_ as c}from"./InputError.vue_vue_type_script_setup_true_lang-CZgj9OKU.js";import{T as st}from"./trash-2-DbqPpW9d.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-BPOQs094.js";import"./createLucideIcon-v3dwDfDK.js";import"./RovingFocusGroup-2lk2zDI0.js";import"./LocationInput.vue_vue_type_style_index_0_scoped_0fe2f881_lang-t1aBslqt.js";import"./Input.vue_vue_type_script_setup_true_lang-jsWgIkao.js";import"./search-Duxdi3O0.js";import"./VisuallyHidden-BnI_JCk-.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-CMhuGCG-.js";const it={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},nt={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},rt={class:"flex justify-between items-center"},lt={class:"space-y-3"},at={class:"flex justify-between items-center mb-3"},ut={class:"font-medium text-sm"},dt={class:"grid grid-cols-1 md:grid-cols-4 gap-3"},mt=["id","onUpdate:modelValue","onInput"],ct={key:0,class:"text-[11px] text-gray-500 mt-1"},pt=["id","onUpdate:modelValue","onInput"],ft={class:"w-full rounded-md border border-input bg-transparent px-2 py-1 mt-1 text-sm text-foreground dark:bg-input/30 h-8 flex items-center"},_t={class:"mt-4 pt-3 border-t"},vt={class:"flex justify-end"},gt={class:"text-right space-y-1"},bt={class:"text-sm text-muted-foreground"},yt={class:"text-sm text-muted-foreground"},xt={class:"text-base font-medium"},Et=H({__name:"Create",props:{customers:{},products:{}},setup(j){const p=j,n=J({customer_id:null,status:"draft",payment_method:"cash",notes:"",invoice_items:[{product_id:null,quantity:1,price:0,total:0}]}),A=[{title:"Invoices",href:"/invoices"},{title:"Create Invoice",href:"/invoices/create"}],y=_(()=>n.invoice_items.reduce((o,t)=>o+t.total,0)),V=_(()=>y.value*.12),F=_(()=>y.value+V.value),O=_(()=>!n.customer_id||!n.invoice_items.length?!1:n.invoice_items.some(o=>!!o.product_id&&o.quantity>0&&o.price>=0));function D(){n.invoice_items.push({product_id:null,quantity:1,price:0,total:0})}function Q(o){n.invoice_items.length>1&&n.invoice_items.splice(o,1)}function g(o){const t=n.invoice_items[o];t.product_id&&t.quantity&&t.price?t.total=t.quantity*t.price:t.total=0}function N(o){const t=n.invoice_items[o];if(t.product_id){const s=p.products.find(a=>a.id===t.product_id);s&&(t.price=s.selling_price,g(o))}}function E(o){const t=n.invoice_items[o];if(t.product_id&&t.quantity){const s=p.products.find(a=>a.id===t.product_id);s&&t.quantity>s.stock&&(t.quantity=s.stock,C.fire({icon:"info",title:"Quantity Adjusted",text:`Quantity for "${s.name}" has been adjusted to the maximum available stock (${s.stock} units).`,confirmButtonText:"OK",toast:!0,position:"top-end",timer:3e3,timerProgressBar:!0}))}g(o)}function M(o){g(o)}function K(){for(let o=0;o<n.invoice_items.length;o++){const t=n.invoice_items[o];if(t.product_id&&t.quantity){const s=p.products.find(a=>a.id===t.product_id);s&&t.quantity>s.stock&&(t.quantity=s.stock,g(o),C.fire({icon:"warning",title:"Quantity Auto-Adjusted",text:`Quantity for "${s.name}" was automatically adjusted to ${s.stock} units due to stock limitations.`,confirmButtonText:"OK"}))}}n.post(route("invoices.store"),{preserveScroll:!0,onSuccess:()=>{C.fire({toast:!0,position:"top-end",icon:"success",title:"Invoice created successfully",showConfirmButton:!1,timer:3e3,timerProgressBar:!0})}})}function x(o){return n.errors[o]}const W=_(()=>[{value:null,label:"Select customer"},...p.customers.map(o=>({value:o.id,label:`${o.name}${o.company_name?` (${o.company_name})`:""}`}))]),z=[{value:"draft",label:"Draft"},{value:"pending",label:"Pending"},{value:"completed",label:"Completed"},{value:"cancelled",label:"Cancelled"}],L=[{value:"cash",label:"Cash"},{value:"bank_transfer",label:"Bank Transfer"},{value:"e-wallet",label:"E-Wallet"},{value:"other",label:"Other"}];function G(){return[{value:null,label:"Select product"},...p.products.map(o=>({value:o.id,label:`${o.name}`}))]}return(o,t)=>(v(),w(et,{breadcrumbs:A},{default:l(()=>[e(r(R),{title:"Create Invoice"}),t[20]||(t[20]=i("div",{class:"flex items-center justify-between mb-6"},[i("h1",{class:"text-2xl font-bold"},"Create Invoice")],-1)),i("form",{onSubmit:t[4]||(t[4]=X(s=>K(),["prevent"])),class:"space-y-6"},[e(q,null,{default:l(()=>[e(P,null,{default:l(()=>[e(U,null,{default:l(()=>t[5]||(t[5]=[u("Invoice Details")])),_:1,__:[5]})]),_:1}),e(B,{class:"space-y-6"},{default:l(()=>[i("div",it,[i("div",null,[e(m,{for:"customer_id"},{default:l(()=>t[6]||(t[6]=[u("Customer")])),_:1,__:[6]}),e(r(T),{modelValue:r(n).customer_id,"onUpdate:modelValue":t[0]||(t[0]=s=>r(n).customer_id=s),options:W.value,placeholder:"Select customer","search-placeholder":"Search customers...",class:"mt-1",required:""},null,8,["modelValue","options"]),e(c,{message:r(n).errors.customer_id},null,8,["message"])]),i("div",null,[e(m,{for:"status"},{default:l(()=>t[7]||(t[7]=[u("Status")])),_:1,__:[7]}),e(r(S),{modelValue:r(n).status,"onUpdate:modelValue":t[1]||(t[1]=s=>r(n).status=s),options:z,placeholder:"Select status",class:"mt-1",required:""},null,8,["modelValue"]),t[8]||(t[8]=i("div",{class:"text-[11px] text-gray-500 mt-1"}," Draft: still editing, Pending: awaiting payment, Completed: paid, Cancelled: void. ",-1)),e(c,{message:r(n).errors.status},null,8,["message"])])]),i("div",nt,[i("div",null,[e(m,{for:"payment_method"},{default:l(()=>t[9]||(t[9]=[u("Payment Method")])),_:1,__:[9]}),e(r(S),{modelValue:r(n).payment_method,"onUpdate:modelValue":t[2]||(t[2]=s=>r(n).payment_method=s),options:L,placeholder:"Select payment method",class:"mt-1",required:""},null,8,["modelValue"]),t[10]||(t[10]=i("div",{class:"text-[11px] text-gray-500 mt-1"}," Pick how the customer will pay (e.g. Cash, Bank Transfer, E‑Wallet). ",-1)),e(c,{message:r(n).errors.payment_method},null,8,["message"])])]),i("div",null,[e(m,{for:"notes"},{default:l(()=>t[11]||(t[11]=[u("Notes")])),_:1,__:[11]}),h(i("textarea",{id:"notes","onUpdate:modelValue":t[3]||(t[3]=s=>r(n).notes=s),class:"w-full rounded-md border border-input bg-transparent px-3 py-2 mt-1 text-foreground dark:bg-input/30 focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] focus-visible:outline-none",rows:"3"},null,512),[[$,r(n).notes]]),e(c,{message:r(n).errors.notes},null,8,["message"])])]),_:1})]),_:1}),e(q,null,{default:l(()=>[e(P,null,{default:l(()=>[i("div",rt,[e(U,null,{default:l(()=>t[12]||(t[12]=[u("Invoice Items")])),_:1,__:[12]}),e(r(b),{type:"button",variant:"outline",onClick:D},{default:l(()=>t[13]||(t[13]=[i("span",{class:"mr-2"},"+",-1),u(" Add Item ")])),_:1,__:[13]})])]),_:1}),e(B,null,{default:l(()=>[i("div",lt,[(v(!0),k(Y,null,Z(r(n).invoice_items,(s,a)=>(v(),k("div",{key:a,class:"border rounded-md p-3"},[i("div",at,[i("h4",ut,"Item "+f(a+1),1),r(n).invoice_items.length>1?(v(),w(r(b),{key:0,type:"button",variant:"ghost",size:"sm",class:"h-7 w-7 p-0 text-red-500 hover:text-red-600 hover:bg-red-50 dark:hover:bg-red-950/20",onClick:d=>Q(a)},{default:l(()=>[e(r(st),{class:"h-4 w-4"})]),_:2},1032,["onClick"])):I("",!0)]),i("div",dt,[i("div",null,[e(m,{for:`product_id_${a}`,class:"text-xs"},{default:l(()=>t[14]||(t[14]=[u("Product")])),_:2,__:[14]},1032,["for"]),e(r(T),{modelValue:s.product_id,"onUpdate:modelValue":[d=>s.product_id=d,d=>N(a)],options:G(),placeholder:"Select product","search-placeholder":"Search products...",class:"mt-1 h-8",required:""},null,8,["modelValue","onUpdate:modelValue","options"]),e(c,{message:x(`invoice_items.${a}.product_id`)},null,8,["message"])]),i("div",null,[e(m,{for:`quantity_${a}`,class:"text-xs"},{default:l(()=>t[15]||(t[15]=[u("Quantity")])),_:2,__:[15]},1032,["for"]),h(i("input",{id:`quantity_${a}`,"onUpdate:modelValue":d=>s.quantity=d,type:"number",min:"1",class:"w-full rounded-md border border-input bg-transparent px-2 py-1 mt-1 text-sm text-foreground dark:bg-input/30 focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] focus-visible:outline-none h-8",onInput:d=>E(a),required:""},null,40,mt),[[$,s.quantity,void 0,{number:!0}]]),s.product_id?(v(),k("div",ct," In stock: "+f((p.products.find(d=>d.id===s.product_id)||{stock:0}).stock),1)):I("",!0),e(c,{message:x(`invoice_items.${a}.quantity`)},null,8,["message"])]),i("div",null,[e(m,{for:`price_${a}`,class:"text-xs"},{default:l(()=>t[16]||(t[16]=[u("Price")])),_:2,__:[16]},1032,["for"]),h(i("input",{id:`price_${a}`,"onUpdate:modelValue":d=>s.price=d,type:"number",min:"0",step:"0.01",class:"w-full rounded-md border border-input bg-transparent px-2 py-1 mt-1 text-sm text-foreground dark:bg-input/30 focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] focus-visible:outline-none h-8",onInput:d=>M(a),required:""},null,40,pt),[[$,s.price,void 0,{number:!0}]]),e(c,{message:x(`invoice_items.${a}.price`)},null,8,["message"])]),i("div",null,[e(m,{class:"text-xs"},{default:l(()=>t[17]||(t[17]=[u("Total")])),_:1,__:[17]}),i("div",ft," ₱"+f(s.total.toFixed(2)),1)])])]))),128))]),i("div",_t,[i("div",vt,[i("div",gt,[i("div",bt,"Subtotal: ₱"+f(y.value.toFixed(2)),1),i("div",yt,"VAT (12%): ₱"+f(V.value.toFixed(2)),1),i("div",xt,"Total Amount: ₱"+f(F.value.toFixed(2)),1)])])])]),_:1})]),_:1}),e(q,null,{default:l(()=>[e(ot,{class:"flex gap-2 justify-end"},{default:l(()=>[e(r(b),{type:"submit",disabled:!O.value,variant:"default"},{default:l(()=>t[18]||(t[18]=[u("Create Invoice")])),_:1,__:[18]},8,["disabled"]),e(r(tt),{href:o.route("invoices.index")},{default:l(()=>[e(r(b),{type:"button",variant:"ghost"},{default:l(()=>t[19]||(t[19]=[u("Cancel")])),_:1,__:[19]})]),_:1},8,["href"])]),_:1})]),_:1})],32)]),_:1,__:[20]}))}});export{Et as default};
