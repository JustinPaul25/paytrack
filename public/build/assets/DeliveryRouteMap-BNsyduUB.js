import{d as Q,v as X,p as U,m as c,s as F,q as Z,z as B,e as d,o as s,n as ee,b as l,f as u,c as N,u as b,i as V,w as E,a as te,t as g,h as ae,C as S,x as T,y as $}from"./app-6YU8Xi1-.js";import{i as oe,v as le,u as H,p as se}from"./vue-leaflet.es-BFkjfgu8.js";import{a as j}from"./LocationInput.vue_vue_type_style_index_0_scoped_85568d9b_lang-CiBDiogE.js";import re from"./marker-icon-2x-1TirABJh.js";import ne from"./marker-icon-B6h-nX3D.js";import ie from"./marker-shadow-B9CpECYs.js";import{_ as ue}from"./_plugin-vue_export-helper-DlAUqK2U.js";const de={class:"relative"},ce={class:"text-center"},ve={key:0,class:"text-xs text-gray-500 mb-1"},ge={class:"text-sm text-gray-600"},me={class:"text-center"},pe={class:"text-sm text-gray-600"},fe={key:0,class:"text-xs text-gray-500 mt-1"},ye={key:2,class:"absolute inset-0 bg-white/80 dark:bg-gray-900/80 flex items-center justify-center rounded-lg"},be={key:0,class:"mt-4 p-4 bg-gray-50 dark:bg-gray-800 rounded-lg"},xe={class:"mb-2 text-sm text-gray-600"},we={class:"flex items-center justify-between"},he={key:0,class:"text-right"},ke={class:"text-lg font-bold text-gray-900 dark:text-gray-100"},Le={key:0,class:"text-sm text-gray-600 dark:text-gray-400"},Ne={key:1,class:"mt-4 p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg"},Ce={class:"flex items-center gap-2 mb-3"},Me={class:"text-sm text-red-700 dark:text-red-400"},Ie={key:0,class:"flex gap-2"},ze={key:1,class:"mt-3 p-3 bg-white dark:bg-gray-700 rounded border"},Ae={class:"flex gap-2"},Fe={key:2,class:"mt-4 p-4 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg"},Ee={key:3,class:"mt-4 p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg"},Se=Q({__name:"DeliveryRouteMap",props:{customerLocation:{},deliveryAddress:{},class:{default:""},mapHeight:{default:"400px"}},emits:["distance-calculated"],setup(q,{emit:G}){j.Icon.Default.mergeOptions({iconRetinaUrl:re,iconUrl:ne,shadowUrl:ie});const C=G,r=q,P=X(),v=U(()=>{const t=P.props.deliveryOriginLocation;return t&&typeof t.lat=="number"&&typeof t.lng=="number"?{lat:t.lat,lng:t.lng}:null}),M=U(()=>P.props.deliveryOriginAddress||""),a=c(null),x=c([]),y=c(null),h=c(null),k=c(!1),n=c(null),m=c([14.5995,120.9842]),p=c(10),L=c(!1),I=c(""),z=c(""),_=c(!1),D=t=>new j.Icon({iconUrl:`data:image/svg+xml;base64,${btoa(`
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="${t}" width="24" height="24">
        <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
      </svg>
    `)}`,iconSize:[24,24],iconAnchor:[12,24],popupAnchor:[0,-24]}),W=D("#3b82f6"),Y=D("#ef4444"),O=()=>new Promise((t,e)=>{if(!navigator.geolocation){e(new Error("Geolocation is not supported by this browser"));return}navigator.geolocation.getCurrentPosition(o=>{t({lat:o.coords.latitude,lng:o.coords.longitude})},o=>{let i="Unknown geolocation error";switch(o.code){case o.PERMISSION_DENIED:i="Location access was denied. Please allow location access in your browser settings and refresh the page.";break;case o.POSITION_UNAVAILABLE:i="Location information is unavailable. Please check your device location settings.";break;case o.TIMEOUT:i="Location request timed out. Please try again.";break;default:i=`Geolocation error: ${o.message}`}e(new Error(i))},{enableHighAccuracy:!1,timeout:15e3,maximumAge:3e5})}),w=async(t,e)=>{if(!t||!e||typeof t.lat!="number"||typeof t.lng!="number"||typeof e.lat!="number"||typeof e.lng!="number"||isNaN(t.lat)||isNaN(t.lng)||isNaN(e.lat)||isNaN(e.lng)){console.error("Invalid coordinates for route calculation:",{from:t,to:e}),n.value="Invalid coordinates for route calculation";return}try{k.value=!0,n.value=null;const o=`https://router.project-osrm.org/route/v1/driving/${t.lng},${t.lat};${e.lng},${e.lat}?overview=full&geometries=geojson`,i=await fetch(o);if(!i.ok)throw new Error("Failed to calculate route");const f=await i.json();if(f.routes&&f.routes[0]&&f.routes[0].geometry){const A=f.routes[0].geometry.coordinates;x.value=A.map(R=>[R[1],R[0]]),y.value=parseFloat((f.routes[0].distance/1e3).toFixed(1)),h.value=parseFloat((f.routes[0].duration/60).toFixed(1)),C("distance-calculated",y.value),console.log("Route calculated:",{distance:y.value,duration:h.value,coordinates:x.value.length})}else throw new Error("No route found")}catch(o){console.error("Route calculation error:",o),n.value="Failed to calculate route. Please check your internet connection.",x.value=[[t.lat,t.lng],[e.lat,e.lng]]}finally{k.value=!1}};F(()=>r.customerLocation,async t=>{if(t){let e=t.lat,o=t.lng;if(typeof e=="string"&&(e=parseFloat(e)),typeof o=="string"&&(o=parseFloat(o)),typeof e=="number"&&typeof o=="number"&&!isNaN(e)&&!isNaN(o)&&e>=-90&&e<=90&&o>=-180&&o<=180&&(e!=0||o!=0)){const i={lat:e,lng:o};if(a.value){await w(a.value,i);const f=(a.value.lat+i.lat)/2,A=(a.value.lng+i.lng)/2;m.value=[f,A],p.value=12}else m.value=[i.lat,i.lng],p.value=13}else t&&(console.warn("Invalid customer location data:",t),n.value="Customer location data is invalid or missing. Please update the customer with valid coordinates.")}},{immediate:!0}),Z(async()=>{await B(),await new Promise(t=>setTimeout(t,100)),_.value=!0,await B();try{v.value?(a.value={lat:v.value.lat,lng:v.value.lng},m.value=[a.value.lat,a.value.lng],p.value=13,r.customerLocation&&await w(a.value,r.customerLocation)):(a.value=await O(),m.value=[a.value.lat,a.value.lng],p.value=13,r.customerLocation&&await w(a.value,r.customerLocation))}catch(t){console.error("Failed to get current location:",t),v.value?n.value="Failed to load delivery origin location. Please check admin settings.":n.value="Unable to get your current location. Please set the delivery origin address in Admin Settings or enable location services."}}),F(x,t=>{t.length<2&&(y.value=null,h.value=null,C("distance-calculated",null))}),F(y,t=>{C("distance-calculated",t)});function J(){const t=parseFloat(I.value),e=parseFloat(z.value);if(isNaN(t)||isNaN(e)){n.value="Please enter valid latitude and longitude coordinates";return}if(t<-90||t>90){n.value="Latitude must be between -90 and 90";return}if(e<-180||e>180){n.value="Longitude must be between -180 and 180";return}a.value={lat:t,lng:e},m.value=[t,e],p.value=13,n.value=null,L.value=!1,r.customerLocation&&w(a.value,r.customerLocation)}async function K(){n.value=null,k.value=!0;try{v.value?(a.value={lat:v.value.lat,lng:v.value.lng},m.value=[a.value.lat,a.value.lng],p.value=13,r.customerLocation&&await w(a.value,r.customerLocation)):(a.value=await O(),m.value=[a.value.lat,a.value.lng],p.value=13,r.customerLocation&&await w(a.value,r.customerLocation))}catch(t){console.error("Failed to get current location:",t),n.value=t instanceof Error?t.message:"Unable to get your current location"}finally{k.value=!1}}return(t,e)=>(s(),d("div",{class:ee(["w-full",r.class])},[l("div",de,[_.value?(s(),N(b(oe),{key:0,center:m.value,"onUpdate:center":e[0]||(e[0]=o=>m.value=o),zoom:p.value,style:V({width:"100%",height:r.mapHeight,borderRadius:"0.5rem",border:"1px solid #e5e7eb",overflow:"hidden"}),"aria-label":"Delivery route map",tabindex:"0",role:"application"},{default:E(()=>[te(b(le),{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:"Â© OpenStreetMap contributors","max-zoom":19}),a.value&&typeof a.value.lat=="number"&&typeof a.value.lng=="number"&&!isNaN(a.value.lat)&&!isNaN(a.value.lng)?(s(),N(b(H),{key:0,"lat-lng":[a.value.lat,a.value.lng],icon:b(W)},{popup:E(()=>[l("div",ce,[e[4]||(e[4]=l("div",{class:"font-semibold text-blue-600"},"Current Location",-1)),M.value?(s(),d("div",ve,g(M.value),1)):u("",!0),l("div",ge,g(Number(a.value.lat).toFixed(6))+", "+g(Number(a.value.lng).toFixed(6)),1)])]),_:1},8,["lat-lng","icon"])):u("",!0),t.customerLocation&&typeof t.customerLocation.lat=="number"&&typeof t.customerLocation.lng=="number"&&!isNaN(t.customerLocation.lat)&&!isNaN(t.customerLocation.lng)?(s(),N(b(H),{key:1,"lat-lng":[t.customerLocation.lat,t.customerLocation.lng],icon:b(Y)},{popup:E(()=>[l("div",me,[e[5]||(e[5]=l("div",{class:"font-semibold text-red-600"},"Delivery Location",-1)),l("div",pe,g(Number(t.customerLocation.lat).toFixed(6))+", "+g(Number(t.customerLocation.lng).toFixed(6)),1),t.deliveryAddress?(s(),d("div",fe,g(t.deliveryAddress),1)):u("",!0)])]),_:1},8,["lat-lng","icon"])):u("",!0),x.value.length>1?(s(),N(b(se),{key:2,"lat-lngs":x.value,color:"#10b981",weight:"4",opacity:"0.8"},null,8,["lat-lngs"])):u("",!0)]),_:1},8,["center","zoom","style"])):(s(),d("div",{key:1,style:V({width:"100%",height:r.mapHeight,borderRadius:"0.5rem",border:"1px solid #e5e7eb",display:"flex",alignItems:"center",justifyContent:"center",background:"#f3f4f6"})},e[6]||(e[6]=[l("span",{class:"text-muted-foreground text-sm"},"Loading map...",-1)]),4)),k.value?(s(),d("div",ye,e[7]||(e[7]=[l("div",{class:"text-center"},[l("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),l("div",{class:"mt-2 text-sm text-gray-600"},"Calculating route...")],-1)]))):u("",!0)]),a.value&&t.customerLocation?(s(),d("div",be,[l("div",xe,[e[8]||(e[8]=l("strong",null,"Origin:",-1)),ae(" "+g(M.value||"Delivery Origin (from admin settings)"),1)]),l("div",we,[e[10]||(e[10]=S('<div data-v-1f1551c6><h3 class="font-semibold text-gray-900 dark:text-gray-100" data-v-1f1551c6>Route Information</h3><div class="text-sm text-gray-600 dark:text-gray-400 mt-1" data-v-1f1551c6><div class="flex items-center gap-2" data-v-1f1551c6><div class="w-3 h-3 bg-blue-500 rounded-full" data-v-1f1551c6></div><span data-v-1f1551c6>Current Location</span></div><div class="flex items-center gap-2 mt-1" data-v-1f1551c6><div class="w-3 h-3 bg-red-500 rounded-full" data-v-1f1551c6></div><span data-v-1f1551c6>Delivery Location</span></div></div></div>',1)),y.value?(s(),d("div",he,[l("div",ke,g(y.value)+" km",1),h.value?(s(),d("div",Le,g(h.value)+" min",1)):u("",!0),e[9]||(e[9]=l("div",{class:"text-xs text-gray-500"},"Route distance & time",-1))])):u("",!0)])])):u("",!0),n.value?(s(),d("div",Ne,[l("div",Ce,[e[11]||(e[11]=l("div",{class:"w-5 h-5 text-red-500"},[l("svg",{fill:"currentColor",viewBox:"0 0 20 20"},[l("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule":"evenodd"})])],-1)),l("span",Me,g(n.value),1)]),v.value?u("",!0):(s(),d("div",Ie,[l("button",{type:"button",onClick:K,class:"px-3 py-1 text-xs bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors"}," ðŸ”„ Retry Location "),l("button",{type:"button",onClick:e[1]||(e[1]=o=>L.value=!L.value),class:"px-3 py-1 text-xs bg-gray-500 text-white rounded hover:bg-gray-600 transition-colors"}," ðŸ“ Enter Manually ")])),L.value&&!v.value?(s(),d("div",ze,[e[12]||(e[12]=l("div",{class:"text-xs text-gray-600 dark:text-gray-400 mb-2"}," Enter your current location coordinates: ",-1)),l("div",Ae,[T(l("input",{"onUpdate:modelValue":e[2]||(e[2]=o=>I.value=o),type:"number",step:"any",placeholder:"Latitude",class:"flex-1 px-2 py-1 text-xs border rounded"},null,512),[[$,I.value]]),T(l("input",{"onUpdate:modelValue":e[3]||(e[3]=o=>z.value=o),type:"number",step:"any",placeholder:"Longitude",class:"flex-1 px-2 py-1 text-xs border rounded"},null,512),[[$,z.value]]),l("button",{type:"button",onClick:J,class:"px-3 py-1 text-xs bg-green-500 text-white rounded hover:bg-green-600 transition-colors"}," Set ")]),e[13]||(e[13]=l("div",{class:"text-xs text-gray-500 mt-1"}," Example: 14.5995, 120.9842 (Manila) ",-1))])):u("",!0)])):u("",!0),!a.value&&!t.customerLocation&&!v.value?(s(),d("div",Fe,e[14]||(e[14]=[S('<p class="text-sm text-yellow-800 dark:text-yellow-200" data-v-1f1551c6><strong data-v-1f1551c6>Note:</strong> Please set the delivery origin address and location in <strong data-v-1f1551c6>Admin Settings</strong> to enable route calculation. </p><div class="flex items-center gap-2 mt-2" data-v-1f1551c6><div class="w-5 h-5 text-yellow-500" data-v-1f1551c6><svg fill="currentColor" viewBox="0 0 20 20" data-v-1f1551c6><path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd" data-v-1f1551c6></path></svg></div><span class="text-sm text-yellow-700 dark:text-yellow-400" data-v-1f1551c6>Select a customer with location data to view the route</span></div>',2)]))):u("",!0),!a.value&&!v.value?(s(),d("div",Ee,e[15]||(e[15]=[S('<div class="flex items-start gap-2" data-v-1f1551c6><div class="w-5 h-5 text-blue-500 mt-0.5" data-v-1f1551c6><svg fill="currentColor" viewBox="0 0 20 20" data-v-1f1551c6><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" data-v-1f1551c6></path></svg></div><div class="flex-1" data-v-1f1551c6><h4 class="text-sm font-semibold text-blue-900 dark:text-blue-100 mb-2" data-v-1f1551c6>Location Access Help</h4><div class="text-xs text-blue-800 dark:text-blue-200 space-y-1" data-v-1f1551c6><p data-v-1f1551c6><strong data-v-1f1551c6>Chrome/Edge:</strong> Click the location icon in the address bar â†’ Allow</p><p data-v-1f1551c6><strong data-v-1f1551c6>Firefox:</strong> Click the shield icon â†’ Allow location access</p><p data-v-1f1551c6><strong data-v-1f1551c6>Safari:</strong> Safari â†’ Preferences â†’ Websites â†’ Location â†’ Allow</p><p data-v-1f1551c6><strong data-v-1f1551c6>Mobile:</strong> Check your device&#39;s location settings and browser permissions</p></div><div class="mt-2 text-xs text-blue-600 dark:text-blue-300" data-v-1f1551c6> ðŸ’¡ <strong data-v-1f1551c6>Tip:</strong> You can also manually enter your coordinates using the &quot;Enter Manually&quot; option above. </div></div></div>',1)]))):u("",!0)],2))}}),Ve=ue(Se,[["__scopeId","data-v-1f1551c6"]]);export{Ve as D};
