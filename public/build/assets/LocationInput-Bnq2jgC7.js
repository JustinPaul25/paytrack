import{c as M}from"./index-Cq-jLiLx.js";import{v as R,u as F,i as T}from"./vue-leaflet.es-DXCGBEOL.js";import{a as q}from"./LocationInput.vue_vue_type_style_index_0_scoped_807a495d_lang-C5_-5mdN.js";import P from"./marker-icon-2x-1TirABJh.js";import U from"./marker-icon-B6h-nX3D.js";import B from"./marker-shadow-B9CpECYs.js";import{d as H,m as s,q as Z,z as j,s as D,e as n,o as l,n as E,u as d,b as m,c as k,f as x,F as O,r as X,w as A,a as Q,i as _,h as W,t as y}from"./app-DFV75mBf.js";import{_ as $}from"./_plugin-vue_export-helper-DlAUqK2U.js";const G={style:{"margin-bottom":"0.5rem"}},J=["value"],K={key:0,style:{"margin-top":"4px","font-size":"12px",color:"#6b7280"}},Y={key:1,style:{"margin-top":"4px",border:"1px solid #e5e7eb","border-radius":"6px",background:"var(--background, #fff)","max-height":"180px",overflow:"auto"}},ee=["onClick"],te={key:2,class:"mt-2 text-xs text-muted-foreground"},ae={class:"font-mono"},oe={key:3,class:"mt-2 text-xs text-red-500"},le={key:4,class:"mt-2 text-xs text-muted-foreground"},ne=H({__name:"LocationInput",props:{modelValue:{},defaultValue:{},class:{},mapHeight:{},mapZoom:{}},emits:["update:modelValue"],setup(w,{emit:N}){q.Icon.Default.mergeOptions({iconRetinaUrl:P,iconUrl:U,shadowUrl:B});const r=w,p=N,t=s(null),u=s([0,0]),c=s(r.mapZoom??(r.modelValue?13:2)),b=s(!1);Z(async()=>{await j(),await new Promise(e=>setTimeout(e,100)),b.value=!0});const f=s(""),i=s([]),v=s(!1);let g=null;async function S(e){const a=e.trim();if(!a){i.value=[];return}v.value=!0;try{const o=new URL(route("geocoding.search"),window.location.origin);o.searchParams.set("q",a),o.searchParams.set("limit","5");const h=await fetch(o.toString(),{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});if(!h.ok)throw new Error("Search failed");const L=await h.json();i.value=(L??[]).slice(0,5)}catch{i.value=[]}finally{v.value=!1}}function V(e){const a=e.target.value;f.value=a,g&&clearTimeout(g),g=setTimeout(()=>S(a),400)}function C(e){const a=parseFloat(e.lat),o=parseFloat(e.lon);isNaN(a)||isNaN(o)||(t.value={lat:a,lng:o},u.value=[a,o],c.value=15,p("update:modelValue",t.value),f.value=e.display_name,i.value=[])}D(()=>r.modelValue,e=>{e&&typeof e.lat=="number"&&typeof e.lng=="number"&&!isNaN(e.lat)&&!isNaN(e.lng)?(t.value=e,u.value=[e.lat,e.lng],c.value=r.mapZoom??13):(t.value=null,u.value=[0,0],c.value=r.mapZoom??2)},{immediate:!0});function z(e){const{latlng:a}=e;t.value={lat:a.lat,lng:a.lng},p("update:modelValue",t.value)}function I(e){const{lat:a,lng:o}=e.target.getLatLng();t.value={lat:a,lng:o},p("update:modelValue",t.value)}return(e,a)=>(l(),n("div",{class:E(d(M)("w-full",r.class))},[m("div",G,[m("input",{value:f.value,onInput:V,type:"text",placeholder:"Search place or address…","aria-label":"Search place or address",style:{width:"100%",height:"36px",border:"1px solid #e5e7eb","border-radius":"6px",padding:"0 10px",background:"var(--background, #fff)",color:"inherit"}},null,40,J),v.value?(l(),n("div",K,"Searching…")):x("",!0),i.value.length?(l(),n("div",Y,[(l(!0),n(O,null,X(i.value,o=>(l(),n("button",{key:o.lat+","+o.lon+"-"+o.display_name,type:"button",onClick:h=>C(o),style:{display:"block",width:"100%","text-align":"left",padding:"8px 10px",border:"none",background:"transparent",cursor:"pointer","font-size":"12px",color:"inherit"}},y(o.display_name),9,ee))),128))])):x("",!0)]),b.value?(l(),k(d(T),{key:0,center:u.value,"onUpdate:center":a[0]||(a[0]=o=>u.value=o),zoom:c.value,style:_({width:"100%",height:r.mapHeight??"300px",borderRadius:"0.5rem",border:"1px solid #e5e7eb",overflow:"hidden"}),onClick:z,"aria-label":"Location map input",tabindex:"0",role:"application"},{default:A(()=>[Q(d(R),{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:"© OpenStreetMap contributors","max-zoom":19}),t.value&&typeof t.value.lat=="number"&&typeof t.value.lng=="number"&&!isNaN(t.value.lat)&&!isNaN(t.value.lng)?(l(),k(d(F),{key:0,"lat-lng":[t.value.lat,t.value.lng],draggable:!0,onMoveend:I},null,8,["lat-lng"])):x("",!0)]),_:1},8,["center","zoom","style"])):(l(),n("div",{key:1,style:_({width:"100%",height:r.mapHeight??"300px",borderRadius:"0.5rem",border:"1px solid #e5e7eb",display:"flex",alignItems:"center",justifyContent:"center",background:"#f3f4f6"})},a[1]||(a[1]=[m("span",{class:"text-muted-foreground text-sm"},"Loading map...",-1)]),4)),t.value&&typeof t.value.lat=="number"&&typeof t.value.lng=="number"?(l(),n("div",te,[a[2]||(a[2]=W(" Selected: ")),m("span",ae,y(t.value.lat.toFixed(6))+", "+y(t.value.lng.toFixed(6)),1)])):t.value?(l(),n("div",oe," Invalid location data. Please click on the map to select a new location. ")):(l(),n("div",le,"Click on the map to select a location."))],2))}}),fe=$(ne,[["__scopeId","data-v-807a495d"]]);export{fe as default};
