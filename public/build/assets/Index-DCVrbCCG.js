import{d as X,v as B,m as v,p as b,q as O,z as P,A as I,c as y,o as a,w as m,a as l,b as o,u as _,g as W,t as c,h as g,e as C,f as r,F,r as V,l as $,B as z,W as K}from"./app-BkHalNTO.js";import{B as L,_ as U,P as Y}from"./AppLayout.vue_vue_type_script_setup_true_lang-CNenHwyy.js";import{_ as G,a as J}from"./CardContent.vue_vue_type_script_setup_true_lang-Dycyza_F.js";import{_ as Q,a as Z}from"./CardTitle.vue_vue_type_script_setup_true_lang-B7TTAUx0.js";import{_ as M}from"./index-gl4GIWPw.js";import{C as ee,M as te}from"./message-square-Y8OK_O-3.js";import{L as se}from"./loader-circle--hdWDkhR.js";import{D as oe}from"./dollar-sign-gYj2TyXT.js";import"./LocationInput.vue_vue_type_style_index_0_scoped_0fe2f881_lang-Bcmdzp5l.js";import"./RovingFocusGroup-hNCDy1GI.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-C9T_yUme.js";import"./createLucideIcon-b2VYfB8N.js";import"./VisuallyHidden-B2sC3urC.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-1ljwWgWY.js";import"./chevron-right-DSCzSCrA.js";const ae={class:"flex items-center justify-between my-6"},ne={class:"text-sm text-muted-foreground mt-1"},re={class:"flex gap-2"},ie={key:0,class:"py-12 text-center"},le=["onClick"],ce={class:"flex items-start gap-4"},ue={class:"mt-1"},de={class:"flex-1 min-w-0"},fe={class:"flex items-start justify-between gap-2"},me={class:"flex items-center gap-2"},pe={key:0,class:"h-2 w-2 rounded-full bg-primary flex-shrink-0"},_e={key:1,class:"text-muted-foreground"},ge={class:"mt-1 text-sm text-muted-foreground"},he={class:"flex items-center gap-2 mt-2"},ve={class:"text-xs text-muted-foreground"},xe={class:"text-xs text-muted-foreground"},ye={key:0,class:"flex justify-center items-center py-6"},we={key:1,class:"flex items-center gap-2 text-muted-foreground"},ke={key:1,class:"py-4 text-center text-sm text-muted-foreground"},Xe=X({__name:"Index",props:{notifications:{}},setup(N){B();const p=N,E=[{title:"Notifications",href:"/notifications"}],u=v([...p.notifications.data]),w=v(p.notifications.current_page),S=v(p.notifications.last_page),d=v(!1),f=v(null),T=e=>{try{const t=new Date(e),n=Math.floor((new Date().getTime()-t.getTime())/1e3);if(n<60)return"just now";if(n<3600){const i=Math.floor(n/60);return`${i} minute${i>1?"s":""} ago`}else if(n<86400){const i=Math.floor(n/3600);return`${i} hour${i>1?"s":""} ago`}else{const i=Math.floor(n/86400);return`${i} day${i>1?"s":""} ago`}}catch{return""}},A=e=>{try{return new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return e}},D=e=>e.includes("order")?Y:e.includes("comment")?te:e.includes("refund")?oe:L,H=async e=>{var t;if(!e.read)try{(await fetch(`/notifications/${e.id}/read`,{method:"POST",headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":((t=document.querySelector('meta[name="csrf-token"]'))==null?void 0:t.getAttribute("content"))||""}})).ok&&(e.read=!0,e.read_at=new Date().toISOString())}catch(s){console.error("Error marking notification as read:",s)}},q=async()=>{var e;try{(await fetch("/notifications/read-all",{method:"POST",headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":((e=document.querySelector('meta[name="csrf-token"]'))==null?void 0:e.getAttribute("content"))||""}})).ok&&u.value.forEach(s=>{s.read=!0,s.read_at=new Date().toISOString()})}catch(t){console.error("Error marking all notifications as read:",t)}},R=async e=>{await H(e),e.action_url&&K.visit(e.action_url)},j=b(()=>u.value.filter(e=>!e.read).length),h=b(()=>w.value<S.value),k=async()=>{if(!(d.value||!h.value)){d.value=!0;try{const e=w.value+1,t=await fetch(`/notifications?page=${e}`,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});if(t.ok){const s=await t.json();s.notifications&&Array.isArray(s.notifications.data)&&(u.value.push(...s.notifications.data),w.value=s.notifications.current_page,S.value=s.notifications.last_page)}}catch(e){console.error("Error loading more notifications:",e)}finally{d.value=!1}}},x=()=>{if(!(d.value||!h.value))if(f.value){const e=f.value,t=e.scrollTop,s=e.scrollHeight,n=e.clientHeight;t+n>=s-200&&k()}else{const e=window.pageYOffset||document.documentElement.scrollTop,t=document.documentElement.scrollHeight,s=window.innerHeight;e+s>=t-200&&k()}};return O(async()=>{await P(),f.value?f.value.addEventListener("scroll",x):window.addEventListener("scroll",x)}),I(()=>{f.value?f.value.removeEventListener("scroll",x):window.removeEventListener("scroll",x)}),(e,t)=>(a(),y(U,{breadcrumbs:E},{default:m(()=>[l(_(W),{title:"Notifications"}),o("div",ae,[o("div",null,[t[0]||(t[0]=o("h1",{class:"text-2xl font-bold"},"Notifications",-1)),o("p",ne,c(p.notifications.total)+" total notification"+c(p.notifications.total!==1?"s":""),1)]),o("div",re,[j.value>0?(a(),y(_(M),{key:0,variant:"outline",onClick:q},{default:m(()=>t[1]||(t[1]=[C(" Mark all as read ")])),_:1,__:[1]})):g("",!0)])]),l(G,null,{default:m(()=>[l(Q,null,{default:m(()=>[l(Z,null,{default:m(()=>t[2]||(t[2]=[C("All Notifications")])),_:1,__:[2]})]),_:1}),l(J,null,{default:m(()=>[u.value.length===0?(a(),r("div",ie,[l(_(L),{class:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),t[3]||(t[3]=o("p",{class:"text-muted-foreground"},"No notifications yet",-1))])):(a(),r("div",{key:1,ref_key:"scrollContainer",ref:f,class:"divide-y max-h-[600px] overflow-y-auto",style:{"scrollbar-width":"thin"}},[(a(!0),r(F,null,V(u.value,s=>(a(),r("button",{key:s.id,onClick:n=>R(s),class:$(["w-full text-left hover:bg-accent transition-colors p-4",{"bg-accent/50":!s.read}])},[o("div",ce,[o("div",ue,[(a(),y(z(D(s.type)),{class:"w-5 h-5 text-muted-foreground"}))]),o("div",de,[o("div",fe,[o("p",{class:$(["text-sm font-medium",{"font-semibold":!s.read}])},c(s.title),3),o("div",me,[s.read?g("",!0):(a(),r("span",pe)),s.read?(a(),r("span",_e,[l(_(ee),{class:"w-4 h-4"})])):g("",!0)])]),o("p",ge,c(s.message),1),o("div",he,[o("p",ve,c(T(s.created_at)),1),t[4]||(t[4]=o("span",{class:"text-xs text-muted-foreground"},"â€¢",-1)),o("p",xe,c(A(s.created_at)),1)])])])],10,le))),128)),h.value||d.value?(a(),r("div",ye,[h.value&&!d.value?(a(),y(_(M),{key:0,variant:"outline",onClick:k},{default:m(()=>t[5]||(t[5]=[C(" Load More ")])),_:1,__:[5]})):d.value?(a(),r("div",we,[l(_(se),{class:"w-4 h-4 animate-spin"}),t[6]||(t[6]=o("span",{class:"text-sm"},"Loading more notifications...",-1))])):g("",!0)])):g("",!0),!h.value&&u.value.length>0?(a(),r("div",ke,[o("p",null,"You've reached the end. Showing "+c(u.value.length)+" of "+c(p.notifications.total)+" notifications",1)])):g("",!0)],512))]),_:1})]),_:1})]),_:1}))}});export{Xe as default};
