import{d as G,D as H,p as $,c as q,o as f,w as n,a as t,b as i,u as l,g as J,E as R,e as d,f as v,h,x as g,y as b,F as X,r as Y,t as y,S as Z}from"./app-Du4GjnqY.js";import{_ as x}from"./index-B1B-wuAy.js";import{_ as V}from"./Select.vue_vue_type_script_setup_true_lang-2dMc3g12.js";import{_ as I}from"./SearchSelect.vue_vue_type_script_setup_true_lang-Cjm4Wq4y.js";import{_ as ee}from"./AppLayout.vue_vue_type_script_setup_true_lang-C5-77bQX.js";import{_ as w,a as S}from"./CardContent.vue_vue_type_script_setup_true_lang-CsIZBT8t.js";import{_ as T,a as U}from"./CardTitle.vue_vue_type_script_setup_true_lang-Yjmxyl1g.js";import{_ as te}from"./CardFooter.vue_vue_type_script_setup_true_lang-CmGr18V_.js";import{_ as m}from"./Label.vue_vue_type_script_setup_true_lang-7De4O60e.js";import{S as C}from"./sweetalert2.esm.all-BQIkj5Wb.js";import{_ as p}from"./InputError.vue_vue_type_script_setup_true_lang-BWgwLU_F.js";import{T as se}from"./trash-2-B6DjoUNv.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-BItx2YQm.js";import"./createLucideIcon-knc4Tqmj.js";import"./RovingFocusGroup-Bek87zqo.js";import"./LocationInput.vue_vue_type_style_index_0_scoped_0fe2f881_lang-DHw6Z5C7.js";import"./Input.vue_vue_type_script_setup_true_lang-CMLq3oKH.js";import"./search-CImxIYP8.js";import"./VisuallyHidden-8qINCcSU.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang--3inaUNk.js";import"./chevron-right-Ds8ma9mO.js";const oe={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ie={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},re={key:0,class:"grid grid-cols-1 md:grid-cols-2 gap-4"},le={class:"flex justify-between items-center"},ne={class:"space-y-3"},ae={class:"flex justify-between items-center mb-3"},de={class:"font-medium text-sm"},ue={class:"grid grid-cols-1 md:grid-cols-4 gap-3"},me=["id","onUpdate:modelValue","onInput"],pe={key:0,class:"text-[11px] text-gray-500 mt-1"},ce=["id","onUpdate:modelValue","onInput"],fe={class:"w-full rounded-md border border-input bg-transparent px-2 py-1 mt-1 text-sm text-foreground dark:bg-input/30 h-8 flex items-center"},_e={class:"mt-4 pt-3 border-t"},ve={class:"flex justify-end"},ge={class:"text-right"},be={class:"text-base font-medium"},Ee=G({__name:"Create",props:{customers:{},products:{}},setup(B){const c=B,o=H({customer_id:null,status:"draft",payment_method:"cash",invoice_type:"walk_in",credit_term_days:null,notes:"",invoice_items:[{product_id:null,quantity:1,price:0,total:0}]}),P=[{title:"Invoices",href:"/invoices"},{title:"Create Invoice",href:"/invoices/create"}],j=$(()=>o.invoice_items.reduce((r,e)=>r+e.total,0)),D=$(()=>!o.customer_id||!o.invoice_items.length?!1:o.invoice_items.some(r=>!!r.product_id&&r.quantity>0&&r.price>=0));function O(){o.invoice_items.push({product_id:null,quantity:1,price:0,total:0})}function A(r){o.invoice_items.length>1&&o.invoice_items.splice(r,1)}function _(r){const e=o.invoice_items[r];e.product_id&&e.quantity&&e.price?e.total=e.quantity*e.price:e.total=0}function N(r){const e=o.invoice_items[r];if(e.product_id){const s=c.products.find(a=>a.id===e.product_id);s&&(e.price=s.selling_price,_(r))}}function Q(r){const e=o.invoice_items[r];if(e.product_id&&e.quantity){const s=c.products.find(a=>a.id===e.product_id);s&&e.quantity>s.stock&&(e.quantity=s.stock,C.fire({icon:"info",title:"Quantity Adjusted",text:`Quantity for "${s.name}" has been adjusted to the maximum available stock (${s.stock} units).`,confirmButtonText:"OK",toast:!0,position:"top-end",timer:3e3,timerProgressBar:!0}))}_(r)}function E(r){_(r)}function F(){for(let r=0;r<o.invoice_items.length;r++){const e=o.invoice_items[r];if(e.product_id&&e.quantity){const s=c.products.find(a=>a.id===e.product_id);s&&e.quantity>s.stock&&(e.quantity=s.stock,_(r),C.fire({icon:"warning",title:"Quantity Auto-Adjusted",text:`Quantity for "${s.name}" was automatically adjusted to ${s.stock} units due to stock limitations.`,confirmButtonText:"OK"}))}}o.post(route("invoices.store"),{preserveScroll:!0,onSuccess:()=>{C.fire({toast:!0,position:"top-end",icon:"success",title:"Invoice created successfully",showConfirmButton:!1,timer:3e3,timerProgressBar:!0})}})}function k(r){return o.errors[r]}const M=$(()=>[{value:null,label:"Select customer"},...c.customers.map(r=>({value:r.id,label:`${r.name}${r.company_name?` (${r.company_name})`:""}`}))]),W=[{value:"draft",label:"Draft"},{value:"pending",label:"Pending"},{value:"completed",label:"Completed"},{value:"cancelled",label:"Cancelled"}],K=[{value:"cash",label:"Cash"},{value:"bank_transfer",label:"Bank Transfer"},{value:"e-wallet",label:"E-Wallet"},{value:"other",label:"Other"}],z=[{value:"walk_in",label:"Walk-in"},{value:"delivery",label:"Delivery"}];function L(){return[{value:null,label:"Select product"},...c.products.map(r=>({value:r.id,label:`${r.name}`}))]}return(r,e)=>(f(),q(ee,{breadcrumbs:P},{default:n(()=>[t(l(J),{title:"Create Invoice"}),e[27]||(e[27]=i("div",{class:"flex items-center justify-between mb-6"},[i("h1",{class:"text-2xl font-bold"},"Create Invoice")],-1)),i("form",{onSubmit:e[6]||(e[6]=R(s=>F(),["prevent"])),class:"space-y-6"},[t(w,null,{default:n(()=>[t(T,null,{default:n(()=>[t(U,null,{default:n(()=>e[7]||(e[7]=[d("Invoice Details")])),_:1,__:[7]})]),_:1}),t(S,{class:"space-y-6"},{default:n(()=>[i("div",oe,[i("div",null,[t(m,{for:"customer_id"},{default:n(()=>e[8]||(e[8]=[d("Customer")])),_:1,__:[8]}),t(l(I),{modelValue:l(o).customer_id,"onUpdate:modelValue":e[0]||(e[0]=s=>l(o).customer_id=s),options:M.value,placeholder:"Select customer","search-placeholder":"Search customers...",class:"mt-1",required:""},null,8,["modelValue","options"]),t(p,{message:l(o).errors.customer_id},null,8,["message"])]),i("div",null,[t(m,{for:"status"},{default:n(()=>e[9]||(e[9]=[d("Status")])),_:1,__:[9]}),t(l(V),{modelValue:l(o).status,"onUpdate:modelValue":e[1]||(e[1]=s=>l(o).status=s),options:W,placeholder:"Select status",class:"mt-1",required:""},null,8,["modelValue"]),e[10]||(e[10]=i("div",{class:"text-[11px] text-gray-500 mt-1"}," Draft: still editing, Pending: awaiting payment, Completed: paid, Cancelled: void. ",-1)),t(p,{message:l(o).errors.status},null,8,["message"])])]),i("div",ie,[i("div",null,[t(m,{for:"payment_method"},{default:n(()=>e[11]||(e[11]=[d("Payment Method")])),_:1,__:[11]}),t(l(V),{modelValue:l(o).payment_method,"onUpdate:modelValue":e[2]||(e[2]=s=>l(o).payment_method=s),options:K,placeholder:"Select payment method",class:"mt-1",required:""},null,8,["modelValue"]),e[12]||(e[12]=i("div",{class:"text-[11px] text-gray-500 mt-1"}," Pick how the customer will pay (e.g. Cash, Bank Transfer, E‑Wallet). ",-1)),t(p,{message:l(o).errors.payment_method},null,8,["message"])]),i("div",null,[t(m,{for:"invoice_type"},{default:n(()=>e[13]||(e[13]=[d("Invoice Type")])),_:1,__:[13]}),t(l(V),{modelValue:l(o).invoice_type,"onUpdate:modelValue":e[3]||(e[3]=s=>l(o).invoice_type=s),options:z,placeholder:"Select invoice type",class:"mt-1",required:""},null,8,["modelValue"]),e[14]||(e[14]=i("div",{class:"text-[11px] text-gray-500 mt-1"}," Walk-in: Customer purchases in-store. Delivery: Items will be delivered. ",-1)),t(p,{message:l(o).errors.invoice_type},null,8,["message"])])]),l(o).payment_method!=="cash"?(f(),v("div",re,[i("div",null,[t(m,{for:"credit_term_days"},{default:n(()=>e[15]||(e[15]=[d("Credit Term (Days)")])),_:1,__:[15]}),g(i("input",{"onUpdate:modelValue":e[4]||(e[4]=s=>l(o).credit_term_days=s),type:"number",id:"credit_term_days",min:"0",max:"365",class:"mt-1 block w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",placeholder:"e.g., 30"},null,512),[[b,l(o).credit_term_days,void 0,{number:!0}]]),e[16]||(e[16]=i("div",{class:"text-[11px] text-gray-500 mt-1"}," Number of days until payment is due (default: 30 days). ",-1)),t(p,{message:l(o).errors.credit_term_days},null,8,["message"])])])):h("",!0),i("div",null,[t(m,{for:"notes"},{default:n(()=>e[17]||(e[17]=[d("Notes")])),_:1,__:[17]}),g(i("textarea",{id:"notes","onUpdate:modelValue":e[5]||(e[5]=s=>l(o).notes=s),class:"w-full rounded-md border border-input bg-transparent px-3 py-2 mt-1 text-foreground dark:bg-input/30 focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] focus-visible:outline-none",rows:"3"},null,512),[[b,l(o).notes]]),t(p,{message:l(o).errors.notes},null,8,["message"])])]),_:1})]),_:1}),t(w,null,{default:n(()=>[t(T,null,{default:n(()=>[i("div",le,[t(U,null,{default:n(()=>e[18]||(e[18]=[d("Invoice Items")])),_:1,__:[18]}),t(l(x),{type:"button",variant:"outline",onClick:O},{default:n(()=>e[19]||(e[19]=[i("span",{class:"mr-2"},"+",-1),d(" Add Item ")])),_:1,__:[19]})])]),_:1}),t(S,null,{default:n(()=>[i("div",ne,[(f(!0),v(X,null,Y(l(o).invoice_items,(s,a)=>(f(),v("div",{key:a,class:"border rounded-md p-3"},[i("div",ae,[i("h4",de,"Item "+y(a+1),1),l(o).invoice_items.length>1?(f(),q(l(x),{key:0,type:"button",variant:"ghost",size:"sm",class:"h-7 w-7 p-0 text-red-500 hover:text-red-600 hover:bg-red-50 dark:hover:bg-red-950/20",onClick:u=>A(a)},{default:n(()=>[t(l(se),{class:"h-4 w-4"})]),_:2},1032,["onClick"])):h("",!0)]),i("div",ue,[i("div",null,[t(m,{for:`product_id_${a}`,class:"text-xs"},{default:n(()=>e[20]||(e[20]=[d("Product")])),_:2,__:[20]},1032,["for"]),t(l(I),{modelValue:s.product_id,"onUpdate:modelValue":[u=>s.product_id=u,u=>N(a)],options:L(),placeholder:"Select product","search-placeholder":"Search products...",class:"mt-1 h-8",required:""},null,8,["modelValue","onUpdate:modelValue","options"]),t(p,{message:k(`invoice_items.${a}.product_id`)},null,8,["message"])]),i("div",null,[t(m,{for:`quantity_${a}`,class:"text-xs"},{default:n(()=>e[21]||(e[21]=[d("Quantity")])),_:2,__:[21]},1032,["for"]),g(i("input",{id:`quantity_${a}`,"onUpdate:modelValue":u=>s.quantity=u,type:"number",min:"1",class:"w-full rounded-md border border-input bg-transparent px-2 py-1 mt-1 text-sm text-foreground dark:bg-input/30 focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] focus-visible:outline-none h-8",onInput:u=>Q(a),required:""},null,40,me),[[b,s.quantity,void 0,{number:!0}]]),s.product_id?(f(),v("div",pe," In stock: "+y((c.products.find(u=>u.id===s.product_id)||{stock:0}).stock),1)):h("",!0),t(p,{message:k(`invoice_items.${a}.quantity`)},null,8,["message"])]),i("div",null,[t(m,{for:`price_${a}`,class:"text-xs"},{default:n(()=>e[22]||(e[22]=[d("Price")])),_:2,__:[22]},1032,["for"]),g(i("input",{id:`price_${a}`,"onUpdate:modelValue":u=>s.price=u,type:"number",min:"0",step:"0.01",class:"w-full rounded-md border border-input bg-transparent px-2 py-1 mt-1 text-sm text-foreground dark:bg-input/30 focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] focus-visible:outline-none h-8",onInput:u=>E(a),required:""},null,40,ce),[[b,s.price,void 0,{number:!0}]]),t(p,{message:k(`invoice_items.${a}.price`)},null,8,["message"])]),i("div",null,[t(m,{class:"text-xs"},{default:n(()=>e[23]||(e[23]=[d("Total")])),_:1,__:[23]}),i("div",fe," ₱"+y(s.total.toFixed(2)),1)])])]))),128))]),i("div",_e,[i("div",ve,[i("div",ge,[i("div",be,"Total Amount: ₱"+y(j.value.toFixed(2)),1),e[24]||(e[24]=i("div",{class:"text-xs text-muted-foreground mt-1"},"12% VAT is included in price",-1))])])])]),_:1})]),_:1}),t(w,null,{default:n(()=>[t(te,{class:"flex gap-2 justify-end"},{default:n(()=>[t(l(x),{type:"submit",disabled:!D.value,variant:"default"},{default:n(()=>e[25]||(e[25]=[d("Create Invoice")])),_:1,__:[25]},8,["disabled"]),t(l(Z),{href:r.route("invoices.index")},{default:n(()=>[t(l(x),{type:"button",variant:"ghost"},{default:n(()=>e[26]||(e[26]=[d("Cancel")])),_:1,__:[26]})]),_:1},8,["href"])]),_:1})]),_:1})],32)]),_:1,__:[27]}))}});export{Ee as default};
