import{d as W,v as Y,p as D,m as c,s as P,q as J,f as u,o as s,l as K,b as o,h as n,a as O,u as f,n as Q,w as I,c as z,t as v,e as X,C as A,x as U,y as R}from"./app-CrbxPDKR.js";import{i as Z,v as ee,u as B,p as te}from"./vue-leaflet.es-Be2_S52i.js";import{q as V}from"./LocationInput.vue_vue_type_style_index_0_scoped_0fe2f881_lang-DcvXf-iQ.js";import ae from"./marker-icon-2x-1TirABJh.js";import oe from"./marker-icon-B6h-nX3D.js";import le from"./marker-shadow-B9CpECYs.js";import{_ as se}from"./_plugin-vue_export-helper-DlAUqK2U.js";const re={class:"relative"},ne={class:"text-center"},ie={key:0,class:"text-xs text-gray-500 mb-1"},ue={class:"text-sm text-gray-600"},de={class:"text-center"},ce={class:"text-sm text-gray-600"},ve={key:0,class:"text-xs text-gray-500 mt-1"},ge={key:0,class:"absolute inset-0 bg-white/80 dark:bg-gray-900/80 flex items-center justify-center rounded-lg"},me={key:0,class:"mt-4 p-4 bg-gray-50 dark:bg-gray-800 rounded-lg"},pe={class:"mb-2 text-sm text-gray-600"},fe={class:"flex items-center justify-between"},ye={key:0,class:"text-right"},be={class:"text-lg font-bold text-gray-900 dark:text-gray-100"},xe={key:0,class:"text-sm text-gray-600 dark:text-gray-400"},he={key:1,class:"mt-4 p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg"},we={class:"flex items-center gap-2 mb-3"},ke={class:"text-sm text-red-700 dark:text-red-400"},Le={key:0,class:"flex gap-2"},Ne={key:1,class:"mt-3 p-3 bg-white dark:bg-gray-700 rounded border"},Ce={class:"flex gap-2"},Me={key:2,class:"mt-4 p-4 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg"},Ie={key:3,class:"mt-4 p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg"},ze=W({__name:"DeliveryRouteMap",props:{customerLocation:{},deliveryAddress:{},class:{default:""},mapHeight:{default:"400px"}},setup($){V.Icon.Default.mergeOptions({iconRetinaUrl:ae,iconUrl:oe,shadowUrl:le});const i=$,E=Y(),d=D(()=>{const e=E.props.deliveryOriginLocation;return e&&typeof e.lat=="number"&&typeof e.lng=="number"?{lat:e.lat,lng:e.lng}:null}),N=D(()=>E.props.deliveryOriginAddress||""),a=c(null),y=c([]),h=c(null),w=c(null),k=c(!1),r=c(null),g=c([14.5995,120.9842]),m=c(10),L=c(!1),C=c(""),M=c(""),_=e=>new V.Icon({iconUrl:`data:image/svg+xml;base64,${btoa(`
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="${e}" width="24" height="24">
        <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
      </svg>
    `)}`,iconSize:[24,24],iconAnchor:[12,24],popupAnchor:[0,-24]}),H=_("#3b82f6"),T=_("#ef4444"),F=()=>new Promise((e,t)=>{if(!navigator.geolocation){t(new Error("Geolocation is not supported by this browser"));return}navigator.geolocation.getCurrentPosition(l=>{e({lat:l.coords.latitude,lng:l.coords.longitude})},l=>{let p="Unknown geolocation error";switch(l.code){case l.PERMISSION_DENIED:p="Location access was denied. Please allow location access in your browser settings and refresh the page.";break;case l.POSITION_UNAVAILABLE:p="Location information is unavailable. Please check your device location settings.";break;case l.TIMEOUT:p="Location request timed out. Please try again.";break;default:p=`Geolocation error: ${l.message}`}t(new Error(p))},{enableHighAccuracy:!1,timeout:15e3,maximumAge:3e5})}),b=async(e,t)=>{if(!e||!t||typeof e.lat!="number"||typeof e.lng!="number"||typeof t.lat!="number"||typeof t.lng!="number"||isNaN(e.lat)||isNaN(e.lng)||isNaN(t.lat)||isNaN(t.lng)){console.error("Invalid coordinates for route calculation:",{from:e,to:t}),r.value="Invalid coordinates for route calculation";return}try{k.value=!0,r.value=null;const l=`https://router.project-osrm.org/route/v1/driving/${e.lng},${e.lat};${t.lng},${t.lat}?overview=full&geometries=geojson`,p=await fetch(l);if(!p.ok)throw new Error("Failed to calculate route");const x=await p.json();if(x.routes&&x.routes[0]&&x.routes[0].geometry){const G=x.routes[0].geometry.coordinates;y.value=G.map(S=>[S[1],S[0]]),h.value=parseFloat((x.routes[0].distance/1e3).toFixed(1)),w.value=parseFloat((x.routes[0].duration/60).toFixed(1)),console.log("Route calculated:",{distance:h.value,duration:w.value,coordinates:y.value.length})}else throw new Error("No route found")}catch(l){console.error("Route calculation error:",l),r.value="Failed to calculate route. Please check your internet connection.",y.value=[[e.lat,e.lng],[t.lat,t.lng]]}finally{k.value=!1}};P(()=>i.customerLocation,async e=>{if(e&&typeof e.lat=="number"&&typeof e.lng=="number"&&!isNaN(e.lat)&&!isNaN(e.lng)&&e.lat>=-90&&e.lat<=90&&e.lng>=-180&&e.lng<=180)if(a.value){await b(a.value,e);const t=(a.value.lat+e.lat)/2,l=(a.value.lng+e.lng)/2;g.value=[t,l],m.value=12}else g.value=[e.lat,e.lng],m.value=13;else e&&(console.warn("Invalid customer location data:",e),r.value="Customer location data is invalid or missing. Please update the customer with valid coordinates.")},{immediate:!0}),J(async()=>{try{d.value?(a.value={lat:d.value.lat,lng:d.value.lng},g.value=[a.value.lat,a.value.lng],m.value=13,i.customerLocation&&await b(a.value,i.customerLocation)):(a.value=await F(),g.value=[a.value.lat,a.value.lng],m.value=13,i.customerLocation&&await b(a.value,i.customerLocation))}catch(e){console.error("Failed to get current location:",e),d.value?r.value="Failed to load delivery origin location. Please check admin settings.":r.value="Unable to get your current location. Please set the delivery origin address in Admin Settings or enable location services."}}),P(y,e=>{e.length<2&&(h.value=null,w.value=null)});function q(){const e=parseFloat(C.value),t=parseFloat(M.value);if(isNaN(e)||isNaN(t)){r.value="Please enter valid latitude and longitude coordinates";return}if(e<-90||e>90){r.value="Latitude must be between -90 and 90";return}if(t<-180||t>180){r.value="Longitude must be between -180 and 180";return}a.value={lat:e,lng:t},g.value=[e,t],m.value=13,r.value=null,L.value=!1,i.customerLocation&&b(a.value,i.customerLocation)}async function j(){r.value=null,k.value=!0;try{d.value?(a.value={lat:d.value.lat,lng:d.value.lng},g.value=[a.value.lat,a.value.lng],m.value=13,i.customerLocation&&await b(a.value,i.customerLocation)):(a.value=await F(),g.value=[a.value.lat,a.value.lng],m.value=13,i.customerLocation&&await b(a.value,i.customerLocation))}catch(e){console.error("Failed to get current location:",e),r.value=e instanceof Error?e.message:"Unable to get your current location"}finally{k.value=!1}}return(e,t)=>(s(),u("div",{class:K(["w-full",i.class])},[o("div",re,[O(f(Z),{center:g.value,"onUpdate:center":t[0]||(t[0]=l=>g.value=l),zoom:m.value,style:Q({width:"100%",height:i.mapHeight,borderRadius:"0.5rem",border:"1px solid #e5e7eb",overflow:"hidden"}),"aria-label":"Delivery route map",tabindex:"0",role:"application"},{default:I(()=>[O(f(ee),{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:"Â© OpenStreetMap contributors","max-zoom":19}),a.value&&typeof a.value.lat=="number"&&typeof a.value.lng=="number"&&!isNaN(a.value.lat)&&!isNaN(a.value.lng)?(s(),z(f(B),{key:0,"lat-lng":[a.value.lat,a.value.lng],icon:f(H)},{popup:I(()=>[o("div",ne,[t[4]||(t[4]=o("div",{class:"font-semibold text-blue-600"},"Current Location",-1)),N.value?(s(),u("div",ie,v(N.value),1)):n("",!0),o("div",ue,v(Number(a.value.lat).toFixed(6))+", "+v(Number(a.value.lng).toFixed(6)),1)])]),_:1},8,["lat-lng","icon"])):n("",!0),e.customerLocation&&typeof e.customerLocation.lat=="number"&&typeof e.customerLocation.lng=="number"&&!isNaN(e.customerLocation.lat)&&!isNaN(e.customerLocation.lng)?(s(),z(f(B),{key:1,"lat-lng":[e.customerLocation.lat,e.customerLocation.lng],icon:f(T)},{popup:I(()=>[o("div",de,[t[5]||(t[5]=o("div",{class:"font-semibold text-red-600"},"Delivery Location",-1)),o("div",ce,v(Number(e.customerLocation.lat).toFixed(6))+", "+v(Number(e.customerLocation.lng).toFixed(6)),1),e.deliveryAddress?(s(),u("div",ve,v(e.deliveryAddress),1)):n("",!0)])]),_:1},8,["lat-lng","icon"])):n("",!0),y.value.length>1?(s(),z(f(te),{key:2,"lat-lngs":y.value,color:"#10b981",weight:"4",opacity:"0.8"},null,8,["lat-lngs"])):n("",!0)]),_:1},8,["center","zoom","style"]),k.value?(s(),u("div",ge,t[6]||(t[6]=[o("div",{class:"text-center"},[o("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),o("div",{class:"mt-2 text-sm text-gray-600"},"Calculating route...")],-1)]))):n("",!0)]),a.value&&e.customerLocation?(s(),u("div",me,[o("div",pe,[t[7]||(t[7]=o("strong",null,"Origin:",-1)),X(" "+v(N.value||"Delivery Origin (from admin settings)"),1)]),o("div",fe,[t[9]||(t[9]=A('<div data-v-9256f384><h3 class="font-semibold text-gray-900 dark:text-gray-100" data-v-9256f384>Route Information</h3><div class="text-sm text-gray-600 dark:text-gray-400 mt-1" data-v-9256f384><div class="flex items-center gap-2" data-v-9256f384><div class="w-3 h-3 bg-blue-500 rounded-full" data-v-9256f384></div><span data-v-9256f384>Current Location</span></div><div class="flex items-center gap-2 mt-1" data-v-9256f384><div class="w-3 h-3 bg-red-500 rounded-full" data-v-9256f384></div><span data-v-9256f384>Delivery Location</span></div></div></div>',1)),h.value?(s(),u("div",ye,[o("div",be,v(h.value)+" km",1),w.value?(s(),u("div",xe,v(w.value)+" min",1)):n("",!0),t[8]||(t[8]=o("div",{class:"text-xs text-gray-500"},"Route distance & time",-1))])):n("",!0)])])):n("",!0),r.value?(s(),u("div",he,[o("div",we,[t[10]||(t[10]=o("div",{class:"w-5 h-5 text-red-500"},[o("svg",{fill:"currentColor",viewBox:"0 0 20 20"},[o("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule":"evenodd"})])],-1)),o("span",ke,v(r.value),1)]),d.value?n("",!0):(s(),u("div",Le,[o("button",{type:"button",onClick:j,class:"px-3 py-1 text-xs bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors"}," ðŸ”„ Retry Location "),o("button",{type:"button",onClick:t[1]||(t[1]=l=>L.value=!L.value),class:"px-3 py-1 text-xs bg-gray-500 text-white rounded hover:bg-gray-600 transition-colors"}," ðŸ“ Enter Manually ")])),L.value&&!d.value?(s(),u("div",Ne,[t[11]||(t[11]=o("div",{class:"text-xs text-gray-600 dark:text-gray-400 mb-2"}," Enter your current location coordinates: ",-1)),o("div",Ce,[U(o("input",{"onUpdate:modelValue":t[2]||(t[2]=l=>C.value=l),type:"number",step:"any",placeholder:"Latitude",class:"flex-1 px-2 py-1 text-xs border rounded"},null,512),[[R,C.value]]),U(o("input",{"onUpdate:modelValue":t[3]||(t[3]=l=>M.value=l),type:"number",step:"any",placeholder:"Longitude",class:"flex-1 px-2 py-1 text-xs border rounded"},null,512),[[R,M.value]]),o("button",{type:"button",onClick:q,class:"px-3 py-1 text-xs bg-green-500 text-white rounded hover:bg-green-600 transition-colors"}," Set ")]),t[12]||(t[12]=o("div",{class:"text-xs text-gray-500 mt-1"}," Example: 14.5995, 120.9842 (Manila) ",-1))])):n("",!0)])):n("",!0),!a.value&&!e.customerLocation&&!d.value?(s(),u("div",Me,t[13]||(t[13]=[A('<p class="text-sm text-yellow-800 dark:text-yellow-200" data-v-9256f384><strong data-v-9256f384>Note:</strong> Please set the delivery origin address and location in <strong data-v-9256f384>Admin Settings</strong> to enable route calculation. </p><div class="flex items-center gap-2 mt-2" data-v-9256f384><div class="w-5 h-5 text-yellow-500" data-v-9256f384><svg fill="currentColor" viewBox="0 0 20 20" data-v-9256f384><path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd" data-v-9256f384></path></svg></div><span class="text-sm text-yellow-700 dark:text-yellow-400" data-v-9256f384>Select a customer with location data to view the route</span></div>',2)]))):n("",!0),!a.value&&!d.value?(s(),u("div",Ie,t[14]||(t[14]=[A('<div class="flex items-start gap-2" data-v-9256f384><div class="w-5 h-5 text-blue-500 mt-0.5" data-v-9256f384><svg fill="currentColor" viewBox="0 0 20 20" data-v-9256f384><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" data-v-9256f384></path></svg></div><div class="flex-1" data-v-9256f384><h4 class="text-sm font-semibold text-blue-900 dark:text-blue-100 mb-2" data-v-9256f384>Location Access Help</h4><div class="text-xs text-blue-800 dark:text-blue-200 space-y-1" data-v-9256f384><p data-v-9256f384><strong data-v-9256f384>Chrome/Edge:</strong> Click the location icon in the address bar â†’ Allow</p><p data-v-9256f384><strong data-v-9256f384>Firefox:</strong> Click the shield icon â†’ Allow location access</p><p data-v-9256f384><strong data-v-9256f384>Safari:</strong> Safari â†’ Preferences â†’ Websites â†’ Location â†’ Allow</p><p data-v-9256f384><strong data-v-9256f384>Mobile:</strong> Check your device&#39;s location settings and browser permissions</p></div><div class="mt-2 text-xs text-blue-600 dark:text-blue-300" data-v-9256f384> ðŸ’¡ <strong data-v-9256f384>Tip:</strong> You can also manually enter your coordinates using the &quot;Enter Manually&quot; option above. </div></div></div>',1)]))):n("",!0)],2))}}),Oe=se(ze,[["__scopeId","data-v-9256f384"]]);export{Oe as D};
