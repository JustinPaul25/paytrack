import{d as O,D as L,l as c,z as R,c as T,o as j,w as s,a as o,b as n,u as r,g as F,q as I,e as a,A as m,B as p,S as G}from"./app-DORIYMDG.js";import{_ as v}from"./index-DoNjpcdn.js";import{_ as g}from"./Select.vue_vue_type_script_setup_true_lang-BamoeKlh.js";import{_ as H}from"./SearchSelect.vue_vue_type_script_setup_true_lang-eoJT7c39.js";import{_ as z}from"./AppLayout.vue_vue_type_script_setup_true_lang-DeN0eqzz.js";import{_ as b,a as w}from"./CardContent.vue_vue_type_script_setup_true_lang-DWvSx-wv.js";import{_ as C,a as P}from"./CardTitle.vue_vue_type_script_setup_true_lang-C6fCULAJ.js";import{_ as J}from"./CardFooter.vue_vue_type_script_setup_true_lang-C2v_d4KS.js";import{_ as d}from"./Label.vue_vue_type_script_setup_true_lang-CPLqprlq.js";import{S as _}from"./sweetalert2.esm.all-BQIkj5Wb.js";import{_ as u}from"./InputError.vue_vue_type_script_setup_true_lang-CFSiBcyX.js";import{D as Y}from"./DeliveryRouteMap-C3XS5LBA.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-QOJlGbE-.js";import"./createLucideIcon-etrCRwme.js";import"./RovingFocusGroup-D09oAaLD.js";import"./LocationInput.vue_vue_type_style_index_0_scoped_0fe2f881_lang-CUAz4wew.js";import"./Input.vue_vue_type_script_setup_true_lang-BpbrWRlr.js";import"./search-Cyfl6PAK.js";import"./VisuallyHidden-BmVAsIHk.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-I3Ux6KpB.js";import"./_plugin-vue_export-helper-C7wsLqbr.js";import"./marker-icon-2x-1TirABJh.js";import"./marker-icon-B6h-nX3D.js";import"./marker-shadow-B9CpECYs.js";const K={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Q={class:"flex gap-2 mt-1"},W={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Z={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},h=["min"],ee={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Me=O({__name:"Create",props:{customers:{},invoices:{}},setup(M){const f=M,t=L({customer_id:null,invoice_id:null,delivery_address:"",contact_person:"",contact_phone:"",delivery_date:"",delivery_time:"",status:"pending",notes:"",delivery_fee:"",create_another:void 0}),V=[{title:"Deliveries",href:"/deliveries"},{title:"Create Delivery",href:"/deliveries/create"}];function y(i=!1){if(!t.invoice_id){t.setError("invoice_id","Invoice is required.");return}if(!/^(?:\+?63|0)9\d{9}$/.test(t.contact_phone||"")){t.setError("contact_phone","Enter a valid PH mobile number (09XXXXXXXXX or +639XXXXXXXXX).");return}i?t.create_another=1:delete t.create_another,t.post(route("deliveries.store"),{preserveScroll:!0,onSuccess:()=>{_.fire({toast:!0,position:"top-end",icon:"success",title:"Delivery created successfully",showConfirmButton:!1,timer:3e3,timerProgressBar:!0}),i&&t.reset()}})}const $=c(()=>[{value:null,label:"Select customer"},...f.customers.map(i=>({value:i.id,label:`${i.name}${i.company_name?` (${i.company_name})`:""}`}))]),D=c(()=>{if(!t.customer_id)return[{value:null,label:"Select invoice (select customer first)"}];const i=f.invoices.filter(e=>e.customer_id===t.customer_id);return[{value:null,label:"Select invoice"},...i.map(e=>({value:e.id,label:`${e.reference_number}`}))]}),S=[{value:"pending",label:"Pending"},{value:"completed",label:"Completed"},{value:"cancelled",label:"Cancelled"}],k=[{value:"09:00 AM - 12:00 PM",label:"09:00 AM - 12:00 PM"},{value:"12:00 PM - 03:00 PM",label:"12:00 PM - 03:00 PM"},{value:"03:00 PM - 06:00 PM",label:"03:00 PM - 06:00 PM"},{value:"06:00 PM - 09:00 PM",label:"06:00 PM - 09:00 PM"},{value:"Custom",label:"Custom"}],q=new Date().toISOString().split("T")[0],U=c(()=>{if(!t.customer_id)return null;const i=f.customers.find(l=>l.id===t.customer_id);if(!(i!=null&&i.location))return null;let e=i.location;if(typeof e=="string")try{e=JSON.parse(e)}catch{return console.warn("Failed to parse customer location string:",e),null}return e&&typeof e.lat=="number"&&typeof e.lng=="number"&&!isNaN(e.lat)&&!isNaN(e.lng)&&e.lat>=-90&&e.lat<=90&&e.lng>=-180&&e.lng<=180?e:(console.warn("Invalid customer location data:",i.location),null)}),E=c(()=>t.customer_id&&f.customers.find(i=>i.id===t.customer_id)||null);R(()=>t.customer_id,i=>{if(i){const e=f.customers.find(l=>l.id===i);e!=null&&e.address&&!t.delivery_address&&(t.delivery_address=e.address)}});async function N(){try{if(!navigator.geolocation){_.fire({icon:"error",title:"Geolocation not supported",text:"Your browser does not support geolocation."});return}const i=await new Promise((B,A)=>{navigator.geolocation.getCurrentPosition(B,A,{enableHighAccuracy:!0,timeout:1e4,maximumAge:6e4})}),{latitude:e,longitude:l}=i.coords,x=await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${e}&lon=${l}&addressdetails=1`);if(!x.ok)throw new Error("Failed to get address");const X=await x.json();X.display_name&&(t.delivery_address=X.display_name,_.fire({icon:"success",title:"Location Retrieved",text:"Current location address has been filled in.",toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3}))}catch(i){console.error("Error getting location address:",i),_.fire({icon:"error",title:"Location Error",text:"Failed to get your current location address. Please enter it manually."})}}return(i,e)=>(j(),T(z,{breadcrumbs:V},{default:s(()=>[o(r(F),{title:"Create Delivery"}),e[28]||(e[28]=n("div",{class:"flex items-center justify-between mb-6"},[n("h1",{class:"text-2xl font-bold"},"Create Delivery")],-1)),n("form",{onSubmit:e[11]||(e[11]=I(l=>y(),["prevent"])),class:"space-y-6"},[o(b,null,{default:s(()=>[o(C,null,{default:s(()=>[o(P,null,{default:s(()=>e[12]||(e[12]=[a("Delivery Details")])),_:1,__:[12]})]),_:1}),o(w,{class:"space-y-6"},{default:s(()=>[n("div",K,[n("div",null,[o(d,{for:"customer_id"},{default:s(()=>e[13]||(e[13]=[a("Customer")])),_:1,__:[13]}),o(r(H),{modelValue:r(t).customer_id,"onUpdate:modelValue":e[0]||(e[0]=l=>r(t).customer_id=l),options:$.value,placeholder:"Select customer","search-placeholder":"Search customers...",class:"mt-1",required:""},null,8,["modelValue","options"]),o(u,{message:r(t).errors.customer_id},null,8,["message"])]),n("div",null,[o(d,{for:"invoice_id"},{default:s(()=>e[14]||(e[14]=[a("Invoice")])),_:1,__:[14]}),o(r(g),{modelValue:r(t).invoice_id,"onUpdate:modelValue":e[1]||(e[1]=l=>r(t).invoice_id=l),options:D.value,placeholder:"Select invoice",class:"mt-1",required:""},null,8,["modelValue","options"]),o(u,{message:r(t).errors.invoice_id},null,8,["message"])])]),n("div",null,[o(d,{for:"delivery_address"},{default:s(()=>e[15]||(e[15]=[a("Delivery Address")])),_:1,__:[15]}),n("div",Q,[m(n("textarea",{"onUpdate:modelValue":e[2]||(e[2]=l=>r(t).delivery_address=l),id:"delivery_address",class:"flex-1 rounded-md border border-input bg-transparent px-3 py-2 text-foreground dark:bg-input/30 focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] focus-visible:outline-none",rows:"3",placeholder:"Enter complete delivery address",required:""},null,512),[[p,r(t).delivery_address]]),o(r(v),{type:"button",variant:"outline",onClick:N,class:"h-fit px-3 py-2"},{default:s(()=>e[16]||(e[16]=[a(" ðŸ“ Get Current Location ")])),_:1,__:[16]})]),o(u,{message:r(t).errors.delivery_address},null,8,["message"])]),n("div",W,[n("div",null,[o(d,{for:"contact_person"},{default:s(()=>e[17]||(e[17]=[a("Contact Person")])),_:1,__:[17]}),m(n("input",{"onUpdate:modelValue":e[3]||(e[3]=l=>r(t).contact_person=l),type:"text",id:"contact_person",class:"w-full rounded-md border border-input bg-transparent px-3 py-2 mt-1 text-foreground dark:bg-input/30 focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] focus-visible:outline-none",placeholder:"Enter contact person name",required:""},null,512),[[p,r(t).contact_person]]),o(u,{message:r(t).errors.contact_person},null,8,["message"])]),n("div",null,[o(d,{for:"contact_phone"},{default:s(()=>e[18]||(e[18]=[a("Contact Phone")])),_:1,__:[18]}),m(n("input",{"onUpdate:modelValue":e[4]||(e[4]=l=>r(t).contact_phone=l),type:"tel",id:"contact_phone",inputmode:"numeric",pattern:"^(?:\\+?63|0)9\\d{9}$",maxlength:"13",class:"w-full rounded-md border border-input bg-transparent px-3 py-2 mt-1 text-foreground dark:bg-input/30 focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] focus-visible:outline-none",placeholder:"09XXXXXXXXX or +639XXXXXXXXX",required:""},null,512),[[p,r(t).contact_phone]]),o(u,{message:r(t).errors.contact_phone},null,8,["message"])])]),n("div",Z,[n("div",null,[o(d,{for:"delivery_date"},{default:s(()=>e[19]||(e[19]=[a("Delivery Date")])),_:1,__:[19]}),m(n("input",{"onUpdate:modelValue":e[5]||(e[5]=l=>r(t).delivery_date=l),type:"date",id:"delivery_date",min:r(q),class:"w-full rounded-md border border-input bg-transparent px-3 py-2 mt-1 text-foreground dark:bg-input/30 focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] focus-visible:outline-none",required:""},null,8,h),[[p,r(t).delivery_date]]),o(u,{message:r(t).errors.delivery_date},null,8,["message"])]),n("div",null,[o(d,{for:"delivery_time"},{default:s(()=>e[20]||(e[20]=[a("Delivery Time")])),_:1,__:[20]}),o(r(g),{modelValue:r(t).delivery_time,"onUpdate:modelValue":e[6]||(e[6]=l=>r(t).delivery_time=l),options:k,placeholder:"Select delivery time",class:"mt-1",required:""},null,8,["modelValue"]),o(u,{message:r(t).errors.delivery_time},null,8,["message"])]),n("div",null,[o(d,{for:"status"},{default:s(()=>e[21]||(e[21]=[a("Status")])),_:1,__:[21]}),o(r(g),{modelValue:r(t).status,"onUpdate:modelValue":e[7]||(e[7]=l=>r(t).status=l),options:S,placeholder:"Select status",class:"mt-1",required:""},null,8,["modelValue"]),o(u,{message:r(t).errors.status},null,8,["message"])])]),n("div",ee,[n("div",null,[o(d,{for:"delivery_fee"},{default:s(()=>e[22]||(e[22]=[a("Delivery Fee")])),_:1,__:[22]}),m(n("input",{"onUpdate:modelValue":e[8]||(e[8]=l=>r(t).delivery_fee=l),type:"number",id:"delivery_fee",min:"0",step:"0.01",class:"w-full rounded-md border border-input bg-transparent px-3 py-2 mt-1 text-foreground dark:bg-input/30 focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] focus-visible:outline-none",placeholder:"0.00",required:""},null,512),[[p,r(t).delivery_fee]]),o(u,{message:r(t).errors.delivery_fee},null,8,["message"])]),n("div",null,[o(d,{for:"notes"},{default:s(()=>e[23]||(e[23]=[a("Notes")])),_:1,__:[23]}),m(n("textarea",{"onUpdate:modelValue":e[9]||(e[9]=l=>r(t).notes=l),id:"notes",class:"w-full rounded-md border border-input bg-transparent px-3 py-2 mt-1 text-foreground dark:bg-input/30 focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] focus-visible:outline-none",rows:"3",placeholder:"Enter any additional notes"},null,512),[[p,r(t).notes]]),o(u,{message:r(t).errors.notes},null,8,["message"])])])]),_:1})]),_:1}),o(b,null,{default:s(()=>[o(C,null,{default:s(()=>[o(P,null,{default:s(()=>e[24]||(e[24]=[a("Delivery Route")])),_:1,__:[24]})]),_:1}),o(w,null,{default:s(()=>{var l;return[o(Y,{"customer-location":U.value,"delivery-address":r(t).delivery_address||((l=E.value)==null?void 0:l.address),"map-height":"400px"},null,8,["customer-location","delivery-address"])]}),_:1})]),_:1}),o(b,null,{default:s(()=>[o(J,{class:"flex gap-2 justify-end"},{default:s(()=>[o(r(v),{type:"submit",variant:"default"},{default:s(()=>e[25]||(e[25]=[a("Create Delivery")])),_:1,__:[25]}),o(r(v),{type:"button",variant:"secondary",onClick:e[10]||(e[10]=l=>y(!0))},{default:s(()=>e[26]||(e[26]=[a("Create & create another")])),_:1,__:[26]}),o(r(G),{href:i.route("deliveries.index")},{default:s(()=>[o(r(v),{type:"button",variant:"ghost"},{default:s(()=>e[27]||(e[27]=[a("Cancel")])),_:1,__:[27]})]),_:1},8,["href"])]),_:1})]),_:1})],32)]),_:1,__:[28]}))}});export{Me as default};
