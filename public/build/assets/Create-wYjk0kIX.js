import{d as k,D as A,p as g,q as E,s as x,c as O,o as B,w as l,a as o,b as n,u as s,g as T,E as F,h as u,x as c,y as f,S as j}from"./app-CFepRPwu.js";import{_ as V}from"./index-DV2OFQX6.js";import{_ as b}from"./Select.vue_vue_type_script_setup_true_lang-CYtQqIPO.js";import{_ as R}from"./SearchSelect.vue_vue_type_script_setup_true_lang-BGkoXXLE.js";import{_ as W}from"./AppLayout.vue_vue_type_script_setup_true_lang-DNgqyd1_.js";import{_ as y,a as D}from"./CardContent.vue_vue_type_script_setup_true_lang-C9g0iyFA.js";import{_ as M,a as S}from"./CardTitle.vue_vue_type_script_setup_true_lang-DERnjdva.js";import{_ as z}from"./CardFooter.vue_vue_type_script_setup_true_lang-CErjnYTK.js";import{_ as m}from"./Label.vue_vue_type_script_setup_true_lang-BFiR0kh7.js";import{_ as J}from"./PhoneInput.vue_vue_type_script_setup_true_lang-DQuFK-eJ.js";import{S as L}from"./sweetalert2.esm.all-BQIkj5Wb.js";import{_ as p}from"./InputError.vue_vue_type_script_setup_true_lang-DdSnOkF9.js";import{D as G}from"./DeliveryRouteMap-DuWHNt5j.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-Bf_YxJw4.js";import"./useForwardPropsEmits-dJhCFBuM.js";import"./Teleport-Cw4jQHPm.js";import"./RovingFocusGroup-ULlmQ5Ks.js";import"./chevron-down-R92geRre.js";import"./Input.vue_vue_type_script_setup_true_lang-XrjY7wlE.js";import"./LocationInput.vue_vue_type_style_index_0_scoped_85568d9b_lang-BVtomLDo.js";import"./search-ctf0gLio.js";import"./x-Ca8660xC.js";import"./VisuallyHidden-CWyJyYAC.js";import"./DialogPortal-DiCFzSGZ.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-LUv5QWXH.js";import"./circle-check-BFRkzvLo.js";import"./chevron-right-y-5Kn7YG.js";import"./vue-leaflet.es-DjPla3e2.js";import"./marker-icon-2x-1TirABJh.js";import"./marker-icon-B6h-nX3D.js";import"./marker-shadow-B9CpECYs.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const H={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},K={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Q={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},Y=["min"],Z={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ne=k({__name:"Create",props:{customers:{},invoices:{},preselectedInvoiceId:{}},setup(P){const d=P,t=A({customer_id:null,invoice_id:null,delivery_address:"",contact_person:"",contact_phone:"",delivery_date:"",delivery_time:"",status:"pending",notes:"",delivery_fee:""}),$=[{title:"Deliveries",href:"/deliveries"},{title:"Create Delivery",href:"/deliveries/create"}];function w(){if(!t.invoice_id){t.setError("invoice_id","Invoice is required.");return}t.contact_phone&&(t.contact_phone=v(t.contact_phone));const i=/^\+63\d{10}$/;if(t.contact_phone&&!i.test(t.contact_phone)){t.setError("contact_phone","Enter a valid 10-digit Philippine mobile number.");return}t.post(route("deliveries.store"),{preserveScroll:!0,onSuccess:()=>{L.fire({toast:!0,position:"top-end",icon:"success",title:"Delivery created successfully",showConfirmButton:!1,timer:3e3,timerProgressBar:!0})}})}const C=g(()=>[{value:null,label:"Select customer"},...d.customers.map(i=>({value:i.id,label:`${i.name}${i.company_name?` (${i.company_name})`:""}`}))]),h=g(()=>{if(!t.customer_id){if(d.preselectedInvoiceId){const e=d.invoices.find(r=>r.id===d.preselectedInvoiceId);if(e)return[{value:null,label:"Select invoice"},{value:e.id,label:`${e.reference_number}`}]}return[{value:null,label:"Select invoice (select customer first)"}]}const i=d.invoices.filter(e=>e.customer_id===t.customer_id);return[{value:null,label:"Select invoice"},...i.map(e=>({value:e.id,label:`${e.reference_number}`}))]}),I=[{value:"pending",label:"Out for Delivery"},{value:"completed",label:"Delivered"},{value:"cancelled",label:"Cancelled"}],q=[{value:"09:00 AM - 12:00 PM",label:"09:00 AM - 12:00 PM"},{value:"12:00 PM - 03:00 PM",label:"12:00 PM - 03:00 PM"},{value:"03:00 PM - 06:00 PM",label:"03:00 PM - 06:00 PM"},{value:"06:00 PM - 09:00 PM",label:"06:00 PM - 09:00 PM"},{value:"Custom",label:"Custom"}],N=new Date().toISOString().split("T")[0];function v(i){if(!i)return"";let e=i.replace(/[^0-9]/g,"");return e.startsWith("63")?e=e.substring(2):e.startsWith("0")&&(e=e.substring(1)),e=e.substring(0,10),e.length===10?"+63"+e:i}function _(i){if(!i)return"";const e=[];return i.purok&&e.push(i.purok),i.barangay&&e.push(i.barangay),i.city_municipality&&e.push(i.city_municipality),i.province&&e.push(i.province),e.length>0?e.join(", "):""}const U=g(()=>{if(!t.customer_id)return null;const i=d.customers.find(r=>r.id===t.customer_id);if(!(i!=null&&i.location))return null;let e=i.location;if(typeof e=="string")try{e=JSON.parse(e)}catch{return console.warn("Failed to parse customer location string:",e),null}if(e){let r=e.lat,a=e.lng;if(typeof r=="string"&&(r=parseFloat(r)),typeof a=="string"&&(a=parseFloat(a)),typeof r=="number"&&typeof a=="number"&&!isNaN(r)&&!isNaN(a)&&r>=-90&&r<=90&&a>=-180&&a<=180&&(r!=0||a!=0))return{lat:r,lng:a}}return console.warn("Invalid customer location data:",i.location),null}),X=g(()=>t.customer_id&&d.customers.find(i=>i.id===t.customer_id)||null);return E(()=>{if(d.preselectedInvoiceId){const i=d.invoices.find(e=>e.id===d.preselectedInvoiceId);if(i){t.invoice_id=i.id,t.customer_id=i.customer_id;const e=d.customers.find(r=>r.id===i.customer_id);if(e){const r=_(e);r&&!t.delivery_address&&(t.delivery_address=r),e.name&&!t.contact_person&&(t.contact_person=e.name),e.phone&&!t.contact_phone&&(t.contact_phone=v(e.phone))}}}}),x(()=>t.customer_id,i=>{if(i){const e=d.customers.find(r=>r.id===i);if(e){const r=_(e);r&&!t.delivery_address&&(t.delivery_address=r),e.name&&!t.contact_person&&(t.contact_person=e.name),e.phone&&!t.contact_phone&&(t.contact_phone=v(e.phone))}}}),x(()=>t.invoice_id,i=>{if(i){const e=d.invoices.find(r=>r.id===i);if(e!=null&&e.customer){t.customer_id=e.customer_id;const r=d.customers.find(a=>a.id===e.customer_id);if(r){const a=_(r);a&&!t.delivery_address&&(t.delivery_address=a)}e.customer.name&&!t.contact_person&&(t.contact_person=e.customer.name),e.customer.phone&&!t.contact_phone&&(t.contact_phone=v(e.customer.phone))}}}),(i,e)=>(B(),O(W,{breadcrumbs:$},{default:l(()=>[o(s(T),{title:"Create Delivery"}),e[25]||(e[25]=n("div",{class:"flex items-center justify-between mb-6"},[n("h1",{class:"text-2xl font-bold"},"Create Delivery")],-1)),n("form",{onSubmit:e[10]||(e[10]=F(r=>w(),["prevent"])),class:"space-y-6"},[o(y,null,{default:l(()=>[o(M,null,{default:l(()=>[o(S,null,{default:l(()=>e[11]||(e[11]=[u("Delivery Details")])),_:1,__:[11]})]),_:1}),o(D,{class:"space-y-6"},{default:l(()=>[n("div",H,[n("div",null,[o(m,{for:"customer_id"},{default:l(()=>e[12]||(e[12]=[u("Customer")])),_:1,__:[12]}),o(s(R),{modelValue:s(t).customer_id,"onUpdate:modelValue":e[0]||(e[0]=r=>s(t).customer_id=r),options:C.value,placeholder:"Select customer","search-placeholder":"Search customers...",class:"mt-1",required:""},null,8,["modelValue","options"]),o(p,{message:s(t).errors.customer_id},null,8,["message"])]),n("div",null,[o(m,{for:"invoice_id"},{default:l(()=>e[13]||(e[13]=[u("Invoice")])),_:1,__:[13]}),o(s(b),{modelValue:s(t).invoice_id,"onUpdate:modelValue":e[1]||(e[1]=r=>s(t).invoice_id=r),options:h.value,placeholder:"Select invoice",class:"mt-1",required:""},null,8,["modelValue","options"]),o(p,{message:s(t).errors.invoice_id},null,8,["message"])])]),n("div",null,[o(m,{for:"delivery_address"},{default:l(()=>e[14]||(e[14]=[u("Delivery Address")])),_:1,__:[14]}),c(n("textarea",{"onUpdate:modelValue":e[2]||(e[2]=r=>s(t).delivery_address=r),id:"delivery_address",class:"w-full rounded-md border border-input bg-transparent px-3 py-2 mt-1 text-foreground dark:bg-input/30 focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] focus-visible:outline-none",rows:"3",placeholder:"Enter complete delivery address",required:""},null,512),[[f,s(t).delivery_address]]),o(p,{message:s(t).errors.delivery_address},null,8,["message"])]),n("div",K,[n("div",null,[o(m,{for:"contact_person"},{default:l(()=>e[15]||(e[15]=[u("Contact Person")])),_:1,__:[15]}),c(n("input",{"onUpdate:modelValue":e[3]||(e[3]=r=>s(t).contact_person=r),type:"text",id:"contact_person",class:"w-full rounded-md border border-input bg-transparent px-3 py-2 mt-1 text-foreground dark:bg-input/30 focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] focus-visible:outline-none",placeholder:"Enter contact person name",required:""},null,512),[[f,s(t).contact_person]]),o(p,{message:s(t).errors.contact_person},null,8,["message"])]),n("div",null,[o(m,{for:"contact_phone"},{default:l(()=>e[16]||(e[16]=[u("Contact Phone")])),_:1,__:[16]}),o(J,{modelValue:s(t).contact_phone,"onUpdate:modelValue":e[4]||(e[4]=r=>s(t).contact_phone=r),id:"contact_phone",placeholder:"XXXXXXXXXX",required:"",class:"mt-1"},null,8,["modelValue"]),o(p,{message:s(t).errors.contact_phone},null,8,["message"])])]),n("div",Q,[n("div",null,[o(m,{for:"delivery_date"},{default:l(()=>e[17]||(e[17]=[u("Delivery Date")])),_:1,__:[17]}),c(n("input",{"onUpdate:modelValue":e[5]||(e[5]=r=>s(t).delivery_date=r),type:"date",id:"delivery_date",min:s(N),class:"w-full rounded-md border border-input bg-transparent px-3 py-2 mt-1 text-foreground dark:bg-input/30 focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] focus-visible:outline-none",required:""},null,8,Y),[[f,s(t).delivery_date]]),o(p,{message:s(t).errors.delivery_date},null,8,["message"])]),n("div",null,[o(m,{for:"delivery_time"},{default:l(()=>e[18]||(e[18]=[u("Delivery Time")])),_:1,__:[18]}),o(s(b),{modelValue:s(t).delivery_time,"onUpdate:modelValue":e[6]||(e[6]=r=>s(t).delivery_time=r),options:q,placeholder:"Select delivery time",class:"mt-1",required:""},null,8,["modelValue"]),o(p,{message:s(t).errors.delivery_time},null,8,["message"])]),n("div",null,[o(m,{for:"status"},{default:l(()=>e[19]||(e[19]=[u("Status")])),_:1,__:[19]}),o(s(b),{modelValue:s(t).status,"onUpdate:modelValue":e[7]||(e[7]=r=>s(t).status=r),options:I,placeholder:"Select status",class:"mt-1",required:""},null,8,["modelValue"]),o(p,{message:s(t).errors.status},null,8,["message"])])]),n("div",Z,[n("div",null,[o(m,{for:"delivery_fee"},{default:l(()=>e[20]||(e[20]=[u("Delivery Fee")])),_:1,__:[20]}),c(n("input",{"onUpdate:modelValue":e[8]||(e[8]=r=>s(t).delivery_fee=r),type:"number",id:"delivery_fee",min:"0",step:"0.01",class:"w-full rounded-md border border-input bg-transparent px-3 py-2 mt-1 text-foreground dark:bg-input/30 focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] focus-visible:outline-none",placeholder:"0.00",required:""},null,512),[[f,s(t).delivery_fee]]),o(p,{message:s(t).errors.delivery_fee},null,8,["message"])]),n("div",null,[o(m,{for:"notes"},{default:l(()=>e[21]||(e[21]=[u("Notes")])),_:1,__:[21]}),c(n("textarea",{"onUpdate:modelValue":e[9]||(e[9]=r=>s(t).notes=r),id:"notes",class:"w-full rounded-md border border-input bg-transparent px-3 py-2 mt-1 text-foreground dark:bg-input/30 focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] focus-visible:outline-none",rows:"3",placeholder:"Enter any additional notes"},null,512),[[f,s(t).notes]]),o(p,{message:s(t).errors.notes},null,8,["message"])])])]),_:1})]),_:1}),o(y,null,{default:l(()=>[o(M,null,{default:l(()=>[o(S,null,{default:l(()=>e[22]||(e[22]=[u("Delivery Route")])),_:1,__:[22]})]),_:1}),o(D,null,{default:l(()=>[o(G,{"customer-location":U.value,"delivery-address":s(t).delivery_address||_(X.value),"map-height":"400px"},null,8,["customer-location","delivery-address"])]),_:1})]),_:1}),o(y,null,{default:l(()=>[o(z,{class:"flex gap-2 justify-end"},{default:l(()=>[o(s(V),{type:"submit",variant:"default"},{default:l(()=>e[23]||(e[23]=[u("Create Delivery")])),_:1,__:[23]}),o(s(j),{href:i.route("deliveries.index")},{default:l(()=>[o(s(V),{type:"button",variant:"ghost"},{default:l(()=>e[24]||(e[24]=[u("Cancel")])),_:1,__:[24]})]),_:1},8,["href"])]),_:1})]),_:1})],32)]),_:1,__:[25]}))}});export{Ne as default};
