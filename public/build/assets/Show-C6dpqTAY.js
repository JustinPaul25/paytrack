import{d as ue,E as pe,m as K,p as x,s as se,c as b,o as u,u as m,w as r,a as l,b as e,h as v,t as i,e as p,f as _,x as U,y as I,G as fe,v as ve,g as _e,F as T,S as te,n as q,r as Q,W as ye}from"./app-BJGGIgA8.js";import{_ as D}from"./index-riohrRak.js";import{e as ge,f as xe,g as be,_ as ke}from"./AppLayout.vue_vue_type_script_setup_true_lang-6OmCq4tp.js";import{_ as R,a as S}from"./CardContent.vue_vue_type_script_setup_true_lang-DPB8yWHX.js";import{_ as $,a as M}from"./CardTitle.vue_vue_type_script_setup_true_lang-DvxTgNYv.js";import{_ as he}from"./Select.vue_vue_type_script_setup_true_lang-CVoDpg_u.js";import{_ as we}from"./SearchSelect.vue_vue_type_script_setup_true_lang-DjNxBFPF.js";import{e as De,a as Ce,b as Pe,c as Re,d as Se,_ as $e}from"./DialogTitle.vue_vue_type_script_setup_true_lang-BKWl03TP.js";import{_ as P}from"./Label.vue_vue_type_script_setup_true_lang-bOJZE9lv.js";import{_ as Me}from"./PhoneInput.vue_vue_type_script_setup_true_lang--2OWr11_.js";import{S as L}from"./sweetalert2.esm.all-BQIkj5Wb.js";import{_ as A}from"./InputError.vue_vue_type_script_setup_true_lang-YNpV2x5o.js";import{D as Ae}from"./DeliveryRouteMap-_iYDp81U.js";import"./LocationInput.vue_vue_type_style_index_0_scoped_85568d9b_lang-CX_goT8l.js";import"./useForwardPropsEmits-CZzI8B5e.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-MrJHOVsW.js";import"./Teleport-MSIji786.js";import"./RovingFocusGroup-gSG5KO_4.js";import"./VisuallyHidden-BC0AEIfW.js";import"./DialogPortal-Dpb7jdpY.js";import"./x-BjkU5bBK.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-DSD56j4j.js";import"./chevron-down-B83M1Caq.js";import"./chevron-right-CjvrEjDl.js";import"./Input.vue_vue_type_script_setup_true_lang-o7QhFVaq.js";import"./search-BUl39vHB.js";import"./vue-leaflet.es-BKYkO_Ao.js";import"./marker-icon-2x-1TirABJh.js";import"./marker-icon-B6h-nX3D.js";import"./marker-shadow-B9CpECYs.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const Be={class:"space-y-4"},Fe={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ve=["min"],qe={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ee={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ne={class:"relative"},je={key:0,class:"text-xs text-muted-foreground mt-1"},Ue={key:0},re=50,ae=10,de=50,Ie=ue({__name:"DeliveryFormModal",props:{open:{type:Boolean},invoice:{},customers:{}},emits:["update:open"],setup(Y,{emit:n}){var W,H;const y=Y,B=n,G=()=>{if(y.invoice.customer){const c=y.customers.find(s=>s.id===y.invoice.customer_id);return h(c||y.invoice.customer)}return""},d=pe({customer_id:y.invoice.customer_id,invoice_id:y.invoice.id,delivery_address:G(),contact_person:((W=y.invoice.customer)==null?void 0:W.name)||"",contact_phone:N((H=y.invoice.customer)==null?void 0:H.phone)||"",delivery_date:"",delivery_time:"",status:"pending",notes:"",delivery_fee:""}),w=K(null),C=K(!1);function k(c){if(!c||c<=0)return de;const s=re+c*ae;return Math.max(s,de)}function E(c){if(w.value=c,!d.delivery_fee||d.delivery_fee==="0"||d.delivery_fee==="0.00"){C.value=!0;const s=k(c);d.delivery_fee=s.toFixed(2),C.value=!1}}const F=new Date().toISOString().split("T")[0];function N(c){if(!c)return"";let s=c.replace(/[^0-9]/g,"");return s.startsWith("63")?s=s.substring(2):s.startsWith("0")&&(s=s.substring(1)),s=s.substring(0,10),s.length===10?"+63"+s:c}function h(c){if(!c)return"";const s=[];return c.purok&&s.push(c.purok),c.barangay&&s.push(c.barangay),c.city_municipality&&s.push(c.city_municipality),c.province&&s.push(c.province),s.length>0?s.join(", "):""}const O=x(()=>[{value:null,label:"Select customer"},...y.customers.map(c=>({value:c.id,label:`${c.name}${c.company_name?` (${c.company_name})`:""}`}))]),X=[{value:"09:00 AM - 12:00 PM",label:"09:00 AM - 12:00 PM"},{value:"12:00 PM - 03:00 PM",label:"12:00 PM - 03:00 PM"},{value:"03:00 PM - 06:00 PM",label:"03:00 PM - 06:00 PM"},{value:"06:00 PM - 09:00 PM",label:"06:00 PM - 09:00 PM"},{value:"Custom",label:"Custom"}],j=x(()=>{if(!d.customer_id)return null;const c=y.customers.find(V=>V.id===d.customer_id);if(!(c!=null&&c.location))return null;let s=c.location;if(typeof s=="string")try{s=JSON.parse(s)}catch{return console.warn("Failed to parse customer location string:",s),null}let f=s.lat,g=s.lng;return typeof f=="string"&&(f=parseFloat(f)),typeof g=="string"&&(g=parseFloat(g)),typeof f=="number"&&typeof g=="number"&&!isNaN(f)&&!isNaN(g)&&f>=-90&&f<=90&&g>=-180&&g<=180&&(f!=0||g!=0)?{lat:f,lng:g}:null}),z=x(()=>d.customer_id&&y.customers.find(c=>c.id===d.customer_id)||null);se(()=>d.customer_id,c=>{if(c){const s=y.customers.find(f=>f.id===c);if(s){const f=h(s);f&&!d.delivery_address&&(d.delivery_address=f)}w.value=null,C.value===!1&&(d.delivery_fee="")}}),se(()=>y.open,c=>{var s,f;if(c){d.reset(),d.customer_id=y.invoice.customer_id,d.invoice_id=y.invoice.id;const g=y.customers.find(V=>V.id===y.invoice.customer_id);d.delivery_address=g?h(g):"",d.contact_person=((s=y.invoice.customer)==null?void 0:s.name)||"",d.contact_phone=N((f=y.invoice.customer)==null?void 0:f.phone)||"",d.clearErrors(),w.value=null}});function J(){d.contact_phone&&(d.contact_phone=N(d.contact_phone));const c=/^\+63\d{10}$/;if(d.contact_phone&&!c.test(d.contact_phone)){d.setError("contact_phone","Enter a valid 10-digit Philippine mobile number.");return}d.status="pending",d.post(route("deliveries.store"),{preserveScroll:!0,onSuccess:()=>{L.fire({toast:!0,position:"top-end",icon:"success",title:"Delivery created successfully",showConfirmButton:!1,timer:3e3,timerProgressBar:!0}),B("update:open",!1),d.reset()}})}function Z(){B("update:open",!1),d.clearErrors()}return(c,s)=>(u(),b(m(De),{open:c.open,"onUpdate:open":s[10]||(s[10]=f=>B("update:open",f))},{default:r(()=>[l(m($e),{class:"max-w-4xl max-h-[90vh] overflow-y-auto"},{default:r(()=>[l(m(Ce),null,{default:r(()=>[l(m(Pe),null,{default:r(()=>s[11]||(s[11]=[v("Create Delivery")])),_:1,__:[11]}),l(m(Re),null,{default:r(()=>[v(" Create a delivery for invoice "+i(c.invoice.reference_number),1)]),_:1})]),_:1}),e("form",{onSubmit:s[9]||(s[9]=fe(f=>J(),["prevent"])),class:"space-y-6"},[e("div",Be,[e("div",Fe,[e("div",null,[l(P,{for:"customer_id"},{default:r(()=>s[12]||(s[12]=[v("Customer")])),_:1,__:[12]}),l(m(we),{modelValue:m(d).customer_id,"onUpdate:modelValue":s[0]||(s[0]=f=>m(d).customer_id=f),options:O.value,placeholder:"Select customer","search-placeholder":"Search customers...",class:"mt-1",required:""},null,8,["modelValue","options"]),l(A,{message:m(d).errors.customer_id},null,8,["message"])]),e("div",null,[l(P,{for:"delivery_date"},{default:r(()=>s[13]||(s[13]=[v("Delivery Date")])),_:1,__:[13]}),U(e("input",{"onUpdate:modelValue":s[1]||(s[1]=f=>m(d).delivery_date=f),type:"date",id:"delivery_date",min:m(F),class:"w-full rounded-md border border-input bg-transparent px-3 py-2 mt-1 text-foreground dark:bg-input/30 focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] focus-visible:outline-none",required:""},null,8,Ve),[[I,m(d).delivery_date]]),l(A,{message:m(d).errors.delivery_date},null,8,["message"])])]),e("div",null,[l(P,{for:"delivery_address"},{default:r(()=>s[14]||(s[14]=[v("Delivery Address")])),_:1,__:[14]}),U(e("textarea",{"onUpdate:modelValue":s[2]||(s[2]=f=>m(d).delivery_address=f),id:"delivery_address",class:"w-full rounded-md border border-input bg-transparent px-3 py-2 mt-1 text-foreground dark:bg-input/30 focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] focus-visible:outline-none",rows:"3",placeholder:"Enter complete delivery address",required:""},null,512),[[I,m(d).delivery_address]]),l(A,{message:m(d).errors.delivery_address},null,8,["message"])]),e("div",qe,[e("div",null,[l(P,{for:"contact_person"},{default:r(()=>s[15]||(s[15]=[v("Contact Person")])),_:1,__:[15]}),U(e("input",{"onUpdate:modelValue":s[3]||(s[3]=f=>m(d).contact_person=f),type:"text",id:"contact_person",class:"w-full rounded-md border border-input bg-transparent px-3 py-2 mt-1 text-foreground dark:bg-input/30 focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] focus-visible:outline-none",placeholder:"Enter contact person name",required:""},null,512),[[I,m(d).contact_person]]),l(A,{message:m(d).errors.contact_person},null,8,["message"])]),e("div",null,[l(P,{for:"contact_phone"},{default:r(()=>s[16]||(s[16]=[v("Contact Phone")])),_:1,__:[16]}),l(Me,{modelValue:m(d).contact_phone,"onUpdate:modelValue":s[4]||(s[4]=f=>m(d).contact_phone=f),id:"contact_phone",placeholder:"XXXXXXXXXX",required:"",class:"mt-1"},null,8,["modelValue"]),l(A,{message:m(d).errors.contact_phone},null,8,["message"])])]),e("div",Ee,[e("div",null,[l(P,{for:"delivery_time"},{default:r(()=>s[17]||(s[17]=[v("Delivery Time")])),_:1,__:[17]}),l(m(he),{modelValue:m(d).delivery_time,"onUpdate:modelValue":s[5]||(s[5]=f=>m(d).delivery_time=f),options:X,placeholder:"Select delivery time",class:"mt-1",required:""},null,8,["modelValue"]),l(A,{message:m(d).errors.delivery_time},null,8,["message"])]),e("div",null,[l(P,{for:"delivery_fee"},{default:r(()=>s[18]||(s[18]=[v("Delivery Fee")])),_:1,__:[18]}),e("div",Ne,[U(e("input",{"onUpdate:modelValue":s[6]||(s[6]=f=>m(d).delivery_fee=f),type:"number",id:"delivery_fee",min:"0",step:"0.01",class:"w-full rounded-md border border-input bg-transparent px-3 py-2 mt-1 text-foreground dark:bg-input/30 focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] focus-visible:outline-none",placeholder:"0.00",required:""},null,512),[[I,m(d).delivery_fee]]),w.value!==null?(u(),p("button",{key:0,type:"button",onClick:s[7]||(s[7]=f=>m(d).delivery_fee=k(w.value).toFixed(2)),class:"absolute right-2 top-[calc(0.25rem+1px)] px-2 py-1 text-xs bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors",title:"Recalculate based on distance"}," Recalculate ")):_("",!0)]),w.value!==null?(u(),p("div",je," Distance: "+i(w.value)+" km • Fee: ₱"+i(re.toFixed(2))+" base + ₱"+i(ae.toFixed(2))+"/km ",1)):_("",!0),l(A,{message:m(d).errors.delivery_fee},null,8,["message"])])]),e("div",null,[l(P,{for:"notes"},{default:r(()=>s[19]||(s[19]=[v("Notes")])),_:1,__:[19]}),U(e("textarea",{"onUpdate:modelValue":s[8]||(s[8]=f=>m(d).notes=f),id:"notes",class:"w-full rounded-md border border-input bg-transparent px-3 py-2 mt-1 text-foreground dark:bg-input/30 focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] focus-visible:outline-none",rows:"3",placeholder:"Enter any additional notes"},null,512),[[I,m(d).notes]]),l(A,{message:m(d).errors.notes},null,8,["message"])])]),j.value||m(d).delivery_address||h(z.value)?(u(),p("div",Ue,[l(P,{class:"mb-2 block"},{default:r(()=>s[20]||(s[20]=[v("Delivery Route")])),_:1,__:[20]}),l(Ae,{"customer-location":j.value,"delivery-address":m(d).delivery_address||h(z.value),"map-height":"300px",onDistanceCalculated:E},null,8,["customer-location","delivery-address"])])):_("",!0),l(m(Se),{class:"gap-2"},{default:r(()=>[l(m(D),{type:"button",variant:"ghost",onClick:Z},{default:r(()=>s[21]||(s[21]=[v("Cancel")])),_:1,__:[21]}),l(m(D),{type:"submit",variant:"default",disabled:m(d).processing},{default:r(()=>s[22]||(s[22]=[v(" Create Delivery ")])),_:1,__:[22]},8,["disabled"])]),_:1})],32)]),_:1})]),_:1},8,["open"]))}}),Te={key:0,class:"mb-4 p-4 bg-blue-50 border-l-4 border-blue-500 rounded-md"},Le={class:"flex items-start"},Oe={class:"ml-3 flex-1"},Xe={class:"mt-2 text-sm text-blue-700"},ze={class:"font-semibold"},We={class:"flex items-center justify-between my-6"},He={class:"text-2xl font-bold"},Qe={class:"flex gap-2"},Ke={class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},Ye={class:"lg:col-span-2 space-y-6"},Ge={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Je={class:"text-lg font-semibold"},Ze={key:0},et={key:1},tt={key:0,class:"text-xs font-normal text-green-600 ml-2"},st={key:2},nt={key:3},ot={key:0,class:"mt-4"},it={class:"mt-1"},lt={class:"overflow-x-auto"},rt={class:"min-w-full divide-y divide-border"},at={class:"px-4 py-2"},dt={class:"font-medium"},ut={class:"text-sm text-gray-500"},mt={class:"px-4 py-2"},ct={class:"px-4 py-2"},pt={class:"px-4 py-2 font-medium"},ft={class:"border-t"},vt={class:"px-4 py-2 text-sm font-medium text-gray-700"},_t={key:0},yt={colspan:"3",class:"px-4 py-2 text-right text-sm text-gray-600"},gt={class:"px-4 py-2 text-sm text-gray-600"},xt={class:"px-4 py-2 text-sm font-medium text-gray-700"},bt={key:1},kt={colspan:"3",class:"px-4 py-2 text-right text-sm text-red-600"},ht={class:"px-4 py-2 text-sm text-red-600"},wt={key:2},Dt={class:"px-4 py-2 text-sm text-gray-600"},Ct={class:"border-t-2"},Pt={class:"px-4 py-2 font-bold text-lg"},Rt={key:3,class:"border-t bg-yellow-50"},St={class:"px-4 py-2 font-medium text-orange-700"},$t={key:4,class:"border-t-2 border-blue-500 bg-blue-50"},Mt={colspan:"3",class:"px-4 py-2 text-right font-bold text-lg text-blue-700"},At={class:"flex items-center justify-end gap-2"},Bt={key:0},Ft={key:1},Vt={class:"px-4 py-2 font-bold text-lg text-blue-700"},qt={class:"space-y-6"},Et={class:"flex justify-between items-center"},Nt={class:"font-medium"},jt={class:"flex justify-between items-center"},Ut={class:"font-medium text-orange-600"},It={class:"border-t pt-3 mt-3"},Tt={class:"flex justify-between items-center"},Lt={key:0,class:"mt-2 text-xs text-green-600 flex items-center gap-1"},Ot={class:"space-y-3"},Xt={class:"flex items-center justify-between mb-2"},zt={class:"font-medium"},Wt={class:"text-sm text-gray-600 space-y-1"},Ht={key:0},Qt={key:1},Kt={class:"text-xs mt-0.5"},Yt={key:2},Gt={key:3},Jt={key:4},Zt={key:5,class:"mt-2 pt-2 border-t"},es={class:"text-xs mt-0.5"},ts={key:6,class:"text-xs text-gray-500 mt-2"},ss={key:7,class:"mt-2 pt-2 border-t"},ns={class:"space-y-3"},os={class:"flex items-center justify-between"},is={class:"font-medium"},ls={class:"text-sm text-gray-600"},rs={key:0},as={class:"text-xs text-gray-500"},ds={key:1,class:"mt-1 text-xs text-red-500"},us={key:2,class:"text-xs"},ms=["href"],cs={class:"space-y-3"},ps={class:"flex items-center justify-between"},fs={class:"font-medium"},vs={class:"text-sm text-gray-600"},_s={key:0},ys={class:"text-xs text-gray-500"},gs={class:"space-y-3"},xs={class:"flex items-center gap-3"},bs={class:"font-medium"},ks={key:0},hs={key:1},ws={key:2},Ds={class:"text-sm"},Cs={class:"mt-3"},Ps={class:"text-sm"},on=ue({__name:"Show",props:{invoice:{},refunds:{},refundRequests:{},deliveries:{},customers:{},netBalance:{},totalRefunded:{}},setup(Y){var ie,le;const n=Y,y=ve(),B=Array.isArray((ie=y.props.auth)==null?void 0:ie.userRoles)&&y.props.auth.userRoles.includes("Customer"),G=Array.isArray((le=y.props.auth)==null?void 0:le.userRoles)&&y.props.auth.userRoles.includes("Staff"),d=x(()=>Array.isArray(n.refundRequests)&&n.refundRequests.some(a=>a.status==="pending")),w=x(()=>{var a;return G&&((a=n.invoice.customer)==null?void 0:a.email)&&n.invoice.payment_status!=="paid"}),C=K(!1),k=x(()=>n.netBalance!==void 0?n.netBalance:n.invoice.total_amount),E=x(()=>n.totalRefunded!==void 0?n.totalRefunded:0),F=x(()=>E.value>0),N=x(()=>F.value&&Math.abs(k.value-n.invoice.total_amount)>.01),h=x(()=>n.invoice.payment_method==="credit"),O=x(()=>!n.deliveries||n.deliveries.length===0?0:n.deliveries.reduce((a,t)=>a+(t.delivery_fee||0),0)),X=x(()=>n.invoice.vat_amount||0),j=x(()=>n.invoice.withholding_tax_amount||0),z=x(()=>n.invoice.subtotal_amount+X.value),J=[{title:"Invoices",href:"/invoices"},{title:n.invoice.reference_number,href:`/invoices/${n.invoice.id}`}];function Z(a){switch(a){case"draft":return"bg-gray-100 text-gray-800";case"pending":return"bg-yellow-100 text-yellow-800";case"completed":return"bg-green-100 text-green-800";case"cancelled":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}}function W(a){if(a==="pending"&&n.deliveries&&n.deliveries.length>0&&n.deliveries.some(o=>o.status==="pending"))return"Out for Delivery";switch(a){case"draft":return"Draft";case"pending":return"Pending";case"completed":return"Completed";case"cancelled":return"Cancelled";default:return a.charAt(0).toUpperCase()+a.slice(1)}}function H(a){switch(a){case"pending":return"bg-yellow-100 text-yellow-800";case"completed":return"bg-green-100 text-green-800";case"cancelled":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}}function c(a){switch(a){case"pending":return"Out for Delivery";case"completed":return"Delivered";case"cancelled":return"Cancelled";default:return a.charAt(0).toUpperCase()+a.slice(1)}}function s(a){return new Intl.NumberFormat("en-PH",{style:"currency",currency:"PHP",minimumFractionDigits:2}).format(a)}function f(a){return new Date(a).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})}function g(a){return new Date(a).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})}function V(a){const t=[];return a.address&&t.push(a.address),a.purok&&t.push(`Purok ${a.purok}`),a.barangay&&t.push(`Barangay ${a.barangay}`),a.city_municipality&&t.push(a.city_municipality),a.province&&t.push(a.province),t.length>0?t.join(", "):""}function ne(){window.print()}function oe(a){if(!a.media||a.media.length===0)return null;const t=a.media.find(o=>o.mime_type.startsWith("image/"));return t?t.thumb_url||t.original_url:null}function me(a){return a.name.split(" ").map(t=>t.charAt(0)).join("").toUpperCase().slice(0,2)}const ee=K(!1);function ce(){!w.value||C.value||(C.value=!0,ye.post(route("invoices.sendPaymentReminder",n.invoice.id),{},{preserveScroll:!0,onSuccess:()=>{const a=y.props.flash;a!=null&&a.success&&L.fire({toast:!0,position:"top-end",icon:"success",title:a.success,showConfirmButton:!1,timer:3e3,timerProgressBar:!0})},onError:a=>{const t=y.props.flash,o=(t==null?void 0:t.error)||"Failed to send payment reminder. Please try again.";L.fire({toast:!0,position:"top-end",icon:"error",title:o,showConfirmButton:!1,timer:3e3,timerProgressBar:!0})},onFinish:()=>{C.value=!1}}))}return se(()=>y.props.flash,a=>{a!=null&&a.success?L.fire({toast:!0,position:"top-end",icon:"success",title:a.success,showConfirmButton:!1,timer:3e3,timerProgressBar:!0}):a!=null&&a.error&&L.fire({toast:!0,position:"top-end",icon:"error",title:a.error,showConfirmButton:!1,timer:3e3,timerProgressBar:!0})}),(a,t)=>(u(),b(ke,{breadcrumbs:J},{default:r(()=>[l(m(_e),{title:n.invoice.reference_number},null,8,["title"]),N.value&&h.value?(u(),p("div",Te,[e("div",Le,[t[7]||(t[7]=e("div",{class:"flex-shrink-0"},[e("svg",{class:"h-5 w-5 text-blue-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1)),e("div",Oe,[t[6]||(t[6]=e("h3",{class:"text-sm font-medium text-blue-800"},"Credit Invoice with Refunds",-1)),e("div",Xe,[e("p",null,[t[2]||(t[2]=v(" Original invoice amount: ")),e("strong",null,i(s(n.invoice.total_amount)),1),t[3]||(t[3]=e("br",null,null,-1)),t[4]||(t[4]=v(" Total refunded: ")),e("strong",null,i(s(E.value)),1),t[5]||(t[5]=e("br",null,null,-1)),e("span",ze,"Amount Due: "+i(s(k.value)),1)])])])])])):_("",!0),e("div",We,[e("h1",He,i(n.invoice.reference_number),1),e("div",Qe,[l(m(D),{variant:"outline",onClick:ne},{default:r(()=>t[8]||(t[8]=[v("Download PDF")])),_:1,__:[8]}),l(m(D),{variant:"outline",onClick:ne},{default:r(()=>t[9]||(t[9]=[v("Print")])),_:1,__:[9]}),w.value?(u(),b(m(D),{key:0,variant:"default",onClick:ce,disabled:C.value},{default:r(()=>[v(i(C.value?"Sending...":"Send Payment Reminder"),1)]),_:1},8,["disabled"])):_("",!0),!m(B)&&n.invoice.status!=="completed"?(u(),b(m(D),{key:1,variant:"default",onClick:t[0]||(t[0]=o=>ee.value=!0)},{default:r(()=>t[10]||(t[10]=[v("Create Delivery")])),_:1,__:[10]})):_("",!0),m(B)&&n.invoice.status==="completed"?(u(),p(T,{key:2},[d.value?(u(),b(m(D),{key:1,variant:"outline",disabled:"",title:"You already have a pending refund request for this invoice."},{default:r(()=>t[12]||(t[12]=[v(" Request Pending ")])),_:1,__:[12]})):(u(),b(m(te),{key:0,href:a.route("refundRequests.create",n.invoice.id)},{default:r(()=>[l(m(D),{variant:"default"},{default:r(()=>t[11]||(t[11]=[v("Request Refund")])),_:1,__:[11]})]),_:1},8,["href"]))],64)):_("",!0),l(m(te),{href:a.route("invoices.index")},{default:r(()=>[l(m(D),{variant:"ghost"},{default:r(()=>t[13]||(t[13]=[v("Back")])),_:1,__:[13]})]),_:1},8,["href"])])]),e("div",Ke,[e("div",Ye,[l(R,null,{default:r(()=>[l($,null,{default:r(()=>[l(M,null,{default:r(()=>t[14]||(t[14]=[v("Invoice Information")])),_:1,__:[14]})]),_:1}),l(S,null,{default:r(()=>[e("div",Ge,[e("div",null,[t[15]||(t[15]=e("label",{class:"text-sm font-medium text-gray-500"},"Reference Number",-1)),e("p",Je,i(n.invoice.reference_number),1)]),e("div",null,[t[16]||(t[16]=e("label",{class:"text-sm font-medium text-gray-500"},"Date Created",-1)),e("p",null,i(f(n.invoice.created_at)),1)]),e("div",null,[t[17]||(t[17]=e("label",{class:"text-sm font-medium text-gray-500"},"Status",-1)),e("span",{class:q(["px-2 py-1 rounded-full text-xs font-medium",Z(n.invoice.status)])},i(W(n.invoice.status)),3)]),e("div",null,[t[18]||(t[18]=e("label",{class:"text-sm font-medium text-gray-500"},"Payment Method",-1)),e("p",null,i(n.invoice.payment_method.replace("_"," ")),1)]),n.invoice.payment_status?(u(),p("div",Ze,[t[19]||(t[19]=e("label",{class:"text-sm font-medium text-gray-500"},"Payment Status",-1)),e("span",{class:q(["px-2 py-1 rounded-full text-xs font-medium",n.invoice.payment_status==="paid"?"bg-green-100 text-green-800":n.invoice.payment_status==="pending"?"bg-yellow-100 text-yellow-800":n.invoice.payment_status==="Cancelled Order"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"])},i(n.invoice.payment_status),3)])):_("",!0),F.value&&h.value?(u(),p("div",et,[t[20]||(t[20]=e("label",{class:"text-sm font-medium text-gray-500"},"Amount Due",-1)),e("p",{class:q(["font-semibold text-lg",k.value<=0?"text-green-600":"text-orange-600"])},[v(i(s(k.value))+" ",1),k.value<=0?(u(),p("span",tt,"(Fully Settled)")):_("",!0)],2)])):_("",!0),n.invoice.due_date?(u(),p("div",st,[t[21]||(t[21]=e("label",{class:"text-sm font-medium text-gray-500"},"Due Date",-1)),e("p",null,i(g(n.invoice.due_date)),1)])):_("",!0),n.invoice.payment_reference?(u(),p("div",nt,[t[22]||(t[22]=e("label",{class:"text-sm font-medium text-gray-500"},"Payment Reference",-1)),e("p",null,i(n.invoice.payment_reference),1)])):_("",!0)]),n.invoice.notes?(u(),p("div",ot,[t[23]||(t[23]=e("label",{class:"text-sm font-medium text-gray-500"},"Notes",-1)),e("p",it,i(n.invoice.notes),1)])):_("",!0)]),_:1})]),_:1}),l(R,null,{default:r(()=>[l($,null,{default:r(()=>[l(M,null,{default:r(()=>t[24]||(t[24]=[v("Invoice Items")])),_:1,__:[24]})]),_:1}),l(S,null,{default:r(()=>[e("div",lt,[e("table",rt,[t[31]||(t[31]=e("thead",null,[e("tr",null,[e("th",{class:"px-4 py-2 text-left"},"Product"),e("th",{class:"px-4 py-2 text-left"},"Quantity"),e("th",{class:"px-4 py-2 text-left"},"Price"),e("th",{class:"px-4 py-2 text-left"},"Total")])],-1)),e("tbody",null,[(u(!0),p(T,null,Q(n.invoice.invoice_items,o=>(u(),p("tr",{key:o.id,class:"hover:bg-muted"},[e("td",at,[e("div",null,[e("div",dt,i(o.product.name),1),e("div",ut,"SKU: "+i(o.product.id),1)])]),e("td",mt,i(o.quantity),1),e("td",ct,i(s(o.price)),1),e("td",pt,i(s(o.total)),1)]))),128))]),e("tfoot",null,[e("tr",ft,[t[25]||(t[25]=e("td",{colspan:"3",class:"px-4 py-2 text-right text-sm font-medium text-gray-700"}," Subtotal: ",-1)),e("td",vt,i(s(n.invoice.subtotal_amount)),1)]),n.invoice.vat_rate>0?(u(),p("tr",_t,[e("td",yt," VAT ("+i(n.invoice.vat_rate)+"%): ",1),e("td",gt,i(s(X.value)),1)])):_("",!0),e("tr",null,[t[26]||(t[26]=e("td",{colspan:"3",class:"px-4 py-2 text-right text-sm font-medium text-gray-700"}," Amount Net of VAT: ",-1)),e("td",xt,i(s(z.value)),1)]),j.value>0?(u(),p("tr",bt,[e("td",kt," Less: W/Holding Tax ("+i(n.invoice.withholding_tax_rate)+"%): ",1),e("td",ht,"-"+i(s(j.value)),1)])):_("",!0),n.invoice.invoice_type==="delivery"&&O.value>0?(u(),p("tr",wt,[t[27]||(t[27]=e("td",{colspan:"3",class:"px-4 py-2 text-right text-sm text-gray-600"}," Delivery Fee: ",-1)),e("td",Dt,i(s(O.value)),1)])):_("",!0),e("tr",Ct,[t[28]||(t[28]=e("td",{colspan:"3",class:"px-4 py-2 text-right font-bold text-lg"},"Total Amount Due:",-1)),e("td",Pt,i(s(n.invoice.total_amount)),1)]),F.value?(u(),p("tr",Rt,[t[29]||(t[29]=e("td",{colspan:"3",class:"px-4 py-2 text-right font-medium text-orange-700"},[e("div",{class:"flex items-center justify-end gap-2"},[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})]),v(" Total Refunded: ")])],-1)),e("td",St,"-"+i(s(E.value)),1)])):_("",!0),F.value?(u(),p("tr",$t,[e("td",Mt,[e("div",At,[t[30]||(t[30]=e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),h.value?(u(),p("span",Bt,"Amount Due:")):(u(),p("span",Ft,"Net Balance:"))])]),e("td",Vt,i(s(k.value)),1)])):_("",!0)])])])]),_:1})]),_:1})]),e("div",qt,[F.value&&h.value?(u(),b(R,{key:0,class:"border-blue-200 bg-blue-50"},{default:r(()=>[l($,null,{default:r(()=>[l(M,{class:"text-blue-800"},{default:r(()=>t[32]||(t[32]=[v("Payment Summary")])),_:1,__:[32]})]),_:1}),l(S,{class:"space-y-3"},{default:r(()=>[e("div",Et,[t[33]||(t[33]=e("span",{class:"text-sm text-gray-600"},"Original Amount:",-1)),e("span",Nt,i(s(n.invoice.total_amount)),1)]),e("div",jt,[t[34]||(t[34]=e("span",{class:"text-sm text-gray-600"},"Total Refunded:",-1)),e("span",Ut,"-"+i(s(E.value)),1)]),e("div",It,[e("div",Tt,[t[35]||(t[35]=e("span",{class:"text-sm font-semibold text-blue-800"},"Amount Due:",-1)),e("span",{class:q(["text-lg font-bold",k.value<=0?"text-green-600":"text-blue-700"])},i(s(k.value)),3)]),k.value<=0?(u(),p("div",Lt,t[36]||(t[36]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1),v(" Fully settled ")]))):_("",!0)])]),_:1})]),_:1})):_("",!0),n.deliveries&&n.deliveries.length?(u(),b(R,{key:1},{default:r(()=>[l($,null,{default:r(()=>[l(M,null,{default:r(()=>t[37]||(t[37]=[v("Deliveries")])),_:1,__:[37]})]),_:1}),l(S,null,{default:r(()=>[e("div",Ot,[(u(!0),p(T,null,Q(n.deliveries,o=>(u(),p("div",{key:o.id,class:"border rounded-md p-3"},[e("div",Xt,[e("div",zt,"Delivery #"+i(o.id),1),e("span",{class:q(["px-2 py-1 rounded-full text-xs font-medium",H(o.status)])},i(c(o.status)),3)]),e("div",Wt,[o.delivery_date?(u(),p("div",Ht,[t[38]||(t[38]=e("span",{class:"font-medium"},"Date:",-1)),v(" "+i(o.delivery_date),1)])):_("",!0),o.delivery_time?(u(),p("div",Qt,[t[39]||(t[39]=e("span",{class:"font-medium"},"Time:",-1)),v(" "+i(o.delivery_time),1)])):_("",!0),e("div",null,[t[40]||(t[40]=e("span",{class:"font-medium"},"Address:",-1)),e("p",Kt,i(o.delivery_address),1)]),o.contact_person?(u(),p("div",Yt,[t[41]||(t[41]=e("span",{class:"font-medium"},"Contact:",-1)),v(" "+i(o.contact_person),1)])):_("",!0),o.contact_phone?(u(),p("div",Gt,[t[42]||(t[42]=e("span",{class:"font-medium"},"Phone:",-1)),v(" "+i(o.contact_phone),1)])):_("",!0),o.delivery_fee>0?(u(),p("div",Jt,[t[43]||(t[43]=e("span",{class:"font-medium"},"Fee:",-1)),v(" "+i(s(o.delivery_fee)),1)])):_("",!0),o.notes?(u(),p("div",Zt,[t[44]||(t[44]=e("span",{class:"font-medium"},"Notes:",-1)),e("p",es,i(o.notes),1)])):_("",!0),o.created_at?(u(),p("div",ts," Created: "+i(o.created_at),1)):_("",!0),m(B)?_("",!0):(u(),p("div",ss,[l(m(te),{href:a.route("deliveries.show",o.id)},{default:r(()=>[l(m(D),{variant:"outline",size:"sm",class:"w-full"},{default:r(()=>t[45]||(t[45]=[v(" View Delivery Details ")])),_:1,__:[45]})]),_:2},1032,["href"])]))])]))),128))])]),_:1})]),_:1})):_("",!0),n.refundRequests&&n.refundRequests.length?(u(),b(R,{key:2},{default:r(()=>[l($,null,{default:r(()=>[l(M,null,{default:r(()=>t[46]||(t[46]=[v("Refund Requests")])),_:1,__:[46]})]),_:1}),l(S,null,{default:r(()=>[e("div",ns,[(u(!0),p(T,null,Q(n.refundRequests,o=>(u(),p("div",{key:o.id,class:"border rounded-md p-3"},[e("div",os,[e("div",is,i(o.tracking_number),1),e("span",{class:q(["px-2 py-1 rounded-full text-xs font-medium",{"bg-yellow-100 text-yellow-800":o.status==="pending","bg-green-100 text-green-800":o.status==="approved"||o.status==="completed","bg-red-100 text-red-800":o.status==="rejected"}])},i(o.status),3)]),e("div",ls,[o.product_name?(u(),p("div",rs,"Product: "+i(o.product_name),1)):_("",!0),e("div",null,"Qty: "+i(o.quantity),1),e("div",as,"Date: "+i(o.created_at),1),o.status==="rejected"&&o.review_notes?(u(),p("div",ds," Reason: "+i(o.review_notes),1)):_("",!0),o.media_link?(u(),p("div",us,[e("a",{href:o.media_link,target:"_blank",class:"text-blue-500 underline"},"Media",8,ms)])):_("",!0)])]))),128))])]),_:1})]),_:1})):_("",!0),n.refunds&&n.refunds.length?(u(),b(R,{key:3},{default:r(()=>[l($,null,{default:r(()=>[l(M,null,{default:r(()=>t[47]||(t[47]=[v("Refunds")])),_:1,__:[47]})]),_:1}),l(S,null,{default:r(()=>[e("div",cs,[(u(!0),p(T,null,Q(n.refunds,o=>(u(),p("div",{key:o.id,class:"border rounded-md p-3"},[e("div",ps,[e("div",fs,i(o.refund_number),1),e("span",{class:q(["px-2 py-1 rounded-full text-xs font-medium",{"bg-green-100 text-green-800":o.status==="approved"||o.status==="completed","bg-yellow-100 text-yellow-800":o.status==="pending","bg-red-100 text-red-800":o.status==="cancelled"}])},i(o.status),3)]),e("div",vs,[o.product_name?(u(),p("div",_s,"Product: "+i(o.product_name),1)):_("",!0),e("div",null,"Qty: "+i(o.quantity_refunded),1),e("div",null,"Amount: "+i(s(o.refund_amount)),1),e("div",ys,"Date: "+i(o.created_at),1)])]))),128))])]),_:1})]),_:1})):_("",!0),l(R,null,{default:r(()=>[l($,null,{default:r(()=>[l(M,null,{default:r(()=>t[48]||(t[48]=[v("Customer Information")])),_:1,__:[48]})]),_:1}),l(S,null,{default:r(()=>[e("div",gs,[e("div",xs,[l(ge,{class:"size-12"},{default:r(()=>[oe(n.invoice.customer)?(u(),b(xe,{key:0,src:oe(n.invoice.customer),alt:n.invoice.customer.name},null,8,["src","alt"])):(u(),b(be,{key:1},{default:r(()=>[v(i(me(n.invoice.customer)),1)]),_:1}))]),_:1}),e("div",null,[t[49]||(t[49]=e("label",{class:"text-sm font-medium text-gray-500"},"Name",-1)),e("p",bs,i(n.invoice.customer.name),1)])]),n.invoice.customer.company_name?(u(),p("div",ks,[t[50]||(t[50]=e("label",{class:"text-sm font-medium text-gray-500"},"Company",-1)),e("p",null,i(n.invoice.customer.company_name),1)])):_("",!0),e("div",null,[t[51]||(t[51]=e("label",{class:"text-sm font-medium text-gray-500"},"Email",-1)),e("p",null,i(n.invoice.customer.email),1)]),n.invoice.customer.phone?(u(),p("div",hs,[t[52]||(t[52]=e("label",{class:"text-sm font-medium text-gray-500"},"Phone",-1)),e("p",null,i(n.invoice.customer.phone),1)])):_("",!0),V(n.invoice.customer)?(u(),p("div",ws,[t[53]||(t[53]=e("label",{class:"text-sm font-medium text-gray-500"},"Address",-1)),e("p",Ds,i(V(n.invoice.customer)),1)])):_("",!0)])]),_:1})]),_:1}),l(R,null,{default:r(()=>[l($,null,{default:r(()=>[l(M,null,{default:r(()=>t[54]||(t[54]=[v("Created By")])),_:1,__:[54]})]),_:1}),l(S,null,{default:r(()=>[e("div",null,[t[55]||(t[55]=e("label",{class:"text-sm font-medium text-gray-500"},"User",-1)),e("p",null,i(n.invoice.user.name),1)]),e("div",Cs,[t[56]||(t[56]=e("label",{class:"text-sm font-medium text-gray-500"},"Last Updated",-1)),e("p",Ps,i(f(n.invoice.updated_at)),1)])]),_:1})]),_:1})])]),n.customers?(u(),b(Ie,{key:1,open:ee.value,"onUpdate:open":t[1]||(t[1]=o=>ee.value=o),invoice:n.invoice,customers:n.customers},null,8,["open","invoice","customers"])):_("",!0)]),_:1}))}});export{on as default};
