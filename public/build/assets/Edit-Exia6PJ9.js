import{d as K,E as R,p as _,c as S,o as g,w as l,a as s,b as t,u as i,g as X,t as p,G as Y,h as d,x as $,y as w,e as V,F as Z,r as ee,f as q,S as te}from"./app-BJGGIgA8.js";import{_ as y}from"./index-riohrRak.js";import{_ as I}from"./Select.vue_vue_type_script_setup_true_lang-CVoDpg_u.js";import{_ as T}from"./SearchSelect.vue_vue_type_script_setup_true_lang-DjNxBFPF.js";import{_ as se}from"./AppLayout.vue_vue_type_script_setup_true_lang-6OmCq4tp.js";import{_ as k,a as U}from"./CardContent.vue_vue_type_script_setup_true_lang-DPB8yWHX.js";import{_ as j,a as F}from"./CardTitle.vue_vue_type_script_setup_true_lang-DvxTgNYv.js";import{_ as oe}from"./CardFooter.vue_vue_type_script_setup_true_lang-viGH8JM8.js";import{_ as c}from"./Label.vue_vue_type_script_setup_true_lang-bOJZE9lv.js";import{S as ie}from"./sweetalert2.esm.all-BQIkj5Wb.js";import{_ as f}from"./InputError.vue_vue_type_script_setup_true_lang-YNpV2x5o.js";import{T as ne}from"./trash-2-DcMzLwyY.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-MrJHOVsW.js";import"./useForwardPropsEmits-CZzI8B5e.js";import"./Teleport-MSIji786.js";import"./RovingFocusGroup-gSG5KO_4.js";import"./chevron-down-B83M1Caq.js";import"./Input.vue_vue_type_script_setup_true_lang-o7QhFVaq.js";import"./LocationInput.vue_vue_type_style_index_0_scoped_85568d9b_lang-CX_goT8l.js";import"./search-BUl39vHB.js";import"./x-BjkU5bBK.js";import"./VisuallyHidden-BC0AEIfW.js";import"./DialogPortal-Dpb7jdpY.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-DSD56j4j.js";import"./chevron-right-CjvrEjDl.js";const le={class:"flex items-center justify-between mb-6"},re={class:"text-2xl font-bold"},ae={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},de={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ue={class:"flex justify-between items-center"},me={class:"space-y-3"},pe={class:"flex justify-between items-center mb-3"},ce={class:"font-medium text-sm"},fe={class:"grid grid-cols-1 md:grid-cols-4 gap-3"},_e=["id","onUpdate:modelValue","onInput"],ve={key:0,class:"text-[11px] text-gray-500 mt-1"},ge=["id","onUpdate:modelValue","onInput"],be={class:"w-full rounded-md border border-input bg-transparent px-2 py-1 mt-1 text-sm text-foreground dark:bg-input/30 h-8 flex items-center"},ye={class:"mt-4 pt-3 border-t"},xe={class:"flex justify-end"},he={class:"text-right space-y-2"},$e={class:"flex justify-between gap-8"},we={class:"text-sm font-medium"},Ve={class:"flex justify-between gap-8"},Ie={class:"text-sm font-medium"},ke={class:"flex justify-between gap-8 border-t pt-2"},Ce={class:"text-sm font-medium"},Se={class:"flex justify-between gap-8"},qe={class:"text-sm font-medium text-red-600"},Te={class:"flex justify-between gap-8 border-t-2 pt-2"},Ue={class:"text-base font-bold"},ot=K({__name:"Edit",props:{invoice:{},customers:{},products:{}},setup(P){const u=P,n=R({customer_id:u.invoice.customer_id,status:u.invoice.status,payment_method:u.invoice.payment_method,invoice_type:u.invoice.invoice_type||"walk_in",notes:u.invoice.notes||"",invoice_items:u.invoice.invoice_items.map(o=>({id:o.id,product_id:o.product_id,quantity:o.quantity,price:o.price,total:o.total}))}),A=[{title:"Invoices",href:"/invoices"},{title:"Edit Invoice",href:`/invoices/${u.invoice.id}/edit`}],v=_(()=>n.invoice_items.reduce((o,e)=>o+e.total,0)),b=_(()=>v.value*.12),C=_(()=>(v.value+b.value)*.01),D=_(()=>v.value+b.value-C.value),E=_(()=>!n.customer_id||!n.invoice_items.length?!1:n.invoice_items.some(o=>!!o.product_id&&o.quantity>0&&o.price>=0));function B(){n.invoice_items.push({id:void 0,product_id:null,quantity:1,price:0,total:0})}function N(o){n.invoice_items.length>1&&n.invoice_items.splice(o,1)}function x(o){const e=n.invoice_items[o];e.product_id&&e.quantity&&e.price?e.total=e.quantity*e.price:e.total=0}function O(o){const e=n.invoice_items[o];if(e.product_id){const r=u.products.find(a=>a.id===e.product_id);r&&(e.price=r.selling_price,x(o))}}function M(o){x(o)}function W(o){x(o)}function L(){n.post(route("invoices.update",u.invoice.id),{preserveScroll:!0,onSuccess:()=>{ie.fire({toast:!0,position:"top-end",icon:"success",title:"Invoice updated successfully",showConfirmButton:!1,timer:3e3,timerProgressBar:!0})},method:"post"})}function h(o){return n.errors[o]}const Q=_(()=>[{value:null,label:"Select customer"},...u.customers.map(o=>({value:o.id,label:`${o.name}${o.company_name?` (${o.company_name})`:""}`}))]),z=[{value:"draft",label:"Draft"},{value:"pending",label:"Pending"},{value:"completed",label:"Completed"},{value:"cancelled",label:"Cancelled"}],G=[{value:"cash",label:"Cash"},{value:"credit",label:"Credit"}],H=[{value:"walk_in",label:"Walk-in"},{value:"delivery",label:"Delivery"}];function J(){return[{value:null,label:"Select product"},...u.products.map(o=>({value:o.id,label:`${o.name} - ₱${o.selling_price.toFixed(2)}`}))]}return(o,e)=>(g(),S(se,{breadcrumbs:A},{default:l(()=>[s(i(X),{title:"Edit Invoice"}),t("div",le,[t("h1",re,"Edit Invoice #"+p(u.invoice.id),1)]),t("form",{onSubmit:Y(L,["prevent"]),class:"space-y-6"},[s(k,null,{default:l(()=>[s(j,null,{default:l(()=>[s(F,null,{default:l(()=>e[5]||(e[5]=[d("Invoice Details")])),_:1,__:[5]})]),_:1}),s(U,{class:"space-y-6"},{default:l(()=>[t("div",ae,[t("div",null,[s(c,{for:"customer_id"},{default:l(()=>e[6]||(e[6]=[d("Customer *")])),_:1,__:[6]}),s(i(T),{modelValue:i(n).customer_id,"onUpdate:modelValue":e[0]||(e[0]=r=>i(n).customer_id=r),options:Q.value,placeholder:"Select customer","search-placeholder":"Search customers...",class:"mt-1",required:""},null,8,["modelValue","options"]),s(f,{message:i(n).errors.customer_id},null,8,["message"])]),t("div",null,[s(c,{for:"status"},{default:l(()=>e[7]||(e[7]=[d("Status *")])),_:1,__:[7]}),s(i(I),{modelValue:i(n).status,"onUpdate:modelValue":e[1]||(e[1]=r=>i(n).status=r),options:z,placeholder:"Select status",class:"mt-1",required:""},null,8,["modelValue"]),e[8]||(e[8]=t("div",{class:"text-[11px] text-gray-500 mt-1"}," Draft: still editing, Pending: awaiting payment, Completed: paid, Cancelled: void. ",-1)),s(f,{message:i(n).errors.status},null,8,["message"])])]),t("div",de,[t("div",null,[s(c,{for:"payment_method"},{default:l(()=>e[9]||(e[9]=[d("Payment Method *")])),_:1,__:[9]}),s(i(I),{modelValue:i(n).payment_method,"onUpdate:modelValue":e[2]||(e[2]=r=>i(n).payment_method=r),options:G,placeholder:"Select payment method",class:"mt-1",required:""},null,8,["modelValue"]),e[10]||(e[10]=t("div",{class:"text-[11px] text-gray-500 mt-1"}," Pick how the customer will pay (Cash or Credit). ",-1)),s(f,{message:i(n).errors.payment_method},null,8,["message"])]),t("div",null,[s(c,{for:"invoice_type"},{default:l(()=>e[11]||(e[11]=[d("Invoice Type *")])),_:1,__:[11]}),s(i(I),{modelValue:i(n).invoice_type,"onUpdate:modelValue":e[3]||(e[3]=r=>i(n).invoice_type=r),options:H,placeholder:"Select invoice type",class:"mt-1",required:""},null,8,["modelValue"]),e[12]||(e[12]=t("div",{class:"text-[11px] text-gray-500 mt-1"}," Walk-in: Customer purchases in-store. Delivery: Items will be delivered. ",-1)),s(f,{message:i(n).errors.invoice_type},null,8,["message"])])]),t("div",null,[s(c,{for:"notes"},{default:l(()=>e[13]||(e[13]=[d("Notes")])),_:1,__:[13]}),$(t("textarea",{id:"notes","onUpdate:modelValue":e[4]||(e[4]=r=>i(n).notes=r),class:"w-full rounded-md border border-input bg-transparent px-3 py-2 mt-1 text-foreground dark:bg-input/30 focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] focus-visible:outline-none",rows:"3"},null,512),[[w,i(n).notes]]),s(f,{message:i(n).errors.notes},null,8,["message"])])]),_:1})]),_:1}),s(k,null,{default:l(()=>[s(j,null,{default:l(()=>[t("div",ue,[s(F,null,{default:l(()=>e[14]||(e[14]=[d("Invoice Items")])),_:1,__:[14]}),s(i(y),{type:"button",variant:"outline",onClick:B},{default:l(()=>e[15]||(e[15]=[t("span",{class:"mr-2"},"+",-1),d(" Add Item ")])),_:1,__:[15]})])]),_:1}),s(U,null,{default:l(()=>[t("div",me,[(g(!0),V(Z,null,ee(i(n).invoice_items,(r,a)=>(g(),V("div",{key:a,class:"border rounded-md p-3"},[t("div",pe,[t("h4",ce,"Item "+p(a+1),1),i(n).invoice_items.length>1?(g(),S(i(y),{key:0,type:"button",variant:"ghost",size:"sm",class:"h-7 w-7 p-0 text-red-500 hover:text-red-600 hover:bg-red-50 dark:hover:bg-red-950/20",onClick:m=>N(a)},{default:l(()=>[s(i(ne),{class:"h-4 w-4"})]),_:2},1032,["onClick"])):q("",!0)]),t("div",fe,[t("div",null,[s(c,{for:`product_id_${a}`,class:"text-xs"},{default:l(()=>e[16]||(e[16]=[d("Product *")])),_:2,__:[16]},1032,["for"]),s(i(T),{modelValue:r.product_id,"onUpdate:modelValue":[m=>r.product_id=m,m=>O(a)],options:J(),placeholder:"Select product","search-placeholder":"Search products...",class:"mt-1 h-8",required:""},null,8,["modelValue","onUpdate:modelValue","options"]),s(f,{message:h(`invoice_items.${a}.product_id`)},null,8,["message"])]),t("div",null,[s(c,{for:`quantity_${a}`,class:"text-xs"},{default:l(()=>e[17]||(e[17]=[d("Quantity *")])),_:2,__:[17]},1032,["for"]),$(t("input",{id:`quantity_${a}`,"onUpdate:modelValue":m=>r.quantity=m,type:"number",min:"1",class:"w-full rounded-md border border-input bg-transparent px-2 py-1 mt-1 text-sm text-foreground dark:bg-input/30 focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] focus-visible:outline-none h-8",onInput:m=>M(a),required:""},null,40,_e),[[w,r.quantity,void 0,{number:!0}]]),r.product_id?(g(),V("div",ve," In stock: "+p((u.products.find(m=>m.id===r.product_id)||{stock:0}).stock),1)):q("",!0),s(f,{message:h(`invoice_items.${a}.quantity`)},null,8,["message"])]),t("div",null,[s(c,{for:`price_${a}`,class:"text-xs"},{default:l(()=>e[18]||(e[18]=[d("Price *")])),_:2,__:[18]},1032,["for"]),$(t("input",{id:`price_${a}`,"onUpdate:modelValue":m=>r.price=m,type:"number",min:"0",step:"0.01",class:"w-full rounded-md border border-input bg-transparent px-2 py-1 mt-1 text-sm text-foreground dark:bg-input/30 focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] focus-visible:outline-none h-8",onInput:m=>W(a),required:""},null,40,ge),[[w,r.price,void 0,{number:!0}]]),s(f,{message:h(`invoice_items.${a}.price`)},null,8,["message"])]),t("div",null,[s(c,{class:"text-xs"},{default:l(()=>e[19]||(e[19]=[d("Total")])),_:1,__:[19]}),t("div",be," ₱"+p(r.total.toFixed(2)),1)])])]))),128))]),t("div",ye,[t("div",xe,[t("div",he,[t("div",$e,[e[20]||(e[20]=t("span",{class:"text-sm text-gray-600"},"Subtotal:",-1)),t("span",we,"₱"+p(v.value.toFixed(2)),1)]),t("div",Ve,[e[21]||(e[21]=t("span",{class:"text-sm text-gray-600"},"VAT (12%):",-1)),t("span",Ie,"₱"+p(b.value.toFixed(2)),1)]),t("div",ke,[e[22]||(e[22]=t("span",{class:"text-sm text-gray-600"},"Amount Net of VAT:",-1)),t("span",Ce,"₱"+p((v.value+b.value).toFixed(2)),1)]),t("div",Se,[e[23]||(e[23]=t("span",{class:"text-sm text-red-600"},"Less: W/Holding Tax (1%):",-1)),t("span",qe,"-₱"+p(C.value.toFixed(2)),1)]),t("div",Te,[e[24]||(e[24]=t("span",{class:"text-base font-bold"},"Total Amount Due:",-1)),t("span",Ue,"₱"+p(D.value.toFixed(2)),1)])])])])]),_:1})]),_:1}),s(k,null,{default:l(()=>[s(oe,{class:"flex gap-2 justify-end"},{default:l(()=>[s(i(y),{type:"submit",disabled:!E.value,variant:"default"},{default:l(()=>e[25]||(e[25]=[d("Update Invoice")])),_:1,__:[25]},8,["disabled"]),s(i(te),{href:o.route("invoices.index")},{default:l(()=>[s(i(y),{type:"button",variant:"ghost"},{default:l(()=>e[26]||(e[26]=[d("Cancel")])),_:1,__:[26]})]),_:1},8,["href"])]),_:1})]),_:1})],32)]),_:1}))}});export{ot as default};
