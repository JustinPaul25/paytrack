import{d as F,m as g,p as N,c as M,o as h,w as n,a as i,b as e,u as p,g as j,S as T,e as a,t as c,f as P,F as W,r as E,E as H,x as I,y as $,W as L}from"./app-Du4GjnqY.js";import{_ as O}from"./AppLayout.vue_vue_type_script_setup_true_lang-C5-77bQX.js";import{_ as f,a as m}from"./CardContent.vue_vue_type_script_setup_true_lang-CsIZBT8t.js";import{_,a as v}from"./CardTitle.vue_vue_type_script_setup_true_lang-Yjmxyl1g.js";import{_ as B}from"./index-B1B-wuAy.js";import"./LocationInput.vue_vue_type_style_index_0_scoped_0fe2f881_lang-DHw6Z5C7.js";import"./RovingFocusGroup-Bek87zqo.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-BItx2YQm.js";import"./createLucideIcon-knc4Tqmj.js";import"./VisuallyHidden-8qINCcSU.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang--3inaUNk.js";import"./chevron-right-Ds8ma9mO.js";const Q={class:"flex items-center justify-between my-6"},U={class:"flex gap-2"},A={class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},z={class:"lg:col-span-2 space-y-6"},G={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},J={class:"font-semibold"},K={class:"min-w-full divide-y divide-border"},X={class:"px-4 py-2"},Y={class:"font-medium"},Z={class:"px-4 py-2"},tt={class:"px-4 py-2"},et={class:"px-4 py-2"},st=["max","value","onInput","onBlur"],nt={class:"border-t"},it={class:"px-4 py-2 font-semibold"},lt={class:"space-y-4"},ot={class:"pt-2"},rt={class:"space-y-6"},gt=F({__name:"Create",props:{invoice:{}},setup(R){const u=R,b=g(""),y=g(""),d=g({});function k(l){return new Intl.NumberFormat("en-PH",{style:"currency",currency:"PHP",minimumFractionDigits:2}).format(l)}function x(l,t){const s=Number.isFinite(l)?Math.floor(l):0;return s<0?0:s>t?t:s}function q(l,t,s){d.value[l]=x(t,s)}const S=N(()=>{const l=Object.entries(d.value);if(l.length===0)return!1;let t=!1;for(const[s,o]of l){const r=u.invoice.invoice_items.find(D=>D.id===Number(s));if(!r)continue;const w=x(o,r.quantity);if(w!==o)return!1;w>0&&(t=!0)}return t}),V=N(()=>u.invoice.invoice_items.reduce((l,t)=>{const s=x(d.value[t.id]??0,t.quantity);return l+s*t.price},0));function C(){const l=Object.entries(d.value).filter(([t,s])=>s>0).map(([t,s])=>{const o=u.invoice.invoice_items.find(r=>r.id===Number(t));return{invoice_item_id:Number(t),product_id:o.product_id,quantity:Math.min(Number(s),o.quantity)}});L.post(`/invoices/${u.invoice.id}/refund-request`,{description:b.value||void 0,media_link:y.value||void 0,items:l})}return(l,t)=>(h(),M(O,null,{default:n(()=>[i(p(j),{title:`Request Refund - ${u.invoice.reference_number}`},null,8,["title"]),e("div",Q,[t[4]||(t[4]=e("h1",{class:"text-2xl font-bold"},"Request Refund",-1)),e("div",U,[i(p(T),{href:l.route("invoices.show",u.invoice.id)},{default:n(()=>[i(p(B),{variant:"ghost"},{default:n(()=>t[3]||(t[3]=[a("Back to Invoice")])),_:1,__:[3]})]),_:1},8,["href"])])]),e("div",A,[e("div",z,[i(f,null,{default:n(()=>[i(_,null,{default:n(()=>[i(v,null,{default:n(()=>t[5]||(t[5]=[a("Invoice")])),_:1,__:[5]})]),_:1}),i(m,null,{default:n(()=>[e("div",G,[e("div",null,[t[6]||(t[6]=e("div",{class:"text-sm text-gray-500"},"Invoice number",-1)),e("div",J,c(u.invoice.reference_number),1)])])]),_:1})]),_:1}),i(f,null,{default:n(()=>[i(_,null,{default:n(()=>[i(v,null,{default:n(()=>t[7]||(t[7]=[a("Products to refund")])),_:1,__:[7]})]),_:1}),i(m,null,{default:n(()=>[e("table",K,[t[9]||(t[9]=e("thead",null,[e("tr",null,[e("th",{class:"px-4 py-2 text-left"},"Product"),e("th",{class:"px-4 py-2 text-left"},"Qty Purchased"),e("th",{class:"px-4 py-2 text-left"},"Price"),e("th",{class:"px-4 py-2 text-left"},"Refund Qty")])],-1)),e("tbody",null,[(h(!0),P(W,null,E(u.invoice.invoice_items,s=>(h(),P("tr",{key:s.id,class:"hover:bg-muted"},[e("td",X,[e("div",Y,c(s.product_name),1)]),e("td",Z,c(s.quantity),1),e("td",tt,c(k(s.price)),1),e("td",et,[e("input",{type:"number",min:"0",max:s.quantity,step:"1",inputmode:"numeric",pattern:"[0-9]*",class:"w-24 rounded-md border border-input bg-background px-3 py-2 text-sm",value:d.value[s.id]??0,onInput:o=>{var r;return q(s.id,Number(((r=o==null?void 0:o.target)==null?void 0:r.value)??0),s.quantity)},onBlur:o=>{var r;return q(s.id,Number(((r=o==null?void 0:o.target)==null?void 0:r.value)??0),s.quantity)},onWheel:t[0]||(t[0]=H(()=>{},["prevent"]))},null,40,st)])]))),128))]),e("tfoot",null,[e("tr",nt,[t[8]||(t[8]=e("td",{class:"px-4 py-2 text-right font-medium",colspan:"3"},"Total refund amount:",-1)),e("td",it,c(k(V.value)),1)])])])]),_:1})]),_:1}),i(f,null,{default:n(()=>[i(_,null,{default:n(()=>[i(v,null,{default:n(()=>t[10]||(t[10]=[a("Additional details")])),_:1,__:[10]})]),_:1}),i(m,null,{default:n(()=>[e("div",lt,[e("div",null,[t[11]||(t[11]=e("label",{class:"block text-sm text-gray-600 mb-1"},"Description",-1)),I(e("textarea",{"onUpdate:modelValue":t[1]||(t[1]=s=>b.value=s),rows:"4",class:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm",placeholder:"Describe the reason for the refund"},null,512),[[$,b.value]])]),e("div",null,[t[12]||(t[12]=e("label",{class:"block text-sm text-gray-600 mb-1"},"Video/Image link",-1)),I(e("input",{"onUpdate:modelValue":t[2]||(t[2]=s=>y.value=s),type:"url",class:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm",placeholder:"https://..."},null,512),[[$,y.value]])]),e("div",ot,[i(p(B),{disabled:!S.value,onClick:C},{default:n(()=>t[13]||(t[13]=[a("Submit Request")])),_:1,__:[13]},8,["disabled"])])])]),_:1})]),_:1})]),e("div",rt,[i(f,null,{default:n(()=>[i(_,null,{default:n(()=>[i(v,null,{default:n(()=>t[14]||(t[14]=[a("Instructions")])),_:1,__:[14]})]),_:1}),i(m,null,{default:n(()=>t[15]||(t[15]=[e("ul",{class:"list-disc pl-5 text-sm text-gray-600 space-y-2"},[e("li",null,"Select the items and quantities to refund."),e("li",null,"Provide a brief description of the issue."),e("li",null,"Paste a link to photos or a short video if available.")],-1)])),_:1,__:[15]})]),_:1})])])]),_:1}))}});export{gt as default};
