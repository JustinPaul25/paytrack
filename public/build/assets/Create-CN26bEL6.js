import{d as K,I as H,l as k,c as h,o as c,w as n,a as r,b as i,u,g as z,q as L,e as a,B as $,C as q,f as b,F as W,r as Y,h as w,t as _,S as G}from"./app-CHFGHI2U.js";import{_ as y}from"./index-BPZtiyvS.js";import{_ as V}from"./Select.vue_vue_type_script_setup_true_lang-BBFXdPEO.js";import{_ as J}from"./SearchSelect.vue_vue_type_script_setup_true_lang-wwfURqA1.js";import{_ as R}from"./AppLayout.vue_vue_type_script_setup_true_lang-CiRTWXZU.js";import{_ as g,a as C}from"./CardContent.vue_vue_type_script_setup_true_lang-DKQWnTwG.js";import{_ as O,a as S}from"./CardTitle.vue_vue_type_script_setup_true_lang-CYVz1YDC.js";import{_ as X}from"./CardFooter.vue_vue_type_script_setup_true_lang-Dx-y-q_x.js";import{_ as p}from"./Label.vue_vue_type_script_setup_true_lang-CA7ORn_P.js";import{S as v}from"./sweetalert2.esm.all-BQIkj5Wb.js";import{_ as f}from"./InputError.vue_vue_type_script_setup_true_lang-CSBVdlBt.js";import{T as Z}from"./trash-2-QwGc1T6b.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-C1jxNv1I.js";import"./createLucideIcon-CVX3-DV0.js";import"./RovingFocusGroup-RbAYv2er.js";import"./LocationInput.vue_vue_type_style_index_0_scoped_0fe2f881_lang-D4_hQTes.js";import"./Input.vue_vue_type_script_setup_true_lang-B8qvUURK.js";import"./search-DDm5OKbs.js";import"./VisuallyHidden-B2gL0Z8P.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-a1xrzGkp.js";import"./chevron-right-DhIVwPtD.js";const tt={class:"flex justify-between items-center"},et={class:"space-y-3"},rt={class:"flex justify-between items-center mb-3"},ot={class:"font-medium text-sm"},st={class:"grid grid-cols-1 md:grid-cols-3 gap-3"},it=["id","onUpdate:modelValue","max","onInput"],nt={key:0,class:"text-[11px] text-gray-500 mt-1"},dt={class:"w-full rounded-md border border-input bg-transparent px-2 py-1 mt-1 text-sm text-foreground dark:bg-input/30 h-8 flex items-center"},ut={class:"mt-4 pt-3 border-t"},at={class:"flex justify-end"},lt={class:"text-right"},mt={class:"text-base font-medium"},It=K({__name:"Create",props:{customer_id:{},products:{}},setup(B){const m=B,s=H({customer_id:m.customer_id,delivery_type:"delivery",payment_method:"cash",notes:"",order_items:[{product_id:null,quantity:1}]}),T=[{title:"Orders",href:"/orders"},{title:"Create Order",href:"/orders/create"}],j=k(()=>s.order_items.reduce((o,t)=>{if(t.product_id&&t.quantity){const e=m.products.find(d=>d.id===t.product_id);if(e)return o+t.quantity*e.selling_price}return o},0)),I=k(()=>!s.customer_id||!s.order_items.length?!1:s.order_items.some(o=>!!o.product_id&&o.quantity>0));function P(){s.order_items.push({product_id:null,quantity:1})}function A(o){s.order_items.length>1&&s.order_items.splice(o,1)}function Q(o){const t=s.order_items[o];if(t.product_id&&t.quantity){const e=m.products.find(d=>d.id===t.product_id);e&&t.quantity>e.stock&&(t.quantity=e.stock,v.fire({icon:"info",title:"Quantity Adjusted",text:`Quantity for "${e.name}" has been adjusted to the maximum available stock (${e.stock} units).`,confirmButtonText:"OK",toast:!0,position:"top-end",timer:3e3,timerProgressBar:!0}))}}function F(o){const t=s.order_items[o];if(t.product_id&&t.quantity){const e=m.products.find(d=>d.id===t.product_id);e&&t.quantity>e.stock&&(t.quantity=e.stock,v.fire({icon:"info",title:"Quantity Adjusted",text:`Quantity for "${e.name}" has been adjusted to the maximum available stock (${e.stock} units).`,confirmButtonText:"OK",toast:!0,position:"top-end",timer:3e3,timerProgressBar:!0}))}}function U(){for(let o=0;o<s.order_items.length;o++){const t=s.order_items[o];if(t.product_id&&t.quantity){const e=m.products.find(d=>d.id===t.product_id);e&&t.quantity>e.stock&&(t.quantity=e.stock,v.fire({icon:"warning",title:"Quantity Auto-Adjusted",text:`Quantity for "${e.name}" was automatically adjusted to ${e.stock} units due to stock limitations.`,confirmButtonText:"OK"}))}}s.post(route("orders.store"),{preserveScroll:!0,onSuccess:()=>{v.fire({toast:!0,position:"top-end",icon:"success",title:"Order created successfully",text:"Your order is pending approval from staff.",showConfirmButton:!1,timer:3e3,timerProgressBar:!0})}})}function x(o){return s.errors[o]}function D(o){return new Intl.NumberFormat("en-PH",{style:"currency",currency:"PHP",minimumFractionDigits:2}).format(o)}const N=[{value:"cash",label:"Cash"},{value:"bank_transfer",label:"Bank Transfer"},{value:"e-wallet",label:"E-Wallet"},{value:"other",label:"Other"}];function M(){return[{value:null,label:"Select product"},...m.products.map(o=>({value:o.id,label:o.name,description:`${D(o.selling_price)} • Stock: ${o.stock}`}))]}function E(o){const t=s.order_items[o];if(t.product_id&&t.quantity){const e=m.products.find(d=>d.id===t.product_id);if(e)return t.quantity*e.selling_price}return 0}return(o,t)=>(c(),h(R,{breadcrumbs:T},{default:n(()=>[r(u(z),{title:"Create Order"}),t[16]||(t[16]=i("div",{class:"flex items-center justify-between mb-6"},[i("h1",{class:"text-2xl font-bold"},"Create Order")],-1)),i("form",{onSubmit:t[3]||(t[3]=L(e=>U(),["prevent"])),class:"space-y-6"},[r(g,null,{default:n(()=>[r(O,null,{default:n(()=>[r(S,null,{default:n(()=>t[4]||(t[4]=[a("Order Details")])),_:1,__:[4]})]),_:1}),r(C,{class:"space-y-6"},{default:n(()=>[i("div",null,[r(p,{for:"delivery_type"},{default:n(()=>t[5]||(t[5]=[a("Delivery Type *")])),_:1,__:[5]}),r(u(V),{id:"delivery_type",modelValue:u(s).delivery_type,"onUpdate:modelValue":t[0]||(t[0]=e=>u(s).delivery_type=e),options:[{value:"pickup",label:"Pickup"},{value:"delivery",label:"Delivery"}],class:"mt-1",required:""},null,8,["modelValue"]),r(f,{message:u(s).errors.delivery_type},null,8,["message"])]),i("div",null,[r(p,{for:"payment_method"},{default:n(()=>t[6]||(t[6]=[a("Payment Method *")])),_:1,__:[6]}),r(u(V),{id:"payment_method",modelValue:u(s).payment_method,"onUpdate:modelValue":t[1]||(t[1]=e=>u(s).payment_method=e),options:N,class:"mt-1",required:""},null,8,["modelValue"]),r(f,{message:u(s).errors.payment_method},null,8,["message"])]),i("div",null,[r(p,{for:"notes"},{default:n(()=>t[7]||(t[7]=[a("Notes (Optional)")])),_:1,__:[7]}),$(i("textarea",{id:"notes","onUpdate:modelValue":t[2]||(t[2]=e=>u(s).notes=e),class:"w-full rounded-md border border-input bg-transparent px-3 py-2 mt-1 text-foreground dark:bg-input/30 focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] focus-visible:outline-none",rows:"3",placeholder:"Add any special instructions or notes for your order..."},null,512),[[q,u(s).notes]]),r(f,{message:u(s).errors.notes},null,8,["message"])])]),_:1})]),_:1}),r(g,null,{default:n(()=>[r(O,null,{default:n(()=>[i("div",tt,[r(S,null,{default:n(()=>t[8]||(t[8]=[a("Order Items")])),_:1,__:[8]}),r(u(y),{type:"button",variant:"outline",onClick:P},{default:n(()=>t[9]||(t[9]=[i("span",{class:"mr-2"},"+",-1),a(" Add Item ")])),_:1,__:[9]})])]),_:1}),r(C,null,{default:n(()=>[i("div",et,[(c(!0),b(W,null,Y(u(s).order_items,(e,d)=>(c(),b("div",{key:d,class:"border rounded-md p-3"},[i("div",rt,[i("h4",ot,"Item "+_(d+1),1),u(s).order_items.length>1?(c(),h(u(y),{key:0,type:"button",variant:"ghost",size:"sm",class:"h-7 w-7 p-0 text-red-500 hover:text-red-600 hover:bg-red-50 dark:hover:bg-red-950/20",onClick:l=>A(d)},{default:n(()=>[r(u(Z),{class:"h-4 w-4"})]),_:2},1032,["onClick"])):w("",!0)]),i("div",st,[i("div",null,[r(p,{for:`product_id_${d}`,class:"text-xs"},{default:n(()=>t[10]||(t[10]=[a("Product")])),_:2,__:[10]},1032,["for"]),r(u(J),{modelValue:e.product_id,"onUpdate:modelValue":[l=>e.product_id=l,l=>Q(d)],options:M(),placeholder:"Select product","search-placeholder":"Search products...",class:"mt-1 h-8",required:""},null,8,["modelValue","onUpdate:modelValue","options"]),r(f,{message:x(`order_items.${d}.product_id`)},null,8,["message"])]),i("div",null,[r(p,{for:`quantity_${d}`,class:"text-xs"},{default:n(()=>t[11]||(t[11]=[a("Quantity")])),_:2,__:[11]},1032,["for"]),$(i("input",{id:`quantity_${d}`,"onUpdate:modelValue":l=>e.quantity=l,type:"number",min:"1",max:e.product_id?(m.products.find(l=>l.id===e.product_id)||{stock:0}).stock:void 0,class:"w-full rounded-md border border-input bg-transparent px-2 py-1 mt-1 text-sm text-foreground dark:bg-input/30 focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] focus-visible:outline-none h-8",onInput:l=>F(d),required:""},null,40,it),[[q,e.quantity,void 0,{number:!0}]]),e.product_id?(c(),b("div",nt," In stock: "+_((m.products.find(l=>l.id===e.product_id)||{stock:0}).stock),1)):w("",!0),r(f,{message:x(`order_items.${d}.quantity`)},null,8,["message"])]),i("div",null,[r(p,{class:"text-xs"},{default:n(()=>t[12]||(t[12]=[a("Total")])),_:1,__:[12]}),i("div",dt," ₱"+_(E(d).toFixed(2)),1)])])]))),128))]),i("div",ut,[i("div",at,[i("div",lt,[i("div",mt,"Total Amount: ₱"+_(j.value.toFixed(2)),1),t[13]||(t[13]=i("div",{class:"text-xs text-muted-foreground mt-1"},"12% VAT is included in price",-1))])])])]),_:1})]),_:1}),r(g,null,{default:n(()=>[r(X,{class:"flex gap-2 justify-end"},{default:n(()=>[r(u(y),{type:"submit",disabled:!I.value,variant:"default"},{default:n(()=>t[14]||(t[14]=[a("Submit Order")])),_:1,__:[14]},8,["disabled"]),r(u(G),{href:o.route("orders.index")},{default:n(()=>[r(u(y),{type:"button",variant:"ghost"},{default:n(()=>t[15]||(t[15]=[a("Cancel")])),_:1,__:[15]})]),_:1},8,["href"])]),_:1})]),_:1})],32)]),_:1,__:[16]}))}});export{It as default};
