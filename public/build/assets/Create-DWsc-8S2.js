import{d as H,m as U,D as z,a5 as Q,p as C,c as W,o as y,w as i,a as o,b as e,u as p,g as Y,S as G,h as f,t as _,e as b,F as B,r as D,E as J,x as F,y as $,f as L}from"./app-CFepRPwu.js";import{_ as K}from"./AppLayout.vue_vue_type_script_setup_true_lang-DNgqyd1_.js";import{_ as h,a as q}from"./CardContent.vue_vue_type_script_setup_true_lang-C9g0iyFA.js";import{_ as w,a as k}from"./CardTitle.vue_vue_type_script_setup_true_lang-DERnjdva.js";import{_ as M}from"./index-DV2OFQX6.js";import"./LocationInput.vue_vue_type_style_index_0_scoped_85568d9b_lang-BVtomLDo.js";import"./useForwardPropsEmits-dJhCFBuM.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-Bf_YxJw4.js";import"./Teleport-Cw4jQHPm.js";import"./RovingFocusGroup-ULlmQ5Ks.js";import"./VisuallyHidden-CWyJyYAC.js";import"./DialogPortal-DiCFzSGZ.js";import"./x-Ca8660xC.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-LUv5QWXH.js";import"./chevron-down-R92geRre.js";import"./circle-check-BFRkzvLo.js";import"./chevron-right-y-5Kn7YG.js";const X={class:"flex items-center justify-between my-6"},Z={class:"flex gap-2"},ee={class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},te={class:"lg:col-span-2 space-y-6"},se={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},le={class:"font-semibold"},ie={class:"space-y-4"},oe={class:"min-w-full divide-y divide-border"},ne={class:"px-4 py-2"},ae={class:"font-medium"},re={class:"px-4 py-2"},ue={class:"px-4 py-2"},de={class:"px-4 py-2"},ce=["max","value","onInput","onBlur"],me={class:"border-t"},pe={class:"px-4 py-2 font-semibold"},fe={class:"space-y-4"},ge={key:0,class:"mt-3 grid grid-cols-2 md:grid-cols-3 gap-2"},ve=["src"],ye=["onClick"],_e={class:"text-xs text-gray-500 mt-1 truncate"},be={class:"pt-2"},xe={class:"space-y-6"},Se=H({__name:"Create",props:{invoice:{}},setup(S){const c=S,m=U([]),r=U([]),g=U({}),d=z({request_type:"refund",description:"",damaged_items_terms:"",items:[],proof_images:[]});function I(l){return new Intl.NumberFormat("en-PH",{style:"currency",currency:"PHP",minimumFractionDigits:2}).format(l)}function P(l,t){const s=Number.isFinite(l)?Math.floor(l):0;return s<0?0:s>t?t:s}function N(l,t,s){g.value[l]||(g.value[l]={qty:0}),g.value[l].qty=P(t,s)}function O(l){const t=l.target;if(t.files){const n=Array.from(t.files).filter(v=>v.size>5*1024*1024?(alert(`File "${v.name}" is too large. Maximum size is 5MB.`),!1):!0),a=n.map(v=>URL.createObjectURL(v)),u=[...m.value,...n].slice(0,5),R=[...r.value,...a].slice(0,5),j=m.value.length+n.length-5;if(j>0){const v=r.value.length;for(let x=v;x<v+j;x++)r.value[x]&&URL.revokeObjectURL(r.value[x])}m.value=u,r.value=R}t.value=""}function T(l){r.value[l]&&URL.revokeObjectURL(r.value[l]),m.value.splice(l,1),r.value.splice(l,1)}Q(()=>{r.value.forEach(l=>{l&&URL.revokeObjectURL(l)})});const V=C(()=>{const l=Object.entries(g.value);if(l.length===0)return!1;let t=!1;for(const[s,n]of l){const a=c.invoice.invoice_items.find(R=>R.id===Number(s));if(!a)continue;const u=P(n.qty,a.quantity);if(u!==n.qty)return!1;u>0&&(t=!0)}return t}),A=C(()=>c.invoice.invoice_items.reduce((l,t)=>{const s=g.value[t.id];return!s||!s.qty?l:l+s.qty*t.price},0));function E(){const l=Object.entries(g.value).filter(([t,s])=>s.qty>0).map(([t,s])=>{const n=c.invoice.invoice_items.find(a=>a.id===Number(t));return{invoice_item_id:Number(t),product_id:n.product_id,quantity:Math.min(s.qty,n.quantity)}});d.request_type="refund",d.items=l,m.value.length>0?d.proof_images=m.value:d.proof_images=[],d.post(`/invoices/${c.invoice.id}/refund-request`,{forceFormData:!0})}return(l,t)=>(y(),W(K,null,{default:i(()=>[o(p(Y),{title:`Refund Request - ${c.invoice.reference_number}`},null,8,["title"]),e("div",X,[t[4]||(t[4]=e("h1",{class:"text-2xl font-bold"},"Request Refund",-1)),e("div",Z,[o(p(G),{href:l.route("invoices.show",c.invoice.id)},{default:i(()=>[o(p(M),{variant:"ghost"},{default:i(()=>t[3]||(t[3]=[f("Back to Invoice")])),_:1,__:[3]})]),_:1},8,["href"])])]),e("div",ee,[e("div",te,[o(h,null,{default:i(()=>[o(w,null,{default:i(()=>[o(k,null,{default:i(()=>t[5]||(t[5]=[f("Invoice")])),_:1,__:[5]})]),_:1}),o(q,null,{default:i(()=>[e("div",se,[e("div",null,[t[6]||(t[6]=e("div",{class:"text-sm text-gray-500"},"Invoice number",-1)),e("div",le,_(c.invoice.reference_number),1)])])]),_:1})]),_:1}),o(h,null,{default:i(()=>[o(w,null,{default:i(()=>[o(k,null,{default:i(()=>t[7]||(t[7]=[f("Products to Refund")])),_:1,__:[7]})]),_:1}),o(q,null,{default:i(()=>[e("div",ie,[e("table",oe,[t[9]||(t[9]=e("thead",null,[e("tr",null,[e("th",{class:"px-4 py-2 text-left"},"Product"),e("th",{class:"px-4 py-2 text-left"},"Qty Purchased"),e("th",{class:"px-4 py-2 text-left"},"Price"),e("th",{class:"px-4 py-2 text-left"},"Refund Qty")])],-1)),e("tbody",null,[(y(!0),b(B,null,D(c.invoice.invoice_items,s=>{var n;return y(),b("tr",{key:s.id,class:"hover:bg-muted"},[e("td",ne,[e("div",ae,_(s.product_name),1)]),e("td",re,_(s.quantity),1),e("td",ue,_(I(s.price)),1),e("td",de,[e("input",{type:"number",min:"0",max:s.quantity,step:"1",inputmode:"numeric",pattern:"[0-9]*",class:"w-24 rounded-md border border-input bg-background px-3 py-2 text-sm",value:((n=g.value[s.id])==null?void 0:n.qty)??0,onInput:a=>{var u;return N(s.id,Number(((u=a==null?void 0:a.target)==null?void 0:u.value)??0),s.quantity)},onBlur:a=>{var u;return N(s.id,Number(((u=a==null?void 0:a.target)==null?void 0:u.value)??0),s.quantity)},onWheel:t[0]||(t[0]=J(()=>{},["prevent"]))},null,40,ce)])])}),128))]),e("tfoot",null,[e("tr",me,[t[8]||(t[8]=e("td",{class:"px-4 py-2 text-right font-medium",colspan:"3"},"Total refund amount:",-1)),e("td",pe,_(I(A.value)),1)])])])])]),_:1})]),_:1}),o(h,null,{default:i(()=>[o(w,null,{default:i(()=>[o(k,null,{default:i(()=>t[10]||(t[10]=[f("Additional Details")])),_:1,__:[10]})]),_:1}),o(q,null,{default:i(()=>[e("div",fe,[e("div",null,[t[11]||(t[11]=e("label",{class:"block text-sm text-gray-600 mb-1"},[f(" Description / Reason "),e("span",{class:"text-gray-400 text-xs"},"(Required)")],-1)),F(e("textarea",{"onUpdate:modelValue":t[1]||(t[1]=s=>p(d).description=s),rows:"4",class:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm",placeholder:"Describe the reason for the refund",required:""},null,512),[[$,p(d).description]]),t[12]||(t[12]=e("p",{class:"text-xs text-gray-500 mt-1"},"Please provide a clear explanation for your request.",-1))]),e("div",null,[t[13]||(t[13]=e("label",{class:"block text-sm text-gray-600 mb-1"},[f(" Proof Images "),e("span",{class:"text-gray-400 text-xs"},"(Recommended)")],-1)),e("input",{type:"file",accept:"image/jpeg,image/png,image/jpg,image/webp",multiple:"",onChange:O,class:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm"},null,32),t[14]||(t[14]=e("p",{class:"text-xs text-gray-500 mt-1"},"Upload photos of the item(s) as proof. Maximum 5 images, 5MB each.",-1)),m.value.length>0?(y(),b("div",ge,[(y(!0),b(B,null,D(m.value,(s,n)=>(y(),b("div",{key:n,class:"relative group"},[r.value[n]?(y(),b("img",{key:0,src:r.value[n],alt:"Proof image",class:"w-full h-32 object-cover rounded-md border"},null,8,ve)):L("",!0),e("button",{type:"button",onClick:a=>T(n),class:"absolute top-1 right-1 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs opacity-0 group-hover:opacity-100 transition-opacity"}," Ã— ",8,ye),e("div",_e,_(s.name),1)]))),128))])):L("",!0)]),e("div",null,[t[15]||(t[15]=e("label",{class:"block text-sm text-gray-600 mb-1"}," Terms for Damaged Items ",-1)),F(e("textarea",{"onUpdate:modelValue":t[2]||(t[2]=s=>p(d).damaged_items_terms=s),rows:"3",class:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm",placeholder:"Any special terms or conditions regarding damaged items (e.g., partial refund for minor damage, etc.)"},null,512),[[$,p(d).damaged_items_terms]]),t[16]||(t[16]=e("p",{class:"text-xs text-gray-500 mt-1"},"Specify any special terms or expectations regarding damaged items.",-1))]),e("div",be,[o(p(M),{disabled:!V.value,onClick:E},{default:i(()=>t[17]||(t[17]=[f(" Submit Refund Request ")])),_:1,__:[17]},8,["disabled"])])])]),_:1})]),_:1})]),e("div",xe,[o(h,null,{default:i(()=>[o(w,null,{default:i(()=>[o(k,null,{default:i(()=>t[18]||(t[18]=[f("Instructions & Clarifications")])),_:1,__:[18]})]),_:1}),o(q,null,{default:i(()=>t[19]||(t[19]=[e("div",{class:"space-y-4 text-sm"},[e("div",null,[e("h4",{class:"font-semibold mb-2"},"Proof Images:"),e("div",{class:"text-gray-600"},[e("p",null,"Upload clear photos showing:"),e("ul",{class:"list-disc pl-5 space-y-1 text-gray-600 mt-1"},[e("li",null,"The item(s) condition"),e("li",null,"Any damage or defects"),e("li",null,"Package/receipt if applicable")]),e("p",{class:"mt-2"},"This helps us process your request faster and ensures accurate assessment.")])]),e("div",null,[e("h4",{class:"font-semibold mb-2"},"What Happens Next:"),e("ol",{class:"list-decimal pl-5 space-y-1 text-gray-600"},[e("li",null,"Submit your request"),e("li",null,"Admin reviews your request (usually within 1-2 business days)"),e("li",null,"You'll receive an email notification about the decision"),e("li",null,"If approved, follow instructions to return items")])]),e("div",null,[e("h4",{class:"font-semibold mb-2"},"Damaged Items:"),e("div",{class:"text-gray-600"},[e("p",null,"If items are damaged, please specify your expectations:"),e("ul",{class:"list-disc pl-5 space-y-1 text-gray-600 mt-1"},[e("li",null,"Full refund expected"),e("li",null,"Partial refund acceptable")])])])],-1)])),_:1,__:[19]})]),_:1})])])]),_:1}))}});export{Se as default};
