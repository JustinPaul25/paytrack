import{d as J,m as b,p as F,c as K,o as p,w as a,a as n,b as e,u as R,g as X,t as d,S as Z,h as f,x as _,bM as A,e as g,f as I,F as E,r as N,E as ee,y as Q,W as te}from"./app-DFV75mBf.js";import{_ as se}from"./AppLayout.vue_vue_type_script_setup_true_lang-DSSSnv_7.js";import{_ as h,a as k}from"./CardContent.vue_vue_type_script_setup_true_lang-BdSOOKEE.js";import{_ as q,a as w}from"./CardTitle.vue_vue_type_script_setup_true_lang-_U7A67EF.js";import{_ as L}from"./index-Cq-jLiLx.js";import"./LocationInput.vue_vue_type_style_index_0_scoped_807a495d_lang-C5_-5mdN.js";import"./useForwardPropsEmits-cDFu6SMJ.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-BbW58MAF.js";import"./createLucideIcon-B3Xwb4hu.js";import"./Teleport-DEuPysO7.js";import"./RovingFocusGroup-Du4voUoU.js";import"./VisuallyHidden-D7jdQsi1.js";import"./x-DeaXVSEy.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-uZfJ_4qz.js";import"./chevron-right-CVvHX4TP.js";const le={class:"flex items-center justify-between my-6"},ae={class:"text-2xl font-bold"},ne={class:"flex gap-2"},oe={class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},ie={class:"lg:col-span-2 space-y-6"},re={class:"flex gap-4"},ue={class:"flex items-center gap-2 cursor-pointer"},de={class:"flex items-center gap-2 cursor-pointer"},ce={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},pe={class:"font-semibold"},me={class:"space-y-4"},fe={class:"min-w-full divide-y divide-border"},ge={class:"px-4 py-2 text-left"},ve={class:"px-4 py-2"},xe={class:"font-medium"},ye={class:"px-4 py-2"},be={class:"px-4 py-2"},_e={class:"px-4 py-2"},he=["max","value","onInput","onBlur"],ke={key:0},qe={class:"border-t"},we={class:"px-4 py-2 font-semibold"},Pe={key:0,class:"space-y-4 mt-6 border-t pt-4"},Re={key:0,class:"p-4 border rounded-md bg-gray-50"},Ie={class:"mb-2"},Ee={class:"font-medium"},Ne={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Se=["value","onChange"],Ce=["value"],$e=["max","value","onInput","disabled"],De={class:"space-y-4"},Qe=["placeholder"],Te={key:0,class:"mt-3 grid grid-cols-2 md:grid-cols-3 gap-2"},Ue=["src"],Ve=["onClick"],je={class:"text-xs text-gray-500 mt-1 truncate"},Be={class:"pt-2"},Me={class:"space-y-6"},st=J({__name:"Create",props:{invoice:{},availableProducts:{}},setup(O){const v=O,u=b("refund"),S=b(""),C=b(""),y=b([]),$=b(""),o=b({});function D(l){return new Intl.NumberFormat("en-PH",{style:"currency",currency:"PHP",minimumFractionDigits:2}).format(l)}function T(l,t){const s=Number.isFinite(l)?Math.floor(l):0;return s<0?0:s>t?t:s}function U(l,t,s){o.value[l]||(o.value[l]={qty:0}),o.value[l].qty=T(t,s)}function V(l,t,s){o.value[l]||(o.value[l]={qty:0}),o.value[l].exchangeProductId=t,o.value[l].exchangeQuantity=s>0?s:void 0}function W(l){const t=l.target;if(t.files){const s=Array.from(t.files);y.value=[...y.value,...s].slice(0,5)}}function H(l){y.value.splice(l,1)}const Y=F(()=>{const l=Object.entries(o.value);if(l.length===0)return!1;let t=!1;for(const[s,r]of l){const i=v.invoice.invoice_items.find(P=>P.id===Number(s));if(!i)continue;const c=T(r.qty,i.quantity);if(c!==r.qty||(c>0&&(t=!0),u.value==="exchange"&&c>0&&(!r.exchangeProductId||!r.exchangeQuantity||r.exchangeQuantity<=0)))return!1}return t}),z=F(()=>v.invoice.invoice_items.reduce((l,t)=>{const s=o.value[t.id];return!s||!s.qty?l:l+s.qty*t.price},0));function G(){const l=Object.entries(o.value).filter(([t,s])=>s.qty>0).map(([t,s])=>{const r=v.invoice.invoice_items.find(c=>c.id===Number(t)),i={invoice_item_id:Number(t),product_id:r.product_id,quantity:Math.min(s.qty,r.quantity)};return u.value==="exchange"&&s.exchangeProductId&&(i.exchange_product_id=s.exchangeProductId,i.exchange_quantity=s.exchangeQuantity||1),i});te.post(`/invoices/${v.invoice.id}/refund-request`,{request_type:u.value,description:S.value||void 0,media_link:C.value||void 0,damaged_items_terms:$.value||void 0,items:l,proof_images:y.value},{forceFormData:!0})}return(l,t)=>(p(),K(se,null,{default:a(()=>[n(R(X),{title:`${u.value==="exchange"?"Exchange":"Refund"} Request - ${v.invoice.reference_number}`},null,8,["title"]),e("div",le,[e("h1",ae,d(u.value==="exchange"?"Request Exchange":"Request Refund"),1),e("div",ne,[n(R(Z),{href:l.route("invoices.show",v.invoice.id)},{default:a(()=>[n(R(L),{variant:"ghost"},{default:a(()=>t[6]||(t[6]=[f("Back to Invoice")])),_:1,__:[6]})]),_:1},8,["href"])])]),e("div",oe,[e("div",ie,[n(h,null,{default:a(()=>[n(q,null,{default:a(()=>[n(w,null,{default:a(()=>t[7]||(t[7]=[f("Request Type")])),_:1,__:[7]})]),_:1}),n(k,null,{default:a(()=>[e("div",re,[e("label",ue,[_(e("input",{type:"radio","onUpdate:modelValue":t[0]||(t[0]=s=>u.value=s),value:"refund",class:"w-4 h-4"},null,512),[[A,u.value]]),t[8]||(t[8]=e("div",null,[e("div",{class:"font-medium"},"Refund"),e("div",{class:"text-sm text-gray-500"},"Return item(s) for money back")],-1))]),e("label",de,[_(e("input",{type:"radio","onUpdate:modelValue":t[1]||(t[1]=s=>u.value=s),value:"exchange",class:"w-4 h-4"},null,512),[[A,u.value]]),t[9]||(t[9]=e("div",null,[e("div",{class:"font-medium"},"Exchange"),e("div",{class:"text-sm text-gray-500"},"Swap item(s) for different product(s)")],-1))])])]),_:1})]),_:1}),n(h,null,{default:a(()=>[n(q,null,{default:a(()=>[n(w,null,{default:a(()=>t[10]||(t[10]=[f("Invoice")])),_:1,__:[10]})]),_:1}),n(k,null,{default:a(()=>[e("div",ce,[e("div",null,[t[11]||(t[11]=e("div",{class:"text-sm text-gray-500"},"Invoice number",-1)),e("div",pe,d(v.invoice.reference_number),1)])])]),_:1})]),_:1}),n(h,null,{default:a(()=>[n(q,null,{default:a(()=>[n(w,null,{default:a(()=>[f(d(u.value==="exchange"?"Products to Exchange":"Products to Refund"),1)]),_:1})]),_:1}),n(k,null,{default:a(()=>[e("div",me,[e("table",fe,[e("thead",null,[e("tr",null,[t[12]||(t[12]=e("th",{class:"px-4 py-2 text-left"},"Product",-1)),t[13]||(t[13]=e("th",{class:"px-4 py-2 text-left"},"Qty Purchased",-1)),t[14]||(t[14]=e("th",{class:"px-4 py-2 text-left"},"Price",-1)),e("th",ge,d(u.value==="exchange"?"Exchange Qty":"Refund Qty"),1)])]),e("tbody",null,[(p(!0),g(E,null,N(v.invoice.invoice_items,s=>{var r;return p(),g("tr",{key:s.id,class:"hover:bg-muted"},[e("td",ve,[e("div",xe,d(s.product_name),1)]),e("td",ye,d(s.quantity),1),e("td",be,d(D(s.price)),1),e("td",_e,[e("input",{type:"number",min:"0",max:s.quantity,step:"1",inputmode:"numeric",pattern:"[0-9]*",class:"w-24 rounded-md border border-input bg-background px-3 py-2 text-sm",value:((r=o.value[s.id])==null?void 0:r.qty)??0,onInput:i=>{var c;return U(s.id,Number(((c=i==null?void 0:i.target)==null?void 0:c.value)??0),s.quantity)},onBlur:i=>{var c;return U(s.id,Number(((c=i==null?void 0:i.target)==null?void 0:c.value)??0),s.quantity)},onWheel:t[2]||(t[2]=ee(()=>{},["prevent"]))},null,40,he)])])}),128))]),u.value==="refund"?(p(),g("tfoot",ke,[e("tr",qe,[t[15]||(t[15]=e("td",{class:"px-4 py-2 text-right font-medium",colspan:"3"},"Total refund amount:",-1)),e("td",we,d(D(z.value)),1)])])):I("",!0)]),u.value==="exchange"?(p(),g("div",Pe,[t[19]||(t[19]=e("h3",{class:"font-semibold"},"Exchange Products",-1)),(p(!0),g(E,null,N(v.invoice.invoice_items,s=>{var r,i,c,P,j,B,M;return p(),g("div",{key:`exchange-${s.id}`,class:"space-y-2"},[(((r=o.value[s.id])==null?void 0:r.qty)??0)>0?(p(),g("div",Re,[e("div",Ie,[e("span",Ee,"Exchanging "+d((i=o.value[s.id])==null?void 0:i.qty)+"x "+d(s.product_name),1)]),e("div",Ne,[e("div",null,[t[17]||(t[17]=e("label",{class:"block text-sm text-gray-600 mb-1"},"Exchange Product",-1)),e("select",{class:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm",value:(c=o.value[s.id])==null?void 0:c.exchangeProductId,onChange:m=>{var x;return V(s.id,m.target.value?Number(m.target.value):void 0,((x=o.value[s.id])==null?void 0:x.exchangeQuantity)||1)}},[t[16]||(t[16]=e("option",{value:""},"Select product...",-1)),(p(!0),g(E,null,N(l.availableProducts,m=>(p(),g("option",{key:m.id,value:m.id},d(m.name)+" - "+d(D(m.price))+" (Stock: "+d(m.stock)+") ",9,Ce))),128))],40,Se)]),e("div",null,[t[18]||(t[18]=e("label",{class:"block text-sm text-gray-600 mb-1"},"Exchange Quantity",-1)),e("input",{type:"number",min:"1",max:((j=(P=l.availableProducts)==null?void 0:P.find(m=>{var x;return m.id===((x=o.value[s.id])==null?void 0:x.exchangeProductId)}))==null?void 0:j.stock)||0,step:"1",class:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm",value:((B=o.value[s.id])==null?void 0:B.exchangeQuantity)||1,onInput:m=>{var x;return V(s.id,(x=o.value[s.id])==null?void 0:x.exchangeProductId,Number(m.target.value))},disabled:!((M=o.value[s.id])!=null&&M.exchangeProductId)},null,40,$e)])])])):I("",!0)])}),128))])):I("",!0)])]),_:1})]),_:1}),n(h,null,{default:a(()=>[n(q,null,{default:a(()=>[n(w,null,{default:a(()=>t[20]||(t[20]=[f("Additional Details")])),_:1,__:[20]})]),_:1}),n(k,null,{default:a(()=>[e("div",De,[e("div",null,[t[21]||(t[21]=e("label",{class:"block text-sm text-gray-600 mb-1"},[f(" Description / Reason "),e("span",{class:"text-gray-400 text-xs"},"(Required)")],-1)),_(e("textarea",{"onUpdate:modelValue":t[3]||(t[3]=s=>S.value=s),rows:"4",class:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm",placeholder:u.value==="exchange"?"Describe why you want to exchange this item":"Describe the reason for the refund",required:""},null,8,Qe),[[Q,S.value]]),t[22]||(t[22]=e("p",{class:"text-xs text-gray-500 mt-1"},"Please provide a clear explanation for your request.",-1))]),e("div",null,[t[23]||(t[23]=e("label",{class:"block text-sm text-gray-600 mb-1"},[f(" Proof Images "),e("span",{class:"text-gray-400 text-xs"},"(Recommended)")],-1)),e("input",{type:"file",accept:"image/jpeg,image/png,image/jpg,image/webp",multiple:"",onChange:W,class:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm"},null,32),t[24]||(t[24]=e("p",{class:"text-xs text-gray-500 mt-1"},"Upload photos of the item(s) as proof. Maximum 5 images, 5MB each.",-1)),y.value.length>0?(p(),g("div",Te,[(p(!0),g(E,null,N(y.value,(s,r)=>(p(),g("div",{key:r,class:"relative group"},[e("img",{src:l.URL.createObjectURL(s),alt:"Proof image",class:"w-full h-32 object-cover rounded-md border"},null,8,Ue),e("button",{type:"button",onClick:i=>H(r),class:"absolute top-1 right-1 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs opacity-0 group-hover:opacity-100 transition-opacity"}," Ã— ",8,Ve),e("div",je,d(s.name),1)]))),128))])):I("",!0)]),e("div",null,[t[25]||(t[25]=e("label",{class:"block text-sm text-gray-600 mb-1"},"Video/Image Link (Optional)",-1)),_(e("input",{"onUpdate:modelValue":t[4]||(t[4]=s=>C.value=s),type:"url",class:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm",placeholder:"https://..."},null,512),[[Q,C.value]]),t[26]||(t[26]=e("p",{class:"text-xs text-gray-500 mt-1"},"Alternative: Paste a link to external photos or video if you prefer.",-1))]),e("div",null,[t[27]||(t[27]=e("label",{class:"block text-sm text-gray-600 mb-1"}," Terms for Damaged Items ",-1)),_(e("textarea",{"onUpdate:modelValue":t[5]||(t[5]=s=>$.value=s),rows:"3",class:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm",placeholder:"Any special terms or conditions regarding damaged items (e.g., partial refund for minor damage, etc.)"},null,512),[[Q,$.value]]),t[28]||(t[28]=e("p",{class:"text-xs text-gray-500 mt-1"},"Specify any special terms or expectations regarding damaged items.",-1))]),e("div",Be,[n(R(L),{disabled:!Y.value,onClick:G},{default:a(()=>[f(" Submit "+d(u.value==="exchange"?"Exchange":"Refund")+" Request ",1)]),_:1},8,["disabled"])])])]),_:1})]),_:1})]),e("div",Me,[n(h,null,{default:a(()=>[n(q,null,{default:a(()=>[n(w,null,{default:a(()=>t[29]||(t[29]=[f("Instructions & Clarifications")])),_:1,__:[29]})]),_:1}),n(k,null,{default:a(()=>t[30]||(t[30]=[e("div",{class:"space-y-4 text-sm"},[e("div",null,[e("h4",{class:"font-semibold mb-2"},"Request Types:"),e("ul",{class:"list-disc pl-5 space-y-1 text-gray-600"},[e("li",null,[e("strong",null,"Refund:"),f(" Return the item(s) and receive money back to your original payment method or as store credit.")]),e("li",null,[e("strong",null,"Exchange:"),f(" Swap your item(s) for different product(s) of equal or different value. Price difference will be handled separately.")])])]),e("div",null,[e("h4",{class:"font-semibold mb-2"},"Proof Images:"),e("p",{class:"text-gray-600"},"Upload clear photos showing:"),e("ul",{class:"list-disc pl-5 space-y-1 text-gray-600 mt-1"},[e("li",null,"The item(s) condition"),e("li",null,"Any damage or defects"),e("li",null,"Package/receipt if applicable")]),e("p",{class:"text-gray-600 mt-2"},"This helps us process your request faster and ensures accurate assessment.")]),e("div",null,[e("h4",{class:"font-semibold mb-2"},"What Happens Next:"),e("ol",{class:"list-decimal pl-5 space-y-1 text-gray-600"},[e("li",null,"Submit your request"),e("li",null,"Admin reviews your request (usually within 1-2 business days)"),e("li",null,"You'll receive an email notification about the decision"),e("li",null,"If approved, follow instructions to return/exchange items")])]),e("div",null,[e("h4",{class:"font-semibold mb-2"},"Damaged Items:"),e("p",{class:"text-gray-600"},[f("If items are damaged, please specify your expectations: "),e("ul",{class:"list-disc pl-5 space-y-1 text-gray-600 mt-1"},[e("li",null,"Full refund expected"),e("li",null,"Partial refund acceptable"),e("li",null,"Exchange preferred")])])])],-1)])),_:1,__:[30]})]),_:1})])])]),_:1}))}});export{st as default};
