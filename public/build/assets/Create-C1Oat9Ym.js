import{d as K,D as H,p as q,c as w,o as f,w as d,a as r,b as i,u as n,g as z,E as L,e as a,f as _,h as g,x,y as k,F as W,r as Y,t as y,S as G}from"./app-Du4GjnqY.js";import{_ as b}from"./index-B1B-wuAy.js";import{_ as V}from"./Select.vue_vue_type_script_setup_true_lang-2dMc3g12.js";import{_ as J}from"./SearchSelect.vue_vue_type_script_setup_true_lang-Cjm4Wq4y.js";import{_ as R}from"./AppLayout.vue_vue_type_script_setup_true_lang-C5-77bQX.js";import{_ as h,a as C}from"./CardContent.vue_vue_type_script_setup_true_lang-CsIZBT8t.js";import{_ as O,a as S}from"./CardTitle.vue_vue_type_script_setup_true_lang-Yjmxyl1g.js";import{_ as X}from"./CardFooter.vue_vue_type_script_setup_true_lang-CmGr18V_.js";import{_ as p}from"./Label.vue_vue_type_script_setup_true_lang-7De4O60e.js";import{S as v}from"./sweetalert2.esm.all-BQIkj5Wb.js";import{_ as c}from"./InputError.vue_vue_type_script_setup_true_lang-BWgwLU_F.js";import{T as Z}from"./trash-2-B6DjoUNv.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-BItx2YQm.js";import"./createLucideIcon-knc4Tqmj.js";import"./RovingFocusGroup-Bek87zqo.js";import"./LocationInput.vue_vue_type_style_index_0_scoped_0fe2f881_lang-DHw6Z5C7.js";import"./Input.vue_vue_type_script_setup_true_lang-CMLq3oKH.js";import"./search-CImxIYP8.js";import"./VisuallyHidden-8qINCcSU.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang--3inaUNk.js";import"./chevron-right-Ds8ma9mO.js";const tt={key:0},et={class:"flex justify-between items-center"},rt={class:"space-y-3"},ot={class:"flex justify-between items-center mb-3"},st={class:"font-medium text-sm"},it={class:"grid grid-cols-1 md:grid-cols-3 gap-3"},nt=["id","onUpdate:modelValue","max","onInput"],dt={key:0,class:"text-[11px] text-gray-500 mt-1"},ut={class:"w-full rounded-md border border-input bg-transparent px-2 py-1 mt-1 text-sm text-foreground dark:bg-input/30 h-8 flex items-center"},at={class:"mt-4 pt-3 border-t"},lt={class:"flex justify-end"},mt={class:"text-right"},pt={class:"text-base font-medium"},It=K({__name:"Create",props:{customer_id:{},products:{}},setup(T){const m=T,o=H({customer_id:m.customer_id,delivery_type:"delivery",payment_method:"cash",credit_term_days:null,notes:"",order_items:[{product_id:null,quantity:1}]}),B=[{title:"Orders",href:"/orders"},{title:"Create Order",href:"/orders/create"}],j=q(()=>o.order_items.reduce((s,t)=>{if(t.product_id&&t.quantity){const e=m.products.find(u=>u.id===t.product_id);if(e)return s+t.quantity*e.selling_price}return s},0)),P=q(()=>!o.customer_id||!o.order_items.length?!1:o.order_items.some(s=>!!s.product_id&&s.quantity>0));function I(){o.order_items.push({product_id:null,quantity:1})}function A(s){o.order_items.length>1&&o.order_items.splice(s,1)}function D(s){const t=o.order_items[s];if(t.product_id&&t.quantity){const e=m.products.find(u=>u.id===t.product_id);e&&t.quantity>e.stock&&(t.quantity=e.stock,v.fire({icon:"info",title:"Quantity Adjusted",text:`Quantity for "${e.name}" has been adjusted to the maximum available stock (${e.stock} units).`,confirmButtonText:"OK",toast:!0,position:"top-end",timer:3e3,timerProgressBar:!0}))}}function Q(s){const t=o.order_items[s];if(t.product_id&&t.quantity){const e=m.products.find(u=>u.id===t.product_id);e&&t.quantity>e.stock&&(t.quantity=e.stock,v.fire({icon:"info",title:"Quantity Adjusted",text:`Quantity for "${e.name}" has been adjusted to the maximum available stock (${e.stock} units).`,confirmButtonText:"OK",toast:!0,position:"top-end",timer:3e3,timerProgressBar:!0}))}}function U(){for(let s=0;s<o.order_items.length;s++){const t=o.order_items[s];if(t.product_id&&t.quantity){const e=m.products.find(u=>u.id===t.product_id);e&&t.quantity>e.stock&&(t.quantity=e.stock,v.fire({icon:"warning",title:"Quantity Auto-Adjusted",text:`Quantity for "${e.name}" was automatically adjusted to ${e.stock} units due to stock limitations.`,confirmButtonText:"OK"}))}}o.post(route("orders.store"),{preserveScroll:!0,onSuccess:()=>{v.fire({toast:!0,position:"top-end",icon:"success",title:"Order created successfully",text:"Your order is pending approval from staff.",showConfirmButton:!1,timer:3e3,timerProgressBar:!0})}})}function $(s){return o.errors[s]}function F(s){return new Intl.NumberFormat("en-PH",{style:"currency",currency:"PHP",minimumFractionDigits:2}).format(s)}const N=[{value:"cash",label:"Cash"},{value:"bank_transfer",label:"Bank Transfer"},{value:"e-wallet",label:"E-Wallet"},{value:"other",label:"Other"}];function E(){return[{value:null,label:"Select product"},...m.products.map(s=>({value:s.id,label:s.name,description:`${F(s.selling_price)} • Stock: ${s.stock}`}))]}function M(s){const t=o.order_items[s];if(t.product_id&&t.quantity){const e=m.products.find(u=>u.id===t.product_id);if(e)return t.quantity*e.selling_price}return 0}return(s,t)=>(f(),w(R,{breadcrumbs:B},{default:d(()=>[r(n(z),{title:"Create Order"}),t[19]||(t[19]=i("div",{class:"flex items-center justify-between mb-6"},[i("h1",{class:"text-2xl font-bold"},"Create Order")],-1)),i("form",{onSubmit:t[4]||(t[4]=L(e=>U(),["prevent"])),class:"space-y-6"},[r(h,null,{default:d(()=>[r(O,null,{default:d(()=>[r(S,null,{default:d(()=>t[5]||(t[5]=[a("Order Details")])),_:1,__:[5]})]),_:1}),r(C,{class:"space-y-6"},{default:d(()=>[i("div",null,[r(p,{for:"delivery_type"},{default:d(()=>t[6]||(t[6]=[a("Delivery Type *")])),_:1,__:[6]}),r(n(V),{id:"delivery_type",modelValue:n(o).delivery_type,"onUpdate:modelValue":t[0]||(t[0]=e=>n(o).delivery_type=e),options:[{value:"pickup",label:"Pickup"},{value:"delivery",label:"Delivery"}],class:"mt-1",required:""},null,8,["modelValue"]),r(c,{message:n(o).errors.delivery_type},null,8,["message"])]),i("div",null,[r(p,{for:"payment_method"},{default:d(()=>t[7]||(t[7]=[a("Payment Method *")])),_:1,__:[7]}),r(n(V),{id:"payment_method",modelValue:n(o).payment_method,"onUpdate:modelValue":t[1]||(t[1]=e=>n(o).payment_method=e),options:N,class:"mt-1",required:""},null,8,["modelValue"]),r(c,{message:n(o).errors.payment_method},null,8,["message"])]),n(o).payment_method!=="cash"?(f(),_("div",tt,[r(p,{for:"credit_term_days"},{default:d(()=>t[8]||(t[8]=[a("Credit Term (Days)")])),_:1,__:[8]}),x(i("input",{"onUpdate:modelValue":t[2]||(t[2]=e=>n(o).credit_term_days=e),type:"number",id:"credit_term_days",min:"0",max:"365",class:"mt-1 block w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",placeholder:"e.g., 30"},null,512),[[k,n(o).credit_term_days,void 0,{number:!0}]]),t[9]||(t[9]=i("div",{class:"text-[11px] text-gray-500 mt-1"}," Number of days until payment is due (default: 30 days). ",-1)),r(c,{message:n(o).errors.credit_term_days},null,8,["message"])])):g("",!0),i("div",null,[r(p,{for:"notes"},{default:d(()=>t[10]||(t[10]=[a("Notes (Optional)")])),_:1,__:[10]}),x(i("textarea",{id:"notes","onUpdate:modelValue":t[3]||(t[3]=e=>n(o).notes=e),class:"w-full rounded-md border border-input bg-transparent px-3 py-2 mt-1 text-foreground dark:bg-input/30 focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] focus-visible:outline-none",rows:"3",placeholder:"Add any special instructions or notes for your order..."},null,512),[[k,n(o).notes]]),r(c,{message:n(o).errors.notes},null,8,["message"])])]),_:1})]),_:1}),r(h,null,{default:d(()=>[r(O,null,{default:d(()=>[i("div",et,[r(S,null,{default:d(()=>t[11]||(t[11]=[a("Order Items")])),_:1,__:[11]}),r(n(b),{type:"button",variant:"outline",onClick:I},{default:d(()=>t[12]||(t[12]=[i("span",{class:"mr-2"},"+",-1),a(" Add Item ")])),_:1,__:[12]})])]),_:1}),r(C,null,{default:d(()=>[i("div",rt,[(f(!0),_(W,null,Y(n(o).order_items,(e,u)=>(f(),_("div",{key:u,class:"border rounded-md p-3"},[i("div",ot,[i("h4",st,"Item "+y(u+1),1),n(o).order_items.length>1?(f(),w(n(b),{key:0,type:"button",variant:"ghost",size:"sm",class:"h-7 w-7 p-0 text-red-500 hover:text-red-600 hover:bg-red-50 dark:hover:bg-red-950/20",onClick:l=>A(u)},{default:d(()=>[r(n(Z),{class:"h-4 w-4"})]),_:2},1032,["onClick"])):g("",!0)]),i("div",it,[i("div",null,[r(p,{for:`product_id_${u}`,class:"text-xs"},{default:d(()=>t[13]||(t[13]=[a("Product")])),_:2,__:[13]},1032,["for"]),r(n(J),{modelValue:e.product_id,"onUpdate:modelValue":[l=>e.product_id=l,l=>D(u)],options:E(),placeholder:"Select product","search-placeholder":"Search products...",class:"mt-1 h-8",required:""},null,8,["modelValue","onUpdate:modelValue","options"]),r(c,{message:$(`order_items.${u}.product_id`)},null,8,["message"])]),i("div",null,[r(p,{for:`quantity_${u}`,class:"text-xs"},{default:d(()=>t[14]||(t[14]=[a("Quantity")])),_:2,__:[14]},1032,["for"]),x(i("input",{id:`quantity_${u}`,"onUpdate:modelValue":l=>e.quantity=l,type:"number",min:"1",max:e.product_id?(m.products.find(l=>l.id===e.product_id)||{stock:0}).stock:void 0,class:"w-full rounded-md border border-input bg-transparent px-2 py-1 mt-1 text-sm text-foreground dark:bg-input/30 focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] focus-visible:outline-none h-8",onInput:l=>Q(u),required:""},null,40,nt),[[k,e.quantity,void 0,{number:!0}]]),e.product_id?(f(),_("div",dt," In stock: "+y((m.products.find(l=>l.id===e.product_id)||{stock:0}).stock),1)):g("",!0),r(c,{message:$(`order_items.${u}.quantity`)},null,8,["message"])]),i("div",null,[r(p,{class:"text-xs"},{default:d(()=>t[15]||(t[15]=[a("Total")])),_:1,__:[15]}),i("div",ut," ₱"+y(M(u).toFixed(2)),1)])])]))),128))]),i("div",at,[i("div",lt,[i("div",mt,[i("div",pt,"Total Amount: ₱"+y(j.value.toFixed(2)),1),t[16]||(t[16]=i("div",{class:"text-xs text-muted-foreground mt-1"},"12% VAT is included in price",-1))])])])]),_:1})]),_:1}),r(h,null,{default:d(()=>[r(X,{class:"flex gap-2 justify-end"},{default:d(()=>[r(n(b),{type:"submit",disabled:!P.value,variant:"default"},{default:d(()=>t[17]||(t[17]=[a("Submit Order")])),_:1,__:[17]},8,["disabled"]),r(n(G),{href:s.route("orders.index")},{default:d(()=>[r(n(b),{type:"button",variant:"ghost"},{default:d(()=>t[18]||(t[18]=[a("Cancel")])),_:1,__:[18]})]),_:1},8,["href"])]),_:1})]),_:1})],32)]),_:1,__:[19]}))}});export{It as default};
