import{c as z}from"./index-DfFRnXuf.js";import{i as I,v as L,u as F,_ as U}from"./_plugin-vue_export-helper-CcWKwKWC.js";import{b as j}from"./LocationInput.vue_vue_type_style_index_0_scoped_0fe2f881_lang-CD7IxCC7.js";import B from"./marker-icon-2x-1TirABJh.js";import M from"./marker-icon-B6h-nX3D.js";import R from"./marker-shadow-B9CpECYs.js";import{d as T,j as i,z as Z,f as n,o as l,x as D,u as d,b as g,a as y,h,F as E,r as q,n as H,w as O,c as P,e as $,t as x}from"./app-skRLxAbO.js";const A={style:{"margin-bottom":"0.5rem"}},Q=["value"],G={key:0,style:{"margin-top":"4px","font-size":"12px",color:"#6b7280"}},J={key:1,style:{"margin-top":"4px",border:"1px solid #e5e7eb","border-radius":"6px",background:"var(--background, #fff)","max-height":"180px",overflow:"auto"}},K=["onClick"],W={key:0,class:"mt-2 text-xs text-muted-foreground"},X={class:"font-mono"},Y={key:1,class:"mt-2 text-xs text-red-500"},ee={key:2,class:"mt-2 text-xs text-muted-foreground"},te=T({__name:"LocationInput",props:{modelValue:{},defaultValue:{},class:{},mapHeight:{},mapZoom:{}},emits:["update:modelValue"],setup(_,{emit:k}){j.Icon.Default.mergeOptions({iconRetinaUrl:B,iconUrl:M,shadowUrl:R});const r=_,p=k,e=i(null),u=i([0,0]),c=i(r.mapZoom??(r.modelValue?13:2)),m=i(""),s=i([]),f=i(!1);let v=null;async function w(t){const a=t.trim();if(!a){s.value=[];return}f.value=!0;try{const o=await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(a)}&limit=5`,{headers:{Accept:"application/json"}});if(!o.ok)throw new Error("Search failed");const b=await o.json();s.value=(b??[]).slice(0,5)}catch{s.value=[]}finally{f.value=!1}}function N(t){const a=t.target.value;m.value=a,v&&clearTimeout(v),v=setTimeout(()=>w(a),400)}function S(t){const a=parseFloat(t.lat),o=parseFloat(t.lon);isNaN(a)||isNaN(o)||(e.value={lat:a,lng:o},u.value=[a,o],c.value=15,p("update:modelValue",e.value),m.value=t.display_name,s.value=[])}Z(()=>r.modelValue,t=>{t&&typeof t.lat=="number"&&typeof t.lng=="number"&&!isNaN(t.lat)&&!isNaN(t.lng)?(e.value=t,u.value=[t.lat,t.lng],c.value=r.mapZoom??13):(e.value=null,u.value=[0,0],c.value=r.mapZoom??2)},{immediate:!0});function V(t){const{latlng:a}=t;e.value={lat:a.lat,lng:a.lng},p("update:modelValue",e.value)}function C(t){const{lat:a,lng:o}=t.target.getLatLng();e.value={lat:a,lng:o},p("update:modelValue",e.value)}return(t,a)=>(l(),n("div",{class:D(d(z)("w-full",r.class))},[g("div",A,[g("input",{value:m.value,onInput:N,type:"text",placeholder:"Search place or address…","aria-label":"Search place or address",style:{width:"100%",height:"36px",border:"1px solid #e5e7eb","border-radius":"6px",padding:"0 10px",background:"var(--background, #fff)",color:"inherit"}},null,40,Q),f.value?(l(),n("div",G,"Searching…")):h("",!0),s.value.length?(l(),n("div",J,[(l(!0),n(E,null,q(s.value,o=>(l(),n("button",{key:o.lat+","+o.lon+"-"+o.display_name,type:"button",onClick:b=>S(o),style:{display:"block",width:"100%","text-align":"left",padding:"8px 10px",border:"none",background:"transparent",cursor:"pointer","font-size":"12px",color:"inherit"}},x(o.display_name),9,K))),128))])):h("",!0)]),y(d(I),{center:u.value,"onUpdate:center":a[0]||(a[0]=o=>u.value=o),zoom:c.value,style:H({width:"100%",height:r.mapHeight??"300px",borderRadius:"0.5rem",border:"1px solid #e5e7eb",overflow:"hidden"}),onClick:V,"aria-label":"Location map input",tabindex:"0",role:"application"},{default:O(()=>[y(d(L),{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:"© OpenStreetMap contributors","max-zoom":19}),e.value&&typeof e.value.lat=="number"&&typeof e.value.lng=="number"&&!isNaN(e.value.lat)&&!isNaN(e.value.lng)?(l(),P(d(F),{key:0,"lat-lng":[e.value.lat,e.value.lng],draggable:!0,onMoveend:C},null,8,["lat-lng"])):h("",!0)]),_:1},8,["center","zoom","style"]),e.value&&typeof e.value.lat=="number"&&typeof e.value.lng=="number"?(l(),n("div",W,[a[1]||(a[1]=$(" Selected: ")),g("span",X,x(e.value.lat.toFixed(6))+", "+x(e.value.lng.toFixed(6)),1)])):e.value?(l(),n("div",Y," Invalid location data. Please click on the map to select a new location. ")):(l(),n("div",ee,"Click on the map to select a location."))],2))}}),ue=U(te,[["__scopeId","data-v-0fe2f881"]]);export{ue as L};
