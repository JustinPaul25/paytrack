import{d as W,x as G,c as g,a as I,o as b,w as l,b as e,e as n,u as r,k as H,q as J,f as u,m as h,v as $,g as w,F as R,h as X,l as Y,t as f,S as Z}from"./app-UO9kVhDU.js";import{_}from"./index-ByT1Ogpd.js";import{_ as S}from"./Select.vue_vue_type_script_setup_true_lang-DHYVl7ke.js";import{_ as T}from"./SearchSelect.vue_vue_type_script_setup_true_lang-Bi0iKoPx.js";import{_ as tt}from"./AppLayout.vue_vue_type_script_setup_true_lang-HFcLNtQ8.js";import{_ as k,a as B}from"./CardContent.vue_vue_type_script_setup_true_lang-BmZM74_C.js";import{a as U,_ as j}from"./CardTitle.vue_vue_type_script_setup_true_lang-BCtSJeK_.js";import{_ as et}from"./CardFooter.vue_vue_type_script_setup_true_lang-D15TpHgZ.js";import{_ as m}from"./Label.vue_vue_type_script_setup_true_lang-CUmyoJVc.js";import{S as q}from"./sweetalert2.esm.all-BQIkj5Wb.js";import{_ as c}from"./InputError.vue_vue_type_script_setup_true_lang-B5sztpaq.js";import{T as ot}from"./trash-2-Db4R7EdX.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-CDmFjciq.js";import"./createLucideIcon-TqQSKtWC.js";import"./RovingFocusGroup-BOkiuXtY.js";import"./LocationInput.vue_vue_type_style_index_0_scoped_5601c0ff_lang-DzfWtGed.js";import"./Input.vue_vue_type_script_setup_true_lang-CYtUzMrl.js";import"./search-CTnouE8I.js";import"./VisuallyHidden-mEyKbXoj.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-CBYKjoNO.js";const st={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},it={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},nt={class:"flex justify-between items-center"},rt={class:"space-y-3"},lt={class:"flex justify-between items-center mb-3"},at={class:"font-medium text-sm"},ut={class:"grid grid-cols-1 md:grid-cols-4 gap-3"},dt=["id","onUpdate:modelValue","onInput"],mt=["id","onUpdate:modelValue","onInput"],ct={class:"w-full rounded-md border border-input bg-transparent px-2 py-1 mt-1 text-sm text-foreground dark:bg-input/30 h-8 flex items-center"},pt={class:"mt-4 pt-3 border-t"},ft={class:"flex justify-end"},_t={class:"text-right space-y-1"},vt={class:"text-sm text-muted-foreground"},gt={class:"text-sm text-muted-foreground"},bt={class:"text-base font-medium"},Nt=W({__name:"Create",props:{customers:{},products:{}},setup(P){const p=P,s=G({customer_id:null,status:"draft",payment_method:"cash",notes:"",invoice_items:[{product_id:null,quantity:1,price:0,total:0}],create_another:void 0}),F=[{title:"Invoices",href:"/invoices"},{title:"Create Invoice",href:"/invoices/create"}],y=g(()=>s.invoice_items.reduce((i,t)=>i+t.total,0)),V=g(()=>y.value*.12),A=g(()=>y.value+V.value);function O(){s.invoice_items.push({product_id:null,quantity:1,price:0,total:0})}function Q(i){s.invoice_items.length>1&&s.invoice_items.splice(i,1)}function v(i){const t=s.invoice_items[i];t.product_id&&t.quantity&&t.price?t.total=t.quantity*t.price:t.total=0}function N(i){const t=s.invoice_items[i];if(t.product_id){const o=p.products.find(a=>a.id===t.product_id);o&&(t.price=o.selling_price,v(i))}}function D(i){const t=s.invoice_items[i];if(t.product_id&&t.quantity){const o=p.products.find(a=>a.id===t.product_id);o&&t.quantity>o.stock&&(t.quantity=o.stock,q.fire({icon:"info",title:"Quantity Adjusted",text:`Quantity for "${o.name}" has been adjusted to the maximum available stock (${o.stock} units).`,confirmButtonText:"OK",toast:!0,position:"top-end",timer:3e3,timerProgressBar:!0}))}v(i)}function M(i){v(i)}function C(i=!1){for(let t=0;t<s.invoice_items.length;t++){const o=s.invoice_items[t];if(o.product_id&&o.quantity){const a=p.products.find(d=>d.id===o.product_id);a&&o.quantity>a.stock&&(o.quantity=a.stock,v(t),q.fire({icon:"warning",title:"Quantity Auto-Adjusted",text:`Quantity for "${a.name}" was automatically adjusted to ${a.stock} units due to stock limitations.`,confirmButtonText:"OK"}))}}i?s.create_another=1:delete s.create_another,s.post(route("invoices.store"),{preserveScroll:!0,onSuccess:()=>{q.fire({toast:!0,position:"top-end",icon:"success",title:"Invoice created successfully",showConfirmButton:!1,timer:3e3,timerProgressBar:!0}),i&&(s.reset(),s.invoice_items=[{product_id:null,quantity:1,price:0,total:0}])}})}function x(i){return s.errors[i]}const E=g(()=>[{value:null,label:"Select customer"},...p.customers.map(i=>({value:i.id,label:`${i.name}${i.company_name?` (${i.company_name})`:""}`}))]),K=[{value:"draft",label:"Draft"},{value:"pending",label:"Pending"},{value:"completed",label:"Completed"},{value:"cancelled",label:"Cancelled"}],z=[{value:"cash",label:"Cash"},{value:"bank_transfer",label:"Bank Transfer"},{value:"e-wallet",label:"E-Wallet"},{value:"other",label:"Other"}];function L(){return[{value:null,label:"Select product"},...p.products.map(i=>({value:i.id,label:`${i.name} - ₱${i.selling_price.toFixed(2)}`}))]}return(i,t)=>(b(),I(tt,{breadcrumbs:F},{default:l(()=>[e(r(H),{title:"Create Invoice"}),t[20]||(t[20]=n("div",{class:"flex items-center justify-between mb-6"},[n("h1",{class:"text-2xl font-bold"},"Create Invoice")],-1)),n("form",{onSubmit:t[5]||(t[5]=J(o=>C(),["prevent"])),class:"space-y-6"},[e(k,null,{default:l(()=>[e(U,null,{default:l(()=>[e(j,null,{default:l(()=>t[6]||(t[6]=[u("Invoice Details")])),_:1,__:[6]})]),_:1}),e(B,{class:"space-y-6"},{default:l(()=>[n("div",st,[n("div",null,[e(m,{for:"customer_id"},{default:l(()=>t[7]||(t[7]=[u("Customer")])),_:1,__:[7]}),e(r(T),{modelValue:r(s).customer_id,"onUpdate:modelValue":t[0]||(t[0]=o=>r(s).customer_id=o),options:E.value,placeholder:"Select customer","search-placeholder":"Search customers...",class:"mt-1",required:""},null,8,["modelValue","options"]),e(c,{message:r(s).errors.customer_id},null,8,["message"])]),n("div",null,[e(m,{for:"status"},{default:l(()=>t[8]||(t[8]=[u("Status")])),_:1,__:[8]}),e(r(S),{modelValue:r(s).status,"onUpdate:modelValue":t[1]||(t[1]=o=>r(s).status=o),options:K,placeholder:"Select status",class:"mt-1",required:""},null,8,["modelValue"]),e(c,{message:r(s).errors.status},null,8,["message"])])]),n("div",it,[n("div",null,[e(m,{for:"payment_method"},{default:l(()=>t[9]||(t[9]=[u("Payment Method")])),_:1,__:[9]}),e(r(S),{modelValue:r(s).payment_method,"onUpdate:modelValue":t[2]||(t[2]=o=>r(s).payment_method=o),options:z,placeholder:"Select payment method",class:"mt-1",required:""},null,8,["modelValue"]),e(c,{message:r(s).errors.payment_method},null,8,["message"])])]),n("div",null,[e(m,{for:"notes"},{default:l(()=>t[10]||(t[10]=[u("Notes")])),_:1,__:[10]}),h(n("textarea",{id:"notes","onUpdate:modelValue":t[3]||(t[3]=o=>r(s).notes=o),class:"w-full rounded-md border border-input bg-transparent px-3 py-2 mt-1 text-foreground dark:bg-input/30 focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] focus-visible:outline-none",rows:"3"},null,512),[[$,r(s).notes]]),e(c,{message:r(s).errors.notes},null,8,["message"])])]),_:1})]),_:1}),e(k,null,{default:l(()=>[e(U,null,{default:l(()=>[n("div",nt,[e(j,null,{default:l(()=>t[11]||(t[11]=[u("Invoice Items")])),_:1,__:[11]}),e(r(_),{type:"button",variant:"outline",onClick:O},{default:l(()=>t[12]||(t[12]=[n("span",{class:"mr-2"},"+",-1),u(" Add Item ")])),_:1,__:[12]})])]),_:1}),e(B,null,{default:l(()=>[n("div",rt,[(b(!0),w(R,null,X(r(s).invoice_items,(o,a)=>(b(),w("div",{key:a,class:"border rounded-md p-3"},[n("div",lt,[n("h4",at,"Item "+f(a+1),1),r(s).invoice_items.length>1?(b(),I(r(_),{key:0,type:"button",variant:"ghost",size:"sm",class:"h-7 w-7 p-0 text-red-500 hover:text-red-600 hover:bg-red-50 dark:hover:bg-red-950/20",onClick:d=>Q(a)},{default:l(()=>[e(r(ot),{class:"h-4 w-4"})]),_:2},1032,["onClick"])):Y("",!0)]),n("div",ut,[n("div",null,[e(m,{for:`product_id_${a}`,class:"text-xs"},{default:l(()=>t[13]||(t[13]=[u("Product")])),_:2,__:[13]},1032,["for"]),e(r(T),{modelValue:o.product_id,"onUpdate:modelValue":[d=>o.product_id=d,d=>N(a)],options:L(),placeholder:"Select product","search-placeholder":"Search products...",class:"mt-1 h-8",required:""},null,8,["modelValue","onUpdate:modelValue","options"]),e(c,{message:x(`invoice_items.${a}.product_id`)},null,8,["message"])]),n("div",null,[e(m,{for:`quantity_${a}`,class:"text-xs"},{default:l(()=>t[14]||(t[14]=[u("Quantity")])),_:2,__:[14]},1032,["for"]),h(n("input",{id:`quantity_${a}`,"onUpdate:modelValue":d=>o.quantity=d,type:"number",min:"1",class:"w-full rounded-md border border-input bg-transparent px-2 py-1 mt-1 text-sm text-foreground dark:bg-input/30 focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] focus-visible:outline-none h-8",onInput:d=>D(a),required:""},null,40,dt),[[$,o.quantity,void 0,{number:!0}]]),e(c,{message:x(`invoice_items.${a}.quantity`)},null,8,["message"])]),n("div",null,[e(m,{for:`price_${a}`,class:"text-xs"},{default:l(()=>t[15]||(t[15]=[u("Price")])),_:2,__:[15]},1032,["for"]),h(n("input",{id:`price_${a}`,"onUpdate:modelValue":d=>o.price=d,type:"number",min:"0",step:"0.01",class:"w-full rounded-md border border-input bg-transparent px-2 py-1 mt-1 text-sm text-foreground dark:bg-input/30 focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] focus-visible:outline-none h-8",onInput:d=>M(a),required:""},null,40,mt),[[$,o.price,void 0,{number:!0}]]),e(c,{message:x(`invoice_items.${a}.price`)},null,8,["message"])]),n("div",null,[e(m,{class:"text-xs"},{default:l(()=>t[16]||(t[16]=[u("Total")])),_:1,__:[16]}),n("div",ct," ₱"+f(o.total.toFixed(2)),1)])])]))),128))]),n("div",pt,[n("div",ft,[n("div",_t,[n("div",vt,"Subtotal: ₱"+f(y.value.toFixed(2)),1),n("div",gt,"VAT (12%): ₱"+f(V.value.toFixed(2)),1),n("div",bt,"Total Amount: ₱"+f(A.value.toFixed(2)),1)])])])]),_:1})]),_:1}),e(k,null,{default:l(()=>[e(et,{class:"flex gap-2 justify-end"},{default:l(()=>[e(r(_),{type:"submit",variant:"default"},{default:l(()=>t[17]||(t[17]=[u("Create Invoice")])),_:1,__:[17]}),e(r(_),{type:"button",variant:"secondary",onClick:t[4]||(t[4]=o=>C(!0))},{default:l(()=>t[18]||(t[18]=[u("Create & create another")])),_:1,__:[18]}),e(r(Z),{href:i.route("invoices.index")},{default:l(()=>[e(r(_),{type:"button",variant:"ghost"},{default:l(()=>t[19]||(t[19]=[u("Cancel")])),_:1,__:[19]})]),_:1},8,["href"])]),_:1})]),_:1})],32)]),_:1,__:[20]}))}});export{Nt as default};
