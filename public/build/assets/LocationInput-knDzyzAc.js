import{c as L}from"./index-DuOHn2HM.js";import{v as F,u as M,i as T}from"./vue-leaflet.es-D9lnfNkH.js";import{q as R}from"./LocationInput.vue_vue_type_style_index_0_scoped_0fdfc5f8_lang-iGDb-D_T.js";import U from"./marker-icon-2x-1TirABJh.js";import j from"./marker-icon-B6h-nX3D.js";import q from"./marker-shadow-B9CpECYs.js";import{d as B,m as s,q as Z,z as D,s as E,e as n,o as l,n as H,u as d,b as m,c as k,f as h,F as P,r as O,w as $,a as A,i as _,h as Q,t as x}from"./app-CrKto25Q.js";import{_ as G}from"./_plugin-vue_export-helper-DlAUqK2U.js";const J={style:{"margin-bottom":"0.5rem"}},K=["value"],W={key:0,style:{"margin-top":"4px","font-size":"12px",color:"#6b7280"}},X={key:1,style:{"margin-top":"4px",border:"1px solid #e5e7eb","border-radius":"6px",background:"var(--background, #fff)","max-height":"180px",overflow:"auto"}},Y=["onClick"],ee={key:2,class:"mt-2 text-xs text-muted-foreground"},te={class:"font-mono"},ae={key:3,class:"mt-2 text-xs text-red-500"},oe={key:4,class:"mt-2 text-xs text-muted-foreground"},le=B({__name:"LocationInput",props:{modelValue:{},defaultValue:{},class:{},mapHeight:{},mapZoom:{}},emits:["update:modelValue"],setup(w,{emit:N}){R.Icon.Default.mergeOptions({iconRetinaUrl:U,iconUrl:j,shadowUrl:q});const r=w,p=N,t=s(null),u=s([0,0]),c=s(r.mapZoom??(r.modelValue?13:2)),y=s(!1);Z(async()=>{await D(),await new Promise(e=>setTimeout(e,100)),y.value=!0});const f=s(""),i=s([]),v=s(!1);let g=null;async function C(e){const a=e.trim();if(!a){i.value=[];return}v.value=!0;try{const o=await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(a)}&limit=5`,{headers:{Accept:"application/json"}});if(!o.ok)throw new Error("Search failed");const b=await o.json();i.value=(b??[]).slice(0,5)}catch{i.value=[]}finally{v.value=!1}}function S(e){const a=e.target.value;f.value=a,g&&clearTimeout(g),g=setTimeout(()=>C(a),400)}function V(e){const a=parseFloat(e.lat),o=parseFloat(e.lon);isNaN(a)||isNaN(o)||(t.value={lat:a,lng:o},u.value=[a,o],c.value=15,p("update:modelValue",t.value),f.value=e.display_name,i.value=[])}E(()=>r.modelValue,e=>{e&&typeof e.lat=="number"&&typeof e.lng=="number"&&!isNaN(e.lat)&&!isNaN(e.lng)?(t.value=e,u.value=[e.lat,e.lng],c.value=r.mapZoom??13):(t.value=null,u.value=[0,0],c.value=r.mapZoom??2)},{immediate:!0});function I(e){const{latlng:a}=e;t.value={lat:a.lat,lng:a.lng},p("update:modelValue",t.value)}function z(e){const{lat:a,lng:o}=e.target.getLatLng();t.value={lat:a,lng:o},p("update:modelValue",t.value)}return(e,a)=>(l(),n("div",{class:H(d(L)("w-full",r.class))},[m("div",J,[m("input",{value:f.value,onInput:S,type:"text",placeholder:"Search place or address…","aria-label":"Search place or address",style:{width:"100%",height:"36px",border:"1px solid #e5e7eb","border-radius":"6px",padding:"0 10px",background:"var(--background, #fff)",color:"inherit"}},null,40,K),v.value?(l(),n("div",W,"Searching…")):h("",!0),i.value.length?(l(),n("div",X,[(l(!0),n(P,null,O(i.value,o=>(l(),n("button",{key:o.lat+","+o.lon+"-"+o.display_name,type:"button",onClick:b=>V(o),style:{display:"block",width:"100%","text-align":"left",padding:"8px 10px",border:"none",background:"transparent",cursor:"pointer","font-size":"12px",color:"inherit"}},x(o.display_name),9,Y))),128))])):h("",!0)]),y.value?(l(),k(d(T),{key:0,center:u.value,"onUpdate:center":a[0]||(a[0]=o=>u.value=o),zoom:c.value,style:_({width:"100%",height:r.mapHeight??"300px",borderRadius:"0.5rem",border:"1px solid #e5e7eb",overflow:"hidden"}),onClick:I,"aria-label":"Location map input",tabindex:"0",role:"application"},{default:$(()=>[A(d(F),{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:"© OpenStreetMap contributors","max-zoom":19}),t.value&&typeof t.value.lat=="number"&&typeof t.value.lng=="number"&&!isNaN(t.value.lat)&&!isNaN(t.value.lng)?(l(),k(d(M),{key:0,"lat-lng":[t.value.lat,t.value.lng],draggable:!0,onMoveend:z},null,8,["lat-lng"])):h("",!0)]),_:1},8,["center","zoom","style"])):(l(),n("div",{key:1,style:_({width:"100%",height:r.mapHeight??"300px",borderRadius:"0.5rem",border:"1px solid #e5e7eb",display:"flex",alignItems:"center",justifyContent:"center",background:"#f3f4f6"})},a[1]||(a[1]=[m("span",{class:"text-muted-foreground text-sm"},"Loading map...",-1)]),4)),t.value&&typeof t.value.lat=="number"&&typeof t.value.lng=="number"?(l(),n("div",ee,[a[2]||(a[2]=Q(" Selected: ")),m("span",te,x(t.value.lat.toFixed(6))+", "+x(t.value.lng.toFixed(6)),1)])):t.value?(l(),n("div",ae," Invalid location data. Please click on the map to select a new location. ")):(l(),n("div",oe,"Click on the map to select a location."))],2))}}),pe=G(le,[["__scopeId","data-v-0fdfc5f8"]]);export{pe as default};
