import{d as L,D as W,p as y,s as H,m as M,J as Y,c as K,o as x,w as n,a as r,b as s,u as l,g as Q,E as Z,h as u,x as c,y as _,e as V,f as C,S as ee}from"./app-DFV75mBf.js";import{_ as b}from"./index-Cq-jLiLx.js";import{_ as P}from"./Select.vue_vue_type_script_setup_true_lang-CPdXLveA.js";import{_ as te}from"./SearchSelect.vue_vue_type_script_setup_true_lang-CnUXx3Sw.js";import{_ as re}from"./AppLayout.vue_vue_type_script_setup_true_lang-DSSSnv_7.js";import{_ as w,a as k}from"./CardContent.vue_vue_type_script_setup_true_lang-BdSOOKEE.js";import{_ as N,a as I}from"./CardTitle.vue_vue_type_script_setup_true_lang-_U7A67EF.js";import{_ as le}from"./CardFooter.vue_vue_type_script_setup_true_lang-Dla22Iba.js";import{_ as m}from"./Label.vue_vue_type_script_setup_true_lang-CrmozfEn.js";import{_ as oe}from"./PhoneInput.vue_vue_type_script_setup_true_lang-CQ3NFK5M.js";import{S as D}from"./sweetalert2.esm.all-BQIkj5Wb.js";import{_ as f}from"./InputError.vue_vue_type_script_setup_true_lang-BzLU122h.js";import{D as ie}from"./DeliveryRouteMap-EHwRjtIz.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-BbW58MAF.js";import"./createLucideIcon-B3Xwb4hu.js";import"./useForwardPropsEmits-cDFu6SMJ.js";import"./Teleport-DEuPysO7.js";import"./RovingFocusGroup-Du4voUoU.js";import"./Input.vue_vue_type_script_setup_true_lang-4kx_nddA.js";import"./LocationInput.vue_vue_type_style_index_0_scoped_807a495d_lang-C5_-5mdN.js";import"./search-BnX95n25.js";import"./x-DeaXVSEy.js";import"./VisuallyHidden-D7jdQsi1.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-uZfJ_4qz.js";import"./chevron-right-CVvHX4TP.js";import"./vue-leaflet.es-DXCGBEOL.js";import"./marker-icon-2x-1TirABJh.js";import"./marker-icon-B6h-nX3D.js";import"./marker-shadow-B9CpECYs.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const se={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ne={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},de={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},ae=["min"],ue={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},me={class:"mt-1 space-y-4"},fe={class:"flex items-center gap-4"},pe={key:0,class:"relative inline-block"},ve=["src"],ce={key:1,class:"relative inline-block"},_e=["src"],Le=L({__name:"Edit",props:{delivery:{},customers:{},invoices:{}},setup(F){const a=F;function E(i){if(!i)return"";if(typeof i=="string"&&/^\d{4}-\d{2}-\d{2}$/.test(i))return i;try{const e=new Date(i);if(isNaN(e.getTime()))return"";const d=e.getFullYear(),o=String(e.getMonth()+1).padStart(2,"0"),p=String(e.getDate()).padStart(2,"0");return`${d}-${o}-${p}`}catch{return""}}function S(i){if(!i)return"";let e=i.replace(/[^0-9]/g,"");return e.startsWith("63")?e=e.substring(2):e.startsWith("0")&&(e=e.substring(1)),e=e.substring(0,10),e.length===10?"+63"+e:i}const t=W({customer_id:a.delivery.customer_id,invoice_id:a.delivery.invoice_id||null,delivery_address:a.delivery.delivery_address,contact_person:a.delivery.contact_person,contact_phone:S(a.delivery.contact_phone),delivery_date:E(a.delivery.delivery_date),delivery_time:a.delivery.delivery_time,status:a.delivery.status,notes:a.delivery.notes||"",delivery_fee:a.delivery.delivery_fee.toString(),proof_of_delivery:null}),U=new Date().toISOString().split("T")[0],h=[{title:"Deliveries",href:"/deliveries"},{title:"Edit Delivery",href:`/deliveries/${a.delivery.id}/edit`}];function X(){t.contact_phone&&(t.contact_phone=S(t.contact_phone));const i=/^\+63\d{10}$/;if(t.contact_phone&&!i.test(t.contact_phone)){t.setError("contact_phone","Enter a valid 10-digit Philippine mobile number.");return}t.put(route("deliveries.update",a.delivery.id),{preserveScroll:!0,onSuccess:()=>{D.fire({toast:!0,position:"top-end",icon:"success",title:"Delivery updated successfully",showConfirmButton:!1,timer:3e3,timerProgressBar:!0})}})}const O=y(()=>[{value:null,label:"Select customer"},...a.customers.map(i=>({value:i.id,label:`${i.name}${i.company_name?` (${i.company_name})`:""}`}))]),q=y(()=>{if(!t.customer_id)return[{value:null,label:"Select invoice (select customer first)"}];const i=a.invoices.filter(e=>e.customer_id===t.customer_id);return[{value:null,label:"Select invoice (optional)"},...i.map(e=>({value:e.id,label:`Invoice #${e.id} - ${R(e.total_amount)}`}))]}),B=[{value:"pending",label:"Out for Delivery"},{value:"completed",label:"Delivered"},{value:"cancelled",label:"Cancelled"}],T=[{value:"09:00 AM - 12:00 PM",label:"09:00 AM - 12:00 PM"},{value:"12:00 PM - 03:00 PM",label:"12:00 PM - 03:00 PM"},{value:"03:00 PM - 06:00 PM",label:"03:00 PM - 06:00 PM"},{value:"06:00 PM - 09:00 PM",label:"06:00 PM - 09:00 PM"},{value:"Custom",label:"Custom"}];function R(i){return new Intl.NumberFormat("en-PH",{style:"currency",currency:"PHP",minimumFractionDigits:2}).format(i)}const G=y(()=>{if(!t.customer_id)return null;const i=a.customers.find(d=>d.id===t.customer_id);if(!(i!=null&&i.location))return null;let e=i.location;if(typeof e=="string")try{e=JSON.parse(e)}catch{return console.warn("Failed to parse customer location string:",e),null}if(e){let d=e.lat,o=e.lng;if(typeof d=="string"&&(d=parseFloat(d)),typeof o=="string"&&(o=parseFloat(o)),typeof d=="number"&&typeof o=="number"&&!isNaN(d)&&!isNaN(o)&&d>=-90&&d<=90&&o>=-180&&o<=180&&(d!=0||o!=0))return{lat:d,lng:o}}return console.warn("Invalid customer location data:",i.location),null}),A=y(()=>t.customer_id&&a.customers.find(i=>i.id===t.customer_id)||null);H(()=>t.customer_id,i=>{if(i){const e=a.customers.find(d=>d.id===i);e!=null&&e.address&&!t.delivery_address&&(t.delivery_address=e.address)}});const v=M(null),g=M(null),J=i=>{var o;const d=(o=i.target.files)==null?void 0:o[0];if(d){if(!d.type.startsWith("image/")){D.fire({icon:"error",title:"Invalid File Type",text:"Please select an image file (JPEG, PNG, GIF, etc.)"});return}if(d.size>5*1024*1024){D.fire({icon:"error",title:"File Too Large",text:"Please select an image smaller than 5MB"});return}t.proof_of_delivery=d;const p=new FileReader;p.onload=z=>{var $;v.value=($=z.target)==null?void 0:$.result},p.readAsDataURL(d)}},j=()=>{t.proof_of_delivery=null,v.value=null,g.value&&(g.value.value="")};return(i,e)=>{const d=Y("Icon");return x(),K(re,{breadcrumbs:h},{default:n(()=>[r(l(Q),{title:"Edit Delivery"}),e[30]||(e[30]=s("div",{class:"flex items-center justify-between mb-6"},[s("h1",{class:"text-2xl font-bold"},"Edit Delivery")],-1)),s("form",{onSubmit:e[11]||(e[11]=Z(o=>X(),["prevent"])),class:"space-y-6"},[r(w,null,{default:n(()=>[r(N,null,{default:n(()=>[r(I,null,{default:n(()=>e[12]||(e[12]=[u("Delivery Details")])),_:1,__:[12]})]),_:1}),r(k,{class:"space-y-6"},{default:n(()=>[s("div",se,[s("div",null,[r(m,{for:"customer_id"},{default:n(()=>e[13]||(e[13]=[u("Customer")])),_:1,__:[13]}),r(l(te),{modelValue:l(t).customer_id,"onUpdate:modelValue":e[0]||(e[0]=o=>l(t).customer_id=o),options:O.value,placeholder:"Select customer","search-placeholder":"Search customers...",class:"mt-1",required:""},null,8,["modelValue","options"]),r(f,{message:l(t).errors.customer_id},null,8,["message"])]),s("div",null,[r(m,{for:"invoice_id"},{default:n(()=>e[14]||(e[14]=[u("Invoice (Optional)")])),_:1,__:[14]}),r(l(P),{modelValue:l(t).invoice_id,"onUpdate:modelValue":e[1]||(e[1]=o=>l(t).invoice_id=o),options:q.value,placeholder:"Select invoice",class:"mt-1"},null,8,["modelValue","options"]),r(f,{message:l(t).errors.invoice_id},null,8,["message"])])]),s("div",null,[r(m,{for:"delivery_address"},{default:n(()=>e[15]||(e[15]=[u("Delivery Address")])),_:1,__:[15]}),c(s("textarea",{"onUpdate:modelValue":e[2]||(e[2]=o=>l(t).delivery_address=o),id:"delivery_address",class:"w-full rounded-md border border-input bg-transparent px-3 py-2 mt-1 text-foreground dark:bg-input/30 focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] focus-visible:outline-none",rows:"3",placeholder:"Enter complete delivery address",required:""},null,512),[[_,l(t).delivery_address]]),r(f,{message:l(t).errors.delivery_address},null,8,["message"])]),s("div",ne,[s("div",null,[r(m,{for:"contact_person"},{default:n(()=>e[16]||(e[16]=[u("Contact Person")])),_:1,__:[16]}),c(s("input",{"onUpdate:modelValue":e[3]||(e[3]=o=>l(t).contact_person=o),type:"text",id:"contact_person",class:"w-full rounded-md border border-input bg-transparent px-3 py-2 mt-1 text-foreground dark:bg-input/30 focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] focus-visible:outline-none",placeholder:"Enter contact person name",required:""},null,512),[[_,l(t).contact_person]]),r(f,{message:l(t).errors.contact_person},null,8,["message"])]),s("div",null,[r(m,{for:"contact_phone"},{default:n(()=>e[17]||(e[17]=[u("Contact Phone")])),_:1,__:[17]}),r(oe,{modelValue:l(t).contact_phone,"onUpdate:modelValue":e[4]||(e[4]=o=>l(t).contact_phone=o),id:"contact_phone",placeholder:"XXXXXXXXXX",required:"",class:"mt-1"},null,8,["modelValue"]),r(f,{message:l(t).errors.contact_phone},null,8,["message"])])]),s("div",de,[s("div",null,[r(m,{for:"delivery_date"},{default:n(()=>e[18]||(e[18]=[u("Delivery Date")])),_:1,__:[18]}),c(s("input",{"onUpdate:modelValue":e[5]||(e[5]=o=>l(t).delivery_date=o),type:"date",id:"delivery_date",min:l(U),class:"w-full rounded-md border border-input bg-transparent px-3 py-2 mt-1 text-foreground dark:bg-input/30 focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] focus-visible:outline-none",required:""},null,8,ae),[[_,l(t).delivery_date]]),r(f,{message:l(t).errors.delivery_date},null,8,["message"])]),s("div",null,[r(m,{for:"delivery_time"},{default:n(()=>e[19]||(e[19]=[u("Delivery Time")])),_:1,__:[19]}),r(l(P),{modelValue:l(t).delivery_time,"onUpdate:modelValue":e[6]||(e[6]=o=>l(t).delivery_time=o),options:T,placeholder:"Select delivery time",class:"mt-1",required:""},null,8,["modelValue"]),r(f,{message:l(t).errors.delivery_time},null,8,["message"])]),s("div",null,[r(m,{for:"status"},{default:n(()=>e[20]||(e[20]=[u("Status")])),_:1,__:[20]}),r(l(P),{modelValue:l(t).status,"onUpdate:modelValue":e[7]||(e[7]=o=>l(t).status=o),options:B,placeholder:"Select status",class:"mt-1",required:""},null,8,["modelValue"]),r(f,{message:l(t).errors.status},null,8,["message"])])]),s("div",ue,[s("div",null,[r(m,{for:"delivery_fee"},{default:n(()=>e[21]||(e[21]=[u("Delivery Fee")])),_:1,__:[21]}),c(s("input",{"onUpdate:modelValue":e[8]||(e[8]=o=>l(t).delivery_fee=o),type:"number",id:"delivery_fee",min:"0",step:"0.01",class:"w-full rounded-md border border-input bg-transparent px-3 py-2 mt-1 text-foreground dark:bg-input/30 focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] focus-visible:outline-none",placeholder:"0.00",required:""},null,512),[[_,l(t).delivery_fee]]),r(f,{message:l(t).errors.delivery_fee},null,8,["message"])]),s("div",null,[r(m,{for:"notes"},{default:n(()=>e[22]||(e[22]=[u("Notes")])),_:1,__:[22]}),c(s("textarea",{"onUpdate:modelValue":e[9]||(e[9]=o=>l(t).notes=o),id:"notes",class:"w-full rounded-md border border-input bg-transparent px-3 py-2 mt-1 text-foreground dark:bg-input/30 focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] focus-visible:outline-none",rows:"3",placeholder:"Enter any additional notes"},null,512),[[_,l(t).notes]]),r(f,{message:l(t).errors.notes},null,8,["message"])])]),s("div",null,[r(m,{for:"proof_of_delivery"},{default:n(()=>e[23]||(e[23]=[u("Proof of Delivery")])),_:1,__:[23]}),s("div",me,[s("div",fe,[s("input",{ref_key:"fileInputRef",ref:g,type:"file",id:"proof_of_delivery",accept:"image/*",onChange:J,class:"hidden"},null,544),r(l(b),{type:"button",variant:"outline",onClick:e[10]||(e[10]=o=>{var p;return(p=g.value)==null?void 0:p.click()}),class:"flex items-center gap-2"},{default:n(()=>[r(d,{name:"upload",class:"h-4 w-4"}),e[24]||(e[24]=u(" Choose Image "))]),_:1,__:[24]}),e[25]||(e[25]=s("span",{class:"text-sm text-muted-foreground"}," Accepted formats: JPEG, PNG, GIF (Max 5MB) ",-1))]),v.value?(x(),V("div",pe,[s("img",{src:v.value,alt:"Proof of delivery preview",class:"max-w-xs rounded-lg border border-border shadow-sm"},null,8,ve),r(l(b),{type:"button",variant:"destructive",size:"sm",onClick:j,class:"absolute -top-2 -right-2 h-6 w-6 rounded-full p-0"},{default:n(()=>[r(d,{name:"x",class:"h-3 w-3"})]),_:1})])):C("",!0),a.delivery.proof_of_delivery_url&&!v.value?(x(),V("div",ce,[s("img",{src:a.delivery.proof_of_delivery_url,alt:"Current proof of delivery",class:"max-w-xs rounded-lg border border-border shadow-sm"},null,8,_e),e[26]||(e[26]=s("div",{class:"mt-2 text-sm text-muted-foreground"}," Current proof of delivery image ",-1))])):C("",!0)]),r(f,{message:l(t).errors.proof_of_delivery},null,8,["message"])])]),_:1})]),_:1}),r(w,null,{default:n(()=>[r(N,null,{default:n(()=>[r(I,null,{default:n(()=>e[27]||(e[27]=[u("Delivery Route")])),_:1,__:[27]})]),_:1}),r(k,null,{default:n(()=>{var o;return[r(ie,{"customer-location":G.value,"delivery-address":l(t).delivery_address||((o=A.value)==null?void 0:o.address),"map-height":"400px"},null,8,["customer-location","delivery-address"])]}),_:1})]),_:1}),r(w,null,{default:n(()=>[r(le,{class:"flex gap-2 justify-end"},{default:n(()=>[r(l(b),{type:"submit",variant:"default"},{default:n(()=>e[28]||(e[28]=[u("Update Delivery")])),_:1,__:[28]}),r(l(ee),{href:i.route("deliveries.index")},{default:n(()=>[r(l(b),{type:"button",variant:"ghost"},{default:n(()=>e[29]||(e[29]=[u("Cancel")])),_:1,__:[29]})]),_:1},8,["href"])]),_:1})]),_:1})],32)]),_:1,__:[30]})}}});export{Le as default};
