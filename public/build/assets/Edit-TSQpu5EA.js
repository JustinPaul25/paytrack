import{d as G,D as H,p as y,c as k,o as _,w as n,a as t,b as i,u as s,g as J,t as f,E as K,h as d,x,y as h,e as $,F as R,r as X,f as w,S as Y}from"./app-D813Jm8L.js";import{_ as v}from"./index-CviG3rkw.js";import{_ as V}from"./Select.vue_vue_type_script_setup_true_lang-CPhyC29e.js";import{_ as C}from"./SearchSelect.vue_vue_type_script_setup_true_lang-Qi6ME5Qz.js";import{_ as Z}from"./AppLayout.vue_vue_type_script_setup_true_lang-BXVphV0c.js";import{_ as I,a as S}from"./CardContent.vue_vue_type_script_setup_true_lang-Bd0-TUSa.js";import{_ as q,a as U}from"./CardTitle.vue_vue_type_script_setup_true_lang-CWkeiFc_.js";import{_ as ee}from"./CardFooter.vue_vue_type_script_setup_true_lang-DIhaTN3o.js";import{_ as p}from"./Label.vue_vue_type_script_setup_true_lang-BknKjZ5m.js";import{S as te}from"./sweetalert2.esm.all-BQIkj5Wb.js";import{_ as c}from"./InputError.vue_vue_type_script_setup_true_lang-CtJMeWTd.js";import{T as oe}from"./trash-2-DYjRZx4U.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-CNZgJ1qe.js";import"./createLucideIcon-DbTVWaVY.js";import"./useForwardPropsEmits-HaL_en7z.js";import"./Teleport-DZRgFwKg.js";import"./RovingFocusGroup-CmZI1JuB.js";import"./Input.vue_vue_type_script_setup_true_lang-BEc-VNKq.js";import"./LocationInput.vue_vue_type_style_index_0_scoped_0fdfc5f8_lang-CV5BHZq7.js";import"./search-DpmRAyJc.js";import"./x-Bm3VYXWf.js";import"./VisuallyHidden-CSeGT6UP.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-JzmBcxvg.js";import"./chevron-right-By_NXETe.js";const ie={class:"flex items-center justify-between mb-6"},se={class:"text-2xl font-bold"},le={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ne={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},re={class:"flex justify-between items-center"},ae={class:"space-y-3"},de={class:"flex justify-between items-center mb-3"},ue={class:"font-medium text-sm"},me={class:"grid grid-cols-1 md:grid-cols-4 gap-3"},pe=["id","onUpdate:modelValue","onInput"],ce={key:0,class:"text-[11px] text-gray-500 mt-1"},_e=["id","onUpdate:modelValue","onInput"],fe={class:"w-full rounded-md border border-input bg-transparent px-2 py-1 mt-1 text-sm text-foreground dark:bg-input/30 h-8 flex items-center"},ve={class:"mt-4 pt-3 border-t"},ge={class:"flex justify-end"},be={class:"text-right space-y-1"},ye={class:"text-base font-medium"},ze=G({__name:"Edit",props:{invoice:{},customers:{},products:{}},setup(P){const u=P,l=H({customer_id:u.invoice.customer_id,status:u.invoice.status,payment_method:u.invoice.payment_method,invoice_type:u.invoice.invoice_type||"walk_in",notes:u.invoice.notes||"",invoice_items:u.invoice.invoice_items.map(o=>({id:o.id,product_id:o.product_id,quantity:o.quantity,price:o.price,total:o.total}))}),T=[{title:"Invoices",href:"/invoices"},{title:"Edit Invoice",href:`/invoices/${u.invoice.id}/edit`}],D=y(()=>l.invoice_items.reduce((o,e)=>o+e.total,0)),E=y(()=>!l.customer_id||!l.invoice_items.length?!1:l.invoice_items.some(o=>!!o.product_id&&o.quantity>0&&o.price>=0));function B(){l.invoice_items.push({id:void 0,product_id:null,quantity:1,price:0,total:0})}function F(o){l.invoice_items.length>1&&l.invoice_items.splice(o,1)}function g(o){const e=l.invoice_items[o];e.product_id&&e.quantity&&e.price?e.total=e.quantity*e.price:e.total=0}function j(o){const e=l.invoice_items[o];if(e.product_id){const r=u.products.find(a=>a.id===e.product_id);r&&(e.price=r.selling_price,g(o))}}function N(o){g(o)}function O(o){g(o)}function A(){l.post(route("invoices.update",u.invoice.id),{preserveScroll:!0,onSuccess:()=>{te.fire({toast:!0,position:"top-end",icon:"success",title:"Invoice updated successfully",showConfirmButton:!1,timer:3e3,timerProgressBar:!0})},method:"post"})}function b(o){return l.errors[o]}const M=y(()=>[{value:null,label:"Select customer"},...u.customers.map(o=>({value:o.id,label:`${o.name}${o.company_name?` (${o.company_name})`:""}`}))]),Q=[{value:"draft",label:"Draft"},{value:"pending",label:"Pending"},{value:"completed",label:"Completed"},{value:"cancelled",label:"Cancelled"}],W=[{value:"cash",label:"Cash"},{value:"credit",label:"Credit"}],z=[{value:"walk_in",label:"Walk-in"},{value:"delivery",label:"Delivery"}];function L(){return[{value:null,label:"Select product"},...u.products.map(o=>({value:o.id,label:`${o.name} - ₱${o.selling_price.toFixed(2)}`}))]}return(o,e)=>(_(),k(Z,{breadcrumbs:T},{default:n(()=>[t(s(J),{title:"Edit Invoice"}),i("div",ie,[i("h1",se,"Edit Invoice #"+f(u.invoice.id),1)]),i("form",{onSubmit:K(A,["prevent"]),class:"space-y-6"},[t(I,null,{default:n(()=>[t(q,null,{default:n(()=>[t(U,null,{default:n(()=>e[5]||(e[5]=[d("Invoice Details")])),_:1,__:[5]})]),_:1}),t(S,{class:"space-y-6"},{default:n(()=>[i("div",le,[i("div",null,[t(p,{for:"customer_id"},{default:n(()=>e[6]||(e[6]=[d("Customer")])),_:1,__:[6]}),t(s(C),{modelValue:s(l).customer_id,"onUpdate:modelValue":e[0]||(e[0]=r=>s(l).customer_id=r),options:M.value,placeholder:"Select customer","search-placeholder":"Search customers...",class:"mt-1",required:""},null,8,["modelValue","options"]),t(c,{message:s(l).errors.customer_id},null,8,["message"])]),i("div",null,[t(p,{for:"status"},{default:n(()=>e[7]||(e[7]=[d("Status")])),_:1,__:[7]}),t(s(V),{modelValue:s(l).status,"onUpdate:modelValue":e[1]||(e[1]=r=>s(l).status=r),options:Q,placeholder:"Select status",class:"mt-1",required:""},null,8,["modelValue"]),e[8]||(e[8]=i("div",{class:"text-[11px] text-gray-500 mt-1"}," Draft: still editing, Pending: awaiting payment, Completed: paid, Cancelled: void. ",-1)),t(c,{message:s(l).errors.status},null,8,["message"])])]),i("div",ne,[i("div",null,[t(p,{for:"payment_method"},{default:n(()=>e[9]||(e[9]=[d("Payment Method")])),_:1,__:[9]}),t(s(V),{modelValue:s(l).payment_method,"onUpdate:modelValue":e[2]||(e[2]=r=>s(l).payment_method=r),options:W,placeholder:"Select payment method",class:"mt-1",required:""},null,8,["modelValue"]),e[10]||(e[10]=i("div",{class:"text-[11px] text-gray-500 mt-1"}," Pick how the customer will pay (Cash or Credit). ",-1)),t(c,{message:s(l).errors.payment_method},null,8,["message"])]),i("div",null,[t(p,{for:"invoice_type"},{default:n(()=>e[11]||(e[11]=[d("Invoice Type")])),_:1,__:[11]}),t(s(V),{modelValue:s(l).invoice_type,"onUpdate:modelValue":e[3]||(e[3]=r=>s(l).invoice_type=r),options:z,placeholder:"Select invoice type",class:"mt-1",required:""},null,8,["modelValue"]),e[12]||(e[12]=i("div",{class:"text-[11px] text-gray-500 mt-1"}," Walk-in: Customer purchases in-store. Delivery: Items will be delivered. ",-1)),t(c,{message:s(l).errors.invoice_type},null,8,["message"])])]),i("div",null,[t(p,{for:"notes"},{default:n(()=>e[13]||(e[13]=[d("Notes")])),_:1,__:[13]}),x(i("textarea",{id:"notes","onUpdate:modelValue":e[4]||(e[4]=r=>s(l).notes=r),class:"w-full rounded-md border border-input bg-transparent px-3 py-2 mt-1 text-foreground dark:bg-input/30 focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] focus-visible:outline-none",rows:"3"},null,512),[[h,s(l).notes]]),t(c,{message:s(l).errors.notes},null,8,["message"])])]),_:1})]),_:1}),t(I,null,{default:n(()=>[t(q,null,{default:n(()=>[i("div",re,[t(U,null,{default:n(()=>e[14]||(e[14]=[d("Invoice Items")])),_:1,__:[14]}),t(s(v),{type:"button",variant:"outline",onClick:B},{default:n(()=>e[15]||(e[15]=[i("span",{class:"mr-2"},"+",-1),d(" Add Item ")])),_:1,__:[15]})])]),_:1}),t(S,null,{default:n(()=>[i("div",ae,[(_(!0),$(R,null,X(s(l).invoice_items,(r,a)=>(_(),$("div",{key:a,class:"border rounded-md p-3"},[i("div",de,[i("h4",ue,"Item "+f(a+1),1),s(l).invoice_items.length>1?(_(),k(s(v),{key:0,type:"button",variant:"ghost",size:"sm",class:"h-7 w-7 p-0 text-red-500 hover:text-red-600 hover:bg-red-50 dark:hover:bg-red-950/20",onClick:m=>F(a)},{default:n(()=>[t(s(oe),{class:"h-4 w-4"})]),_:2},1032,["onClick"])):w("",!0)]),i("div",me,[i("div",null,[t(p,{for:`product_id_${a}`,class:"text-xs"},{default:n(()=>e[16]||(e[16]=[d("Product")])),_:2,__:[16]},1032,["for"]),t(s(C),{modelValue:r.product_id,"onUpdate:modelValue":[m=>r.product_id=m,m=>j(a)],options:L(),placeholder:"Select product","search-placeholder":"Search products...",class:"mt-1 h-8",required:""},null,8,["modelValue","onUpdate:modelValue","options"]),t(c,{message:b(`invoice_items.${a}.product_id`)},null,8,["message"])]),i("div",null,[t(p,{for:`quantity_${a}`,class:"text-xs"},{default:n(()=>e[17]||(e[17]=[d("Quantity")])),_:2,__:[17]},1032,["for"]),x(i("input",{id:`quantity_${a}`,"onUpdate:modelValue":m=>r.quantity=m,type:"number",min:"1",class:"w-full rounded-md border border-input bg-transparent px-2 py-1 mt-1 text-sm text-foreground dark:bg-input/30 focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] focus-visible:outline-none h-8",onInput:m=>N(a),required:""},null,40,pe),[[h,r.quantity,void 0,{number:!0}]]),r.product_id?(_(),$("div",ce," In stock: "+f((u.products.find(m=>m.id===r.product_id)||{stock:0}).stock),1)):w("",!0),t(c,{message:b(`invoice_items.${a}.quantity`)},null,8,["message"])]),i("div",null,[t(p,{for:`price_${a}`,class:"text-xs"},{default:n(()=>e[18]||(e[18]=[d("Price")])),_:2,__:[18]},1032,["for"]),x(i("input",{id:`price_${a}`,"onUpdate:modelValue":m=>r.price=m,type:"number",min:"0",step:"0.01",class:"w-full rounded-md border border-input bg-transparent px-2 py-1 mt-1 text-sm text-foreground dark:bg-input/30 focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] focus-visible:outline-none h-8",onInput:m=>O(a),required:""},null,40,_e),[[h,r.price,void 0,{number:!0}]]),t(c,{message:b(`invoice_items.${a}.price`)},null,8,["message"])]),i("div",null,[t(p,{class:"text-xs"},{default:n(()=>e[19]||(e[19]=[d("Total")])),_:1,__:[19]}),i("div",fe," ₱"+f(r.total.toFixed(2)),1)])])]))),128))]),i("div",ve,[i("div",ge,[i("div",be,[i("div",ye,"Total Amount: ₱"+f(D.value.toFixed(2)),1),e[20]||(e[20]=i("div",{class:"text-xs text-muted-foreground mt-1"},"12% VAT is included in price",-1))])])])]),_:1})]),_:1}),t(I,null,{default:n(()=>[t(ee,{class:"flex gap-2 justify-end"},{default:n(()=>[t(s(v),{type:"submit",disabled:!E.value,variant:"default"},{default:n(()=>e[21]||(e[21]=[d("Update Invoice")])),_:1,__:[21]},8,["disabled"]),t(s(Y),{href:o.route("invoices.index")},{default:n(()=>[t(s(v),{type:"button",variant:"ghost"},{default:n(()=>e[22]||(e[22]=[d("Cancel")])),_:1,__:[22]})]),_:1},8,["href"])]),_:1})]),_:1})],32)]),_:1}))}});export{ze as default};
