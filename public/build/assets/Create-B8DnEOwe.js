import{d as H,D as J,l as _,c as w,o as v,w as a,a as e,b as n,u as r,g as R,q as X,e as d,A as h,B as $,f as k,F as Y,r as Z,h as I,t as f,S as tt}from"./app-t40oy0qQ.js";import{_ as b}from"./index-VOqVSyLk.js";import{_ as S}from"./Select.vue_vue_type_script_setup_true_lang-GnkHSpv1.js";import{_ as T}from"./SearchSelect.vue_vue_type_script_setup_true_lang-4bo9FMVG.js";import{_ as et}from"./AppLayout.vue_vue_type_script_setup_true_lang-CylBytAS.js";import{_ as q,a as B}from"./CardContent.vue_vue_type_script_setup_true_lang-fpDXvKRZ.js";import{_ as P,a as U}from"./CardTitle.vue_vue_type_script_setup_true_lang-DibdpYuD.js";import{_ as ot}from"./CardFooter.vue_vue_type_script_setup_true_lang-Dpl3lURZ.js";import{_ as m}from"./Label.vue_vue_type_script_setup_true_lang-DGf8PETm.js";import{S as C}from"./sweetalert2.esm.all-BQIkj5Wb.js";import{_ as c}from"./InputError.vue_vue_type_script_setup_true_lang-ojNQ0enz.js";import{T as st}from"./trash-2-D5ct3Eu6.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-CbeqhPF_.js";import"./createLucideIcon-DERR9B5J.js";import"./RovingFocusGroup-CUnu6A6r.js";import"./LocationInput.vue_vue_type_style_index_0_scoped_0fe2f881_lang-DVnAmXFJ.js";import"./Input.vue_vue_type_script_setup_true_lang-BHBZDHs5.js";import"./search-BYJYKdgl.js";import"./VisuallyHidden-BBCMANA8.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-CiqG73Ph.js";const it={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},nt={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},rt={class:"flex justify-between items-center"},lt={class:"space-y-3"},at={class:"flex justify-between items-center mb-3"},ut={class:"font-medium text-sm"},dt={class:"grid grid-cols-1 md:grid-cols-4 gap-3"},mt=["id","onUpdate:modelValue","onInput"],ct={key:0,class:"text-[11px] text-gray-500 mt-1"},pt=["id","onUpdate:modelValue","onInput"],ft={class:"w-full rounded-md border border-input bg-transparent px-2 py-1 mt-1 text-sm text-foreground dark:bg-input/30 h-8 flex items-center"},_t={class:"mt-4 pt-3 border-t"},vt={class:"flex justify-end"},gt={class:"text-right space-y-1"},bt={class:"text-sm text-muted-foreground"},yt={class:"text-sm text-muted-foreground"},xt={class:"text-base font-medium"},Et=H({__name:"Create",props:{customers:{},products:{}},setup(j){const p=j,s=J({customer_id:null,status:"draft",payment_method:"cash",notes:"",invoice_items:[{product_id:null,quantity:1,price:0,total:0}],create_another:void 0}),A=[{title:"Invoices",href:"/invoices"},{title:"Create Invoice",href:"/invoices/create"}],y=_(()=>s.invoice_items.reduce((i,t)=>i+t.total,0)),V=_(()=>y.value*.12),F=_(()=>y.value+V.value),O=_(()=>!s.customer_id||!s.invoice_items.length?!1:s.invoice_items.some(i=>!!i.product_id&&i.quantity>0&&i.price>=0));function D(){s.invoice_items.push({product_id:null,quantity:1,price:0,total:0})}function Q(i){s.invoice_items.length>1&&s.invoice_items.splice(i,1)}function g(i){const t=s.invoice_items[i];t.product_id&&t.quantity&&t.price?t.total=t.quantity*t.price:t.total=0}function N(i){const t=s.invoice_items[i];if(t.product_id){const o=p.products.find(l=>l.id===t.product_id);o&&(t.price=o.selling_price,g(i))}}function E(i){const t=s.invoice_items[i];if(t.product_id&&t.quantity){const o=p.products.find(l=>l.id===t.product_id);o&&t.quantity>o.stock&&(t.quantity=o.stock,C.fire({icon:"info",title:"Quantity Adjusted",text:`Quantity for "${o.name}" has been adjusted to the maximum available stock (${o.stock} units).`,confirmButtonText:"OK",toast:!0,position:"top-end",timer:3e3,timerProgressBar:!0}))}g(i)}function M(i){g(i)}function K(i=!1){for(let t=0;t<s.invoice_items.length;t++){const o=s.invoice_items[t];if(o.product_id&&o.quantity){const l=p.products.find(u=>u.id===o.product_id);l&&o.quantity>l.stock&&(o.quantity=l.stock,g(t),C.fire({icon:"warning",title:"Quantity Auto-Adjusted",text:`Quantity for "${l.name}" was automatically adjusted to ${l.stock} units due to stock limitations.`,confirmButtonText:"OK"}))}}i?s.create_another=1:delete s.create_another,s.post(route("invoices.store"),{preserveScroll:!0,onSuccess:()=>{C.fire({toast:!0,position:"top-end",icon:"success",title:"Invoice created successfully",showConfirmButton:!1,timer:3e3,timerProgressBar:!0}),i&&(s.reset(),s.invoice_items=[{product_id:null,quantity:1,price:0,total:0}])}})}function x(i){return s.errors[i]}const W=_(()=>[{value:null,label:"Select customer"},...p.customers.map(i=>({value:i.id,label:`${i.name}${i.company_name?` (${i.company_name})`:""}`}))]),z=[{value:"draft",label:"Draft"},{value:"pending",label:"Pending"},{value:"completed",label:"Completed"},{value:"cancelled",label:"Cancelled"}],L=[{value:"cash",label:"Cash"},{value:"bank_transfer",label:"Bank Transfer"},{value:"e-wallet",label:"E-Wallet"},{value:"other",label:"Other"}];function G(){return[{value:null,label:"Select product"},...p.products.map(i=>({value:i.id,label:`${i.name}`}))]}return(i,t)=>(v(),w(et,{breadcrumbs:A},{default:a(()=>[e(r(R),{title:"Create Invoice"}),t[20]||(t[20]=n("div",{class:"flex items-center justify-between mb-6"},[n("h1",{class:"text-2xl font-bold"},"Create Invoice")],-1)),n("form",{onSubmit:t[4]||(t[4]=X(o=>K(),["prevent"])),class:"space-y-6"},[e(q,null,{default:a(()=>[e(P,null,{default:a(()=>[e(U,null,{default:a(()=>t[5]||(t[5]=[d("Invoice Details")])),_:1,__:[5]})]),_:1}),e(B,{class:"space-y-6"},{default:a(()=>[n("div",it,[n("div",null,[e(m,{for:"customer_id"},{default:a(()=>t[6]||(t[6]=[d("Customer")])),_:1,__:[6]}),e(r(T),{modelValue:r(s).customer_id,"onUpdate:modelValue":t[0]||(t[0]=o=>r(s).customer_id=o),options:W.value,placeholder:"Select customer","search-placeholder":"Search customers...",class:"mt-1",required:""},null,8,["modelValue","options"]),e(c,{message:r(s).errors.customer_id},null,8,["message"])]),n("div",null,[e(m,{for:"status"},{default:a(()=>t[7]||(t[7]=[d("Status")])),_:1,__:[7]}),e(r(S),{modelValue:r(s).status,"onUpdate:modelValue":t[1]||(t[1]=o=>r(s).status=o),options:z,placeholder:"Select status",class:"mt-1",required:""},null,8,["modelValue"]),t[8]||(t[8]=n("div",{class:"text-[11px] text-gray-500 mt-1"}," Draft: still editing, Pending: awaiting payment, Completed: paid, Cancelled: void. ",-1)),e(c,{message:r(s).errors.status},null,8,["message"])])]),n("div",nt,[n("div",null,[e(m,{for:"payment_method"},{default:a(()=>t[9]||(t[9]=[d("Payment Method")])),_:1,__:[9]}),e(r(S),{modelValue:r(s).payment_method,"onUpdate:modelValue":t[2]||(t[2]=o=>r(s).payment_method=o),options:L,placeholder:"Select payment method",class:"mt-1",required:""},null,8,["modelValue"]),t[10]||(t[10]=n("div",{class:"text-[11px] text-gray-500 mt-1"}," Pick how the customer will pay (e.g. Cash, Bank Transfer, E‑Wallet). ",-1)),e(c,{message:r(s).errors.payment_method},null,8,["message"])])]),n("div",null,[e(m,{for:"notes"},{default:a(()=>t[11]||(t[11]=[d("Notes")])),_:1,__:[11]}),h(n("textarea",{id:"notes","onUpdate:modelValue":t[3]||(t[3]=o=>r(s).notes=o),class:"w-full rounded-md border border-input bg-transparent px-3 py-2 mt-1 text-foreground dark:bg-input/30 focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] focus-visible:outline-none",rows:"3"},null,512),[[$,r(s).notes]]),e(c,{message:r(s).errors.notes},null,8,["message"])])]),_:1})]),_:1}),e(q,null,{default:a(()=>[e(P,null,{default:a(()=>[n("div",rt,[e(U,null,{default:a(()=>t[12]||(t[12]=[d("Invoice Items")])),_:1,__:[12]}),e(r(b),{type:"button",variant:"outline",onClick:D},{default:a(()=>t[13]||(t[13]=[n("span",{class:"mr-2"},"+",-1),d(" Add Item ")])),_:1,__:[13]})])]),_:1}),e(B,null,{default:a(()=>[n("div",lt,[(v(!0),k(Y,null,Z(r(s).invoice_items,(o,l)=>(v(),k("div",{key:l,class:"border rounded-md p-3"},[n("div",at,[n("h4",ut,"Item "+f(l+1),1),r(s).invoice_items.length>1?(v(),w(r(b),{key:0,type:"button",variant:"ghost",size:"sm",class:"h-7 w-7 p-0 text-red-500 hover:text-red-600 hover:bg-red-50 dark:hover:bg-red-950/20",onClick:u=>Q(l)},{default:a(()=>[e(r(st),{class:"h-4 w-4"})]),_:2},1032,["onClick"])):I("",!0)]),n("div",dt,[n("div",null,[e(m,{for:`product_id_${l}`,class:"text-xs"},{default:a(()=>t[14]||(t[14]=[d("Product")])),_:2,__:[14]},1032,["for"]),e(r(T),{modelValue:o.product_id,"onUpdate:modelValue":[u=>o.product_id=u,u=>N(l)],options:G(),placeholder:"Select product","search-placeholder":"Search products...",class:"mt-1 h-8",required:""},null,8,["modelValue","onUpdate:modelValue","options"]),e(c,{message:x(`invoice_items.${l}.product_id`)},null,8,["message"])]),n("div",null,[e(m,{for:`quantity_${l}`,class:"text-xs"},{default:a(()=>t[15]||(t[15]=[d("Quantity")])),_:2,__:[15]},1032,["for"]),h(n("input",{id:`quantity_${l}`,"onUpdate:modelValue":u=>o.quantity=u,type:"number",min:"1",class:"w-full rounded-md border border-input bg-transparent px-2 py-1 mt-1 text-sm text-foreground dark:bg-input/30 focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] focus-visible:outline-none h-8",onInput:u=>E(l),required:""},null,40,mt),[[$,o.quantity,void 0,{number:!0}]]),o.product_id?(v(),k("div",ct," In stock: "+f((p.products.find(u=>u.id===o.product_id)||{stock:0}).stock),1)):I("",!0),e(c,{message:x(`invoice_items.${l}.quantity`)},null,8,["message"])]),n("div",null,[e(m,{for:`price_${l}`,class:"text-xs"},{default:a(()=>t[16]||(t[16]=[d("Price")])),_:2,__:[16]},1032,["for"]),h(n("input",{id:`price_${l}`,"onUpdate:modelValue":u=>o.price=u,type:"number",min:"0",step:"0.01",class:"w-full rounded-md border border-input bg-transparent px-2 py-1 mt-1 text-sm text-foreground dark:bg-input/30 focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] focus-visible:outline-none h-8",onInput:u=>M(l),required:""},null,40,pt),[[$,o.price,void 0,{number:!0}]]),e(c,{message:x(`invoice_items.${l}.price`)},null,8,["message"])]),n("div",null,[e(m,{class:"text-xs"},{default:a(()=>t[17]||(t[17]=[d("Total")])),_:1,__:[17]}),n("div",ft," ₱"+f(o.total.toFixed(2)),1)])])]))),128))]),n("div",_t,[n("div",vt,[n("div",gt,[n("div",bt,"Subtotal: ₱"+f(y.value.toFixed(2)),1),n("div",yt,"VAT (12%): ₱"+f(V.value.toFixed(2)),1),n("div",xt,"Total Amount: ₱"+f(F.value.toFixed(2)),1)])])])]),_:1})]),_:1}),e(q,null,{default:a(()=>[e(ot,{class:"flex gap-2 justify-end"},{default:a(()=>[e(r(b),{type:"submit",disabled:!O.value,variant:"default"},{default:a(()=>t[18]||(t[18]=[d("Create Invoice")])),_:1,__:[18]},8,["disabled"]),e(r(tt),{href:i.route("invoices.index")},{default:a(()=>[e(r(b),{type:"button",variant:"ghost"},{default:a(()=>t[19]||(t[19]=[d("Cancel")])),_:1,__:[19]})]),_:1},8,["href"])]),_:1})]),_:1})],32)]),_:1,__:[20]}))}});export{Et as default};
