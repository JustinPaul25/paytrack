import{d as E,I as M,l as _,c as h,o as p,w as n,a as r,b as o,u,g as Y,q as z,e as a,B as w,C as O,f as x,F as L,r as G,h as C,t as c,S as H}from"./app-B8QIr-yB.js";import{_ as y}from"./index-CMa7p19_.js";import{_ as J}from"./Select.vue_vue_type_script_setup_true_lang-Yokc8jy6.js";import{_ as R}from"./SearchSelect.vue_vue_type_script_setup_true_lang-Bw3u6K2a.js";import{_ as W}from"./AppLayout.vue_vue_type_script_setup_true_lang-soH5-Krj.js";import{_ as k,a as S}from"./CardContent.vue_vue_type_script_setup_true_lang-aSdnrcFY.js";import{_ as V,a as T}from"./CardTitle.vue_vue_type_script_setup_true_lang-BTzcK9vs.js";import{_ as X}from"./CardFooter.vue_vue_type_script_setup_true_lang-CGMKjujW.js";import{_ as f}from"./Label.vue_vue_type_script_setup_true_lang-BgIPOEA2.js";import{S as v}from"./sweetalert2.esm.all-BQIkj5Wb.js";import{_ as b}from"./InputError.vue_vue_type_script_setup_true_lang-C7x7uEqI.js";import{T as Z}from"./trash-2-Dl0eqfML.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-CpXueLgs.js";import"./createLucideIcon-3f2jlhvw.js";import"./RovingFocusGroup-Cg7u14CM.js";import"./LocationInput.vue_vue_type_style_index_0_scoped_0fe2f881_lang-CVWryCuy.js";import"./Input.vue_vue_type_script_setup_true_lang-GHTKCvWK.js";import"./search-Jjh9EsSI.js";import"./VisuallyHidden-BAokwaoo.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-C0oox_ik.js";import"./chevron-right-BFhBpJLr.js";const tt={class:"flex justify-between items-center"},et={class:"space-y-3"},rt={class:"flex justify-between items-center mb-3"},ot={class:"font-medium text-sm"},st={class:"grid grid-cols-1 md:grid-cols-3 gap-3"},it=["id","onUpdate:modelValue","max","onInput"],dt={key:0,class:"text-[11px] text-gray-500 mt-1"},nt={class:"w-full rounded-md border border-input bg-transparent px-2 py-1 mt-1 text-sm text-foreground dark:bg-input/30 h-8 flex items-center"},ut={class:"mt-4 pt-3 border-t"},at={class:"flex justify-end"},lt={class:"text-right space-y-1"},mt={class:"text-sm text-muted-foreground"},ct={class:"text-sm text-muted-foreground"},pt={class:"text-base font-medium"},Qt=E({__name:"Create",props:{customer_id:{},products:{}},setup(B){const m=B,i=M({customer_id:m.customer_id,delivery_type:"delivery",notes:"",order_items:[{product_id:null,quantity:1}]}),j=[{title:"Orders",href:"/orders"},{title:"Create Order",href:"/orders/create"}],g=_(()=>i.order_items.reduce((s,t)=>{if(t.product_id&&t.quantity){const e=m.products.find(d=>d.id===t.product_id);if(e)return s+t.quantity*e.selling_price}return s},0)),$=_(()=>g.value*.12),A=_(()=>g.value+$.value),I=_(()=>!i.customer_id||!i.order_items.length?!1:i.order_items.some(s=>!!s.product_id&&s.quantity>0));function Q(){i.order_items.push({product_id:null,quantity:1})}function F(s){i.order_items.length>1&&i.order_items.splice(s,1)}function P(s){const t=i.order_items[s];if(t.product_id&&t.quantity){const e=m.products.find(d=>d.id===t.product_id);e&&t.quantity>e.stock&&(t.quantity=e.stock,v.fire({icon:"info",title:"Quantity Adjusted",text:`Quantity for "${e.name}" has been adjusted to the maximum available stock (${e.stock} units).`,confirmButtonText:"OK",toast:!0,position:"top-end",timer:3e3,timerProgressBar:!0}))}}function N(s){const t=i.order_items[s];if(t.product_id&&t.quantity){const e=m.products.find(d=>d.id===t.product_id);e&&t.quantity>e.stock&&(t.quantity=e.stock,v.fire({icon:"info",title:"Quantity Adjusted",text:`Quantity for "${e.name}" has been adjusted to the maximum available stock (${e.stock} units).`,confirmButtonText:"OK",toast:!0,position:"top-end",timer:3e3,timerProgressBar:!0}))}}function U(){for(let s=0;s<i.order_items.length;s++){const t=i.order_items[s];if(t.product_id&&t.quantity){const e=m.products.find(d=>d.id===t.product_id);e&&t.quantity>e.stock&&(t.quantity=e.stock,v.fire({icon:"warning",title:"Quantity Auto-Adjusted",text:`Quantity for "${e.name}" was automatically adjusted to ${e.stock} units due to stock limitations.`,confirmButtonText:"OK"}))}}i.post(route("orders.store"),{preserveScroll:!0,onSuccess:()=>{v.fire({toast:!0,position:"top-end",icon:"success",title:"Order created successfully",text:"Your order is pending approval from staff.",showConfirmButton:!1,timer:3e3,timerProgressBar:!0})}})}function q(s){return i.errors[s]}function D(){return[{value:null,label:"Select product"},...m.products.map(s=>({value:s.id,label:`${s.name} (Stock: ${s.stock})`}))]}function K(s){const t=i.order_items[s];if(t.product_id&&t.quantity){const e=m.products.find(d=>d.id===t.product_id);if(e)return t.quantity*e.selling_price}return 0}return(s,t)=>(p(),h(W,{breadcrumbs:j},{default:n(()=>[r(u(Y),{title:"Create Order"}),t[14]||(t[14]=o("div",{class:"flex items-center justify-between mb-6"},[o("h1",{class:"text-2xl font-bold"},"Create Order")],-1)),o("form",{onSubmit:t[2]||(t[2]=z(e=>U(),["prevent"])),class:"space-y-6"},[r(k,null,{default:n(()=>[r(V,null,{default:n(()=>[r(T,null,{default:n(()=>t[3]||(t[3]=[a("Order Details")])),_:1,__:[3]})]),_:1}),r(S,{class:"space-y-6"},{default:n(()=>[t[6]||(t[6]=o("div",{class:"bg-yellow-50 border border-yellow-200 rounded-md p-4"},[o("p",{class:"text-sm text-yellow-800"},[o("strong",null,"Note:"),a(" Your order will be reviewed by staff for product availability before approval. Once approved, an invoice will be automatically generated. ")])],-1)),o("div",null,[r(f,{for:"delivery_type"},{default:n(()=>t[4]||(t[4]=[a("Delivery Type *")])),_:1,__:[4]}),r(u(J),{id:"delivery_type",modelValue:u(i).delivery_type,"onUpdate:modelValue":t[0]||(t[0]=e=>u(i).delivery_type=e),options:[{value:"pickup",label:"Pickup"},{value:"delivery",label:"Delivery"}],class:"mt-1",required:""},null,8,["modelValue"]),r(b,{message:u(i).errors.delivery_type},null,8,["message"])]),o("div",null,[r(f,{for:"notes"},{default:n(()=>t[5]||(t[5]=[a("Notes (Optional)")])),_:1,__:[5]}),w(o("textarea",{id:"notes","onUpdate:modelValue":t[1]||(t[1]=e=>u(i).notes=e),class:"w-full rounded-md border border-input bg-transparent px-3 py-2 mt-1 text-foreground dark:bg-input/30 focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] focus-visible:outline-none",rows:"3",placeholder:"Add any special instructions or notes for your order..."},null,512),[[O,u(i).notes]]),r(b,{message:u(i).errors.notes},null,8,["message"])])]),_:1,__:[6]})]),_:1}),r(k,null,{default:n(()=>[r(V,null,{default:n(()=>[o("div",tt,[r(T,null,{default:n(()=>t[7]||(t[7]=[a("Order Items")])),_:1,__:[7]}),r(u(y),{type:"button",variant:"outline",onClick:Q},{default:n(()=>t[8]||(t[8]=[o("span",{class:"mr-2"},"+",-1),a(" Add Item ")])),_:1,__:[8]})])]),_:1}),r(S,null,{default:n(()=>[o("div",et,[(p(!0),x(L,null,G(u(i).order_items,(e,d)=>(p(),x("div",{key:d,class:"border rounded-md p-3"},[o("div",rt,[o("h4",ot,"Item "+c(d+1),1),u(i).order_items.length>1?(p(),h(u(y),{key:0,type:"button",variant:"ghost",size:"sm",class:"h-7 w-7 p-0 text-red-500 hover:text-red-600 hover:bg-red-50 dark:hover:bg-red-950/20",onClick:l=>F(d)},{default:n(()=>[r(u(Z),{class:"h-4 w-4"})]),_:2},1032,["onClick"])):C("",!0)]),o("div",st,[o("div",null,[r(f,{for:`product_id_${d}`,class:"text-xs"},{default:n(()=>t[9]||(t[9]=[a("Product")])),_:2,__:[9]},1032,["for"]),r(u(R),{modelValue:e.product_id,"onUpdate:modelValue":[l=>e.product_id=l,l=>P(d)],options:D(),placeholder:"Select product","search-placeholder":"Search products...",class:"mt-1 h-8",required:""},null,8,["modelValue","onUpdate:modelValue","options"]),r(b,{message:q(`order_items.${d}.product_id`)},null,8,["message"])]),o("div",null,[r(f,{for:`quantity_${d}`,class:"text-xs"},{default:n(()=>t[10]||(t[10]=[a("Quantity")])),_:2,__:[10]},1032,["for"]),w(o("input",{id:`quantity_${d}`,"onUpdate:modelValue":l=>e.quantity=l,type:"number",min:"1",max:e.product_id?(m.products.find(l=>l.id===e.product_id)||{stock:0}).stock:void 0,class:"w-full rounded-md border border-input bg-transparent px-2 py-1 mt-1 text-sm text-foreground dark:bg-input/30 focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] focus-visible:outline-none h-8",onInput:l=>N(d),required:""},null,40,it),[[O,e.quantity,void 0,{number:!0}]]),e.product_id?(p(),x("div",dt," In stock: "+c((m.products.find(l=>l.id===e.product_id)||{stock:0}).stock),1)):C("",!0),r(b,{message:q(`order_items.${d}.quantity`)},null,8,["message"])]),o("div",null,[r(f,{class:"text-xs"},{default:n(()=>t[11]||(t[11]=[a("Total")])),_:1,__:[11]}),o("div",nt," ₱"+c(K(d).toFixed(2)),1)])])]))),128))]),o("div",ut,[o("div",at,[o("div",lt,[o("div",mt,"Subtotal: ₱"+c(g.value.toFixed(2)),1),o("div",ct,"VAT (12%): ₱"+c($.value.toFixed(2)),1),o("div",pt,"Total Amount: ₱"+c(A.value.toFixed(2)),1)])])])]),_:1})]),_:1}),r(k,null,{default:n(()=>[r(X,{class:"flex gap-2 justify-end"},{default:n(()=>[r(u(y),{type:"submit",disabled:!I.value,variant:"default"},{default:n(()=>t[12]||(t[12]=[a("Submit Order")])),_:1,__:[12]},8,["disabled"]),r(u(H),{href:s.route("orders.index")},{default:n(()=>[r(u(y),{type:"button",variant:"ghost"},{default:n(()=>t[13]||(t[13]=[a("Cancel")])),_:1,__:[13]})]),_:1},8,["href"])]),_:1})]),_:1})],32)]),_:1,__:[14]}))}});export{Qt as default};
